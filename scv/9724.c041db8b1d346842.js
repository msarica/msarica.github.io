"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9724],{9724:(Oe,w,l)=>{l.r(w),l.d(w,{GameMapPageModule:()=>Qe});var u=l(7590),f=l(9808),x=l(4182),G=l(1393),k=l(591),T=l(5529),y=l(7625),E=l(8328),t=l(2096),R=l(4725),Z=l(655),X=l(5485),K=l(2811),$=l(3632),U=l(9972),I=l(1911),C=l(1729);class S extends $.Z{constructor(n){super(),this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),n&&("function"==typeof n.getSimplifiedGeometry?this.setGeometry(n):this.setProperties(n))}clone(){const n=new S(this.hasProperties()?this.getProperties():null);n.setGeometryName(this.getGeometryName());const e=this.getGeometry();e&&n.setGeometry(e.clone());const i=this.getStyle();return i&&n.setStyle(i),n}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&((0,C.bN)(this.geometryChangeKey_),this.geometryChangeKey_=null);const n=this.getGeometry();n&&(this.geometryChangeKey_=(0,C.oL)(n,U.Z.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(n){this.set(this.geometryName_,n)}setStyle(n){this.style_=n,this.styleFunction_=n?function B(s){if("function"==typeof s)return s;{let n;return Array.isArray(s)?n=s:((0,I.h)("function"==typeof s.getZIndex,41),n=[s]),function(){return n}}}(n):void 0,this.changed()}setId(n){this.id_=n,this.changed()}setGeometryName(n){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=n,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}const H=S;var j=l(187),V=l(5672),z=l(4848),q=l(759),W=l(109),ee=l(9570),te=l(2815),P=l(9889),ne=l(8214),ie=l(4587),se=l(2402),v=l(760),g=l(119),b=l(9466);const N=class oe{constructor(n){this.rbush_=new se(n),this.items_={}}insert(n,e){const i={minX:n[0],minY:n[1],maxX:n[2],maxY:n[3],value:e};this.rbush_.insert(i),this.items_[(0,g.sq)(e)]=i}load(n,e){const i=new Array(e.length);for(let o=0,r=e.length;o<r;o++){const c=n[o],a=e[o],h={minX:c[0],minY:c[1],maxX:c[2],maxY:c[3],value:a};i[o]=h,this.items_[(0,g.sq)(a)]=h}this.rbush_.load(i)}remove(n){const e=(0,g.sq)(n),i=this.items_[e];return delete this.items_[e],null!==this.rbush_.remove(i)}update(n,e){const i=this.items_[(0,g.sq)(e)];(0,v.fS)([i.minX,i.minY,i.maxX,i.maxY],n)||(this.remove(e),this.insert(n,e))}getAll(){return this.rbush_.all().map(function(e){return e.value})}getInExtent(n){return this.rbush_.search({minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}).map(function(o){return o.value})}forEach(n){return this.forEach_(this.getAll(),n)}forEachInExtent(n,e){return this.forEach_(this.getInExtent(n),e)}forEach_(n,e){let i;for(let o=0,r=n.length;o<r;o++)if(i=e(n[o]),i)return i;return i}isEmpty(){return(0,b.x)(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(n){const e=this.rbush_.toJSON();return(0,v.T9)(e.minX,e.minY,e.maxX,e.maxY,n)}concat(n){this.rbush_.load(n.rbush_.all());for(const e in n.items_)this.items_[e]=n.items_[e]}};var re=l(4702);var M=l(1345);function ae(s,n){return[[-1/0,-1/0,1/0,1/0]]}l(6003);var ce=l(2456);function Y(s,n){return function(e,i,o,r,c){const a=this;!function le(s,n,e,i,o,r,c){const a=new XMLHttpRequest;a.open("GET","function"==typeof s?s(e,i,o):s,!0),"arraybuffer"==n.getType()&&(a.responseType="arraybuffer"),a.withCredentials=false,a.onload=function(h){if(!a.status||a.status>=200&&a.status<300){const d=n.getType();let m;"json"==d||"text"==d?m=a.responseText:"xml"==d?(m=a.responseXML,m||(m=(new DOMParser).parseFromString(a.responseText,"application/xml"))):"arraybuffer"==d&&(m=a.response),m?r(n.readFeatures(m,{extent:e,featureProjection:o}),n.readProjection(m)):c()}else c()},a.onerror=c,a.send()}(s,n,e,i,o,function(h,d){a.addFeatures(h),void 0!==r&&r(h)},c||M.Zn)}}class _ extends ne.ZP{constructor(n,e,i){super(n),this.feature=e,this.features=i}}const he=class ue extends re.Z{constructor(n){super({attributions:(n=n||{}).attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:void 0===n.wrapX||n.wrapX}),this.loader_=M.Zn,this.format_=n.format,this.overlaps_=void 0===n.overlaps||n.overlaps,this.url_=n.url,void 0!==n.loader?this.loader_=n.loader:void 0!==this.url_&&((0,I.h)(this.format_,7),this.loader_=Y(this.url_,this.format_)),this.strategy_=void 0!==n.strategy?n.strategy:ae;const e=void 0===n.useSpatialIndex||n.useSpatialIndex;let i,o;this.featuresRtree_=e?new N:null,this.loadedExtentsRtree_=new N,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null,Array.isArray(n.features)?o=n.features:n.features&&(i=n.features,o=i.getArray()),!e&&void 0===i&&(i=new te.Z(o)),void 0!==o&&this.addFeaturesInternal(o),void 0!==i&&this.bindFeaturesCollection_(i)}addFeature(n){this.addFeatureInternal(n),this.changed()}addFeatureInternal(n){const e=(0,g.sq)(n);if(!this.addToIndex_(e,n))return void(this.featuresCollection_&&this.featuresCollection_.remove(n));this.setupChangeEvents_(e,n);const i=n.getGeometry();if(i){const o=i.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(o,n)}else this.nullGeometryFeatures_[e]=n;this.dispatchEvent(new _("addfeature",n))}setupChangeEvents_(n,e){this.featureChangeKeys_[n]=[(0,C.oL)(e,U.Z.CHANGE,this.handleFeatureChange_,this),(0,C.oL)(e,ie.Z.PROPERTYCHANGE,this.handleFeatureChange_,this)]}addToIndex_(n,e){let i=!0;const o=e.getId();return void 0!==o&&(o.toString()in this.idIndex_?i=!1:this.idIndex_[o.toString()]=e),i&&((0,I.h)(!(n in this.uidIndex_),30),this.uidIndex_[n]=e),i}addFeatures(n){this.addFeaturesInternal(n),this.changed()}addFeaturesInternal(n){const e=[],i=[],o=[];for(let r=0,c=n.length;r<c;r++){const a=n[r],h=(0,g.sq)(a);this.addToIndex_(h,a)&&i.push(a)}for(let r=0,c=i.length;r<c;r++){const a=i[r],h=(0,g.sq)(a);this.setupChangeEvents_(h,a);const d=a.getGeometry();if(d){const m=d.getExtent();e.push(m),o.push(a)}else this.nullGeometryFeatures_[h]=a}if(this.featuresRtree_&&this.featuresRtree_.load(e,o),this.hasListener("addfeature"))for(let r=0,c=i.length;r<c;r++)this.dispatchEvent(new _("addfeature",i[r]))}bindFeaturesCollection_(n){let e=!1;this.addEventListener("addfeature",function(i){e||(e=!0,n.push(i.feature),e=!1)}),this.addEventListener("removefeature",function(i){e||(e=!0,n.remove(i.feature),e=!1)}),n.addEventListener(P.Z.ADD,function(i){e||(e=!0,this.addFeature(i.element),e=!1)}.bind(this)),n.addEventListener(P.Z.REMOVE,function(i){e||(e=!0,this.removeFeature(i.element),e=!1)}.bind(this)),this.featuresCollection_=n}clear(n){if(n){for(const i in this.featureChangeKeys_)this.featureChangeKeys_[i].forEach(C.bN);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){const i=function(o){this.removeFeatureInternal(o)}.bind(this);this.featuresRtree_.forEach(i);for(const o in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[o])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const e=new _("clear");this.dispatchEvent(e),this.changed()}forEachFeature(n){if(this.featuresRtree_)return this.featuresRtree_.forEach(n);this.featuresCollection_&&this.featuresCollection_.forEach(n)}forEachFeatureAtCoordinateDirect(n,e){return this.forEachFeatureInExtent([n[0],n[1],n[0],n[1]],function(o){if(o.getGeometry().intersectsCoordinate(n))return e(o)})}forEachFeatureInExtent(n,e){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(n,e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureIntersectingExtent(n,e){return this.forEachFeatureInExtent(n,function(i){if(i.getGeometry().intersectsExtent(n)){const r=e(i);if(r)return r}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let n;return this.featuresCollection_?n=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(n=this.featuresRtree_.getAll(),(0,b.x)(this.nullGeometryFeatures_)||(0,ce.l7)(n,Object.values(this.nullGeometryFeatures_))),n}getFeaturesAtCoordinate(n){const e=[];return this.forEachFeatureAtCoordinateDirect(n,function(i){e.push(i)}),e}getFeaturesInExtent(n,e){if(this.featuresRtree_){if(!(e&&e.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(n);const o=(0,v.MV)(n,e);return[].concat(...o.map(r=>this.featuresRtree_.getInExtent(r)))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(n,e){const i=n[0],o=n[1];let r=null;const c=[NaN,NaN];let a=1/0;const h=[-1/0,-1/0,1/0,1/0];return e=e||M.uX,this.featuresRtree_.forEachInExtent(h,function(d){if(e(d)){const m=d.getGeometry(),Ye=a;if(a=m.closestPointXY(i,o,c,a),a<Ye){r=d;const A=Math.sqrt(a);h[0]=i-A,h[1]=o-A,h[2]=i+A,h[3]=o+A}}}),r}getExtent(n){return this.featuresRtree_.getExtent(n)}getFeatureById(n){const e=this.idIndex_[n.toString()];return void 0!==e?e:null}getFeatureByUid(n){const e=this.uidIndex_[n];return void 0!==e?e:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(n){const e=n.target,i=(0,g.sq)(e),o=e.getGeometry();if(o){const c=o.getExtent();i in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[i],this.featuresRtree_&&this.featuresRtree_.insert(c,e)):this.featuresRtree_&&this.featuresRtree_.update(c,e)}else i in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(e),this.nullGeometryFeatures_[i]=e);const r=e.getId();if(void 0!==r){const c=r.toString();this.idIndex_[c]!==e&&(this.removeFromIdIndex_(e),this.idIndex_[c]=e)}else this.removeFromIdIndex_(e),this.uidIndex_[i]=e;this.changed(),this.dispatchEvent(new _("changefeature",e))}hasFeature(n){const e=n.getId();return void 0!==e?e in this.idIndex_:(0,g.sq)(n)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&(0,b.x)(this.nullGeometryFeatures_):!this.featuresCollection_||0===this.featuresCollection_.getLength()}loadFeatures(n,e,i){const o=this.loadedExtentsRtree_,r=this.strategy_(n,e,i);for(let c=0,a=r.length;c<a;++c){const h=r[c];o.forEachInExtent(h,function(m){return(0,v.r4)(m.extent,h)})||(++this.loadingExtentsCount_,this.dispatchEvent(new _("featuresloadstart")),this.loader_.call(this,h,e,i,function(m){--this.loadingExtentsCount_,this.dispatchEvent(new _("featuresloadend",void 0,m))}.bind(this),function(){--this.loadingExtentsCount_,this.dispatchEvent(new _("featuresloaderror"))}.bind(this)),o.insert(h,{extent:h.slice()}))}this.loading=!(this.loader_.length<4)&&this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(n){const e=this.loadedExtentsRtree_;let i;e.forEachInExtent(n,function(o){if((0,v.fS)(o.extent,n))return i=o,!0}),i&&e.remove(i)}removeFeature(n){if(!n)return;const e=(0,g.sq)(n);e in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[e]:this.featuresRtree_&&this.featuresRtree_.remove(n),this.removeFeatureInternal(n)&&this.changed()}removeFeatureInternal(n){const e=(0,g.sq)(n),i=this.featureChangeKeys_[e];if(!i)return;i.forEach(C.bN),delete this.featureChangeKeys_[e];const o=n.getId();return void 0!==o&&delete this.idIndex_[o.toString()],delete this.uidIndex_[e],this.dispatchEvent(new _("removefeature",n)),n}removeFromIdIndex_(n){let e=!1;for(const i in this.idIndex_)if(this.idIndex_[i]===n){delete this.idIndex_[i],e=!0;break}return e}setLoader(n){this.loader_=n}setUrl(n){(0,I.h)(this.format_,7),this.url_=n,this.setLoader(Y(n,this.format_))}};var F=l(4974),de=l(7224),me=l(2780);const fe=["mapElementRef"];let ge=(()=>{class s{constructor(e,i,o){this.locationService=e,this.gameService=i,this.info=o,this.destroy$=new T.xQ,this.features={}}ngOnInit(){return(0,Z.mG)(this,void 0,void 0,function*(){!this.game||(this.setUpMap(),this.setupSubscriptions())})}setupSubscriptions(){const e=this.locationService.watchLocation();e.pipe((0,de.P)()).subscribe(()=>{this.setUpMarkers(),this.playerFeature=this.setUpUser()}),e.pipe((0,y.R)(this.destroy$)).subscribe(i=>{this.updateUserLocation(i)}),this.gameService.enablePoints$.pipe((0,y.R)(this.destroy$)).subscribe(i=>{this.enableMarkers(i)}),this.gameService.disablePoints$.pipe((0,y.R)(this.destroy$)).subscribe(i=>{this.disableMarkers(i)})}setUpMap(){const[e,i]=this.game.location,o=this.game.zoom,r=(0,F.xA)([i,e]);this.map=new X.Z({view:new K.ZP({center:r,zoom:o}),layers:[new z.Z({source:new V.Z})],target:"ol-map"});const c=new he({features:[]});this.markerSource=c;const a=new q.Z({source:c});this.map.addLayer(a),this.map.on("moveend",h=>{const d=this.map.getView().getZoom();console.log(d)}),this.map.on("click",h=>{const d=this.map.forEachFeatureAtPixel(h.pixel,m=>m);!d||this.onFeatureClicked(h,d)}),setTimeout(()=>{this.map.setTarget(this.mapElementRef.nativeElement)})}onFeatureClicked(e,i){console.log(i);const o=i.get("data");if(!o.clickable)return;const r=(0,F.FY)(i.getGeometry().getCoordinates()),c=(0,F.FY)(this.playerFeature.getGeometry().getCoordinates()),a=this.locationService.distance(r[1],c[1],r[0],c[0]),h=this.gameService.isCloseEnough(a);console.log(a),this.gameService.pointSelected({point:o,distance:a,isClose:h})}setUpMarkers(){const e=this.gameService.getPoints();this.game.points.forEach(i=>{var o,r;null===(o=e[i.name])||void 0===o||!o.visible||(console.log(i.name,null===(r=e[i.name])||void 0===r?void 0:r.visible),this.showMarker(i))})}showMarker(e){const[i,o]=e.location,r=(0,F.xA)([o,i]);this.addMarker(r,Object.assign({clickable:!0,img:e.img||"assets/x_marker.png"},e))}getRegexExpr(e){return e.map(i=>{const o=i.replace(/\*/g,".*");return new RegExp(o,"g")})}enableMarkers(e){const i=this.getRegexExpr(e);this.game.points.filter(o=>i.some(r=>o.name.match(r))).forEach(o=>{o.visible=!0,this.showMarker(o)})}disableMarkers(e){const i=this.getRegexExpr(e),o=this.game.points.filter(r=>i.some(c=>r.name.match(c))).map(r=>r.name);for(const r of o){const c=this.features[r];!c||(c.forEach(a=>this.markerSource.removeFeature(a)),delete this.features[r])}}setUpUser(){return this.addMarker([0,0],{clickable:!1,img:"assets/current_location.png"})}ngOnDestroy(){console.log("destroying"),this.destroy$.next(),this.destroy$.unsubscribe()}addMarker(e,i){const o=new H({geometry:new j.Z(e),data:i}),r=new W.ZP({image:new ee.Z({anchor:[.5,46],anchorXUnits:"fraction",anchorYUnits:"pixels",src:i.img})});return o.setStyle(r),this.markerSource.addFeature(o),this.features[i.name]=[...this.features[i.name]||[],o],o}updateUserLocation(e){!this.playerFeature||this.playerFeature.getGeometry().setCoordinates((0,F.Z_)(e))}ngAfterContentInit(){}}return s.\u0275fac=function(e){return new(e||s)(t.Y36(me.a),t.Y36(E.h),t.Y36(R.C))},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-map"]],viewQuery:function(e,i){if(1&e&&t.Gf(fe,7),2&e){let o;t.iGM(o=t.CRH())&&(i.mapElementRef=o.first)}},inputs:{game:"game"},decls:3,vars:0,consts:[["id","ol-map",1,"map-container"],["mapElementRef",""]],template:function(e,i){1&e&&(t.ynx(0),t._UZ(1,"div",0,1),t.BQk())},styles:["[_nghost-%COMP%]{display:flex;flex-grow:1;flex-direction:column;height:100vh}.map-container[_ngcontent-%COMP%]{flex-grow:1}"],changeDetection:0}),s})();var O=l(2198);class J{constructor(n){this.gameService=n}onSubmit(n){const e=this.isCorrect(n),i=Array.isArray(n)?n:[n];this.gameService.answerSelected(this.point,e?"correct":"incorrect",i)}}function pe(s,n){if(1&s&&(t.TgZ(0,"ion-item")(1,"ion-label"),t._uU(2),t.qZA(),t._UZ(3,"ion-radio",4),t.qZA()),2&s){const e=n.$implicit;t.xp6(2),t.Oqu(e),t.xp6(1),t.Q6J("value",e)}}function _e(s,n){if(1&s){const e=t.EpF();t.TgZ(0,"ion-list")(1,"ion-item-group")(2,"ion-item-divider")(3,"ion-label"),t._uU(4," Options "),t.qZA()(),t.TgZ(5,"ion-radio-group",1),t.NdJ("ngModelChange",function(o){t.CHM(e);const r=t.oxw();return t.KtG(r.selected=o)}),t.YNc(6,pe,4,2,"ion-item",2),t.qZA()(),t.TgZ(7,"ion-button",3),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.select())}),t._uU(8," Submit "),t.qZA()()}if(2&s){const e=t.oxw();t.xp6(5),t.Q6J("ngModel",e.selected),t.xp6(1),t.Q6J("ngForOf",e.point.body.choices),t.xp6(1),t.Q6J("disabled",!e.selected)}}let L=(()=>{class s extends J{constructor(e){super(e),this.answered=!1}set point(e){this._point=e,this.answered=!1}get point(){return this._point}ngOnInit(){}select(){this.onSubmit(this.selected)}isCorrect(e){const i=this.point.body.possibleAnswers.includes(e);return i&&(this.answered=!0),i}}return s.\u0275fac=function(e){return new(e||s)(t.Y36(E.h))},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-multiple-choice"]],inputs:{point:"point"},features:[t.qOj],decls:1,vars:1,consts:[[4,"ngIf"],[3,"ngModel","ngModelChange"],[4,"ngFor","ngForOf"],["expand","block",3,"disabled","click"],["slot","end",3,"value"]],template:function(e,i){1&e&&t.YNc(0,_e,9,3,"ion-list",0),2&e&&t.Q6J("ngIf",!i.answered)},dependencies:[u.YG,u.Ie,u.rH,u.Ub,u.Q$,u.q_,u.B7,u.se,u.U5,u.QI,f.sg,f.O5,x.JJ,x.On],encapsulation:2}),s})();function xe(s,n){if(1&s){const e=t.EpF();t.ynx(0),t.TgZ(1,"ion-item")(2,"ion-input",1),t.NdJ("ngModelChange",function(o){t.CHM(e);const r=t.oxw();return t.KtG(r.input=o)})("keyup.enter",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.submit())}),t.qZA()(),t.TgZ(3,"ion-button",2),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.submit())}),t._uU(4," Submit "),t.qZA(),t.BQk()}if(2&s){const e=t.oxw();t.xp6(2),t.Q6J("ngModel",e.input),t.xp6(1),t.Q6J("disabled",!(null!=e.input&&e.input.length))}}let D=(()=>{class s extends J{constructor(e){super(e),this.input="",this.found=!1}set point(e){this._point=e,this.found=!1,this.input=""}get point(){return this._point}ngOnInit(){}submit(){var e;null!==(e=this.input)&&void 0!==e&&e.length&&this.onSubmit(this.input)}isCorrect(e){if(!e.length)return;e=e.trim().toLowerCase();const i=this.point.body.possibleAnswers.some(o=>o.trim().toLowerCase()===e);return this.found=i,i}}return s.\u0275fac=function(e){return new(e||s)(t.Y36(E.h))},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-short-answer"]],inputs:{point:"point"},features:[t.qOj],decls:1,vars:1,consts:[[4,"ngIf"],["placeholder","Enter your answer",3,"ngModel","ngModelChange","keyup.enter"],["expand","block",3,"disabled","click"]],template:function(e,i){1&e&&t.YNc(0,xe,5,2,"ng-container",0),2&e&&t.Q6J("ngIf",!i.found)},dependencies:[u.YG,u.pK,u.Ie,u.j9,f.O5,x.JJ,x.On],encapsulation:2}),s})();function ye(s,n){1&s&&(t.ynx(0),t.TgZ(1,"ion-item"),t._uU(2," You are not close to this location! "),t.qZA(),t.BQk())}function Ce(s,n){if(1&s&&(t.ynx(0),t._UZ(1,"app-short-answer",4),t.BQk()),2&s){const e=t.oxw(3);t.xp6(1),t.Q6J("point",e.pointAny)}}function Ee(s,n){if(1&s&&(t.ynx(0),t._UZ(1,"app-multiple-choice",4),t.BQk()),2&s){const e=t.oxw(3);t.xp6(1),t.Q6J("point",e.pointAny)}}function ve(s,n){if(1&s){const e=t.EpF();t.ynx(0),t.TgZ(1,"ion-item",5),t.NdJ("click",function(){t.CHM(e);const o=t.oxw(3);return t.KtG(o.ok())}),t._uU(2," OK "),t.qZA(),t.BQk()}}function Fe(s,n){if(1&s&&(t.TgZ(0,"p"),t._uU(1),t.qZA()),2&s){const e=t.oxw(5);t.xp6(1),t.hij(" ",e.point.body.messageIfCorrect," ")}}function Ie(s,n){if(1&s){const e=t.EpF();t.TgZ(0,"div"),t._uU(1," correct "),t.YNc(2,Fe,2,1,"p",0),t.TgZ(3,"ion-button",6),t.NdJ("click",function(){t.CHM(e);const o=t.oxw(4);return t.KtG(o.ok())}),t._uU(4," Next "),t.qZA()()}if(2&s){const e=t.oxw(4);t.xp6(2),t.Q6J("ngIf",e.point.body.messageIfCorrect)}}function Ae(s,n){if(1&s&&(t.TgZ(0,"p"),t._uU(1),t.qZA()),2&s){const e=t.oxw(5);t.xp6(1),t.hij(" ",e.point.body.messageIfIncorrect," ")}}function Ge(s,n){if(1&s){const e=t.EpF();t.ynx(0),t._uU(1," incorrect "),t.YNc(2,Ae,2,1,"p",0),t.TgZ(3,"ion-footer")(4,"ion-button",6),t.NdJ("click",function(){t.CHM(e);const o=t.oxw(4);return t.KtG(o.giveUp())}),t._uU(5," Give Up "),t.qZA()(),t.BQk()}if(2&s){const e=t.oxw(4);t.xp6(2),t.Q6J("ngIf",e.point.body.messageIfIncorrect)}}function Te(s,n){if(1&s&&(t.ynx(0),t.YNc(1,Ie,5,1,"div",0),t.YNc(2,Ge,6,1,"ng-container",0),t.BQk()),2&s){const e=t.oxw(3);t.xp6(1),t.Q6J("ngIf",e.isCorrect),t.xp6(1),t.Q6J("ngIf",!e.isCorrect)}}function Re(s,n){if(1&s&&(t.ynx(0),t.TgZ(1,"ion-item-group")(2,"ion-item-divider")(3,"ion-label"),t._uU(4),t.qZA()(),t.TgZ(5,"div"),t._uU(6),t.qZA()(),t.ynx(7,1),t.YNc(8,Ce,2,1,"ng-container",2),t.YNc(9,Ee,2,1,"ng-container",2),t.YNc(10,ve,3,0,"ng-container",3),t.BQk(),t.YNc(11,Te,3,2,"ng-container",0),t.BQk()),2&s){const e=t.oxw(2);t.xp6(4),t.hij(" ",e.point.body.title," "),t.xp6(2),t.hij(" ",e.point.body.text," "),t.xp6(1),t.Q6J("ngSwitch",e.point.body.type),t.xp6(1),t.Q6J("ngSwitchCase","shortanswer"),t.xp6(1),t.Q6J("ngSwitchCase","multiplechoice"),t.xp6(2),t.Q6J("ngIf",e.showFeedback)}}function Se(s,n){if(1&s&&(t.ynx(0),t.TgZ(1,"ion-item")(2,"ion-label"),t._uU(3),t.qZA()(),t.BQk()),2&s){const e=t.oxw(2);t.xp6(3),t.hij(" ",e.point.body.afterExplored," ")}}function be(s,n){if(1&s&&(t.ynx(0)(1,1),t.YNc(2,ye,3,0,"ng-container",2),t.YNc(3,Re,12,6,"ng-container",2),t.YNc(4,Se,4,1,"ng-container",2),t.BQk()()),2&s){const e=t.oxw();t.xp6(1),t.Q6J("ngSwitch",e.status),t.xp6(1),t.Q6J("ngSwitchCase","not_close"),t.xp6(1),t.Q6J("ngSwitchCase","close"),t.xp6(1),t.Q6J("ngSwitchCase","explored")}}let Me=(()=>{class s{constructor(e,i,o){this.gameService=e,this.menuController=i,this.info=o,this.destroy$=new T.xQ,this.showFeedback=!1,this.isCorrect=!1,this.status="not_close"}set selectedPoint(e){this._selectedPoint=e,this.showFeedback=!1,e&&(this.status=e.explored?"explored":e.isClose?"close":"not_close")}get selectedPoint(){return this._selectedPoint}get pointAny(){return this.point}get point(){return this._selectedPoint.point}ngOnInit(){const e=this.gameService.answerSelected$.pipe((0,y.R)(this.destroy$));e.pipe((0,O.h)(i=>["correct","incorrect"].includes(i.result))).subscribe(i=>{this.showFeedback=!0,this.isCorrect="correct"===i.result}),e.pipe((0,O.h)(i=>"ok"===i.result)).subscribe(i=>{this.gameService.moveNext(this.point),this.menuController.close()})}ok(){this.gameService.answerSelected(this.point,"ok")}giveUp(){return(0,Z.mG)(this,void 0,void 0,function*(){!(yield this.info.confirm("Give up","Are you sure to give up?"))||this.ok()})}ngOnDestroy(){console.log("destro"),this.destroy$.next(),this.destroy$.unsubscribe()}}return s.\u0275fac=function(e){return new(e||s)(t.Y36(E.h),t.Y36(u._q),t.Y36(R.C))},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-game-point"]],inputs:{selectedPoint:"selectedPoint"},decls:1,vars:1,consts:[[4,"ngIf"],[3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],[3,"point"],["button","",3,"click"],["expand","block",3,"click"]],template:function(e,i){1&e&&t.YNc(0,be,5,4,"ng-container",0),2&e&&t.Q6J("ngIf",i.selectedPoint)},dependencies:[u.YG,u.fr,u.Ie,u.rH,u.Ub,u.Q$,f.O5,f.RF,f.n9,f.ED,L,D]}),s})();function we(s,n){if(1&s&&(t.ynx(0),t._UZ(1,"app-map",10),t.BQk()),2&s){const e=t.oxw();t.xp6(1),t.Q6J("game",e.game)}}function Ze(s,n){1&s&&(t.TgZ(0,"div"),t._uU(1," GAME NOT LOADED "),t.qZA())}const Ue=[{path:"",component:(()=>{class s{constructor(e,i,o,r){this.menuController=e,this.gameService=i,this.router=o,this.info=r,this.title$=new k.X("Menu"),this.destroy$=new T.xQ}ngOnInit(){this.menuController.swipeGesture(!1),this.gameService.pointSelected$.pipe((0,y.R)(this.destroy$)).subscribe(e=>{!e||(console.log(e),this.selectedPoint=e,this.title$.next(e.point.title),this.menuController.open())}),this.gameService.gameSelected$.pipe((0,y.R)(this.destroy$)).subscribe(e=>{!e||(this.game=e)})}ngOnDestroy(){this.destroy$.next(),this.destroy$.unsubscribe()}}return s.\u0275fac=function(e){return new(e||s)(t.Y36(u._q),t.Y36(E.h),t.Y36(G.F0),t.Y36(R.C))},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-game-map"]],features:[t._Bn([u._q])],decls:23,vars:8,consts:[["contentId","main-content"],[1,"ion-text-center"],[1,"ion-padding"],[3,"selectedPoint"],["id","main-content",1,"ion-page"],[3,"translucent"],[3,"fullscreen"],["collapse","condense"],["size","large"],[4,"ngIf"],[3,"game"]],template:function(e,i){1&e&&(t.TgZ(0,"ion-menu",0)(1,"ion-header",1)(2,"ion-toolbar")(3,"ion-title"),t._uU(4),t.ALo(5,"async"),t.qZA()()(),t.TgZ(6,"ion-content",2)(7,"ion-menu-toggle")(8,"ion-button"),t._uU(9,"Close"),t.qZA()(),t._UZ(10,"app-game-point",3),t.qZA()(),t.TgZ(11,"div",4)(12,"ion-header",5)(13,"ion-toolbar")(14,"ion-title"),t._uU(15," Map "),t.qZA()()(),t.TgZ(16,"ion-content",6)(17,"ion-header",7)(18,"ion-toolbar")(19,"ion-title",8),t._uU(20,"Game"),t.qZA()()(),t.YNc(21,we,2,1,"ng-container",9),t.YNc(22,Ze,2,0,"div",9),t.qZA()()),2&e&&(t.xp6(4),t.Oqu(t.lcZ(5,6,i.title$)),t.xp6(6),t.Q6J("selectedPoint",i.selectedPoint),t.xp6(2),t.Q6J("translucent",!0),t.xp6(4),t.Q6J("fullscreen",!0),t.xp6(5),t.Q6J("ngIf",i.game),t.xp6(1),t.Q6J("ngIf",!i.game))},dependencies:[u.YG,u.W2,u.Gu,u.z0,u.zc,u.wd,u.sr,f.O5,ge,Me,f.Ov]}),s})()}];let Pe=(()=>{class s{}return s.\u0275fac=function(e){return new(e||s)},s.\u0275mod=t.oAB({type:s}),s.\u0275inj=t.cJS({imports:[G.Bz.forChild(Ue),G.Bz]}),s})(),Ne=(()=>{class s{}return s.\u0275fac=function(e){return new(e||s)},s.\u0275mod=t.oAB({type:s}),s.\u0275inj=t.cJS({imports:[u.Pc,f.ez,x.u5]}),s})(),Qe=(()=>{class s{}return s.\u0275fac=function(e){return new(e||s)},s.\u0275mod=t.oAB({type:s}),s.\u0275inj=t.cJS({imports:[u.Pc,f.ez,x.u5,Pe,Ne]}),s})()}}]);