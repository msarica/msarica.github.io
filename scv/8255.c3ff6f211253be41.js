(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8255],{8255:(ns,ti,Q)=>{"use strict";Q.r(ti),Q.d(ti,{GameMapPageModule:()=>bc});var q=Q(7590),V=Q(9808),ae=Q(4182),Zt=Q(1393),we=Q(591),Jt=Q(5529),le=Q(7625),Le=Q(8328),g=Q(2096),he=Q(4725),Ge=Q(655);const y=class Ye{constructor(t){this.type=t,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}},P=class w{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}};function L(s,t){return s>t?1:s<t?-1:0}function k(s,t,e){const i=s.length;if(s[0]<=t)return 0;if(t<=s[i-1])return i-1;{let n;if(e>0){for(n=1;n<i;++n)if(s[n]<t)return n-1}else if(e<0){for(n=1;n<i;++n)if(s[n]<=t)return n}else for(n=1;n<i;++n){if(s[n]==t)return n;if(s[n]<t)return"function"==typeof e?e(t,s[n-1],s[n])>0?n-1:n:s[n-1]-t<t-s[n]?n-1:n}return i-1}}function j(s,t,e){for(;t<e;){const i=s[t];s[t]=s[e],s[e]=i,++t,--e}}function J(s,t){const e=Array.isArray(t)?t:[t],i=e.length;for(let n=0;n<i;n++)s[s.length]=e[n]}function ot(s,t){const e=s.length;if(e!==t.length)return!1;for(let i=0;i<e;i++)if(s[i]!==t[i])return!1;return!0}function Nt(){return!0}function Pt(){return!1}function Rt(){}function Kt(s){for(const t in s)delete s[t]}function Gt(s){let t;for(t in s)return!1;return!t}const Ti=class wt extends P{constructor(t){super(),this.eventTarget_=t,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(t,e){if(!t||!e)return;const i=this.listeners_||(this.listeners_={}),n=i[t]||(i[t]=[]);n.includes(e)||n.push(e)}dispatchEvent(t){const e="string"==typeof t,i=e?t:t.type,n=this.listeners_&&this.listeners_[i];if(!n)return;const r=e?new y(t):t;r.target||(r.target=this.eventTarget_||this);const o=this.dispatching_||(this.dispatching_={}),a=this.pendingRemovals_||(this.pendingRemovals_={});let l;i in o||(o[i]=0,a[i]=0),++o[i];for(let h=0,c=n.length;h<c;++h)if(l="handleEvent"in n[h]?n[h].handleEvent(r):n[h].call(this,r),!1===l||r.propagationStopped){l=!1;break}if(0==--o[i]){let h=a[i];for(delete a[i];h--;)this.removeEventListener(i,Rt);delete o[i]}return l}disposeInternal(){this.listeners_&&Kt(this.listeners_)}getListeners(t){return this.listeners_&&this.listeners_[t]||void 0}hasListener(t){return!!this.listeners_&&(t?t in this.listeners_:Object.keys(this.listeners_).length>0)}removeEventListener(t,e){const i=this.listeners_&&this.listeners_[t];if(i){const n=i.indexOf(e);-1!==n&&(this.pendingRemovals_&&t in this.pendingRemovals_?(i[n]=Rt,++this.pendingRemovals_[t]):(i.splice(n,1),0===i.length&&delete this.listeners_[t]))}}};function $(s,t,e,i,n){if(i&&i!==s&&(e=e.bind(i)),n){const o=e;e=function(){s.removeEventListener(t,e),o.apply(this,arguments)}}const r={target:s,type:t,listener:e};return s.addEventListener(t,e),r}function Ri(s,t,e,i){return $(s,t,e,i,!0)}function dt(s){s&&s.target&&(s.target.removeEventListener(s.type,s.listener),Kt(s))}const rs=class vi extends Ti{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent("change")}getRevision(){return this.revision_}onInternal(t,e){if(Array.isArray(t)){const i=t.length,n=new Array(i);for(let r=0;r<i;++r)n[r]=$(this,t[r],e);return n}return $(this,t,e)}onceInternal(t,e){let i;if(Array.isArray(t)){const n=t.length;i=new Array(n);for(let r=0;r<n;++r)i[r]=Ri(this,t[r],e)}else i=Ri(this,t,e);return e.ol_key=i,i}unInternal(t,e){const i=e.ol_key;if(i)!function io(s){if(Array.isArray(s))for(let t=0,e=s.length;t<e;++t)dt(s[t]);else dt(s)}(i);else if(Array.isArray(t))for(let n=0,r=t.length;n<r;++n)this.removeEventListener(t[n],e);else this.removeEventListener(t,e)}};function tt(){throw new Error("Unimplemented abstract method.")}let no=0;function st(s){return s.ol_uid||(s.ol_uid=String(++no))}class os extends y{constructor(t,e,i){super(t),this.key=e,this.oldValue=i}}const Bt=class so extends rs{constructor(t){super(),st(this),this.values_=null,void 0!==t&&this.setProperties(t)}get(t){let e;return this.values_&&this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}hasProperties(){return!!this.values_}notify(t,e){let i;i=`change:${t}`,this.hasListener(i)&&this.dispatchEvent(new os(i,t,e)),i="propertychange",this.hasListener(i)&&this.dispatchEvent(new os(i,t,e))}addChangeListener(t,e){this.addEventListener(`change:${t}`,e)}removeChangeListener(t,e){this.removeEventListener(`change:${t}`,e)}set(t,e,i){const n=this.values_||(this.values_={});if(i)n[t]=e;else{const r=n[t];n[t]=e,r!==e&&this.notify(t,r)}}setProperties(t,e){for(const i in t)this.set(i,t[i],e)}applyProperties(t){!t.values_||Object.assign(this.values_||(this.values_={}),t.values_)}unset(t,e){if(this.values_&&t in this.values_){const i=this.values_[t];delete this.values_[t],Gt(this.values_)&&(this.values_=null),e||this.notify(t,i)}}};var ro=Q(6978);class Ii extends y{constructor(t,e,i){super(t),this.element=e,this.index=i}}const Ut=class oo extends Bt{constructor(t,e){if(super(),this.unique_=!!(e=e||{}).unique,this.array_=t||[],this.unique_)for(let i=0,n=this.array_.length;i<n;++i)this.assertUnique_(this.array_[i],i);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(t){for(let e=0,i=t.length;e<i;++e)this.push(t[e]);return this}forEach(t){const e=this.array_;for(let i=0,n=e.length;i<n;++i)t(e[i],i,e)}getArray(){return this.array_}item(t){return this.array_[t]}getLength(){return this.get("length")}insertAt(t,e){if(t<0||t>this.getLength())throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e),this.array_.splice(t,0,e),this.updateLength_(),this.dispatchEvent(new Ii("add",e,t))}pop(){return this.removeAt(this.getLength()-1)}push(t){this.unique_&&this.assertUnique_(t);const e=this.getLength();return this.insertAt(e,t),this.getLength()}remove(t){const e=this.array_;for(let i=0,n=e.length;i<n;++i)if(e[i]===t)return this.removeAt(i)}removeAt(t){if(t<0||t>=this.getLength())return;const e=this.array_[t];return this.array_.splice(t,1),this.updateLength_(),this.dispatchEvent(new Ii("remove",e,t)),e}setAt(t,e){if(t>=this.getLength())return void this.insertAt(t,e);if(t<0)throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e,t);const n=this.array_[t];this.array_[t]=e,this.dispatchEvent(new Ii("remove",n,t)),this.dispatchEvent(new Ii("add",e,t))}updateLength_(){this.set("length",this.array_.length)}assertUnique_(t,e){for(let i=0,n=this.array_.length;i<n;++i)if(this.array_[i]===t&&i!==e)throw new ro.Z(58)}},ue="undefined"!=typeof navigator&&void 0!==navigator.userAgent?navigator.userAgent.toLowerCase():"",ao=ue.includes("firefox"),lo=(ue.includes("safari")&&!ue.includes("chrom")&&(ue.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(ue)),ue.includes("webkit")&&!ue.includes("edge")),ho=ue.includes("macintosh"),ls="undefined"!=typeof devicePixelRatio?devicePixelRatio:1,$i="undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof OffscreenCanvas&&self instanceof WorkerGlobalScope,co="undefined"!=typeof Image&&Image.prototype.decode,hs=function(){let s=!1;try{const t=Object.defineProperty({},"passive",{get:function(){s=!0}});window.addEventListener("_",null,t),window.removeEventListener("_",null,t)}catch(t){}return s}();var H=Q(1911);function pt(s,t){const e=t[0],i=t[1];return t[0]=s[0]*e+s[2]*i+s[4],t[1]=s[1]*e+s[3]*i+s[5],t}function Qt(s,t,e,i,n,r,o,a){const l=Math.sin(r),h=Math.cos(r);return s[0]=i*h,s[1]=n*l,s[2]=-i*l,s[3]=n*h,s[4]=o*i*h-a*i*l+t,s[5]=o*n*l+a*n*h+e,s}function Si(s,t){const e=function fo(s){return s[0]*s[3]-s[1]*s[2]}(t);(0,H.h)(0!==e,32);const i=t[0],n=t[1],r=t[2],o=t[3],a=t[4],l=t[5];return s[0]=o/e,s[1]=-n/e,s[2]=-r/e,s[3]=i/e,s[4]=(r*l-o*a)/e,s[5]=-(i*l-n*a)/e,s}let cs;function nn(s){const t="matrix("+s.join(", ")+")";if($i)return t;const e=cs||(cs=document.createElement("div"));return e.style.transform=t,e.style.transform}new Array(6);var T=Q(760),Y=Q(2156);const us=/^#([a-f0-9]{3}|[a-f0-9]{4}(?:[a-f0-9]{2}){0,2})$/i,ds=/^([a-z]*)$|^hsla?\(.*\)$/i;function gs(s){return"string"==typeof s?s:ms(s)}const _o=function(){const t={};let e=0;return function(i){let n;if(t.hasOwnProperty(i))n=t[i];else{if(e>=1024){let r=0;for(const o in t)0==(3&r++)&&(delete t[o],--e)}n=function mo(s){let t,e,i,n,r;if(ds.exec(s)&&(s=function fs(s){const t=document.createElement("div");if(t.style.color=s,""!==t.style.color){document.body.appendChild(t);const e=getComputedStyle(t).color;return document.body.removeChild(t),e}return""}(s)),us.exec(s)){const o=s.length-1;let a;a=o<=4?1:2;const l=4===o||8===o;t=parseInt(s.substr(1+0*a,a),16),e=parseInt(s.substr(1+1*a,a),16),i=parseInt(s.substr(1+2*a,a),16),n=l?parseInt(s.substr(1+3*a,a),16):255,1==a&&(t=(t<<4)+t,e=(e<<4)+e,i=(i<<4)+i,l&&(n=(n<<4)+n)),r=[t,e,i,n/255]}else s.startsWith("rgba(")?(r=s.slice(5,-1).split(",").map(Number),_s(r)):s.startsWith("rgb(")?(r=s.slice(4,-1).split(",").map(Number),r.push(1),_s(r)):(0,H.h)(!1,14);return r}(i),t[i]=n,++e}return n}}();function wi(s){return Array.isArray(s)?s:_o(s)}function _s(s){return s[0]=(0,Y.uZ)(s[0]+.5|0,0,255),s[1]=(0,Y.uZ)(s[1]+.5|0,0,255),s[2]=(0,Y.uZ)(s[2]+.5|0,0,255),s[3]=(0,Y.uZ)(s[3],0,1),s}function ms(s){let t=s[0];t!=(0|t)&&(t=t+.5|0);let e=s[1];e!=(0|e)&&(e=e+.5|0);let i=s[2];return i!=(0|i)&&(i=i+.5|0),"rgba("+t+","+e+","+i+","+(void 0===s[3]?1:Math.round(100*s[3])/100)+")"}function ps(s,t,e){return t+":"+s+":"+(e?gs(e):"null")}const Li=new class po{constructor(){this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32}clear(){this.cache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let t=0;for(const e in this.cache_){const i=this.cache_[e];0==(3&t++)&&!i.hasListener()&&(delete this.cache_[e],--this.cacheSize_)}}}get(t,e,i){const n=ps(t,e,i);return n in this.cache_?this.cache_[n]:null}set(t,e,i,n){const r=ps(t,e,i);this.cache_[r]=n,++this.cacheSize_}setSize(t){this.maxCacheSize_=t,this.expire()}},xs=class xo extends Bt{constructor(t){super(),this.background_=t.background;const e=Object.assign({},t);"object"==typeof t.properties&&(delete e.properties,Object.assign(e,t.properties)),e.opacity=void 0!==t.opacity?t.opacity:1,(0,H.h)("number"==typeof e.opacity,64),e.visible=void 0===t.visible||t.visible,e.zIndex=t.zIndex,e.maxResolution=void 0!==t.maxResolution?t.maxResolution:1/0,e.minResolution=void 0!==t.minResolution?t.minResolution:0,e.minZoom=void 0!==t.minZoom?t.minZoom:-1/0,e.maxZoom=void 0!==t.maxZoom?t.maxZoom:1/0,this.className_=void 0!==e.className?e.className:"ol-layer",delete e.className,this.setProperties(e),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(t){const e=this.state_||{layer:this,managed:void 0===t||t},i=this.getZIndex();return e.opacity=(0,Y.uZ)(Math.round(100*this.getOpacity())/100,0,1),e.visible=this.getVisible(),e.extent=this.getExtent(),e.zIndex=void 0!==i||e.managed?i:1/0,e.maxResolution=this.getMaxResolution(),e.minResolution=Math.max(this.getMinResolution(),0),e.minZoom=this.getMinZoom(),e.maxZoom=this.getMaxZoom(),this.state_=e,e}getLayersArray(t){return tt()}getLayerStatesArray(t){return tt()}getExtent(){return this.get("extent")}getMaxResolution(){return this.get("maxResolution")}getMinResolution(){return this.get("minResolution")}getMinZoom(){return this.get("minZoom")}getMaxZoom(){return this.get("maxZoom")}getOpacity(){return this.get("opacity")}getSourceState(){return tt()}getVisible(){return this.get("visible")}getZIndex(){return this.get("zIndex")}setBackground(t){this.background_=t,this.changed()}setExtent(t){this.set("extent",t)}setMaxResolution(t){this.set("maxResolution",t)}setMinResolution(t){this.set("minResolution",t)}setMaxZoom(t){this.set("maxZoom",t)}setMinZoom(t){this.set("minZoom",t)}setOpacity(t){(0,H.h)("number"==typeof t,64),this.set("opacity",t)}setVisible(t){this.set("visible",t)}setZIndex(t){this.set("zIndex",t)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}};function sn(s,t){if(!s.visible)return!1;const e=t.resolution;if(e<s.minResolution||e>=s.maxResolution)return!1;const i=t.zoom;return i>s.minZoom&&i<=s.maxZoom}const Ai=class yo extends xs{constructor(t){const e=Object.assign({},t);delete e.source,super(e),this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.rendered=!1,t.render&&(this.render=t.render),t.map&&this.setMap(t.map),this.addChangeListener("source",this.handleSourcePropertyChange_),this.setSource(t.source?t.source:null)}getLayersArray(t){return(t=t||[]).push(this),t}getLayerStatesArray(t){return(t=t||[]).push(this.getLayerState()),t}getSource(){return this.get("source")||null}getRenderSource(){return this.getSource()}getSourceState(){const t=this.getSource();return t?t.getState():"undefined"}handleSourceChange_(){this.changed()}handleSourcePropertyChange_(){this.sourceChangeKey_&&(dt(this.sourceChangeKey_),this.sourceChangeKey_=null);const t=this.getSource();t&&(this.sourceChangeKey_=$(t,"change",this.handleSourceChange_,this)),this.changed()}getFeatures(t){return this.renderer_?this.renderer_.getFeatures(t):new Promise(e=>e([]))}getData(t){return this.renderer_&&this.rendered?this.renderer_.getData(t):null}render(t,e){const i=this.getRenderer();if(i.prepareFrame(t))return this.rendered=!0,i.renderFrame(t,e)}unrender(){this.rendered=!1}setMapInternal(t){t||this.unrender(),this.set("map",t)}getMapInternal(){return this.get("map")}setMap(t){this.mapPrecomposeKey_&&(dt(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&(dt(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=$(t,"precompose",function(e){const n=e.frameState.layerStatesArray,r=this.getLayerState(!1);(0,H.h)(!n.some(function(o){return o.layer===r.layer}),67),n.push(r)},this),this.mapRenderKey_=$(this,"change",t.render,t),this.changed())}setSource(t){this.set("source",t)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}disposeInternal(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),super.disposeInternal()}};var jt=Q(3481);function Co(s,t){Li.expire()}const To=class Eo extends P{constructor(t){super(),this.map_=t}dispatchRenderEvent(t,e){tt()}calculateMatrices2D(t){const e=t.viewState,i=t.coordinateToPixelTransform,n=t.pixelToCoordinateTransform;Qt(i,t.size[0]/2,t.size[1]/2,1/e.resolution,-1/e.resolution,-e.rotation,-e.center[0],-e.center[1]),Si(n,i)}forEachFeatureAtCoordinate(t,e,i,n,r,o,a,l){let h;const c=e.viewState;function u(v,I,A,M){return r.call(o,I,v?A:null,M)}const d=c.projection,f=(0,jt.Cf)(t.slice(),d),_=[[0,0]];if(d.canWrapX()&&n){const v=d.getExtent(),I=(0,T.dz)(v);_.push([-I,0],[I,0])}const m=e.layerStatesArray,p=m.length,x=[],E=[];for(let v=0;v<_.length;v++)for(let I=p-1;I>=0;--I){const A=m[I],M=A.layer;if(M.hasRenderer()&&sn(A,c)&&a.call(l,M)){const F=M.getRenderer(),X=M.getSource();if(F&&X){const Z=X.getWrapX()?f:t,nt=u.bind(null,A.managed);E[0]=Z[0]+_[v][0],E[1]=Z[1]+_[v][1],h=F.forEachFeatureAtCoordinate(E,e,i,nt,x)}if(h)return h}}if(0===x.length)return;const C=1/x.length;return x.forEach((v,I)=>v.distanceSq+=I*C),x.sort((v,I)=>v.distanceSq-I.distanceSq),x.some(v=>h=v.callback(v.feature,v.layer,v.geometry)),h}hasFeatureAtCoordinate(t,e,i,n,r,o){return void 0!==this.forEachFeatureAtCoordinate(t,e,i,n,Nt,this,r,o)}getMap(){return this.map_}renderFrame(t){tt()}scheduleExpireIconCache(t){Li.canExpireCache()&&t.postRenderFunctions.push(Co)}},ys=class Ro extends y{constructor(t,e,i,n){super(t),this.inversePixelTransform=e,this.frameState=i,this.context=n}},Mi="ol-hidden",bi="ol-unselectable",rn="ol-control",Es="ol-collapsed",vo=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))","?\\s*([-,\\\"\\'\\sa-z]+?)\\s*$"].join(""),"i"),Cs=["style","variant","weight","size","lineHeight","family"],Ts=function(s){const t=s.match(vo);if(!t)return null;const e={lineHeight:"normal",size:"1.2em",style:"normal",weight:"normal",variant:"normal"};for(let i=0,n=Cs.length;i<n;++i){const r=t[i+1];void 0!==r&&(e[Cs[i]]=r)}return e.families=e.family.split(/,\s?/),e};function Lt(s,t,e,i){let n;return n=e&&e.length?e.shift():$i?new OffscreenCanvas(s||300,t||300):document.createElement("canvas"),s&&(n.width=s),t&&(n.height=t),n.getContext("2d",i)}function Rs(s){const t=s.canvas;t.width=1,t.height=1,s.clearRect(0,0,1,1)}function vs(s,t){const e=t.parentNode;e&&e.replaceChild(s,t)}function on(s){return s&&s.parentNode?s.parentNode.removeChild(s):null}const Is="10px sans-serif",$t="#000",Oi="round",ii=[],ze="round",ri="#000",oi="center",Pi="middle",Me=[0,0,0,0],te=new Bt;let an,We=null;const ln={},wo=function(){const t="32px ",e=["monospace","serif"],i=e.length,n="wmytzilWMYTZIL@#/&?$%10\uf013";let r,o;function a(h,c,u){let d=!0;for(let f=0;f<i;++f){const _=e[f];if(o=Di(h+" "+c+" "+t+_,n),u!=_){const m=Di(h+" "+c+" "+t+u+","+_,n);d=d&&m!=o}}return!!d}function l(){let h=!0;const c=te.getKeys();for(let u=0,d=c.length;u<d;++u){const f=c[u];te.get(f)<100&&(a.apply(this,f.split("\n"))?(Kt(ln),We=null,an=void 0,te.set(f,100)):(te.set(f,te.get(f)+1,!0),h=!1))}h&&(clearInterval(r),r=void 0)}return function(h){const c=Ts(h);if(!c)return;const u=c.families;for(let d=0,f=u.length;d<f;++d){const _=u[d],m=c.style+"\n"+c.weight+"\n"+_;void 0===te.get(m)&&(te.set(m,100,!0),a(c.style,c.weight,_)||(te.set(m,0,!0),void 0===r&&(r=setInterval(l,32))))}}}(),Lo=function(){let s;return function(t){let e=ln[t];if(null==e){if($i){const i=Ts(t),n=Ss(t,"\u017dg");e=(isNaN(Number(i.lineHeight))?1.2:Number(i.lineHeight))*(n.actualBoundingBoxAscent+n.actualBoundingBoxDescent)}else s||(s=document.createElement("div"),s.innerHTML="M",s.style.minHeight="0",s.style.maxHeight="none",s.style.height="auto",s.style.padding="0",s.style.border="none",s.style.position="absolute",s.style.display="block",s.style.left="-99999px"),s.style.font=t,document.body.appendChild(s),e=s.offsetHeight,document.body.removeChild(s);ln[t]=e}return e}}();function Ss(s,t){return We||(We=Lt(1,1)),s!=an&&(We.font=s,an=We.font),We.measureText(t)}function Di(s,t){return Ss(s,t).width}function ws(s,t,e){if(t in e)return e[t];const i=t.split("\n").reduce((n,r)=>Math.max(n,Di(s,r)),0);return e[t]=i,i}const Po=class Oo extends To{constructor(t){super(t),this.fontChangeListenerKey_=$(te,"propertychange",t.redrawText.bind(t)),this.element_=document.createElement("div");const e=this.element_.style;e.position="absolute",e.width="100%",e.height="100%",e.zIndex="0",this.element_.className=bi+" ol-layers";const i=t.getViewport();i.insertBefore(this.element_,i.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(t,e){const i=this.getMap();if(i.hasListener(t)){const n=new ys(t,void 0,e);i.dispatchEvent(n)}}disposeInternal(){dt(this.fontChangeListenerKey_),this.element_.parentNode.removeChild(this.element_),super.disposeInternal()}renderFrame(t){if(!t)return void(this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1));this.calculateMatrices2D(t),this.dispatchRenderEvent("precompose",t);const e=t.layerStatesArray.sort(function(o,a){return o.zIndex-a.zIndex}),i=t.viewState;this.children_.length=0;const n=[];let r=null;for(let o=0,a=e.length;o<a;++o){const l=e[o];t.layerIndex=o;const h=l.layer,c=h.getSourceState();if(!sn(l,i)||"ready"!=c&&"undefined"!=c){h.unrender();continue}const u=h.render(t,r);!u||(u!==r&&(this.children_.push(u),r=u),"getDeclutter"in h&&n.push(h))}for(let o=n.length-1;o>=0;--o)n[o].renderDeclutter(t);(function So(s,t){const e=s.childNodes;for(let i=0;;++i){const n=e[i],r=t[i];if(!n&&!r)break;if(n!==r){if(!n){s.appendChild(r);continue}if(!r){s.removeChild(n),--i;continue}s.insertBefore(r,n)}}})(this.element_,this.children_),this.dispatchRenderEvent("postcompose",t),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(t)}};class ge extends y{constructor(t,e){super(t),this.layer=e}}class cn extends xs{constructor(t){t=t||{};const e=Object.assign({},t);delete e.layers;let i=t.layers;super(e),this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener("layers",this.handleLayersChanged_),i?Array.isArray(i)?i=new Ut(i.slice(),{unique:!0}):(0,H.h)("function"==typeof i.getArray,43):i=new Ut(void 0,{unique:!0}),this.setLayers(i)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(dt),this.layersListenerKeys_.length=0;const t=this.getLayers();this.layersListenerKeys_.push($(t,"add",this.handleLayersAdd_,this),$(t,"remove",this.handleLayersRemove_,this));for(const i in this.listenerKeys_)this.listenerKeys_[i].forEach(dt);Kt(this.listenerKeys_);const e=t.getArray();for(let i=0,n=e.length;i<n;i++){const r=e[i];this.registerLayerListeners_(r),this.dispatchEvent(new ge("addlayer",r))}this.changed()}registerLayerListeners_(t){const e=[$(t,"propertychange",this.handleLayerChange_,this),$(t,"change",this.handleLayerChange_,this)];t instanceof cn&&e.push($(t,"addlayer",this.handleLayerGroupAdd_,this),$(t,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[st(t)]=e}handleLayerGroupAdd_(t){this.dispatchEvent(new ge("addlayer",t.layer))}handleLayerGroupRemove_(t){this.dispatchEvent(new ge("removelayer",t.layer))}handleLayersAdd_(t){const e=t.element;this.registerLayerListeners_(e),this.dispatchEvent(new ge("addlayer",e)),this.changed()}handleLayersRemove_(t){const e=t.element,i=st(e);this.listenerKeys_[i].forEach(dt),delete this.listenerKeys_[i],this.dispatchEvent(new ge("removelayer",e)),this.changed()}getLayers(){return this.get("layers")}setLayers(t){const e=this.getLayers();if(e){const i=e.getArray();for(let n=0,r=i.length;n<r;++n)this.dispatchEvent(new ge("removelayer",i[n]))}this.set("layers",t)}getLayersArray(t){return t=void 0!==t?t:[],this.getLayers().forEach(function(e){e.getLayersArray(t)}),t}getLayerStatesArray(t){const e=void 0!==t?t:[],i=e.length;this.getLayers().forEach(function(o){o.getLayerStatesArray(e)});const n=this.getLayerState();let r=n.zIndex;!t&&void 0===n.zIndex&&(r=0);for(let o=i,a=e.length;o<a;o++){const l=e[o];l.opacity*=n.opacity,l.visible=l.visible&&n.visible,l.maxResolution=Math.min(l.maxResolution,n.maxResolution),l.minResolution=Math.max(l.minResolution,n.minResolution),l.minZoom=Math.max(l.minZoom,n.minZoom),l.maxZoom=Math.min(l.maxZoom,n.maxZoom),void 0!==n.extent&&(l.extent=void 0!==l.extent?(0,T.Ed)(l.extent,n.extent):n.extent),void 0===l.zIndex&&(l.zIndex=r)}return e}getSourceState(){return"ready"}}const Fi=cn,Xe=class Do extends y{constructor(t,e,i){super(t),this.map=e,this.frameState=void 0!==i?i:null}},fe=class Fo extends Xe{constructor(t,e,i,n,r,o){super(t,e,r),this.originalEvent=i,this.pixel_=null,this.coordinate_=null,this.dragging=void 0!==n&&n,this.activePointers=o}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(t){this.pixel_=t}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(t){this.coordinate_=t}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}},gt={SINGLECLICK:"singleclick",CLICK:"click",DBLCLICK:"dblclick",POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},No=class ko extends Ti{constructor(t,e){super(t),this.map_=t,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=void 0===e?1:e,this.down_=null;const i=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=i,this.pointerdownListenerKey_=$(i,"pointerdown",this.handlePointerDown_,this),this.relayedListenerKey_=$(i,"pointermove",this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener("touchmove",this.boundHandleTouchMove_,!!hs&&{passive:!1})}emulateClick_(t){let e=new fe(gt.CLICK,this.map_,t);this.dispatchEvent(e),void 0!==this.clickTimeoutId_?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,e=new fe(gt.DBLCLICK,this.map_,t),this.dispatchEvent(e)):this.clickTimeoutId_=setTimeout(function(){this.clickTimeoutId_=void 0;const i=new fe(gt.SINGLECLICK,this.map_,t);this.dispatchEvent(i)}.bind(this),250)}updateActivePointers_(t){const e=t,i=e.pointerId;if(e.type==gt.POINTERUP||e.type==gt.POINTERCANCEL){delete this.trackedTouches_[i];for(const n in this.trackedTouches_)if(this.trackedTouches_[n].target!==e.target){delete this.trackedTouches_[n];break}}else(e.type==gt.POINTERDOWN||e.type==gt.POINTERMOVE)&&(this.trackedTouches_[i]=e);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(t){this.updateActivePointers_(t);const e=new fe(gt.POINTERUP,this.map_,t,void 0,void 0,this.activePointers_);this.dispatchEvent(e),this.emulateClicks_&&!e.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(t)&&this.emulateClick_(this.down_),0===this.activePointers_.length&&(this.dragListenerKeys_.forEach(dt),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(t){return 0===t.button}handlePointerDown_(t){this.emulateClicks_=0===this.activePointers_.length,this.updateActivePointers_(t);const e=new fe(gt.POINTERDOWN,this.map_,t,void 0,void 0,this.activePointers_);this.dispatchEvent(e),this.down_={};for(const i in t){const n=t[i];this.down_[i]="function"==typeof n?Rt:n}if(0===this.dragListenerKeys_.length){const i=this.map_.getOwnerDocument();this.dragListenerKeys_.push($(i,gt.POINTERMOVE,this.handlePointerMove_,this),$(i,gt.POINTERUP,this.handlePointerUp_,this),$(this.element_,gt.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==i&&this.dragListenerKeys_.push($(this.element_.getRootNode(),gt.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(t){if(this.isMoving_(t)){this.updateActivePointers_(t),this.dragging_=!0;const e=new fe(gt.POINTERDRAG,this.map_,t,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(e)}}relayMoveEvent_(t){this.originalPointerMoveEvent_=t;const e=!(!this.down_||!this.isMoving_(t));this.dispatchEvent(new fe(gt.POINTERMOVE,this.map_,t,e))}handleTouchMove_(t){const e=this.originalPointerMoveEvent_;(!e||e.defaultPrevented)&&("boolean"!=typeof t.cancelable||!0===t.cancelable)&&t.preventDefault()}isMoving_(t){return this.dragging_||Math.abs(t.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(t.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(dt(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener("touchmove",this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(dt(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(dt),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}},ki=1/0,zt={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};var z=Q(6003);function Ls(s,t,e){return function(i,n,r,o,a){if(!i)return;if(!n&&!t)return i;const l=t?0:r[0]*n,h=t?0:r[1]*n,c=a?a[0]:0,u=a?a[1]:0;let d=s[0]+l/2+c,f=s[2]-l/2+c,_=s[1]+h/2+u,m=s[3]-h/2+u;d>f&&(d=(f+d)/2,f=d),_>m&&(_=(m+_)/2,m=_);let p=(0,Y.uZ)(i[0],d,f),x=(0,Y.uZ)(i[1],_,m);if(o&&e&&n){const E=30*n;p+=-E*Math.log(1+Math.max(0,d-i[0])/E)+E*Math.log(1+Math.max(0,i[0]-f)/E),x+=-E*Math.log(1+Math.max(0,_-i[1])/E)+E*Math.log(1+Math.max(0,i[1]-m)/E)}return[p,x]}}function Ko(s){return s}function gn(s,t,e,i){const n=(0,T.dz)(t)/e[0],r=(0,T.Cr)(t)/e[1];return i?Math.min(s,Math.max(n,r)):Math.min(s,Math.min(n,r))}function fn(s,t,e){let i=Math.min(s,t);return i*=Math.log(1+50*Math.max(0,s/t-1))/50+1,e&&(i=Math.max(i,e),i/=Math.log(1+50*Math.max(0,e/s-1))/50+1),(0,Y.uZ)(i,e/2,2*t)}function As(s,t,e,i,n){return e=void 0===e||e,function(r,o,a,l){if(void 0!==r){const h=i?gn(s,i,a,n):s;return e&&l?fn(r,h,t):(0,Y.uZ)(r,t,h)}}}function _n(s){if(void 0!==s)return 0}function Ms(s){if(void 0!==s)return s}function bs(s){return Math.pow(s,3)}function Ze(s){return 1-bs(1-s)}function mn(s){return 3*s*s-2*s*s*s}function Ho(s){return s}function be(s,t,e,i,n,r){r=r||[];let o=0;for(let a=t;a<e;a+=i){const l=s[a],h=s[a+1];r[o++]=n[0]*l+n[2]*h+n[4],r[o++]=n[1]*l+n[3]*h+n[5]}return r&&r.length!=o&&(r.length=o),r}function Os(s,t,e,i,n,r,o){o=o||[];const a=Math.cos(n),l=Math.sin(n),h=r[0],c=r[1];let u=0;for(let d=t;d<e;d+=i){const f=s[d]-h,_=s[d+1]-c;o[u++]=h+f*a-_*l,o[u++]=c+f*l+_*a;for(let m=d+2;m<d+i;++m)o[u++]=s[m]}return o&&o.length!=u&&(o.length=u),o}const Ps=[1,0,0,1,0,0],$o=class Qo extends Bt{constructor(){super(),this.extent_=(0,T.lJ)(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=function ce(s){let e,i,n,t=!1;return function(){const r=Array.prototype.slice.call(arguments);return(!t||this!==n||!ot(r,i))&&(t=!0,n=this,i=r,e=s.apply(this,arguments)),e}}(function(t,e,i){if(!i)return this.getSimplifiedGeometry(e);const n=this.clone();return n.applyTransform(i),n.getSimplifiedGeometry(e)})}simplifyTransformed(t,e){return this.simplifyTransformedInternal(this.getRevision(),t,e)}clone(){return tt()}closestPointXY(t,e,i,n){return tt()}containsXY(t,e){const i=this.getClosestPoint([t,e]);return i[0]===t&&i[1]===e}getClosestPoint(t,e){return this.closestPointXY(t[0],t[1],e=e||[NaN,NaN],1/0),e}intersectsCoordinate(t){return this.containsXY(t[0],t[1])}computeExtent(t){return tt()}getExtent(t){if(this.extentRevision_!=this.getRevision()){const e=this.computeExtent(this.extent_);(isNaN(e[0])||isNaN(e[1]))&&(0,T.YN)(e),this.extentRevision_=this.getRevision()}return(0,T.EO)(this.extent_,t)}rotate(t,e){tt()}scale(t,e,i){tt()}simplify(t){return this.getSimplifiedGeometry(t*t)}getSimplifiedGeometry(t){return tt()}getType(){return tt()}applyTransform(t){tt()}intersectsExtent(t){return tt()}translate(t,e){tt()}transform(t,e){const i=(0,z.U2)(t),n="tile-pixels"==i.getUnits()?function(r,o,a){const l=i.getExtent(),h=i.getWorldExtent(),c=(0,T.Cr)(h)/(0,T.Cr)(l);return Qt(Ps,h[0],h[3],c,-c,0,0,0),be(r,0,r.length,a,Ps,o),(0,z.Ck)(i,e)(r,o,a)}:(0,z.Ck)(i,e);return this.applyTransform(n),this}};function Ds(s){let t;return"XY"==s?t=2:"XYZ"==s||"XYM"==s?t=3:"XYZM"==s&&(t=4),t}const pn=class ta extends $o{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates=null}computeExtent(t){return(0,T.GN)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinates(){return tt()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=this.getSimplifiedGeometryInternal(t);return e.getFlatCoordinates().length<this.flatCoordinates.length?e:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getSimplifiedGeometryInternal(t){return this}getStride(){return this.stride}setFlatCoordinates(t,e){this.stride=Ds(t),this.layout=t,this.flatCoordinates=e}setCoordinates(t,e){tt()}setLayout(t,e,i){let n;if(t)n=Ds(t);else{for(let r=0;r<i;++r){if(0===e.length)return this.layout="XY",void(this.stride=2);e=e[0]}n=e.length,t=function ea(s){let t;return 2==s?t="XY":3==s?t="XYZ":4==s&&(t="XYZM"),t}(n)}this.layout=t,this.stride=n}applyTransform(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())}rotate(t,e){const i=this.getFlatCoordinates();if(i){const n=this.getStride();Os(i,0,i.length,n,t,e,i),this.changed()}}scale(t,e,i){void 0===e&&(e=t),i||(i=(0,T.qg)(this.getExtent()));const n=this.getFlatCoordinates();if(n){const r=this.getStride();(function qo(s,t,e,i,n,r,o,a){a=a||[];const l=o[0],h=o[1];let c=0;for(let u=t;u<e;u+=i){const f=s[u+1]-h;a[c++]=l+n*(s[u]-l),a[c++]=h+r*f;for(let _=u+2;_<u+i;++_)a[c++]=s[_]}a&&a.length!=c&&(a.length=c)})(n,0,n.length,r,t,e,i,n),this.changed()}}translate(t,e){const i=this.getFlatCoordinates();if(i){const n=this.getStride();(function Jo(s,t,e,i,n,r,o){o=o||[];let a=0;for(let l=t;l<e;l+=i){o[a++]=s[l]+n,o[a++]=s[l+1]+r;for(let h=l+2;h<l+i;++h)o[a++]=s[h]}o&&o.length!=a&&(o.length=a)})(i,0,i.length,n,t,e,i),this.changed()}}};function Fs(s,t,e,i,n,r,o){const a=s[t],l=s[t+1],h=s[e]-a,c=s[e+1]-l;let u;if(0===h&&0===c)u=t;else{const d=((n-a)*h+(r-l)*c)/(h*h+c*c);if(d>1)u=e;else{if(d>0){for(let f=0;f<i;++f)o[f]=(0,Y.t7)(s[t+f],s[e+f],d);return void(o.length=i)}u=t}}for(let d=0;d<i;++d)o[d]=s[u+d];o.length=i}function ks(s,t,e,i,n){let r=s[t],o=s[t+1];for(t+=i;t<e;t+=i){const a=s[t],l=s[t+1],h=(0,Y.bI)(r,o,a,l);h>n&&(n=h),r=a,o=l}return n}function Gs(s,t,e,i,n,r,o,a,l,h,c){if(t==e)return h;let u,d;if(0===n){if(d=(0,Y.bI)(o,a,s[t],s[t+1]),d<h){for(u=0;u<i;++u)l[u]=s[t+u];return l.length=i,d}return h}c=c||[NaN,NaN];let f=t+i;for(;f<e;)if(Fs(s,f-i,f,i,o,a,c),d=(0,Y.bI)(o,a,c[0],c[1]),d<h){for(h=d,u=0;u<i;++u)l[u]=c[u];l.length=i,f+=i}else f+=i*Math.max((Math.sqrt(d)-Math.sqrt(h))/n|0,1);if(r&&(Fs(s,e-i,t,i,o,a,c),d=(0,Y.bI)(o,a,c[0],c[1]),d<h)){for(h=d,u=0;u<i;++u)l[u]=c[u];l.length=i}return h}function zs(s,t,e,i){for(let n=0,r=e.length;n<r;++n){const o=e[n];for(let a=0;a<i;++a)s[t++]=o[a]}return t}function Oe(s,t){return t*Math.round(s/t)}function oa(s,t,e,i,n,r,o){if(t==e)return o;let h,c,a=Oe(s[t],n),l=Oe(s[t+1],n);t+=i,r[o++]=a,r[o++]=l;do{if(h=Oe(s[t],n),c=Oe(s[t+1],n),(t+=i)==e)return r[o++]=h,r[o++]=c,o}while(h==a&&c==l);for(;t<e;){const u=Oe(s[t],n),d=Oe(s[t+1],n);if(t+=i,u==h&&d==c)continue;const f=h-a,_=c-l,m=u-a,p=d-l;f*p==_*m&&(f<0&&m<f||f==m||f>0&&m>f)&&(_<0&&p<_||_==p||_>0&&p>_)?(h=u,c=d):(r[o++]=h,r[o++]=c,a=h,l=c,h=u,c=d)}return r[o++]=h,r[o++]=c,o}function Ke(s,t,e,i,n){n=void 0!==n?n:[];let r=0;for(let o=t;o<e;o+=i)n[r++]=s.slice(o,o+i);return n.length=r,n}function Ni(s,t,e,i,n){n=void 0!==n?n:[];let r=0;for(let o=0,a=e.length;o<a;++o){const l=e[o];n[r++]=Ke(s,t,l,i,n[r]),t=l}return n.length=r,n}function Zs(s,t,e,i,n){n=void 0!==n?n:[];let r=0;for(let o=0,a=e.length;o<a;++o){const l=e[o];n[r++]=1===l.length&&l[0]===t?[]:Ni(s,t,l,i,n[r]),t=l[l.length-1]}return n.length=r,n}function Ks(s,t,e,i){let n=0,r=s[e-i],o=s[e-i+1];for(;t<e;t+=i){const a=s[t],l=s[t+1];n+=o*a-r*l,r=a,o=l}return n/2}class Gi extends pn{constructor(t,e){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,void 0===e||Array.isArray(t[0])?this.setCoordinates(t,e):this.setFlatCoordinates(e,t)}clone(){return new Gi(this.flatCoordinates.slice(),this.layout)}closestPointXY(t,e,i,n){return n<(0,T.qf)(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(ks(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Gs(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,e,i,n))}getArea(){return Ks(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return Ke(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(t){const e=[];return e.length=function xn(s,t,e,i,n,r,o){const a=(e-t)/i;if(a<3){for(;t<e;t+=i)r[o++]=s[t],r[o++]=s[t+1];return o}const l=new Array(a);l[0]=1,l[a-1]=1;const h=[t,e-i];let c=0;for(;h.length>0;){const u=h.pop(),d=h.pop();let f=0;const _=s[d],m=s[d+1],p=s[u],x=s[u+1];for(let E=d+i;E<u;E+=i){const I=(0,Y.rU)(s[E],s[E+1],_,m,p,x);I>f&&(c=E,f=I)}f>n&&(l[(c-t)/i]=1,d+i<c&&h.push(d,c),c+i<u&&h.push(c,u))}for(let u=0;u<a;++u)l[u]&&(r[o++]=s[t+u*i],r[o++]=s[t+u*i+1]);return o}(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new Gi(e,"XY")}getType(){return"LinearRing"}intersectsExtent(t){return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=zs(this.flatCoordinates,0,t,this.stride),this.changed()}}const Us=Gi;class yn extends pn{constructor(t,e){super(),this.setCoordinates(t,e)}clone(){const t=new yn(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,n){const r=this.flatCoordinates,o=(0,Y.bI)(t,e,r[0],r[1]);if(o<n){const a=this.stride;for(let l=0;l<a;++l)i[l]=r[l];return i.length=a,o}return n}getCoordinates(){return this.flatCoordinates?this.flatCoordinates.slice():[]}computeExtent(t){return(0,T.HK)(this.flatCoordinates,t)}getType(){return"Point"}intersectsExtent(t){return(0,T.jE)(t,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(t,e){this.setLayout(e,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=function na(s,t,e,i){for(let n=0,r=e.length;n<r;++n)s[t++]=e[n];return t}(this.flatCoordinates,0,t),this.changed()}}const js=yn;function aa(s,t,e,i,n){return!(0,T.H6)(n,function(o){return!Pe(s,t,e,i,o[0],o[1])})}function Pe(s,t,e,i,n,r){let o=0,a=s[e-i],l=s[e-i+1];for(;t<e;t+=i){const h=s[t],c=s[t+1];l<=r?c>r&&(h-a)*(r-l)-(n-a)*(c-l)>0&&o++:c<=r&&(h-a)*(r-l)-(n-a)*(c-l)<0&&o--,a=h,l=c}return 0!==o}function En(s,t,e,i,n,r){if(0===e.length||!Pe(s,t,e[0],i,n,r))return!1;for(let o=1,a=e.length;o<a;++o)if(Pe(s,e[o-1],e[o],i,n,r))return!1;return!0}function Cn(s,t,e,i,n){const r=(0,T.qP)((0,T.lJ)(),s,t,e,i);return!!(0,T.kK)(n,r)&&(!!((0,T.r4)(n,r)||r[0]>=n[0]&&r[2]<=n[2]||r[1]>=n[1]&&r[3]<=n[3])||function la(s,t,e,i,n){let r;for(t+=i;t<e;t+=i)if(r=n(s.slice(t-i,t),s.slice(t,t+i)),r)return r;return!1}(s,t,e,i,function(o,a){return(0,T.I7)(n,o,a)}))}function Hs(s,t,e,i,n){return!!(Cn(s,t,e,i,n)||Pe(s,t,e,i,n[0],n[1])||Pe(s,t,e,i,n[0],n[3])||Pe(s,t,e,i,n[2],n[1])||Pe(s,t,e,i,n[2],n[3]))}function ha(s,t,e,i){for(;t<e-i;){for(let n=0;n<i;++n){const r=s[t+n];s[t+n]=s[e-i+n],s[e-i+n]=r}t+=i,e-=i}}function Tn(s,t,e,i){let n=0,r=s[e-i],o=s[e-i+1];for(;t<e;t+=i){const a=s[t],l=s[t+1];n+=(a-r)*(l+o),r=a,o=l}return 0===n?void 0:n>0}function Rn(s,t,e,i,n){n=void 0!==n&&n;for(let r=0,o=e.length;r<o;++r){const a=e[r],l=Tn(s,t,a,i);(0===r?n&&l||!n&&!l:n&&!l||!n&&l)&&ha(s,t,a,i),t=a}return t}class De extends pn{constructor(t,e,i){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,void 0!==e&&i?(this.setFlatCoordinates(e,t),this.ends_=i):this.setCoordinates(t,e)}appendLinearRing(t){this.flatCoordinates?J(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new De(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,i,n){return n<(0,T.qf)(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(function Ns(s,t,e,i,n){for(let r=0,o=e.length;r<o;++r){const a=e[r];n=ks(s,t,a,i,n),t=a}return n}(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),function Ys(s,t,e,i,n,r,o,a,l,h,c){c=c||[NaN,NaN];for(let u=0,d=e.length;u<d;++u){const f=e[u];h=Gs(s,t,f,i,n,r,o,a,l,h,c),t=f}return h}(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,e,i,n))}containsXY(t,e){return En(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,e)}getArea(){return function Bs(s,t,e,i){let n=0;for(let r=0,o=e.length;r<o;++r){const a=e[r];n+=Ks(s,t,a,i),t=a}return n}(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(t){let e;return void 0!==t?(e=this.getOrientedFlatCoordinates().slice(),Rn(e,0,this.ends_,this.stride,t)):e=this.flatCoordinates,Ni(e,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const t=(0,T.qg)(this.getExtent());this.flatInteriorPoint_=function Vs(s,t,e,i,n,r,o){let a,l,h,c,u,d,f;const _=n[r+1],m=[];for(let E=0,C=e.length;E<C;++E){const v=e[E];for(c=s[v-i],d=s[v-i+1],a=t;a<v;a+=i)u=s[a],f=s[a+1],(_<=d&&f<=_||d<=_&&_<=f)&&(h=(_-d)/(f-d)*(u-c)+c,m.push(h)),c=u,d=f}let p=NaN,x=-1/0;for(m.sort(L),c=m[0],a=1,l=m.length;a<l;++a){u=m[a];const E=Math.abs(u-c);E>x&&(h=(c+u)/2,En(s,t,e,i,h,_)&&(p=h,x=E)),c=u}return isNaN(p)&&(p=n[r]),o?(o.push(p,_,x),o):[p,_,x]}(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new js(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(t){return t<0||this.ends_.length<=t?null:new Us(this.flatCoordinates.slice(0===t?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLinearRings(){const t=this.layout,e=this.flatCoordinates,i=this.ends_,n=[];let r=0;for(let o=0,a=i.length;o<a;++o){const l=i[o],h=new Us(e.slice(r,l),t);n.push(h),r=l}return n}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;!function Js(s,t,e,i,n){n=void 0!==n&&n;for(let r=0,o=e.length;r<o;++r){const a=e[r],l=Tn(s,t,a,i);if(0===r){if(n&&l||!n&&!l)return!1}else if(n&&!l||!n&&l)return!1;t=a}return!0}(t,0,this.ends_,this.stride)?(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=Rn(this.orientedFlatCoordinates_,0,this.ends_,this.stride)):this.orientedFlatCoordinates_=t,this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],i=[];return e.length=function Xs(s,t,e,i,n,r,o,a){for(let l=0,h=e.length;l<h;++l){const c=e[l];o=oa(s,t,c,i,n,r,o),a.push(o),t=c}return o}(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),e,0,i),new De(e,"XY",i)}getType(){return"Polygon"}intersectsExtent(t){return function qs(s,t,e,i,n){if(!Hs(s,t,e[0],i,n))return!1;if(1===e.length)return!0;for(let r=1,o=e.length;r<o;++r)if(aa(s,e[r-1],e[r],i,n)&&!Cn(s,e[r-1],e[r],i,n))return!1;return!0}(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=function Ws(s,t,e,i,n){n=n||[];let r=0;for(let o=0,a=e.length;o<a;++o){const l=zs(s,t,e[o],i);n[r++]=l,t=l}return n.length=r,n}(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=0===i.length?0:i[i.length-1],this.changed()}}const ca=De;function Qs(s){const t=s[0],e=s[1],i=s[2],n=s[3],r=[t,e,t,n,i,n,i,e,t,e];return new De(r,"XY",[r.length])}function Yi(s,t){setTimeout(function(){s(t)},0)}function In(s,t,e,i,n){const r=Math.cos(-n);let o=Math.sin(-n),a=s[0]*r-s[1]*o,l=s[1]*r+s[0]*o;return a+=(t[0]/2-e[0])*i,l+=(e[1]-t[1]/2)*i,o=-o,[a*r-l*o,l*r+a*o]}const me=class da extends Bt{constructor(t){super(),t=Object.assign({},t),this.hints_=[0,0],this.animations_=[],this.projection_=(0,z.UQ)(t.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.nextCenter_=null,this.cancelAnchor_=void 0,t.projection&&(0,z.h_)(),t.center&&(t.center=(0,z.Vs)(t.center,this.projection_)),t.extent&&(t.extent=(0,z.dY)(t.extent,this.projection_)),this.applyOptions_(t)}applyOptions_(t){const e=Object.assign({},t);for(const a in zt)delete e[a];this.setProperties(e,!0);const i=function fa(s){let t,e,i,o=void 0!==s.minZoom?s.minZoom:0,a=void 0!==s.maxZoom?s.maxZoom:28;const l=void 0!==s.zoomFactor?s.zoomFactor:2,h=void 0!==s.multiWorld&&s.multiWorld,c=void 0===s.smoothResolutionConstraint||s.smoothResolutionConstraint,u=void 0!==s.showFullExtent&&s.showFullExtent,d=(0,z.UQ)(s.projection,"EPSG:3857"),f=d.getExtent();let _=s.constrainOnlyCenter,m=s.extent;if(!h&&!m&&d.isGlobal()&&(_=!1,m=f),void 0!==s.resolutions){const p=s.resolutions;e=p[o],i=void 0!==p[a]?p[a]:p[p.length-1],t=s.constrainResolution?function Bo(s,t,e,i){return t=void 0===t||t,function(n,r,o,a){if(void 0!==n){const l=s[0],h=s[s.length-1],c=e?gn(l,e,o,i):l;if(a)return t?fn(n,c,h):(0,Y.uZ)(n,h,c);const u=Math.min(c,n),d=Math.floor(k(s,u,r));return s[d]>c&&d<s.length-1?s[d+1]:s[d]}}}(p,c,!_&&m,u):As(e,i,c,!_&&m,u)}else{const x=(f?Math.max((0,T.dz)(f),(0,T.Cr)(f)):360*z.Wm.degrees/d.getMetersPerUnit())/256/Math.pow(2,0),E=x/Math.pow(2,28);e=s.maxResolution,void 0!==e?o=0:e=x/Math.pow(l,o),i=s.minResolution,void 0===i&&(i=void 0!==s.maxZoom?void 0!==s.maxResolution?e/Math.pow(l,a):x/Math.pow(l,a):E),a=o+Math.floor(Math.log(e/i)/Math.log(l)),i=e/Math.pow(l,a-o),t=s.constrainResolution?function Uo(s,t,e,i,n,r){return i=void 0===i||i,e=void 0!==e?e:0,function(o,a,l,h){if(void 0!==o){const c=n?gn(t,n,l,r):t;if(h)return i?fn(o,c,e):(0,Y.uZ)(o,e,c);const u=1e-9,d=Math.ceil(Math.log(t/c)/Math.log(s)-u),f=-a*(.5-u)+.5,_=Math.min(c,o),m=Math.floor(Math.log(t/_)/Math.log(s)+f),p=Math.max(d,m),x=t/Math.pow(s,p);return(0,Y.uZ)(x,e,c)}}}(l,e,i,c,!_&&m,u):As(e,i,c,!_&&m,u)}return{constraint:t,maxResolution:e,minResolution:i,minZoom:o,zoomFactor:l}}(t);this.maxResolution_=i.maxResolution,this.minResolution_=i.minResolution,this.zoomFactor_=i.zoomFactor,this.resolutions_=t.resolutions,this.padding_=t.padding,this.minZoom_=i.minZoom;const n=function ga(s){if(void 0!==s.extent)return Ls(s.extent,s.constrainOnlyCenter,void 0===s.smoothExtentConstraint||s.smoothExtentConstraint);const t=(0,z.UQ)(s.projection,"EPSG:3857");if(!0!==s.multiWorld&&t.isGlobal()){const e=t.getExtent().slice();return e[0]=-1/0,e[2]=1/0,Ls(e,!1,!1)}return Ko}(t),r=i.constraint,o=function _a(s){if(void 0===s.enableRotation||s.enableRotation){const e=s.constrainRotation;return void 0===e||!0===e?function Vo(s){return s=s||(0,Y.Yr)(5),function(t,e){return e?t:void 0!==t?Math.abs(t)<=s?0:t:void 0}}():!1===e?Ms:"number"==typeof e?function jo(s){const t=2*Math.PI/s;return function(e,i){return i?e:void 0!==e?e=Math.floor(e/t+.5)*t:void 0}}(e):Ms}return _n}(t);this.constraints_={center:n,resolution:r,rotation:o},this.setRotation(void 0!==t.rotation?t.rotation:0),this.setCenterInternal(void 0!==t.center?t.center:null),void 0!==t.resolution?this.setResolution(t.resolution):void 0!==t.zoom&&this.setZoom(t.zoom)}get padding(){return this.padding_}set padding(t){let e=this.padding_;this.padding_=t;const i=this.getCenter();if(i){const n=t||[0,0,0,0];e=e||[0,0,0,0];const r=this.getResolution();this.setCenterInternal([i[0]+r/2*(n[3]-e[3]+e[1]-n[1]),i[1]-r/2*(n[0]-e[0]+e[2]-n[2])])}}getUpdatedOptions_(t){const e=this.getProperties();return void 0!==e.resolution?e.resolution=this.getResolution():e.zoom=this.getZoom(),e.center=this.getCenterInternal(),e.rotation=this.getRotation(),Object.assign({},e,t)}animate(t){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const e=new Array(arguments.length);for(let i=0;i<e.length;++i){let n=arguments[i];n.center&&(n=Object.assign({},n),n.center=(0,z.Vs)(n.center,this.getProjection())),n.anchor&&(n=Object.assign({},n),n.anchor=(0,z.Vs)(n.anchor,this.getProjection())),e[i]=n}this.animateInternal.apply(this,e)}animateInternal(t){let i,e=arguments.length;e>1&&"function"==typeof arguments[e-1]&&(i=arguments[e-1],--e);let n=0;for(;n<e&&!this.isDef();++n){const c=arguments[n];c.center&&this.setCenterInternal(c.center),void 0!==c.zoom?this.setZoom(c.zoom):c.resolution&&this.setResolution(c.resolution),void 0!==c.rotation&&this.setRotation(c.rotation)}if(n===e)return void(i&&Yi(i,!0));let r=Date.now(),o=this.targetCenter_.slice(),a=this.targetResolution_,l=this.targetRotation_;const h=[];for(;n<e;++n){const c=arguments[n],u={start:r,complete:!1,anchor:c.anchor,duration:void 0!==c.duration?c.duration:1e3,easing:c.easing||mn,callback:i};if(c.center&&(u.sourceCenter=o,u.targetCenter=c.center.slice(),o=u.targetCenter),void 0!==c.zoom?(u.sourceResolution=a,u.targetResolution=this.getResolutionForZoom(c.zoom),a=u.targetResolution):c.resolution&&(u.sourceResolution=a,u.targetResolution=c.resolution,a=u.targetResolution),void 0!==c.rotation){u.sourceRotation=l;const d=(0,Y.$W)(c.rotation-l+Math.PI,2*Math.PI)-Math.PI;u.targetRotation=l+d,l=u.targetRotation}(s=u).sourceCenter&&s.targetCenter&&!(0,jt.fS)(s.sourceCenter,s.targetCenter)||s.sourceResolution!==s.targetResolution||s.sourceRotation!==s.targetRotation?r+=u.duration:u.complete=!0,h.push(u)}var s;this.animations_.push(h),this.setHint(0,1),this.updateAnimations_()}getAnimating(){return this.hints_[0]>0}getInteracting(){return this.hints_[1]>0}cancelAnimations(){let t;this.setHint(0,-this.hints_[0]);for(let e=0,i=this.animations_.length;e<i;++e){const n=this.animations_[e];if(n[0].callback&&Yi(n[0].callback,!1),!t)for(let r=0,o=n.length;r<o;++r){const a=n[r];if(!a.complete){t=a.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=t,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(void 0!==this.updateAnimationKey_&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const t=Date.now();let e=!1;for(let i=this.animations_.length-1;i>=0;--i){const n=this.animations_[i];let r=!0;for(let o=0,a=n.length;o<a;++o){const l=n[o];if(l.complete)continue;const h=t-l.start;let c=l.duration>0?h/l.duration:1;c>=1?(l.complete=!0,c=1):r=!1;const u=l.easing(c);if(l.sourceCenter){const d=l.sourceCenter[0],f=l.sourceCenter[1],_=l.targetCenter[0],m=l.targetCenter[1];this.nextCenter_=l.targetCenter,this.targetCenter_=[d+u*(_-d),f+u*(m-f)]}if(l.sourceResolution&&l.targetResolution){const d=1===u?l.targetResolution:l.sourceResolution+u*(l.targetResolution-l.sourceResolution);if(l.anchor){const f=this.getViewportSize_(this.getRotation()),_=this.constraints_.resolution(d,0,f,!0);this.targetCenter_=this.calculateCenterZoom(_,l.anchor)}this.nextResolution_=l.targetResolution,this.targetResolution_=d,this.applyTargetState_(!0)}if(void 0!==l.sourceRotation&&void 0!==l.targetRotation){const d=1===u?(0,Y.$W)(l.targetRotation+Math.PI,2*Math.PI)-Math.PI:l.sourceRotation+u*(l.targetRotation-l.sourceRotation);if(l.anchor){const f=this.constraints_.rotation(d,!0);this.targetCenter_=this.calculateCenterRotate(f,l.anchor)}this.nextRotation_=l.targetRotation,this.targetRotation_=d}if(this.applyTargetState_(!0),e=!0,!l.complete)break}if(r){this.animations_[i]=null,this.setHint(0,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const o=n[0].callback;o&&Yi(o,!0)}}this.animations_=this.animations_.filter(Boolean),e&&void 0===this.updateAnimationKey_&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(t,e){let i;const n=this.getCenterInternal();return void 0!==n&&(i=[n[0]-e[0],n[1]-e[1]],(0,jt.U1)(i,t-this.getRotation()),(0,jt.IH)(i,e)),i}calculateCenterZoom(t,e){let i;const n=this.getCenterInternal(),r=this.getResolution();return void 0!==n&&void 0!==r&&(i=[e[0]-t*(e[0]-n[0])/r,e[1]-t*(e[1]-n[1])/r]),i}getViewportSize_(t){const e=this.viewportSize_;if(t){const i=e[0],n=e[1];return[Math.abs(i*Math.cos(t))+Math.abs(n*Math.sin(t)),Math.abs(i*Math.sin(t))+Math.abs(n*Math.cos(t))]}return e}setViewportSize(t){this.viewportSize_=Array.isArray(t)?t.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const t=this.getCenterInternal();return t&&(0,z.lO)(t,this.getProjection())}getCenterInternal(){return this.get(zt.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(t){return void 0!==t?(t[0]=this.hints_[0],t[1]=this.hints_[1],t):this.hints_.slice()}calculateExtent(t){const e=this.calculateExtentInternal(t);return(0,z.Fj)(e,this.getProjection())}calculateExtentInternal(t){t=t||this.getViewportSizeMinusPadding_();const e=this.getCenterInternal();(0,H.h)(e,1);const i=this.getResolution();(0,H.h)(void 0!==i,2);const n=this.getRotation();return(0,H.h)(void 0!==n,3),(0,T.p8)(e,i,n,t)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(t){this.applyOptions_(this.getUpdatedOptions_({maxZoom:t}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(t){this.applyOptions_(this.getUpdatedOptions_({minZoom:t}))}setConstrainResolution(t){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:t}))}getProjection(){return this.projection_}getResolution(){return this.get(zt.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(t,e){return this.getResolutionForExtentInternal((0,z.dY)(t,this.getProjection()),e)}getResolutionForExtentInternal(t,e){e=e||this.getViewportSizeMinusPadding_();const i=(0,T.dz)(t)/e[0],n=(0,T.Cr)(t)/e[1];return Math.max(i,n)}getResolutionForValueFunction(t){t=t||2;const e=this.getConstrainedResolution(this.maxResolution_),n=Math.log(e/this.minResolution_)/Math.log(t);return function(r){return e/Math.pow(t,r*n)}}getRotation(){return this.get(zt.ROTATION)}getValueForResolutionFunction(t){const e=Math.log(t||2),i=this.getConstrainedResolution(this.maxResolution_),r=Math.log(i/this.minResolution_)/e;return function(o){return Math.log(i/o)/e/r}}getViewportSizeMinusPadding_(t){let e=this.getViewportSize_(t);const i=this.padding_;return i&&(e=[e[0]-i[1]-i[3],e[1]-i[0]-i[2]]),e}getState(){const t=this.getProjection(),e=this.getResolution(),i=this.getRotation();let n=this.getCenterInternal();const r=this.padding_;if(r){const o=this.getViewportSizeMinusPadding_();n=In(n,this.getViewportSize_(),[o[0]/2+r[3],o[1]/2+r[0]],e,i)}return{center:n.slice(0),projection:void 0!==t?t:null,resolution:e,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:i,zoom:this.getZoom()}}getZoom(){let t;const e=this.getResolution();return void 0!==e&&(t=this.getZoomForResolution(e)),t}getZoomForResolution(t){let i,n,e=this.minZoom_||0;if(this.resolutions_){const r=k(this.resolutions_,t,1);e=r,i=this.resolutions_[r],n=r==this.resolutions_.length-1?2:i/this.resolutions_[r+1]}else i=this.maxResolution_,n=this.zoomFactor_;return e+Math.log(i/t)/Math.log(n)}getResolutionForZoom(t){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;const e=(0,Y.uZ)(Math.floor(t),0,this.resolutions_.length-2);return this.resolutions_[e]/Math.pow(this.resolutions_[e]/this.resolutions_[e+1],(0,Y.uZ)(t-e,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,t-this.minZoom_)}fit(t,e){let i;if((0,H.h)(Array.isArray(t)||"function"==typeof t.getSimplifiedGeometry,24),Array.isArray(t))(0,H.h)(!(0,T.xb)(t),25),i=Qs((0,z.dY)(t,this.getProjection()));else if("Circle"===t.getType()){const n=(0,z.dY)(t.getExtent(),this.getProjection());i=Qs(n),i.rotate(this.getRotation(),(0,T.qg)(n))}else{const n=(0,z.Cs)();i=n?t.clone().transform(n,this.getProjection()):t}this.fitInternal(i,e)}rotatedExtentForGeometry(t){const e=this.getRotation(),i=Math.cos(e),n=Math.sin(-e),r=t.getFlatCoordinates(),o=t.getStride();let a=1/0,l=1/0,h=-1/0,c=-1/0;for(let u=0,d=r.length;u<d;u+=o){const f=r[u]*i-r[u+1]*n,_=r[u]*n+r[u+1]*i;a=Math.min(a,f),l=Math.min(l,_),h=Math.max(h,f),c=Math.max(c,_)}return[a,l,h,c]}fitInternal(t,e){let i=(e=e||{}).size;i||(i=this.getViewportSizeMinusPadding_());const n=void 0!==e.padding?e.padding:[0,0,0,0],r=void 0!==e.nearest&&e.nearest;let o;o=void 0!==e.minResolution?e.minResolution:void 0!==e.maxZoom?this.getResolutionForZoom(e.maxZoom):0;const a=this.rotatedExtentForGeometry(t);let l=this.getResolutionForExtentInternal(a,[i[0]-n[1]-n[3],i[1]-n[0]-n[2]]);l=isNaN(l)?o:Math.max(l,o),l=this.getConstrainedResolution(l,r?0:1);const h=this.getRotation(),c=Math.sin(h),u=Math.cos(h),d=(0,T.qg)(a);d[0]+=(n[1]-n[3])/2*l,d[1]+=(n[0]-n[2])/2*l;const m=this.getConstrainedCenter([d[0]*u-d[1]*c,d[1]*u+d[0]*c],l),p=e.callback?e.callback:Rt;void 0!==e.duration?this.animateInternal({resolution:l,center:m,duration:e.duration,easing:e.easing},p):(this.targetResolution_=l,this.targetCenter_=m,this.applyTargetState_(!1,!0),Yi(p,!0))}centerOn(t,e,i){this.centerOnInternal((0,z.Vs)(t,this.getProjection()),e,i)}centerOnInternal(t,e,i){this.setCenterInternal(In(t,e,i,this.getResolution(),this.getRotation()))}calculateCenterShift(t,e,i,n){let r;const o=this.padding_;if(o&&t){const a=this.getViewportSizeMinusPadding_(-i),l=In(t,n,[a[0]/2+o[3],a[1]/2+o[0]],e,i);r=[t[0]-l[0],t[1]-l[1]]}return r}isDef(){return!!this.getCenterInternal()&&void 0!==this.getResolution()}adjustCenter(t){const e=(0,z.lO)(this.targetCenter_,this.getProjection());this.setCenter([e[0]+t[0],e[1]+t[1]])}adjustCenterInternal(t){const e=this.targetCenter_;this.setCenterInternal([e[0]+t[0],e[1]+t[1]])}adjustResolution(t,e){e=e&&(0,z.Vs)(e,this.getProjection()),this.adjustResolutionInternal(t,e)}adjustResolutionInternal(t,e){const i=this.getAnimating()||this.getInteracting(),n=this.getViewportSize_(this.getRotation()),r=this.constraints_.resolution(this.targetResolution_*t,0,n,i);e&&(this.targetCenter_=this.calculateCenterZoom(r,e)),this.targetResolution_*=t,this.applyTargetState_()}adjustZoom(t,e){this.adjustResolution(Math.pow(this.zoomFactor_,-t),e)}adjustRotation(t,e){e&&(e=(0,z.Vs)(e,this.getProjection())),this.adjustRotationInternal(t,e)}adjustRotationInternal(t,e){const i=this.getAnimating()||this.getInteracting(),n=this.constraints_.rotation(this.targetRotation_+t,i);e&&(this.targetCenter_=this.calculateCenterRotate(n,e)),this.targetRotation_+=t,this.applyTargetState_()}setCenter(t){this.setCenterInternal(t&&(0,z.Vs)(t,this.getProjection()))}setCenterInternal(t){this.targetCenter_=t,this.applyTargetState_()}setHint(t,e){return this.hints_[t]+=e,this.changed(),this.hints_[t]}setResolution(t){this.targetResolution_=t,this.applyTargetState_()}setRotation(t){this.targetRotation_=t,this.applyTargetState_()}setZoom(t){this.setResolution(this.getResolutionForZoom(t))}applyTargetState_(t,e){const i=this.getAnimating()||this.getInteracting()||e,n=this.constraints_.rotation(this.targetRotation_,i),r=this.getViewportSize_(n),o=this.constraints_.resolution(this.targetResolution_,0,r,i),a=this.constraints_.center(this.targetCenter_,o,r,i,this.calculateCenterShift(this.targetCenter_,o,n,r));this.get(zt.ROTATION)!==n&&this.set(zt.ROTATION,n),this.get(zt.RESOLUTION)!==o&&(this.set(zt.RESOLUTION,o),this.set("zoom",this.getZoom(),!0)),(!a||!this.get(zt.CENTER)||!(0,jt.fS)(this.get(zt.CENTER),a))&&this.set(zt.CENTER,a),this.getAnimating()&&!t&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(t,e,i){t=void 0!==t?t:200;const n=e||0,r=this.constraints_.rotation(this.targetRotation_),o=this.getViewportSize_(r),a=this.constraints_.resolution(this.targetResolution_,n,o),l=this.constraints_.center(this.targetCenter_,a,o,!1,this.calculateCenterShift(this.targetCenter_,a,r,o));if(0===t&&!this.cancelAnchor_)return this.targetResolution_=a,this.targetRotation_=r,this.targetCenter_=l,void this.applyTargetState_();i=i||(0===t?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==a||this.getRotation()!==r||!this.getCenterInternal()||!(0,jt.fS)(this.getCenterInternal(),l))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:r,center:l,resolution:a,duration:t,easing:Ze,anchor:i}))}beginInteraction(){this.resolveConstraints(0),this.setHint(1,1)}endInteraction(t,e,i){i=i&&(0,z.Vs)(i,this.getProjection()),this.endInteractionInternal(t,e,i)}endInteractionInternal(t,e,i){this.setHint(1,-1),this.resolveConstraints(t,e,i)}getConstrainedCenter(t,e){const i=this.getViewportSize_(this.getRotation());return this.constraints_.center(t,e||this.getResolution(),i)}getConstrainedZoom(t,e){const i=this.getResolutionForZoom(t);return this.getZoomForResolution(this.getConstrainedResolution(i,e))}getConstrainedResolution(t,e){e=e||0;const i=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(t,e,i)}},Sn=class pa extends Bt{constructor(t){super();const e=t.element;e&&!t.target&&!e.style.pointerEvents&&(e.style.pointerEvents="auto"),this.element=e||null,this.target_=null,this.map_=null,this.listenerKeys=[],t.render&&(this.render=t.render),t.target&&this.setTarget(t.target)}disposeInternal(){on(this.element),super.disposeInternal()}getMap(){return this.map_}setMap(t){this.map_&&on(this.element);for(let e=0,i=this.listenerKeys.length;e<i;++e)dt(this.listenerKeys[e]);this.listenerKeys.length=0,this.map_=t,t&&((this.target_?this.target_:t.getOverlayContainerStopEvent()).appendChild(this.element),this.render!==Rt&&this.listenerKeys.push($(t,"postrender",this.render,this)),t.render())}render(t){}setTarget(t){this.target_="string"==typeof t?document.getElementById(t):t}},ya=class xa extends Sn{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=void 0===t.collapsed||t.collapsed,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=void 0!==t.collapsible,this.collapsible_=void 0===t.collapsible||t.collapsible,this.collapsible_||(this.collapsed_=!1);const e=void 0!==t.className?t.className:"ol-attribution",i=void 0!==t.tipLabel?t.tipLabel:"Attributions",n=void 0!==t.expandClassName?t.expandClassName:e+"-expand",r=void 0!==t.collapseLabel?t.collapseLabel:"\u203a",o=void 0!==t.collapseClassName?t.collapseClassName:e+"-collapse";"string"==typeof r?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=r,this.collapseLabel_.className=o):this.collapseLabel_=r;const a=void 0!==t.label?t.label:"i";"string"==typeof a?(this.label_=document.createElement("span"),this.label_.textContent=a,this.label_.className=n):this.label_=a;const l=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=i,this.toggleButton_.appendChild(l),this.toggleButton_.addEventListener("click",this.handleClick_.bind(this),!1);const c=this.element;c.className=e+" "+bi+" "+rn+(this.collapsed_&&this.collapsible_?" "+Es:"")+(this.collapsible_?"":" ol-uncollapsible"),c.appendChild(this.toggleButton_),c.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(t){const e={},i=[];let n=!0;const r=t.layerStatesArray;for(let o=0,a=r.length;o<a;++o){const l=r[o];if(!sn(l,t.viewState))continue;const h=l.layer.getSource();if(!h)continue;const c=h.getAttributions();if(!c)continue;const u=c(t);if(u)if(n=n&&!1!==h.getAttributionsCollapsible(),Array.isArray(u))for(let d=0,f=u.length;d<f;++d)u[d]in e||(i.push(u[d]),e[u[d]]=!0);else u in e||(i.push(u),e[u]=!0)}return this.overrideCollapsible_||this.setCollapsible(n),i}updateElement_(t){if(!t)return void(this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1));const e=this.collectSourceAttributions_(t),i=e.length>0;if(this.renderedVisible_!=i&&(this.element.style.display=i?"":"none",this.renderedVisible_=i),!ot(e,this.renderedAttributions_)){!function Io(s){for(;s.lastChild;)s.removeChild(s.lastChild)}(this.ulElement_);for(let n=0,r=e.length;n<r;++n){const o=document.createElement("li");o.innerHTML=e[n],this.ulElement_.appendChild(o)}this.renderedAttributions_=e}}handleClick_(t){t.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(Es),this.collapsed_?vs(this.collapseLabel_,this.label_):vs(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(t){this.collapsible_!==t&&(this.collapsible_=t,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(t){this.userCollapsed_=t,this.collapsible_&&this.collapsed_!==t&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(t){this.updateElement_(t.frameState)}},Ca=class Ea extends Sn{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target});const e=void 0!==t.className?t.className:"ol-rotate",i=void 0!==t.label?t.label:"\u21e7",n=void 0!==t.compassClassName?t.compassClassName:"ol-compass";this.label_=null,"string"==typeof i?(this.label_=document.createElement("span"),this.label_.className=n,this.label_.textContent=i):(this.label_=i,this.label_.classList.add(n));const r=t.tipLabel?t.tipLabel:"Reset rotation",o=document.createElement("button");o.className=e+"-reset",o.setAttribute("type","button"),o.title=r,o.appendChild(this.label_),o.addEventListener("click",this.handleClick_.bind(this),!1);const l=this.element;l.className=e+" "+bi+" "+rn,l.appendChild(o),this.callResetNorth_=t.resetNorth?t.resetNorth:void 0,this.duration_=void 0!==t.duration?t.duration:250,this.autoHide_=void 0===t.autoHide||t.autoHide,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(Mi)}handleClick_(t){t.preventDefault(),void 0!==this.callResetNorth_?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const e=this.getMap().getView();if(!e)return;const i=e.getRotation();void 0!==i&&(this.duration_>0&&i%(2*Math.PI)!=0?e.animate({rotation:0,duration:this.duration_,easing:Ze}):e.setRotation(0))}render(t){const e=t.frameState;if(!e)return;const i=e.viewState.rotation;if(i!=this.rotation_){const n="rotate("+i+"rad)";if(this.autoHide_){const r=this.element.classList.contains(Mi);r||0!==i?r&&0!==i&&this.element.classList.remove(Mi):this.element.classList.add(Mi)}this.label_.style.transform=n}this.rotation_=i}},Ra=class Ta extends Sn{constructor(t){t=t||{},super({element:document.createElement("div"),target:t.target});const e=void 0!==t.className?t.className:"ol-zoom",i=void 0!==t.delta?t.delta:1,n=void 0!==t.zoomInClassName?t.zoomInClassName:e+"-in",r=void 0!==t.zoomOutClassName?t.zoomOutClassName:e+"-out",o=void 0!==t.zoomInLabel?t.zoomInLabel:"+",a=void 0!==t.zoomOutLabel?t.zoomOutLabel:"\u2013",l=void 0!==t.zoomInTipLabel?t.zoomInTipLabel:"Zoom in",h=void 0!==t.zoomOutTipLabel?t.zoomOutTipLabel:"Zoom out",c=document.createElement("button");c.className=n,c.setAttribute("type","button"),c.title=l,c.appendChild("string"==typeof o?document.createTextNode(o):o),c.addEventListener("click",this.handleClick_.bind(this,i),!1);const u=document.createElement("button");u.className=r,u.setAttribute("type","button"),u.title=h,u.appendChild("string"==typeof a?document.createTextNode(a):a),u.addEventListener("click",this.handleClick_.bind(this,-i),!1);const f=this.element;f.className=e+" "+bi+" "+rn,f.appendChild(c),f.appendChild(u),this.duration_=void 0!==t.duration?t.duration:250}handleClick_(t,e){e.preventDefault(),this.zoomByDelta_(t)}zoomByDelta_(t){const i=this.getMap().getView();if(!i)return;const n=i.getZoom();if(void 0!==n){const r=i.getConstrainedZoom(n+t);this.duration_>0?(i.getAnimating()&&i.cancelAnimations(),i.animate({zoom:r,duration:this.duration_,easing:Ze})):i.setZoom(r)}}};function wn(s,t,e,i){const n=s.getZoom();if(void 0===n)return;const r=s.getConstrainedZoom(n+t),o=s.getResolutionForZoom(r);s.getAnimating()&&s.cancelAnimations(),s.animate({resolution:o,anchor:e,duration:void 0!==i?i:250,easing:Ze})}const li=class Ia extends Bt{constructor(t){super(),t&&t.handleEvent&&(this.handleEvent=t.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get("active")}getMap(){return this.map_}handleEvent(t){return!0}setActive(t){this.set("active",t)}setMap(t){this.map_=t}},La=class wa extends li{constructor(t){super(),this.delta_=(t=t||{}).delta?t.delta:1,this.duration_=void 0!==t.duration?t.duration:250}handleEvent(t){let e=!1;if(t.type==gt.DBLCLICK){const i=t.originalEvent,r=t.coordinate,o=i.shiftKey?-this.delta_:this.delta_;wn(t.map.getView(),o,r,this.duration_),i.preventDefault(),e=!0}return!e}};function Ln(s){const t=s.length;let e=0,i=0;for(let n=0;n<t;n++)e+=s[n].clientX,i+=s[n].clientY;return[e/t,i/t]}const hi=class Aa extends li{constructor(t){super(t=t||{}),t.handleDownEvent&&(this.handleDownEvent=t.handleDownEvent),t.handleDragEvent&&(this.handleDragEvent=t.handleDragEvent),t.handleMoveEvent&&(this.handleMoveEvent=t.handleMoveEvent),t.handleUpEvent&&(this.handleUpEvent=t.handleUpEvent),t.stopDown&&(this.stopDown=t.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(t){return!1}handleDragEvent(t){}handleEvent(t){if(!t.originalEvent)return!0;let e=!1;if(this.updateTrackedPointers_(t),this.handlingDownUpSequence){if(t.type==gt.POINTERDRAG)this.handleDragEvent(t),t.originalEvent.preventDefault();else if(t.type==gt.POINTERUP){const i=this.handleUpEvent(t);this.handlingDownUpSequence=i&&this.targetPointers.length>0}}else if(t.type==gt.POINTERDOWN){const i=this.handleDownEvent(t);this.handlingDownUpSequence=i,e=this.stopDown(i)}else t.type==gt.POINTERMOVE&&this.handleMoveEvent(t);return!e}handleMoveEvent(t){}handleUpEvent(t){return!1}stopDown(t){return t}updateTrackedPointers_(t){t.activePointers&&(this.targetPointers=t.activePointers)}};function An(s){const t=arguments;return function(e){let i=!0;for(let n=0,r=t.length;n<r&&(i=i&&t[n](e),i);++n);return i}}const Ma=function(s){const t=s.originalEvent;return t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},tr=function(s){return!s.map.getTargetElement().hasAttribute("tabindex")||function(s){const t=s.map.getTargetElement(),e=s.map.getOwnerDocument().activeElement;return t.contains(e)}(s)},Oa=Nt,er=function(s){const t=s.originalEvent;return 0==t.button&&!(lo&&ho&&t.ctrlKey)},ir=function(s){const t=s.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&!t.shiftKey},Pa=function(s){const t=s.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},nr=function(s){const t=s.originalEvent,e=t.target.tagName;return"INPUT"!==e&&"SELECT"!==e&&"TEXTAREA"!==e&&!t.target.isContentEditable},Mn=function(s){const t=s.originalEvent;return(0,H.h)(void 0!==t,56),"mouse"==t.pointerType},Da=function(s){const t=s.originalEvent;return(0,H.h)(void 0!==t,56),t.isPrimary&&0===t.button},ka=class Fa extends hi{constructor(t){super({stopDown:Pt}),this.kinetic_=(t=t||{}).kinetic,this.lastCentroid=null,this.panning_=!1;const e=t.condition?t.condition:An(ir,Da);this.condition_=t.onFocusOnly?An(tr,e):e,this.noKinetic_=!1}handleDragEvent(t){this.panning_||(this.panning_=!0,this.getMap().getView().beginInteraction());const e=this.targetPointers,i=Ln(e);if(e.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(i[0],i[1]),this.lastCentroid){const n=[this.lastCentroid[0]-i[0],i[1]-this.lastCentroid[1]],o=t.map.getView();(0,jt.bA)(n,o.getResolution()),(0,jt.U1)(n,o.getRotation()),o.adjustCenterInternal(n)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=i,this.lastPointersCount_=e.length,t.originalEvent.preventDefault()}handleUpEvent(t){const e=t.map,i=e.getView();if(0===this.targetPointers.length){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const n=this.kinetic_.getDistance(),r=this.kinetic_.getAngle(),o=i.getCenterInternal(),a=e.getPixelFromCoordinateInternal(o),l=e.getCoordinateFromPixelInternal([a[0]-n*Math.cos(r),a[1]-n*Math.sin(r)]);i.animateInternal({center:i.getConstrainedCenter(l),duration:500,easing:Ze})}return this.panning_&&(this.panning_=!1,i.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(t){if(this.targetPointers.length>0&&this.condition_(t)){const i=t.map.getView();return this.lastCentroid=null,i.getAnimating()&&i.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}},Ga=class Na extends hi{constructor(t){t=t||{},super({stopDown:Pt}),this.condition_=t.condition?t.condition:Ma,this.lastAngle_=void 0,this.duration_=void 0!==t.duration?t.duration:250}handleDragEvent(t){if(!Mn(t))return;const e=t.map,i=e.getView();if(i.getConstraints().rotation===_n)return;const n=e.getSize(),r=t.pixel,o=Math.atan2(n[1]/2-r[1],r[0]-n[0]/2);void 0!==this.lastAngle_&&i.adjustRotationInternal(-(o-this.lastAngle_)),this.lastAngle_=o}handleUpEvent(t){return!Mn(t)||(t.map.getView().endInteraction(this.duration_),!1)}handleDownEvent(t){return!!(Mn(t)&&er(t)&&this.condition_(t))&&(t.map.getView().beginInteraction(),this.lastAngle_=void 0,!0)}},za=class Ya extends P{constructor(t){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+t,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const t=this.startPixel_,e=this.endPixel_,i="px",n=this.element_.style;n.left=Math.min(t[0],e[0])+i,n.top=Math.min(t[1],e[1])+i,n.width=Math.abs(e[0]-t[0])+i,n.height=Math.abs(e[1]-t[1])+i}setMap(t){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const e=this.element_.style;e.left="inherit",e.top="inherit",e.width="inherit",e.height="inherit"}this.map_=t,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(t,e){this.startPixel_=t,this.endPixel_=e,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){const t=this.startPixel_,e=this.endPixel_,n=[t,[t[0],e[1]],e,[e[0],t[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);n[4]=n[0].slice(),this.geometry_?this.geometry_.setCoordinates([n]):this.geometry_=new ca([n])}getGeometry(){return this.geometry_}};class bn extends y{constructor(t,e,i){super(t),this.coordinate=e,this.mapBrowserEvent=i}}const Xa=class Wa extends hi{constructor(t){super(),this.box_=new za((t=t||{}).className||"ol-dragbox"),this.minArea_=void 0!==t.minArea?t.minArea:64,t.onBoxEnd&&(this.onBoxEnd=t.onBoxEnd),this.startPixel_=null,this.condition_=t.condition?t.condition:er,this.boxEndCondition_=t.boxEndCondition?t.boxEndCondition:this.defaultBoxEndCondition}defaultBoxEndCondition(t,e,i){const n=i[0]-e[0],r=i[1]-e[1];return n*n+r*r>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(t){this.box_.setPixels(this.startPixel_,t.pixel),this.dispatchEvent(new bn("boxdrag",t.coordinate,t))}handleUpEvent(t){this.box_.setMap(null);const e=this.boxEndCondition_(t,this.startPixel_,t.pixel);return e&&this.onBoxEnd(t),this.dispatchEvent(new bn(e?"boxend":"boxcancel",t.coordinate,t)),!1}handleDownEvent(t){return!!this.condition_(t)&&(this.startPixel_=t.pixel,this.box_.setMap(t.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new bn("boxstart",t.coordinate,t)),!0)}onBoxEnd(t){}},Ka=class Za extends Xa{constructor(t){super({condition:(t=t||{}).condition?t.condition:Pa,className:t.className||"ol-dragzoom",minArea:t.minArea}),this.duration_=void 0!==t.duration?t.duration:200,this.out_=void 0!==t.out&&t.out}onBoxEnd(t){const i=this.getMap().getView();let n=this.getGeometry();if(this.out_){const r=i.rotatedExtentForGeometry(n),o=i.getResolutionForExtentInternal(r),a=i.getResolution()/o;n=n.clone(),n.scale(a*a)}i.fitInternal(n,{duration:this.duration_,easing:Ze})}},Ua=class Ba extends li{constructor(t){super(),t=t||{},this.defaultCondition_=function(e){return ir(e)&&nr(e)},this.condition_=void 0!==t.condition?t.condition:this.defaultCondition_,this.duration_=void 0!==t.duration?t.duration:100,this.pixelDelta_=void 0!==t.pixelDelta?t.pixelDelta:128}handleEvent(t){let e=!1;if("keydown"==t.type){const i=t.originalEvent,n=i.keyCode;if(this.condition_(t)&&(40==n||37==n||39==n||38==n)){const o=t.map.getView(),a=o.getResolution()*this.pixelDelta_;let l=0,h=0;40==n?h=-a:37==n?l=-a:39==n?l=a:h=a;const c=[l,h];(0,jt.U1)(c,o.getRotation()),function Sa(s,t,e){const i=s.getCenterInternal();i&&s.animateInternal({duration:void 0!==e?e:250,easing:Ho,center:s.getConstrainedCenter([i[0]+t[0],i[1]+t[1]])})}(o,c,this.duration_),i.preventDefault(),e=!0}}return!e}},Va=class ja extends li{constructor(t){super(),this.condition_=(t=t||{}).condition?t.condition:nr,this.delta_=t.delta?t.delta:1,this.duration_=void 0!==t.duration?t.duration:100}handleEvent(t){let e=!1;if("keydown"==t.type||"keypress"==t.type){const i=t.originalEvent,n=i.charCode;if(this.condition_(t)&&(n=="+".charCodeAt(0)||n=="-".charCodeAt(0))){const r=t.map,o=n=="+".charCodeAt(0)?this.delta_:-this.delta_;wn(r.getView(),o,void 0,this.duration_),i.preventDefault(),e=!0}}return!e}},Qa=class Ja extends li{constructor(t){super(t=t||{}),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=void 0!==t.maxDelta?t.maxDelta:1,this.duration_=void 0!==t.duration?t.duration:250,this.timeout_=void 0!==t.timeout?t.timeout:80,this.useAnchor_=void 0===t.useAnchor||t.useAnchor,this.constrainResolution_=void 0!==t.constrainResolution&&t.constrainResolution;const e=t.condition?t.condition:Oa;this.condition_=t.onFocusOnly?An(tr,e):e,this.lastAnchor_=null,this.startTime_=void 0,this.mode_=void 0,this.trackpadEventGap_=400,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const t=this.getMap();t&&t.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_)}handleEvent(t){if(!this.condition_(t)||"wheel"!==t.type)return!0;const i=t.map,n=t.originalEvent;let r;if(n.preventDefault(),this.useAnchor_&&(this.lastAnchor_=t.coordinate),"wheel"==t.type&&(r=n.deltaY,ao&&n.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(r/=ls),n.deltaMode===WheelEvent.DOM_DELTA_LINE&&(r*=40)),0===r)return!1;this.lastDelta_=r;const o=Date.now();void 0===this.startTime_&&(this.startTime_=o),(!this.mode_||o-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(r)<4?"trackpad":"wheel");const a=i.getView();if("trackpad"===this.mode_&&!a.getConstrainResolution()&&!this.constrainResolution_)return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(a.getAnimating()&&a.cancelAnimations(),a.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),a.adjustZoom(-r/this.deltaPerZoom_,this.lastAnchor_),this.startTime_=o,!1;this.totalDelta_+=r;const l=Math.max(this.timeout_-(o-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,i),l),!1}handleWheelZoom_(t){const e=t.getView();e.getAnimating()&&e.cancelAnimations();let i=-(0,Y.uZ)(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(e.getConstrainResolution()||this.constrainResolution_)&&(i=i?i>0?1:-1:0),wn(e,i,this.lastAnchor_,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(t){this.useAnchor_=t,t||(this.lastAnchor_=null)}},tl=class $a extends hi{constructor(t){const e=t=t||{};e.stopDown||(e.stopDown=Pt),super(e),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=void 0!==t.threshold?t.threshold:.3,this.duration_=void 0!==t.duration?t.duration:250}handleDragEvent(t){let e=0;const i=this.targetPointers[0],n=this.targetPointers[1],r=Math.atan2(n.clientY-i.clientY,n.clientX-i.clientX);if(void 0!==this.lastAngle_){const c=r-this.lastAngle_;this.rotationDelta_+=c,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),e=c}this.lastAngle_=r;const o=t.map,a=o.getView();if(a.getConstraints().rotation===_n)return;const l=o.getViewport().getBoundingClientRect(),h=Ln(this.targetPointers);h[0]-=l.left,h[1]-=l.top,this.anchor_=o.getCoordinateFromPixelInternal(h),this.rotating_&&(o.render(),a.adjustRotationInternal(e,this.anchor_))}handleUpEvent(t){return!(this.targetPointers.length<2&&(t.map.getView().endInteraction(this.duration_),1))}handleDownEvent(t){if(this.targetPointers.length>=2){const e=t.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1}},il=class el extends hi{constructor(t){const e=t=t||{};e.stopDown||(e.stopDown=Pt),super(e),this.anchor_=null,this.duration_=void 0!==t.duration?t.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(t){let e=1;const i=this.targetPointers[0],n=this.targetPointers[1],r=i.clientX-n.clientX,o=i.clientY-n.clientY,a=Math.sqrt(r*r+o*o);void 0!==this.lastDistance_&&(e=this.lastDistance_/a),this.lastDistance_=a;const l=t.map,h=l.getView();1!=e&&(this.lastScaleDelta_=e);const c=l.getViewport().getBoundingClientRect(),u=Ln(this.targetPointers);u[0]-=c.left,u[1]-=c.top,this.anchor_=l.getCoordinateFromPixelInternal(u),l.render(),h.adjustResolutionInternal(e,this.anchor_)}handleUpEvent(t){return!(this.targetPointers.length<2)||(t.map.getView().endInteraction(this.duration_,this.lastScaleDelta_>1?1:-1),!1)}handleDownEvent(t){if(this.targetPointers.length>=2){const e=t.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1}};function sr(s){return s[0]>0&&s[1]>0}function At(s,t){return Array.isArray(s)?s:(void 0===t?t=[s,s]:(t[0]=s,t[1]=s),t)}function rr(s){s instanceof Ai?s.setMapInternal(null):s instanceof Fi&&s.getLayers().forEach(rr)}function or(s,t){if(s instanceof Ai)s.setMapInternal(t);else if(s instanceof Fi){const e=s.getLayers().getArray();for(let i=0,n=e.length;i<n;++i)or(e[i],t)}}const al=class rl extends Bt{constructor(t){super();const e=function ol(s){let t=null;void 0!==s.keyboardEventTarget&&(t="string"==typeof s.keyboardEventTarget?document.getElementById(s.keyboardEventTarget):s.keyboardEventTarget);const e={},i=s.layers&&"function"==typeof s.layers.getLayers?s.layers:new Fi({layers:s.layers});let n,r,o;return e.layergroup=i,e.target=s.target,e.view=s.view instanceof me?s.view:new me,void 0!==s.controls&&(Array.isArray(s.controls)?n=new Ut(s.controls.slice()):((0,H.h)("function"==typeof s.controls.getArray,47),n=s.controls)),void 0!==s.interactions&&(Array.isArray(s.interactions)?r=new Ut(s.interactions.slice()):((0,H.h)("function"==typeof s.interactions.getArray,48),r=s.interactions)),void 0!==s.overlays?Array.isArray(s.overlays)?o=new Ut(s.overlays.slice()):((0,H.h)("function"==typeof s.overlays.getArray,49),o=s.overlays):o=new Ut,{controls:n,interactions:r,keyboardEventTarget:t,overlays:o,values:e}}(t=t||{});this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=void 0!==t.maxTilesLoading?t.maxTilesLoading:16,this.pixelRatio_=void 0!==t.pixelRatio?t.pixelRatio:ls,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=[1,0,0,1,0,0],this.pixelToCoordinateTransform_=[1,0,0,1,0,0],this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=t.moveTolerance,this.keyboardEventTarget_=e.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.controls=e.controls||function va(s){s=s||{};const t=new Ut;return(void 0===s.zoom||s.zoom)&&t.push(new Ra(s.zoomOptions)),(void 0===s.rotate||s.rotate)&&t.push(new Ca(s.rotateOptions)),(void 0===s.attribution||s.attribution)&&t.push(new ya(s.attributionOptions)),t}(),this.interactions=e.interactions||function nl(s){s=s||{};const t=new Ut,e=new class Ha{constructor(t,e,i){this.decay_=t,this.minVelocity_=e,this.delay_=i,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(t,e){this.points_.push(t,e,Date.now())}end(){if(this.points_.length<6)return!1;const t=Date.now()-this.delay_,e=this.points_.length-3;if(this.points_[e+2]<t)return!1;let i=e-3;for(;i>0&&this.points_[i+2]>t;)i-=3;const n=this.points_[e+2]-this.points_[i+2];if(n<1e3/60)return!1;const r=this.points_[e]-this.points_[i],o=this.points_[e+1]-this.points_[i+1];return this.angle_=Math.atan2(o,r),this.initialVelocity_=Math.sqrt(r*r+o*o)/n,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}}(-.005,.05,100);return(void 0===s.altShiftDragRotate||s.altShiftDragRotate)&&t.push(new Ga),(void 0===s.doubleClickZoom||s.doubleClickZoom)&&t.push(new La({delta:s.zoomDelta,duration:s.zoomDuration})),(void 0===s.dragPan||s.dragPan)&&t.push(new ka({onFocusOnly:s.onFocusOnly,kinetic:e})),(void 0===s.pinchRotate||s.pinchRotate)&&t.push(new tl),(void 0===s.pinchZoom||s.pinchZoom)&&t.push(new il({duration:s.zoomDuration})),(void 0===s.keyboard||s.keyboard)&&(t.push(new Ua),t.push(new Va({delta:s.zoomDelta,duration:s.zoomDuration}))),(void 0===s.mouseWheelZoom||s.mouseWheelZoom)&&t.push(new Qa({onFocusOnly:s.onFocusOnly,duration:s.zoomDuration})),(void 0===s.shiftDragZoom||s.shiftDragZoom)&&t.push(new Ka({duration:s.zoomDuration})),t}({onFocusOnly:!0}),this.overlays_=e.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new class zo extends class Go{constructor(t,e){this.priorityFunction_=t,this.keyFunction_=e,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,Kt(this.queuedElements_)}dequeue(){const t=this.elements_,e=this.priorities_,i=t[0];1==t.length?(t.length=0,e.length=0):(t[0]=t.pop(),e[0]=e.pop(),this.siftUp_(0));const n=this.keyFunction_(i);return delete this.queuedElements_[n],i}enqueue(t){(0,H.h)(!(this.keyFunction_(t)in this.queuedElements_),31);const e=this.priorityFunction_(t);return e!=ki&&(this.elements_.push(t),this.priorities_.push(e),this.queuedElements_[this.keyFunction_(t)]=!0,this.siftDown_(0,this.elements_.length-1),!0)}getCount(){return this.elements_.length}getLeftChildIndex_(t){return 2*t+1}getRightChildIndex_(t){return 2*t+2}getParentIndex_(t){return t-1>>1}heapify_(){let t;for(t=(this.elements_.length>>1)-1;t>=0;t--)this.siftUp_(t)}isEmpty(){return 0===this.elements_.length}isKeyQueued(t){return t in this.queuedElements_}isQueued(t){return this.isKeyQueued(this.keyFunction_(t))}siftUp_(t){const e=this.elements_,i=this.priorities_,n=e.length,r=e[t],o=i[t],a=t;for(;t<n>>1;){const l=this.getLeftChildIndex_(t),h=this.getRightChildIndex_(t),c=h<n&&i[h]<i[l]?h:l;e[t]=e[c],i[t]=i[c],t=c}e[t]=r,i[t]=o,this.siftDown_(a,t)}siftDown_(t,e){const i=this.elements_,n=this.priorities_,r=i[e],o=n[e];for(;e>t;){const a=this.getParentIndex_(e);if(!(n[a]>o))break;i[e]=i[a],n[e]=n[a],e=a}i[e]=r,n[e]=o}reprioritize(){const t=this.priorityFunction_,e=this.elements_,i=this.priorities_;let n=0;const r=e.length;let o,a,l;for(a=0;a<r;++a)o=e[a],l=t(o),l==ki?delete this.queuedElements_[this.keyFunction_(o)]:(i[n]=l,e[n++]=o);e.length=n,i.length=n,this.heapify_()}}{constructor(t,e){super(function(i){return t.apply(null,i)},function(i){return i[0].getKey()}),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=e,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(t){const e=super.enqueue(t);return e&&t[0].addEventListener("change",this.boundHandleTileChange_),e}getTilesLoading(){return this.tilesLoading_}handleTileChange(t){const e=t.target,i=e.getState();if(2===i||3===i||4===i){3!==i&&e.removeEventListener("change",this.boundHandleTileChange_);const n=e.getKey();n in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[n],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(t,e){let n,r,o,i=0;for(;this.tilesLoading_<t&&i<e&&this.getCount()>0;)r=this.dequeue()[0],o=r.getKey(),n=r.getState(),0===n&&!(o in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[o]=!0,++this.tilesLoading_,++i,r.load())}}(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener("layergroup",this.handleLayerGroupChanged_),this.addChangeListener("view",this.handleViewChanged_),this.addChangeListener("size",this.handleSizeChanged_),this.addChangeListener("target",this.handleTargetChanged_),this.setProperties(e.values);const i=this;t.view&&!(t.view instanceof me)&&t.view.then(function(n){i.setView(new me(n))}),this.controls.addEventListener("add",function(n){n.element.setMap(this)}.bind(this)),this.controls.addEventListener("remove",function(n){n.element.setMap(null)}.bind(this)),this.interactions.addEventListener("add",function(n){n.element.setMap(this)}.bind(this)),this.interactions.addEventListener("remove",function(n){n.element.setMap(null)}.bind(this)),this.overlays_.addEventListener("add",function(n){this.addOverlayInternal_(n.element)}.bind(this)),this.overlays_.addEventListener("remove",function(n){const r=n.element.getId();void 0!==r&&delete this.overlayIdIndex_[r.toString()],n.element.setMap(null)}.bind(this)),this.controls.forEach(function(n){n.setMap(this)}.bind(this)),this.interactions.forEach(function(n){n.setMap(this)}.bind(this)),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(t){this.getControls().push(t)}addInteraction(t){this.getInteractions().push(t)}addLayer(t){this.getLayerGroup().getLayers().push(t)}handleLayerAdd_(t){or(t.layer,this)}addOverlay(t){this.getOverlays().push(t)}addOverlayInternal_(t){const e=t.getId();void 0!==e&&(this.overlayIdIndex_[e.toString()]=t),t.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(t,e,i){if(!this.frameState_||!this.renderer_)return;const n=this.getCoordinateFromPixelInternal(t);return this.renderer_.forEachFeatureAtCoordinate(n,this.frameState_,void 0!==(i=void 0!==i?i:{}).hitTolerance?i.hitTolerance:0,!1!==i.checkWrapped,e,null,void 0!==i.layerFilter?i.layerFilter:Nt,null)}getFeaturesAtPixel(t,e){const i=[];return this.forEachFeatureAtPixel(t,function(n){i.push(n)},e),i}getAllLayers(){const t=[];return function e(i){i.forEach(function(n){n instanceof Fi?e(n.getLayers()):t.push(n)})}(this.getLayers()),t}hasFeatureAtPixel(t,e){if(!this.frameState_||!this.renderer_)return!1;const i=this.getCoordinateFromPixelInternal(t);return this.renderer_.hasFeatureAtCoordinate(i,this.frameState_,void 0!==(e=void 0!==e?e:{}).hitTolerance?e.hitTolerance:0,!1!==e.checkWrapped,void 0!==e.layerFilter?e.layerFilter:Nt,null)}getEventCoordinate(t){return this.getCoordinateFromPixel(this.getEventPixel(t))}getEventCoordinateInternal(t){return this.getCoordinateFromPixelInternal(this.getEventPixel(t))}getEventPixel(t){const e=this.viewport_.getBoundingClientRect(),i="changedTouches"in t?t.changedTouches[0]:t;return[i.clientX-e.left,i.clientY-e.top]}getTarget(){return this.get("target")}getTargetElement(){const t=this.getTarget();return void 0!==t?"string"==typeof t?document.getElementById(t):t:null}getCoordinateFromPixel(t){return(0,z.lO)(this.getCoordinateFromPixelInternal(t),this.getView().getProjection())}getCoordinateFromPixelInternal(t){const e=this.frameState_;return e?pt(e.pixelToCoordinateTransform,t.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(t){const e=this.overlayIdIndex_[t.toString()];return void 0!==e?e:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get("layergroup")}setLayers(t){const e=this.getLayerGroup();if(t instanceof Ut)return void e.setLayers(t);const i=e.getLayers();i.clear(),i.extend(t)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const t=this.getLayerGroup().getLayerStatesArray();for(let e=0,i=t.length;e<i;++e){const n=t[e];if(!n.visible)continue;const r=n.layer.getRenderer();if(r&&!r.ready)return!0;const o=n.layer.getSource();if(o&&o.loading)return!0}return!1}getPixelFromCoordinate(t){const e=(0,z.Vs)(t,this.getView().getProjection());return this.getPixelFromCoordinateInternal(e)}getPixelFromCoordinateInternal(t){const e=this.frameState_;return e?pt(e.coordinateToPixelTransform,t.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get("size")}getView(){return this.get("view")}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const t=this.getTargetElement();return t?t.ownerDocument:document}getTilePriority(t,e,i,n){return function Xo(s,t,e,i,n){if(!s||!(e in s.wantedTiles)||!s.wantedTiles[e][t.getKey()])return ki;const r=s.viewState.center,o=i[0]-r[0],a=i[1]-r[1];return 65536*Math.log(n)+Math.sqrt(o*o+a*a)/n}(this.frameState_,t,e,i,n)}handleBrowserEvent(t,e){const i=new fe(e=e||t.type,this,t);this.handleMapBrowserEvent(i)}handleMapBrowserEvent(t){if(!this.frameState_)return;const e=t.originalEvent,i=e.type;if("pointerdown"===i||"wheel"===i||"keydown"===i){const n=this.getOwnerDocument(),r=this.viewport_.getRootNode?this.viewport_.getRootNode():n,o=e.target;if(this.overlayContainerStopEvent_.contains(o)||!(r===n?n.documentElement:r).contains(o))return}if(t.frameState=this.frameState_,!1!==this.dispatchEvent(t)){const n=this.getInteractions().getArray().slice();for(let r=n.length-1;r>=0;r--){const o=n[r];if(o.getMap()===this&&o.getActive()&&this.getTargetElement()&&(!o.handleEvent(t)||t.propagationStopped))break}}}handlePostRender(){const t=this.frameState_,e=this.tileQueue_;if(!e.isEmpty()){let n=this.maxTilesLoading_,r=n;if(t){const o=t.viewHints;if(o[0]||o[1]){const a=Date.now()-t.time>8;n=a?0:8,r=a?0:2}}e.getTilesLoading()<n&&(e.reprioritize(),e.loadMoreTiles(n,r))}t&&this.renderer_&&!t.animate&&(!0===this.renderComplete_?(this.hasListener("rendercomplete")&&this.renderer_.dispatchRenderEvent("rendercomplete",t),!1===this.loaded_&&(this.loaded_=!0,this.dispatchEvent(new Xe("loadend",this,t)))):!0===this.loaded_&&(this.loaded_=!1,this.dispatchEvent(new Xe("loadstart",this,t))));const i=this.postRenderFunctions_;for(let n=0,r=i.length;n<r;++n)i[n](this,t);i.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let e=0,i=this.targetChangeHandlerKeys_.length;e<i;++e)dt(this.targetChangeHandlerKeys_[e]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener("contextmenu",this.boundHandleBrowserEvent_),this.viewport_.removeEventListener("wheel",this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,on(this.viewport_)}const t=this.getTargetElement();if(t){t.appendChild(this.viewport_),this.renderer_||(this.renderer_=new Po(this)),this.mapBrowserEventHandler_=new No(this,this.moveTolerance_);for(const n in gt)this.mapBrowserEventHandler_.addEventListener(gt[n],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener("contextmenu",this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener("wheel",this.boundHandleBrowserEvent_,!!hs&&{passive:!1});const e=this.getOwnerDocument().defaultView,i=this.keyboardEventTarget_?this.keyboardEventTarget_:t;this.targetChangeHandlerKeys_=[$(i,"keydown",this.handleBrowserEvent,this),$(i,"keypress",this.handleBrowserEvent,this),$(e,"resize",this.updateSize,this)]}else this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(dt(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(dt(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const t=this.getView();t&&(this.updateViewportSize_(),this.viewPropertyListenerKey_=$(t,"propertychange",this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=$(t,"change",this.handleViewPropertyChanged_,this),t.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(dt),this.layerGroupPropertyListenerKeys_=null);const t=this.getLayerGroup();t&&(this.handleLayerAdd_(new ge("addlayer",t)),this.layerGroupPropertyListenerKeys_=[$(t,"propertychange",this.render,this),$(t,"change",this.render,this),$(t,"addlayer",this.handleLayerAdd_,this),$(t,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){const t=this.getLayerGroup().getLayerStatesArray();for(let e=0,i=t.length;e<i;++e){const n=t[e].layer;n.hasRenderer()&&n.getRenderer().handleFontsChanged()}}render(){this.renderer_&&void 0===this.animationDelayKey_&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}removeControl(t){return this.getControls().remove(t)}removeInteraction(t){return this.getInteractions().remove(t)}removeLayer(t){return this.getLayerGroup().getLayers().remove(t)}handleLayerRemove_(t){rr(t.layer)}removeOverlay(t){return this.getOverlays().remove(t)}renderFrame_(t){const e=this.getSize(),i=this.getView(),n=this.frameState_;let r=null;if(void 0!==e&&sr(e)&&i&&i.isDef()){const o=i.getHints(this.frameState_?this.frameState_.viewHints:void 0),a=i.getState();if(r={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutterTree:null,extent:(0,T.p8)(a.center,a.resolution,a.rotation,e),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:e,tileQueue:this.tileQueue_,time:t,usedTiles:{},viewState:a,viewHints:o,wantedTiles:{},mapId:st(this),renderTargets:{}},a.nextCenter&&a.nextResolution){const l=isNaN(a.nextRotation)?a.rotation:a.nextRotation;r.nextExtent=(0,T.p8)(a.nextCenter,a.nextResolution,l,e)}}this.frameState_=r,this.renderer_.renderFrame(r),r&&(r.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,r.postRenderFunctions),n&&(!this.previousExtent_||!(0,T.xb)(this.previousExtent_)&&!(0,T.fS)(r.extent,this.previousExtent_))&&(this.dispatchEvent(new Xe("movestart",this,n)),this.previousExtent_=(0,T.YN)(this.previousExtent_)),this.previousExtent_&&!r.viewHints[0]&&!r.viewHints[1]&&!(0,T.fS)(r.extent,this.previousExtent_)&&(this.dispatchEvent(new Xe("moveend",this,r)),(0,T.d9)(r.extent,this.previousExtent_))),this.dispatchEvent(new Xe("postrender",this,r)),this.renderComplete_=this.hasListener("loadstart")||this.hasListener("loadend")||this.hasListener("rendercomplete")?!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady():void 0,this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(t){const e=this.getLayerGroup();e&&this.handleLayerRemove_(new ge("removelayer",e)),this.set("layergroup",t)}setSize(t){this.set("size",t)}setTarget(t){this.set("target",t)}setView(t){if(!t||t instanceof me)return void this.set("view",t);this.set("view",new me);const e=this;t.then(function(i){e.setView(new me(i))})}updateSize(){const t=this.getTargetElement();let e;if(t){const i=getComputedStyle(t),n=t.offsetWidth-parseFloat(i.borderLeftWidth)-parseFloat(i.paddingLeft)-parseFloat(i.paddingRight)-parseFloat(i.borderRightWidth),r=t.offsetHeight-parseFloat(i.borderTopWidth)-parseFloat(i.paddingTop)-parseFloat(i.paddingBottom)-parseFloat(i.borderBottomWidth);!isNaN(n)&&!isNaN(r)&&(e=[n,r],!sr(e)&&(t.offsetWidth||t.offsetHeight||t.getClientRects().length)&&console.warn("No map visible because the map container's width or height are 0."))}this.setSize(e),this.updateViewportSize_()}updateViewportSize_(){const t=this.getView();if(t){let e;const i=getComputedStyle(this.viewport_);i.width&&i.height&&(e=[parseInt(i.width,10),parseInt(i.height,10)]),t.setViewportSize(e)}}};class On extends Bt{constructor(t){super(),this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),t&&("function"==typeof t.getSimplifiedGeometry?this.setGeometry(t):this.setProperties(t))}clone(){const t=new On(this.hasProperties()?this.getProperties():null);t.setGeometryName(this.getGeometryName());const e=this.getGeometry();e&&t.setGeometry(e.clone());const i=this.getStyle();return i&&t.setStyle(i),t}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(dt(this.geometryChangeKey_),this.geometryChangeKey_=null);const t=this.getGeometry();t&&(this.geometryChangeKey_=$(t,"change",this.handleGeometryChange_,this)),this.changed()}setGeometry(t){this.set(this.geometryName_,t)}setStyle(t){this.style_=t,this.styleFunction_=t?function ll(s){if("function"==typeof s)return s;{let t;return Array.isArray(s)?t=s:((0,H.h)("function"==typeof s.getZIndex,41),t=[s]),function(){return t}}}(t):void 0,this.changed()}setId(t){this.id_=t,this.changed()}setGeometryName(t){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=t,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}const hl=On,ar=class cl extends Ti{constructor(t,e,i){super(),i=i||{},this.tileCoord=t,this.state=e,this.interimTile=null,this.key="",this.transition_=void 0===i.transition?250:i.transition,this.transitionStarts_={},this.interpolate=!!i.interpolate}changed(){this.dispatchEvent("change")}release(){3===this.state&&this.setState(4)}getKey(){return this.key+"/"+this.tileCoord}getInterimTile(){if(!this.interimTile)return this;let t=this.interimTile;do{if(2==t.getState())return this.transition_=0,t;t=t.interimTile}while(t);return this}refreshInterimChain(){if(!this.interimTile)return;let t=this.interimTile,e=this;do{if(2==t.getState()){t.interimTile=null;break}1==t.getState()?e=t:0==t.getState()?e.interimTile=t.interimTile:e=t,t=e.interimTile}while(t)}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(t){if(3!==this.state&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()}load(){tt()}getAlpha(t,e){if(!this.transition_)return 1;let i=this.transitionStarts_[t];if(i){if(-1===i)return 1}else i=e,this.transitionStarts_[t]=i;const n=e-i+1e3/60;return n>=this.transition_?1:bs(n/this.transition_)}inTransition(t){return!!this.transition_&&-1!==this.transitionStarts_[t]}endTransition(t){this.transition_&&(this.transitionStarts_[t]=-1)}};function Pn(s,t,e){const i=s;let n=!0,r=!1,o=!1;const a=[Ri(i,"load",function(){o=!0,r||t()})];return i.src&&co?(r=!0,i.decode().then(function(){n&&t()}).catch(function(l){n&&(o?t():e())})):a.push(Ri(i,"error",e)),function(){n=!1,a.forEach(dt)}}const lr=class ul extends ar{constructor(t,e,i,n,r,o){super(t,e,o),this.crossOrigin_=n,this.src_=i,this.key=i,this.image_=new Image,null!==n&&(this.image_.crossOrigin=n),this.unlisten_=null,this.tileLoadFunction_=r}getImage(){return this.image_}setImage(t){this.image_=t,this.state=2,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=3,this.unlistenImage_(),this.image_=function dl(){const s=Lt(1,1);return s.fillStyle="rgba(0,0,0,0)",s.fillRect(0,0,1,1),s.canvas}(),this.changed()}handleImageLoad_(){const t=this.image_;this.state=t.naturalWidth&&t.naturalHeight?2:4,this.unlistenImage_(),this.changed()}load(){3==this.state&&(this.state=0,this.image_=new Image,null!==this.crossOrigin_&&(this.image_.crossOrigin=this.crossOrigin_)),0==this.state&&(this.state=1,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=Pn(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}};let Dn;const cr=[];function ur(s,t,e,i,n){s.beginPath(),s.moveTo(0,0),s.lineTo(t,e),s.lineTo(i,n),s.closePath(),s.save(),s.clip(),s.fillRect(0,0,Math.max(t,i)+1,Math.max(e,n)),s.restore()}function Fn(s,t){return Math.abs(s[4*t]-210)>2||Math.abs(s[4*t+3]-191.25)>2}function dr(s,t,e,i){const n=(0,z.vs)(e,t,s);let r=(0,z._Q)(t,i,e);const o=t.getMetersPerUnit();void 0!==o&&(r*=o);const a=s.getMetersPerUnit();void 0!==a&&(r/=a);const l=s.getExtent();if(!l||(0,T.b8)(l,n)){const h=(0,z._Q)(s,r,n)/r;isFinite(h)&&h>0&&(r/=h)}return r}const kn=class El extends ar{constructor(t,e,i,n,r,o,a,l,h,c,u,d){super(r,0,{interpolate:!!d}),this.renderEdges_=void 0!==u&&u,this.pixelRatio_=a,this.gutter_=l,this.canvas_=null,this.sourceTileGrid_=e,this.targetTileGrid_=n,this.wrappedTileCoord_=o||r,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const f=n.getTileCoordExtent(this.wrappedTileCoord_),_=this.targetTileGrid_.getExtent();let m=this.sourceTileGrid_.getExtent();const p=_?(0,T.Ed)(f,_):f;if(0===(0,T.bg)(p))return void(this.state=4);const x=t.getExtent();x&&(m=m?(0,T.Ed)(m,x):x);const E=n.getResolution(this.wrappedTileCoord_[0]),C=function xl(s,t,e,i){const n=(0,T.qg)(e);let r=dr(s,t,n,i);return(!isFinite(r)||r<=0)&&(0,T.H6)(e,function(o){return r=dr(s,t,o,i),isFinite(r)&&r>0}),r}(t,i,p,E);if(!isFinite(C)||C<=0)return void(this.state=4);if(this.triangulation_=new class _l{constructor(t,e,i,n,r,o){this.sourceProj_=t,this.targetProj_=e;let a={};const l=(0,z.Ck)(this.targetProj_,this.sourceProj_);this.transformInv_=function(E){const C=E[0]+"/"+E[1];return a[C]||(a[C]=l(E)),a[C]},this.maxSourceExtent_=n,this.errorThresholdSquared_=r*r,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!n&&!!this.sourceProj_.getExtent()&&(0,T.dz)(n)==(0,T.dz)(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?(0,T.dz)(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?(0,T.dz)(this.targetProj_.getExtent()):null;const h=(0,T.rL)(i),c=(0,T.Xv)(i),u=(0,T.w$)(i),d=(0,T.hC)(i),f=this.transformInv_(h),_=this.transformInv_(c),m=this.transformInv_(u),p=this.transformInv_(d),x=10+(o?Math.max(0,Math.ceil(Math.log2((0,T.bg)(i)/(o*o*256*256)))):0);if(this.addQuad_(h,c,u,d,f,_,m,p,x),this.wrapsXInSource_){let E=1/0;this.triangles_.forEach(function(C,v,I){E=Math.min(E,C.source[0][0],C.source[1][0],C.source[2][0])}),this.triangles_.forEach(function(C){if(Math.max(C.source[0][0],C.source[1][0],C.source[2][0])-E>this.sourceWorldWidth_/2){const v=[[C.source[0][0],C.source[0][1]],[C.source[1][0],C.source[1][1]],[C.source[2][0],C.source[2][1]]];v[0][0]-E>this.sourceWorldWidth_/2&&(v[0][0]-=this.sourceWorldWidth_),v[1][0]-E>this.sourceWorldWidth_/2&&(v[1][0]-=this.sourceWorldWidth_),v[2][0]-E>this.sourceWorldWidth_/2&&(v[2][0]-=this.sourceWorldWidth_);const I=Math.min(v[0][0],v[1][0],v[2][0]);Math.max(v[0][0],v[1][0],v[2][0])-I<this.sourceWorldWidth_/2&&(C.source=v)}}.bind(this))}a={}}addTriangle_(t,e,i,n,r,o){this.triangles_.push({source:[n,r,o],target:[t,e,i]})}addQuad_(t,e,i,n,r,o,a,l,h){const c=(0,T.hI)([r,o,a,l]),u=this.sourceWorldWidth_?(0,T.dz)(c)/this.sourceWorldWidth_:null,d=this.sourceWorldWidth_,f=this.sourceProj_.canWrapX()&&u>.5&&u<1;let _=!1;if(h>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const p=(0,T.hI)([t,e,i,n]);_=(0,T.dz)(p)/this.targetWorldWidth_>.25||_}!f&&this.sourceProj_.isGlobal()&&u&&(_=u>.25||_)}if(!_&&this.maxSourceExtent_&&isFinite(c[0])&&isFinite(c[1])&&isFinite(c[2])&&isFinite(c[3])&&!(0,T.kK)(c,this.maxSourceExtent_))return;let m=0;if(!(_||isFinite(r[0])&&isFinite(r[1])&&isFinite(o[0])&&isFinite(o[1])&&isFinite(a[0])&&isFinite(a[1])&&isFinite(l[0])&&isFinite(l[1])))if(h>0)_=!0;else if(m=(isFinite(r[0])&&isFinite(r[1])?0:8)+(isFinite(o[0])&&isFinite(o[1])?0:4)+(isFinite(a[0])&&isFinite(a[1])?0:2)+(isFinite(l[0])&&isFinite(l[1])?0:1),1!=m&&2!=m&&4!=m&&8!=m)return;if(h>0){if(!_){const x=this.transformInv_([(t[0]+i[0])/2,(t[1]+i[1])/2]);let E;E=f?((0,Y.$W)(r[0],d)+(0,Y.$W)(a[0],d))/2-(0,Y.$W)(x[0],d):(r[0]+a[0])/2-x[0];const C=(r[1]+a[1])/2-x[1];_=E*E+C*C>this.errorThresholdSquared_}if(_){if(Math.abs(t[0]-i[0])<=Math.abs(t[1]-i[1])){const p=[(e[0]+i[0])/2,(e[1]+i[1])/2],x=this.transformInv_(p),E=[(n[0]+t[0])/2,(n[1]+t[1])/2],C=this.transformInv_(E);this.addQuad_(t,e,p,E,r,o,x,C,h-1),this.addQuad_(E,p,i,n,C,x,a,l,h-1)}else{const p=[(t[0]+e[0])/2,(t[1]+e[1])/2],x=this.transformInv_(p),E=[(i[0]+n[0])/2,(i[1]+n[1])/2],C=this.transformInv_(E);this.addQuad_(t,p,E,n,r,x,C,l,h-1),this.addQuad_(p,e,i,E,x,o,a,C,h-1)}return}}if(f){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}0==(11&m)&&this.addTriangle_(t,i,n,r,a,l),0==(14&m)&&this.addTriangle_(t,i,e,r,a,o),m&&(0==(13&m)&&this.addTriangle_(e,n,t,o,l,r),0==(7&m)&&this.addTriangle_(e,n,i,o,l,a))}calculateSourceExtent(){const t=(0,T.lJ)();return this.triangles_.forEach(function(e,i,n){const r=e.source;(0,T.Wj)(t,r[0]),(0,T.Wj)(t,r[1]),(0,T.Wj)(t,r[2])}),t}getTriangles(){return this.triangles_}}(t,i,p,m,C*(void 0!==c?c:.5),E),0===this.triangulation_.getTriangles().length)return void(this.state=4);this.sourceZ_=e.getZForResolution(C);let I=this.triangulation_.calculateSourceExtent();if(m&&(t.canWrapX()?(I[1]=(0,Y.uZ)(I[1],m[1],m[3]),I[3]=(0,Y.uZ)(I[3],m[1],m[3])):I=(0,T.Ed)(I,m)),(0,T.bg)(I)){const A=e.getTileRangeForExtentAndZ(I,this.sourceZ_);for(let M=A.minX;M<=A.maxX;M++)for(let F=A.minY;F<=A.maxY;F++){const X=h(this.sourceZ_,M,F,a);X&&this.sourceTiles_.push(X)}0===this.sourceTiles_.length&&(this.state=4)}else this.state=4}getImage(){return this.canvas_}reproject_(){const t=[];if(this.sourceTiles_.forEach(function(e,i,n){e&&2==e.getState()&&t.push({extent:this.sourceTileGrid_.getTileCoordExtent(e.tileCoord),image:e.getImage()})}.bind(this)),this.sourceTiles_.length=0,0===t.length)this.state=3;else{const e=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(e),n="number"==typeof i?i:i[0],r="number"==typeof i?i:i[1],o=this.targetTileGrid_.getResolution(e),a=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=function yl(s,t,e,i,n,r,o,a,l,h,c,u){const d=Lt(Math.round(e*s),Math.round(e*t),cr);if(u||(d.imageSmoothingEnabled=!1),0===l.length)return d.canvas;function f(v){return Math.round(v*e)/e}d.scale(e,e),d.globalCompositeOperation="lighter";const _=(0,T.lJ)();l.forEach(function(v,I,A){(0,T.l7)(_,v.extent)});const m=(0,T.dz)(_),p=(0,T.Cr)(_),x=Lt(Math.round(e*m/i),Math.round(e*p/i));u||(x.imageSmoothingEnabled=!1);const E=e/i;l.forEach(function(v,I,A){const M=v.extent[0]-_[0],F=-(v.extent[3]-_[3]),X=(0,T.dz)(v.extent),Z=(0,T.Cr)(v.extent);v.image.width>0&&v.image.height>0&&x.drawImage(v.image,h,h,v.image.width-2*h,v.image.height-2*h,M*E,F*E,X*E,Z*E)});const C=(0,T.rL)(o);return a.getTriangles().forEach(function(v,I,A){const M=v.source,F=v.target;let X=M[0][0],Z=M[0][1],nt=M[1][0],et=M[1][1],B=M[2][0],mt=M[2][1];const U=f((F[0][0]-C[0])/r),b=f(-(F[0][1]-C[1])/r),O=f((F[1][0]-C[0])/r),N=f(-(F[1][1]-C[1])/r),ct=f((F[2][0]-C[0])/r),ut=f(-(F[2][1]-C[1])/r),xt=X,S=Z;X=0,Z=0,nt-=xt,et-=S,B-=xt,mt-=S;const rt=(0,Y.SV)([[nt,et,0,0,O-U],[B,mt,0,0,ct-U],[0,0,nt,et,N-b],[0,0,B,mt,ut-b]]);if(rt){if(d.save(),d.beginPath(),function pl(){if(void 0===Dn){const s=document.createElement("canvas").getContext("2d");s.globalCompositeOperation="lighter",s.fillStyle="rgba(210, 0, 0, 0.75)",ur(s,4,5,4,0),ur(s,4,5,0,5);const t=s.getImageData(0,0,3,3).data;Dn=Fn(t,0)||Fn(t,4)||Fn(t,8)}return Dn}()||!u){d.moveTo(O,N);const ht=4,Re=U-O,qt=b-N;for(let yt=0;yt<ht;yt++)d.lineTo(O+f((yt+1)*Re/ht),N+f(yt*qt/(ht-1))),yt!=ht-1&&d.lineTo(O+f((yt+1)*Re/ht),N+f((yt+1)*qt/(ht-1)));d.lineTo(ct,ut)}else d.moveTo(O,N),d.lineTo(U,b),d.lineTo(ct,ut);d.clip(),d.transform(rt[0],rt[2],rt[1],rt[3],U,b),d.translate(_[0]-xt,_[3]-S),d.scale(i/e,-i/e),d.drawImage(x.canvas,0,0),d.restore()}}),c&&(d.save(),d.globalCompositeOperation="source-over",d.strokeStyle="black",d.lineWidth=1,a.getTriangles().forEach(function(v,I,A){const M=v.target,F=(M[0][0]-C[0])/r,X=-(M[0][1]-C[1])/r,Z=(M[1][0]-C[0])/r,nt=-(M[1][1]-C[1])/r,et=(M[2][0]-C[0])/r,B=-(M[2][1]-C[1])/r;d.beginPath(),d.moveTo(Z,nt),d.lineTo(F,X),d.lineTo(et,B),d.closePath(),d.stroke()}),d.restore()),d.canvas}(n,r,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),o,l,this.triangulation_,t,this.gutter_,this.renderEdges_,this.interpolate),this.state=2}this.changed()}load(){if(0==this.state){this.state=1,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(function(e,i,n){const r=e.getState();if(0==r||1==r){t++;const o=$(e,"change",function(a){const l=e.getState();(2==l||3==l||4==l)&&(dt(o),t--,0===t&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(o)}}.bind(this)),0===t?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(e,i,n){0==e.getState()&&e.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(dt),this.sourcesListenerKeys_=null}release(){this.canvas_&&(Rs(this.canvas_.getContext("2d")),cr.push(this.canvas_),this.canvas_=null),super.release()}};function gr(s,t,e,i){return void 0!==i?(i[0]=s,i[1]=t,i[2]=e,i):[s,t,e]}function ci(s,t,e){return s+"/"+t+"/"+e}function fr(s){return ci(s[0],s[1],s[2])}const _r=class Sl extends class Cl{constructor(t){this.highWaterMark=void 0!==t?t:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(t){for(;this.canExpireCache();)this.pop()}clear(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}containsKey(t){return this.entries_.hasOwnProperty(t)}forEach(t){let e=this.oldest_;for(;e;)t(e.value_,e.key_,this),e=e.newer}get(t,e){const i=this.entries_[t];return(0,H.h)(void 0!==i,15),i===this.newest_||(i===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(i.newer.older=i.older,i.older.newer=i.newer),i.newer=null,i.older=this.newest_,this.newest_.newer=i,this.newest_=i),i.value_}remove(t){const e=this.entries_[t];return(0,H.h)(void 0!==e,15),e===this.newest_?(this.newest_=e.older,this.newest_&&(this.newest_.newer=null)):e===this.oldest_?(this.oldest_=e.newer,this.oldest_&&(this.oldest_.older=null)):(e.newer.older=e.older,e.older.newer=e.newer),delete this.entries_[t],--this.count_,e.value_}getCount(){return this.count_}getKeys(){const t=new Array(this.count_);let i,e=0;for(i=this.newest_;i;i=i.older)t[e++]=i.key_;return t}getValues(){const t=new Array(this.count_);let i,e=0;for(i=this.newest_;i;i=i.older)t[e++]=i.value_;return t}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(t){if(this.containsKey(t))return this.entries_[t].value_}pop(){const t=this.oldest_;return delete this.entries_[t.key_],t.newer&&(t.newer.older=null),this.oldest_=t.newer,this.oldest_||(this.newest_=null),--this.count_,t.value_}replace(t,e){this.get(t),this.entries_[t].value_=e}set(t,e){(0,H.h)(!(t in this.entries_),16);const i={key_:t,newer:null,older:this.newest_,value_:e};this.newest_?this.newest_.newer=i:this.oldest_=i,this.newest_=i,this.entries_[t]=i,++this.count_}setSize(t){this.highWaterMark=t}}{clear(){for(;this.getCount()>0;)this.pop().release();super.clear()}expireCache(t){for(;this.canExpireCache()&&!(this.peekLast().getKey()in t);)this.pop().release()}pruneExceptNewestZ(){if(0===this.getCount())return;const i=function Rl(s){return s.split("/").map(Number)}(this.peekFirstKey())[0];this.forEach(function(n){n.tileCoord[0]!==i&&(this.remove(fr(n.tileCoord)),n.release())}.bind(this))}};function mr(s){return s?Array.isArray(s)?function(t){return s}:"function"==typeof s?s:function(t){return[s]}:null}const pr=class wl extends Bt{constructor(t){super(),this.projection=(0,z.U2)(t.projection),this.attributions_=mr(t.attributions),this.attributionsCollapsible_=void 0===t.attributionsCollapsible||t.attributionsCollapsible,this.loading=!1,this.state_=void 0!==t.state?t.state:"ready",this.wrapX_=void 0!==t.wrapX&&t.wrapX,this.interpolate_=!!t.interpolate,this.viewResolver=null,this.viewRejector=null;const e=this;this.viewPromise_=new Promise(function(i,n){e.viewResolver=i,e.viewRejector=n})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(){return tt()}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(t){this.attributions_=mr(t),this.changed()}setState(t){this.state_=t,this.changed()}};class xr{constructor(t,e,i,n){this.minX=t,this.maxX=e,this.minY=i,this.maxY=n}contains(t){return this.containsXY(t[1],t[2])}containsTileRange(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY}containsXY(t,e){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY}equals(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY}extend(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY}}function Be(s,t,e,i,n){return void 0!==n?(n.minX=s,n.maxX=t,n.minY=e,n.maxY=i,n):new xr(s,t,e,i)}const yr=xr,Ll=[0,0,0],Er=class Al{constructor(t){let e;if(this.minZoom=void 0!==t.minZoom?t.minZoom:0,this.resolutions_=t.resolutions,(0,H.h)(function ft(s,t,e){const i=t||L;return s.every(function(n,r){if(0===r)return!0;const o=i(s[r-1],n);return!(o>0||e&&0===o)})}(this.resolutions_,function(n,r){return r-n},!0),17),!t.origins)for(let n=0,r=this.resolutions_.length-1;n<r;++n)if(e){if(this.resolutions_[n]/this.resolutions_[n+1]!==e){e=void 0;break}}else e=this.resolutions_[n]/this.resolutions_[n+1];this.zoomFactor_=e,this.maxZoom=this.resolutions_.length-1,this.origin_=void 0!==t.origin?t.origin:null,this.origins_=null,void 0!==t.origins&&(this.origins_=t.origins,(0,H.h)(this.origins_.length==this.resolutions_.length,20));const i=t.extent;void 0!==i&&!this.origin_&&!this.origins_&&(this.origin_=(0,T.rL)(i)),(0,H.h)(!this.origin_&&this.origins_||this.origin_&&!this.origins_,18),this.tileSizes_=null,void 0!==t.tileSizes&&(this.tileSizes_=t.tileSizes,(0,H.h)(this.tileSizes_.length==this.resolutions_.length,19)),this.tileSize_=void 0!==t.tileSize?t.tileSize:this.tileSizes_?null:256,(0,H.h)(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,22),this.extent_=void 0!==i?i:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],void 0!==t.sizes?this.fullTileRanges_=t.sizes.map(function(n,r){const o=new yr(Math.min(0,n[0]),Math.max(n[0]-1,-1),Math.min(0,n[1]),Math.max(n[1]-1,-1));if(i){const a=this.getTileRangeForExtentAndZ(i,r);o.minX=Math.max(a.minX,o.minX),o.maxX=Math.min(a.maxX,o.maxX),o.minY=Math.max(a.minY,o.minY),o.maxY=Math.min(a.maxY,o.maxY)}return o},this):i&&this.calculateTileRanges_(i)}forEachTileCoord(t,e,i){const n=this.getTileRangeForExtentAndZ(t,e);for(let r=n.minX,o=n.maxX;r<=o;++r)for(let a=n.minY,l=n.maxY;a<=l;++a)i([e,r,a])}forEachTileCoordParentTileRange(t,e,i,n){let r,o,a,l=null,h=t[0]-1;for(2===this.zoomFactor_?(o=t[1],a=t[2]):l=this.getTileCoordExtent(t,n);h>=this.minZoom;){if(2===this.zoomFactor_?(o=Math.floor(o/2),a=Math.floor(a/2),r=Be(o,o,a,a,i)):r=this.getTileRangeForExtentAndZ(l,h,i),e(h,r))return!0;--h}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(t){return this.origin_?this.origin_:this.origins_[t]}getResolution(t){return this.resolutions_[t]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(t,e,i){if(t[0]<this.maxZoom){if(2===this.zoomFactor_){const r=2*t[1],o=2*t[2];return Be(r,r+1,o,o+1,e)}const n=this.getTileCoordExtent(t,i||this.tmpExtent_);return this.getTileRangeForExtentAndZ(n,t[0]+1,e)}return null}getTileRangeForTileCoordAndZ(t,e,i){if(e>this.maxZoom||e<this.minZoom)return null;const n=t[0],r=t[1],o=t[2];if(e===n)return Be(r,o,r,o,i);if(this.zoomFactor_){const l=Math.pow(this.zoomFactor_,e-n),h=Math.floor(r*l),c=Math.floor(o*l);return e<n?Be(h,h,c,c,i):Be(h,Math.floor(l*(r+1))-1,c,Math.floor(l*(o+1))-1,i)}const a=this.getTileCoordExtent(t,this.tmpExtent_);return this.getTileRangeForExtentAndZ(a,e,i)}getTileRangeExtent(t,e,i){const n=this.getOrigin(t),r=this.getResolution(t),o=At(this.getTileSize(t),this.tmpSize_);return(0,T.T9)(n[0]+e.minX*o[0]*r,n[1]+e.minY*o[1]*r,n[0]+(e.maxX+1)*o[0]*r,n[1]+(e.maxY+1)*o[1]*r,i)}getTileRangeForExtentAndZ(t,e,i){const n=Ll;this.getTileCoordForXYAndZ_(t[0],t[3],e,!1,n);const r=n[1],o=n[2];return this.getTileCoordForXYAndZ_(t[2],t[1],e,!0,n),Be(r,n[1],o,n[2],i)}getTileCoordCenter(t){const e=this.getOrigin(t[0]),i=this.getResolution(t[0]),n=At(this.getTileSize(t[0]),this.tmpSize_);return[e[0]+(t[1]+.5)*n[0]*i,e[1]-(t[2]+.5)*n[1]*i]}getTileCoordExtent(t,e){const i=this.getOrigin(t[0]),n=this.getResolution(t[0]),r=At(this.getTileSize(t[0]),this.tmpSize_),o=i[0]+t[1]*r[0]*n,a=i[1]-(t[2]+1)*r[1]*n;return(0,T.T9)(o,a,o+r[0]*n,a+r[1]*n,e)}getTileCoordForCoordAndResolution(t,e,i){return this.getTileCoordForXYAndResolution_(t[0],t[1],e,!1,i)}getTileCoordForXYAndResolution_(t,e,i,n,r){const o=this.getZForResolution(i),a=i/this.getResolution(o),l=this.getOrigin(o),h=At(this.getTileSize(o),this.tmpSize_);let c=a*(t-l[0])/i/h[0],u=a*(l[1]-e)/i/h[1];return n?(c=(0,Y.mD)(c,5)-1,u=(0,Y.mD)(u,5)-1):(c=(0,Y.GW)(c,5),u=(0,Y.GW)(u,5)),gr(o,c,u,r)}getTileCoordForXYAndZ_(t,e,i,n,r){const o=this.getOrigin(i),a=this.getResolution(i),l=At(this.getTileSize(i),this.tmpSize_);let h=(t-o[0])/a/l[0],c=(o[1]-e)/a/l[1];return n?(h=(0,Y.mD)(h,5)-1,c=(0,Y.mD)(c,5)-1):(h=(0,Y.GW)(h,5),c=(0,Y.GW)(c,5)),gr(i,h,c,r)}getTileCoordForCoordAndZ(t,e,i){return this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,i)}getTileCoordResolution(t){return this.resolutions_[t[0]]}getTileSize(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]}getFullTileRange(t){return this.fullTileRanges_?this.fullTileRanges_[t]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,t):null}getZForResolution(t,e){const i=k(this.resolutions_,t,e||0);return(0,Y.uZ)(i,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(t,e){return Hs(e,0,e.length,2,this.getTileCoordExtent(t))}calculateTileRanges_(t){const e=this.resolutions_.length,i=new Array(e);for(let n=this.minZoom;n<e;++n)i[n]=this.getTileRangeForExtentAndZ(t,n);this.fullTileRanges_=i}};function Cr(s){let t=s.getDefaultTileGrid();return t||(t=function Pl(s,t,e,i){return function bl(s,t,e,i){i=void 0!==i?i:"top-left";const n=Tr(s,t,e);return new Er({extent:s,origin:(0,T.g0)(s,i),resolutions:n,tileSize:e})}(Gn(s),t,e,i)}(s),s.setDefaultTileGrid(t)),t}function Tr(s,t,e,i){t=void 0!==t?t:42,e=At(void 0!==e?e:256);const n=(0,T.Cr)(s),r=(0,T.dz)(s);i=i>0?i:Math.max(r/e[0],n/e[1]);const o=t+1,a=new Array(o);for(let l=0;l<o;++l)a[l]=i/Math.pow(2,l);return a}function Gn(s){let t=(s=(0,z.U2)(s)).getExtent();if(!t){const e=180*z.Wm.degrees/s.getMetersPerUnit();t=(0,T.T9)(-e,-e,e,e)}return t}class Fl extends y{constructor(t,e){super(t),this.tile=e}}const kl=class Dl extends pr{constructor(t){super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX,interpolate:t.interpolate}),this.opaque_=void 0!==t.opaque&&t.opaque,this.tilePixelRatio_=void 0!==t.tilePixelRatio?t.tilePixelRatio:1,this.tileGrid=void 0!==t.tileGrid?t.tileGrid:null,this.tileGrid&&At(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),[256,256]),this.tileCache=new _r(t.cacheSize||0),this.tmpSize=[0,0],this.key_=t.key||"",this.tileOptions={transition:t.transition,interpolate:t.interpolate},this.zDirection=t.zDirection?t.zDirection:0}canExpireCache(){return this.tileCache.canExpireCache()}expireCache(t,e){const i=this.getTileCacheForProjection(t);i&&i.expireCache(e)}forEachLoadedTile(t,e,i,n){const r=this.getTileCacheForProjection(t);if(!r)return!1;let a,l,h,o=!0;for(let c=i.minX;c<=i.maxX;++c)for(let u=i.minY;u<=i.maxY;++u)l=ci(e,c,u),h=!1,r.containsKey(l)&&(a=r.get(l),h=2===a.getState(),h&&(h=!1!==n(a))),h||(o=!1);return o}getGutterForProjection(t){return 0}getKey(){return this.key_}setKey(t){this.key_!==t&&(this.key_=t,this.changed())}getOpaque(t){return this.opaque_}getResolutions(){return this.tileGrid?this.tileGrid.getResolutions():null}getTile(t,e,i,n,r){return tt()}getTileGrid(){return this.tileGrid}getTileGridForProjection(t){return this.tileGrid?this.tileGrid:Cr(t)}getTileCacheForProjection(t){const e=this.getProjection();return(0,H.h)(null===e||(0,z.OP)(e,t),68),this.tileCache}getTilePixelRatio(t){return this.tilePixelRatio_}getTilePixelSize(t,e,i){const n=this.getTileGridForProjection(i),r=this.getTilePixelRatio(e),o=At(n.getTileSize(t),this.tmpSize);return 1==r?o:function sl(s,t,e){return void 0===e&&(e=[0,0]),e[0]=s[0]*t+.5|0,e[1]=s[1]*t+.5|0,e}(o,r,this.tmpSize)}getTileCoordForTileUrlFunction(t,e){e=void 0!==e?e:this.getProjection();const i=this.getTileGridForProjection(e);return this.getWrapX()&&e.isGlobal()&&(t=function Ml(s,t,e){const i=t[0],n=s.getTileCoordCenter(t),r=Gn(e);if((0,T.b8)(r,n))return t;{const o=(0,T.dz)(r),a=Math.ceil((r[0]-n[0])/o);return n[0]+=o*a,s.getTileCoordForCoordAndZ(n,i)}}(i,t,e)),function Il(s,t){const e=s[0],i=s[1],n=s[2];if(t.getMinZoom()>e||e>t.getMaxZoom())return!1;const r=t.getFullTileRange(e);return!r||r.containsXY(i,n)}(t,i)?t:null}clear(){this.tileCache.clear()}refresh(){this.clear(),super.refresh()}updateCacheSize(t,e){const i=this.getTileCacheForProjection(e);t>i.highWaterMark&&(i.highWaterMark=t)}useTile(t,e,i,n){}};function Nl(s,t){const e=/\{z\}/g,i=/\{x\}/g,n=/\{y\}/g,r=/\{-y\}/g;return function(o,a,l){if(o)return s.replace(e,o[0].toString()).replace(i,o[1].toString()).replace(n,o[2].toString()).replace(r,function(){const c=t.getFullTileRange(o[0]);return(0,H.h)(c,55),(c.getHeight()-o[2]-1).toString()})}}class Yn extends kl{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===Yn.prototype.tileUrlFunction,this.tileLoadFunction=t.tileLoadFunction,t.tileUrlFunction&&(this.tileUrlFunction=t.tileUrlFunction),this.urls=null,t.urls?this.setUrls(t.urls):t.url&&this.setUrl(t.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(t){const e=t.target,i=st(e),n=e.getState();let r;1==n?(this.tileLoadingKeys_[i]=!0,r="tileloadstart"):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],r=3==n?"tileloaderror":2==n?"tileloadend":void 0),null!=r&&this.dispatchEvent(new Fl(r,e))}setTileLoadFunction(t){this.tileCache.clear(),this.tileLoadFunction=t,this.changed()}setTileUrlFunction(t,e){this.tileUrlFunction=t,this.tileCache.pruneExceptNewestZ(),void 0!==e?this.setKey(e):this.changed()}setUrl(t){const e=function zl(s){const t=[];let e=/\{([a-z])-([a-z])\}/.exec(s);if(e){const i=e[1].charCodeAt(0),n=e[2].charCodeAt(0);let r;for(r=i;r<=n;++r)t.push(s.replace(e[0],String.fromCharCode(r)));return t}if(e=/\{(\d+)-(\d+)\}/.exec(s),e){const i=parseInt(e[2],10);for(let n=parseInt(e[1],10);n<=i;n++)t.push(s.replace(e[0],n.toString()));return t}return t.push(s),t}(t);this.urls=e,this.setUrls(e)}setUrls(t){this.urls=t;const e=t.join("\n");this.generateTileUrlFunction_?this.setTileUrlFunction(function Gl(s,t){const e=s.length,i=new Array(e);for(let n=0;n<e;++n)i[n]=Nl(s[n],t);return function Yl(s){return 1===s.length?s[0]:function(t,e,i){if(t){const n=function vl(s){return(s[1]<<s[0])+s[2]}(t),r=(0,Y.$W)(n,s.length);return s[r](t,e,i)}}}(i)}(t,this.tileGrid),e):this.setKey(e)}tileUrlFunction(t,e,i){}useTile(t,e,i){const n=ci(t,e,i);this.tileCache.containsKey(n)&&this.tileCache.get(n)}}const Wl=Yn;function Zl(s,t){s.getImage().src=t}const Kl=class Xl extends Wl{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:Zl,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX,transition:t.transition,interpolate:void 0===t.interpolate||t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.crossOrigin=void 0!==t.crossOrigin?t.crossOrigin:null,this.tileClass=void 0!==t.tileClass?t.tileClass:lr,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=t.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}canExpireCache(){if(this.tileCache.canExpireCache())return!0;for(const t in this.tileCacheForProjection)if(this.tileCacheForProjection[t].canExpireCache())return!0;return!1}expireCache(t,e){const i=this.getTileCacheForProjection(t);this.tileCache.expireCache(this.tileCache==i?e:{});for(const n in this.tileCacheForProjection){const r=this.tileCacheForProjection[n];r.expireCache(r==i?e:{})}}getGutterForProjection(t){return this.getProjection()&&t&&!(0,z.OP)(this.getProjection(),t)?0:this.getGutter()}getGutter(){return 0}getKey(){let t=super.getKey();return this.getInterpolate()||(t+=":disable-interpolation"),t}getOpaque(t){return!(this.getProjection()&&t&&!(0,z.OP)(this.getProjection(),t))&&super.getOpaque(t)}getTileGridForProjection(t){const e=this.getProjection();if(this.tileGrid&&(!e||(0,z.OP)(e,t)))return this.tileGrid;{const i=st(t);return i in this.tileGridForProjection||(this.tileGridForProjection[i]=Cr(t)),this.tileGridForProjection[i]}}getTileCacheForProjection(t){const e=this.getProjection();if(!e||(0,z.OP)(e,t))return this.tileCache;{const i=st(t);return i in this.tileCacheForProjection||(this.tileCacheForProjection[i]=new _r(this.tileCache.highWaterMark)),this.tileCacheForProjection[i]}}createTile_(t,e,i,n,r,o){const a=[t,e,i],l=this.getTileCoordForTileUrlFunction(a,r),h=l?this.tileUrlFunction(l,n,r):void 0,c=new this.tileClass(a,void 0!==h?0:4,void 0!==h?h:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return c.key=o,c.addEventListener("change",this.handleTileChange.bind(this)),c}getTile(t,e,i,n,r){const o=this.getProjection();if(!o||!r||(0,z.OP)(o,r))return this.getTileInternal(t,e,i,n,o||r);{const a=this.getTileCacheForProjection(r),l=[t,e,i];let h;const c=fr(l);a.containsKey(c)&&(h=a.get(c));const u=this.getKey();if(h&&h.key==u)return h;{const d=this.getTileGridForProjection(o),f=this.getTileGridForProjection(r),_=this.getTileCoordForTileUrlFunction(l,r),m=new kn(o,d,r,f,l,_,this.getTilePixelRatio(n),this.getGutter(),function(p,x,E,C){return this.getTileInternal(p,x,E,C,o)}.bind(this),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.getInterpolate());return m.key=u,h?(m.interimTile=h,m.refreshInterimChain(),a.replace(c,m)):a.set(c,m),m}}}getTileInternal(t,e,i,n,r){let o=null;const a=ci(t,e,i),l=this.getKey();if(this.tileCache.containsKey(a)){if(o=this.tileCache.get(a),o.key!=l){const h=o;o=this.createTile_(t,e,i,n,r,l),o.interimTile=0==h.getState()?h.interimTile:h,o.refreshInterimChain(),this.tileCache.replace(a,o)}}else o=this.createTile_(t,e,i,n,r,l),this.tileCache.set(a,o);return o}setRenderReprojectionEdges(t){if(this.renderReprojectionEdges_!=t){this.renderReprojectionEdges_=t;for(const e in this.tileCacheForProjection)this.tileCacheForProjection[e].clear();this.changed()}}setTileGridForProjection(t,e){const i=(0,z.U2)(t);if(i){const n=st(i);n in this.tileGridForProjection||(this.tileGridForProjection[n]=e)}}clear(){super.clear();for(const t in this.tileCacheForProjection)this.tileCacheForProjection[t].clear()}},Ul=class Bl extends Kl{constructor(t){const e=void 0!==(t=t||{}).projection?t.projection:"EPSG:3857",i=void 0!==t.tileGrid?t.tileGrid:function Ol(s){const t=s||{},e=t.extent||(0,z.U2)("EPSG:3857").getExtent(),i={extent:e,minZoom:t.minZoom,tileSize:t.tileSize,resolutions:Tr(e,t.maxZoom,t.tileSize,t.maxResolution)};return new Er(i)}({extent:Gn(e),maxResolution:t.maxResolution,maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:t.tileSize});super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,opaque:t.opaque,projection:e,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileGrid:i,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:void 0===t.wrapX||t.wrapX,transition:t.transition,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.gutter_=void 0!==t.gutter?t.gutter:0}getGutter(){return this.gutter_}},Hl=class Vl extends Ul{constructor(t){let e;e=void 0!==(t=t||{}).attributions?t.attributions:['&#169; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors.'],super({attributions:e,attributionsCollapsible:!1,cacheSize:t.cacheSize,crossOrigin:void 0!==t.crossOrigin?t.crossOrigin:"anonymous",interpolate:t.interpolate,maxZoom:void 0!==t.maxZoom?t.maxZoom:19,opaque:void 0===t.opaque||t.opaque,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileLoadFunction:t.tileLoadFunction,transition:t.transition,url:void 0!==t.url?t.url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png",wrapX:t.wrapX,zDirection:t.zDirection})}},Jl=class ql extends Ai{constructor(t){t=t||{};const e=Object.assign({},t);delete e.preload,delete e.useInterimTilesOnError,super(e),this.setPreload(void 0!==t.preload?t.preload:0),this.setUseInterimTilesOnError(void 0===t.useInterimTilesOnError||t.useInterimTilesOnError)}getPreload(){return this.get("preload")}setPreload(t){this.set("preload",t)}getUseInterimTilesOnError(){return this.get("useInterimTilesOnError")}setUseInterimTilesOnError(t){this.set("useInterimTilesOnError",t)}getData(t){return super.getData(t)}},$l=class Ql extends rs{constructor(t){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=t,this.declutterExecutorGroup=null}getFeatures(t){return tt()}getData(t){return null}prepareFrame(t){return tt()}renderFrame(t,e){return tt()}loadedTileCallback(t,e,i){t[e]||(t[e]={}),t[e][i.tileCoord.toString()]=i}createLoadedTileFinder(t,e,i){return function(n,r){const o=this.loadedTileCallback.bind(this,i,n);return t.forEachLoadedTile(e,n,r,o)}.bind(this)}forEachFeatureAtCoordinate(t,e,i,n,r){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(t){2===t.target.getState()&&this.renderIfReadyAndVisible()}loadImage(t){let e=t.getState();return 2!=e&&3!=e&&t.addEventListener("change",this.boundHandleImageChange_),0==e&&(t.load(),e=t.getState()),2==e}renderIfReadyAndVisible(){const t=this.getLayer();t&&t.getVisible()&&"ready"===t.getSourceState()&&t.changed()}disposeInternal(){delete this.layer_,super.disposeInternal()}},Rr=[];let Ue=null;const vr=class eh extends $l{constructor(t){super(t),this.container=null,this.tempTransform=[1,0,0,1,0,0],this.pixelTransform=[1,0,0,1,0,0],this.inversePixelTransform=[1,0,0,1,0,0],this.context=null,this.containerReused=!1,this.pixelContext_=null,this.frameState=null}getImageData(t,e,i){let n;Ue||function th(){const s=document.createElement("canvas");s.width=1,s.height=1,Ue=s.getContext("2d")}(),Ue.clearRect(0,0,1,1);try{Ue.drawImage(t,e,i,1,1,0,0,1,1),n=Ue.getImageData(0,0,1,1).data}catch(r){return Ue=null,null}return n}getBackground(t){let i=this.getLayer().getBackground();return"function"==typeof i&&(i=i(t.viewState.resolution)),i||void 0}useContainer(t,e,i){const n=this.getLayer().getClassName();let r,o;if(t&&t.className===n&&(!i||t&&t.style.backgroundColor&&ot(wi(t.style.backgroundColor),wi(i)))){const a=t.firstElementChild;a instanceof HTMLCanvasElement&&(o=a.getContext("2d"))}if(o&&o.canvas.style.transform===e?(this.container=t,this.context=o,this.containerReused=!0):this.containerReused&&(this.container=null,this.context=null,this.containerReused=!1),!this.container){r=document.createElement("div"),r.className=n;let a=r.style;a.position="absolute",a.width="100%",a.height="100%",o=Lt();const l=o.canvas;r.appendChild(l),a=l.style,a.position="absolute",a.left="0",a.transformOrigin="top left",this.container=r,this.context=o}!this.containerReused&&i&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=i)}clipUnrotated(t,e,i){const n=(0,T.rL)(i),r=(0,T.Xv)(i),o=(0,T.w$)(i),a=(0,T.hC)(i);pt(e.coordinateToPixelTransform,n),pt(e.coordinateToPixelTransform,r),pt(e.coordinateToPixelTransform,o),pt(e.coordinateToPixelTransform,a);const l=this.inversePixelTransform;pt(l,n),pt(l,r),pt(l,o),pt(l,a),t.save(),t.beginPath(),t.moveTo(Math.round(n[0]),Math.round(n[1])),t.lineTo(Math.round(r[0]),Math.round(r[1])),t.lineTo(Math.round(o[0]),Math.round(o[1])),t.lineTo(Math.round(a[0]),Math.round(a[1])),t.clip()}dispatchRenderEvent_(t,e,i){const n=this.getLayer();if(n.hasListener(t)){const r=new ys(t,this.inversePixelTransform,i,e);n.dispatchEvent(r)}}preRender(t,e){this.frameState=e,this.dispatchRenderEvent_("prerender",t,e)}postRender(t,e){this.dispatchRenderEvent_("postrender",t,e)}getRenderTransform(t,e,i,n,r,o,a){const c=n/e;return Qt(this.tempTransform,r/2,o/2,c,-c,-i,-t[0]+a,-t[1])}disposeInternal(){delete this.frameState,super.disposeInternal()}},nh=class ih extends vr{constructor(t){super(t),this.extentChanged=!0,this.renderedExtent_=null,this.renderedProjection=null,this.renderedTiles=[],this.newTiles_=!1,this.tmpExtent=(0,T.lJ)(),this.tmpTileRange_=new yr(0,0,0,0)}isDrawableTile(t){const e=this.getLayer(),i=t.getState(),n=e.getUseInterimTilesOnError();return 2==i||4==i||3==i&&!n}getTile(t,e,i,n){const r=n.pixelRatio,o=n.viewState.projection,a=this.getLayer();let h=a.getSource().getTile(t,e,i,r,o);return 3==h.getState()&&a.getUseInterimTilesOnError()&&a.getPreload()>0&&(this.newTiles_=!0),this.isDrawableTile(h)||(h=h.getInterimTile()),h}getData(t){const e=this.frameState;if(!e)return null;const i=this.getLayer(),n=pt(e.pixelToCoordinateTransform,t.slice()),r=i.getExtent();if(r&&!(0,T.b8)(r,n))return null;const o=e.pixelRatio,a=e.viewState.projection,l=e.viewState,h=i.getRenderSource(),c=h.getTileGridForProjection(l.projection),u=h.getTilePixelRatio(e.pixelRatio);for(let d=c.getZForResolution(l.resolution);d>=c.getMinZoom();--d){const f=c.getTileCoordForCoordAndZ(n,d),_=h.getTile(d,f[1],f[2],o,a);if(!(_ instanceof lr||_ instanceof kn)||_ instanceof kn&&4===_.getState())return null;if(2!==_.getState())continue;const m=c.getOrigin(d),p=At(c.getTileSize(d)),x=c.getResolution(d),E=Math.floor(u*((n[0]-m[0])/x-f[1]*p[0])),C=Math.floor(u*((m[1]-n[1])/x-f[2]*p[1])),v=Math.round(u*h.getGutterForProjection(l.projection));return this.getImageData(_.getImage(),E+v,C+v)}return null}loadedTileCallback(t,e,i){return!!this.isDrawableTile(i)&&super.loadedTileCallback(t,e,i)}prepareFrame(t){return!!this.getLayer().getSource()}renderFrame(t,e){const i=t.layerStatesArray[t.layerIndex],n=t.viewState,r=n.projection,o=n.resolution,a=n.center,l=n.rotation,h=t.pixelRatio,c=this.getLayer(),u=c.getSource(),d=u.getRevision(),f=u.getTileGridForProjection(r),_=f.getZForResolution(o,u.zDirection),m=f.getResolution(_);let p=t.extent;const x=t.viewState.resolution,E=u.getTilePixelRatio(h),C=Math.round((0,T.dz)(p)/x*h),v=Math.round((0,T.Cr)(p)/x*h),I=i.extent&&(0,z.dY)(i.extent,r);I&&(p=(0,T.Ed)(p,(0,z.dY)(i.extent,r)));const A=m*C/2/E,M=m*v/2/E,F=[a[0]-A,a[1]-M,a[0]+A,a[1]+M],X=f.getTileRangeForExtentAndZ(p,_),Z={};Z[_]={};const nt=this.createLoadedTileFinder(u,r,Z),et=this.tmpExtent,B=this.tmpTileRange_;this.newTiles_=!1;const mt=l?(0,T.dY)(n.center,x,l,t.size):void 0;for(let Mt=X.minX;Mt<=X.maxX;++Mt)for(let rt=X.minY;rt<=X.maxY;++rt){if(l&&!f.tileCoordIntersectsViewport([_,Mt,rt],mt))continue;const ht=this.getTile(_,Mt,rt,t);if(this.isDrawableTile(ht)){const yt=st(this);if(2==ht.getState()){Z[_][ht.tileCoord.toString()]=ht;let ne=ht.inTransition(yt);ne&&1!==i.opacity&&(ht.endTransition(yt),ne=!1),!this.newTiles_&&(ne||!this.renderedTiles.includes(ht))&&(this.newTiles_=!0)}if(1===ht.getAlpha(yt,t.time))continue}const Re=f.getTileCoordChildTileRange(ht.tileCoord,B,et);let qt=!1;Re&&(qt=nt(_+1,Re)),qt||f.forEachTileCoordParentTileRange(ht.tileCoord,nt,B,et)}const U=m/o*h/E;Qt(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/h,1/h,l,-C/2,-v/2);const b=nn(this.pixelTransform);this.useContainer(e,b,this.getBackground(t));const O=this.context,N=O.canvas;Si(this.inversePixelTransform,this.pixelTransform),Qt(this.tempTransform,C/2,v/2,U,U,0,-C/2,-v/2),N.width!=C||N.height!=v?(N.width=C,N.height=v):this.containerReused||O.clearRect(0,0,C,v),I&&this.clipUnrotated(O,t,I),u.getInterpolate()||(O.imageSmoothingEnabled=!1),this.preRender(O,t),this.renderedTiles.length=0;let ut,xt,S,ct=Object.keys(Z).map(Number);ct.sort(L),1!==i.opacity||this.containerReused&&!u.getOpaque(t.viewState.projection)?(ut=[],xt=[]):ct=ct.reverse();for(let Mt=ct.length-1;Mt>=0;--Mt){const rt=ct[Mt],ht=u.getTilePixelSize(rt,h,r),qt=f.getResolution(rt)/m,yt=ht[0]*qt*U,ne=ht[1]*qt*U,Ve=f.getTileCoordForCoordAndZ((0,T.rL)(F),rt),Ki=f.getTileCoordExtent(Ve),He=pt(this.tempTransform,[E*(Ki[0]-F[0])/m,E*(F[3]-Ki[3])/m]),Bi=E*u.getGutterForProjection(r),ve=Z[rt];for(const xi in ve){const Ie=ve[xi],Ui=Ie.tileCoord,ji=Ve[1]-Ui[1],Vi=Math.round(He[0]-(ji-1)*yt),qe=Ve[2]-Ui[2],$n=Math.round(He[1]-(qe-1)*ne),It=Math.round(He[0]-ji*yt),Dt=Math.round(He[1]-qe*ne),Xt=Vi-It,se=$n-Dt,Je=_===rt,Ne=Je&&1!==Ie.getAlpha(st(this),t.time);let Se=!1;if(!Ne)if(ut){S=[It,Dt,It+Xt,Dt,It+Xt,Dt+se,It,Dt+se];for(let Qe=0,Hi=ut.length;Qe<Hi;++Qe)if(_!==rt&&rt<xt[Qe]){const Tt=ut[Qe];(0,T.kK)([It,Dt,It+Xt,Dt+se],[Tt[0],Tt[3],Tt[4],Tt[7]])&&(Se||(O.save(),Se=!0),O.beginPath(),O.moveTo(S[0],S[1]),O.lineTo(S[2],S[3]),O.lineTo(S[4],S[5]),O.lineTo(S[6],S[7]),O.moveTo(Tt[6],Tt[7]),O.lineTo(Tt[4],Tt[5]),O.lineTo(Tt[2],Tt[3]),O.lineTo(Tt[0],Tt[1]),O.clip())}ut.push(S),xt.push(rt)}else O.clearRect(It,Dt,Xt,se);this.drawTileImage(Ie,t,It,Dt,Xt,se,Bi,Je),ut&&!Ne?(Se&&O.restore(),this.renderedTiles.unshift(Ie)):this.renderedTiles.push(Ie),this.updateUsedTiles(t.usedTiles,u,Ie)}}return this.renderedRevision=d,this.renderedResolution=m,this.extentChanged=!this.renderedExtent_||!(0,T.fS)(this.renderedExtent_,F),this.renderedExtent_=F,this.renderedPixelRatio=h,this.renderedProjection=r,this.manageTilePyramid(t,u,f,h,r,p,_,c.getPreload()),this.scheduleExpireCache(t,u),this.postRender(O,t),i.extent&&O.restore(),O.imageSmoothingEnabled=!0,b!==N.style.transform&&(N.style.transform=b),this.container}drawTileImage(t,e,i,n,r,o,a,l){const h=this.getTileImage(t);if(!h)return;const c=st(this),u=e.layerStatesArray[e.layerIndex],d=u.opacity*(l?t.getAlpha(c,e.time):1),f=d!==this.context.globalAlpha;f&&(this.context.save(),this.context.globalAlpha=d),this.context.drawImage(h,a,a,h.width-2*a,h.height-2*a,i,n,r,o),f&&this.context.restore(),d!==u.opacity?e.animate=!0:l&&t.endTransition(c)}getImage(){const t=this.context;return t?t.canvas:null}getTileImage(t){return t.getImage()}scheduleExpireCache(t,e){if(e.canExpireCache()){const i=function(n,r,o){const a=st(n);a in o.usedTiles&&n.expireCache(o.viewState.projection,o.usedTiles[a])}.bind(null,e);t.postRenderFunctions.push(i)}}updateUsedTiles(t,e,i){const n=st(e);n in t||(t[n]={}),t[n][i.getKey()]=!0}manageTilePyramid(t,e,i,n,r,o,a,l,h){const c=st(e);c in t.wantedTiles||(t.wantedTiles[c]={});const u=t.wantedTiles[c],d=t.tileQueue,f=i.getMinZoom(),_=t.viewState.rotation,m=_?(0,T.dY)(t.viewState.center,t.viewState.resolution,_,t.size):void 0;let x,E,C,v,I,A,p=0;for(A=f;A<=a;++A)for(E=i.getTileRangeForExtentAndZ(o,A,E),C=i.getResolution(A),v=E.minX;v<=E.maxX;++v)for(I=E.minY;I<=E.maxY;++I)_&&!i.tileCoordIntersectsViewport([A,v,I],m)||(a-A<=l?(++p,x=e.getTile(A,v,I,n,r),0==x.getState()&&(u[x.getKey()]=!0,d.isKeyQueued(x.getKey())||d.enqueue([x,c,i.getTileCoordCenter(x.tileCoord),C])),void 0!==h&&h(x)):e.useTile(A,v,I,r));e.updateCacheSize(p,r)}},rh=class sh extends Jl{constructor(t){super(t)}createRenderer(){return new nh(this)}};var Ir=Q(2402);class zn{constructor(t){this.opacity_=t.opacity,this.rotateWithView_=t.rotateWithView,this.rotation_=t.rotation,this.scale_=t.scale,this.scaleArray_=At(t.scale),this.displacement_=t.displacement,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new zn({opacity:this.getOpacity(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return tt()}getImage(t){return tt()}getHitDetectionImage(){return tt()}getPixelRatio(t){return 1}getImageState(){return tt()}getImageSize(){return tt()}getOrigin(){return tt()}getSize(){return tt()}setDisplacement(t){this.displacement_=t}setOpacity(t){this.opacity_=t}setRotateWithView(t){this.rotateWithView_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=At(t)}listenImageChange(t){tt()}load(){tt()}unlistenImageChange(t){tt()}}const Sr=zn;function Vt(s){return Array.isArray(s)?ms(s):s}class Wn extends Sr{constructor(t){super({opacity:1,rotateWithView:void 0!==t.rotateWithView&&t.rotateWithView,rotation:void 0!==t.rotation?t.rotation:0,scale:void 0!==t.scale?t.scale:1,displacement:void 0!==t.displacement?t.displacement:[0,0],declutterMode:t.declutterMode}),this.canvas_=void 0,this.hitDetectionCanvas_=null,this.fill_=void 0!==t.fill?t.fill:null,this.origin_=[0,0],this.points_=t.points,this.radius_=void 0!==t.radius?t.radius:t.radius1,this.radius2_=t.radius2,this.angle_=void 0!==t.angle?t.angle:0,this.stroke_=void 0!==t.stroke?t.stroke:null,this.size_=null,this.renderOptions_=null,this.render()}clone(){const t=this.getScale(),e=new Wn({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}getAnchor(){const t=this.size_;if(!t)return null;const e=this.getDisplacement(),i=this.getScaleArray();return[t[0]/2-e[0]/i[0],t[1]/2+e[1]/i[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(t){this.fill_=t,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||this.createHitDetectionCanvas_(this.renderOptions_),this.hitDetectionCanvas_}getImage(t){let e=this.canvas_[t];if(!e){const i=this.renderOptions_,n=Lt(i.size*t,i.size*t);this.draw_(i,n,t),e=n.canvas,this.canvas_[t]=e}return e}getPixelRatio(t){return t}getImageSize(){return this.size_}getImageState(){return 2}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius_}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t,this.render()}listenImageChange(t){}load(){}unlistenImageChange(t){}calculateLineJoinSize_(t,e,i){if(0===e||this.points_===1/0||"bevel"!==t&&"miter"!==t)return e;let n=this.radius_,r=void 0===this.radius2_?n:this.radius2_;if(n<r){const A=n;n=r,r=A}const a=2*Math.PI/(void 0===this.radius2_?this.points_:2*this.points_),l=r*Math.sin(a),c=n-Math.sqrt(r*r-l*l),u=Math.sqrt(l*l+c*c),d=u/l;if("miter"===t&&d<=i)return d*e;const f=e/2/d,_=e/2*(c/u),p=Math.sqrt((n+f)*(n+f)+_*_)-n;if(void 0===this.radius2_||"bevel"===t)return 2*p;const x=n*Math.sin(a),C=r-Math.sqrt(n*n-x*x),I=Math.sqrt(x*x+C*C)/x;return I<=i?2*Math.max(p,I*e/2-r-n):2*p}createRenderOptions(){let r,t=ze,e=0,i=null,n=0,o=0;this.stroke_&&(r=this.stroke_.getColor(),null===r&&(r=ri),r=Vt(r),o=this.stroke_.getWidth(),void 0===o&&(o=1),i=this.stroke_.getLineDash(),n=this.stroke_.getLineDashOffset(),t=this.stroke_.getLineJoin(),void 0===t&&(t=ze),e=this.stroke_.getMiterLimit(),void 0===e&&(e=10));const a=this.calculateLineJoinSize_(t,o,e),l=Math.max(this.radius_,this.radius2_||0);return{strokeStyle:r,strokeWidth:o,size:Math.ceil(2*l+a),lineDash:i,lineDashOffset:n,lineJoin:t,miterLimit:e}}render(){this.renderOptions_=this.createRenderOptions();const t=this.renderOptions_.size;this.canvas_={},this.size_=[t,t]}draw_(t,e,i){if(e.scale(i,i),e.translate(t.size/2,t.size/2),this.createPath_(e),this.fill_){let n=this.fill_.getColor();null===n&&(n=$t),e.fillStyle=Vt(n),e.fill()}this.stroke_&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}createHitDetectionCanvas_(t){if(this.fill_){let e=this.fill_.getColor(),i=0;if("string"==typeof e&&(e=wi(e)),null===e?i=1:Array.isArray(e)&&(i=4===e.length?e[3]:1),0===i){const n=Lt(t.size,t.size);this.hitDetectionCanvas_=n.canvas,this.drawHitDetectionCanvas_(t,n)}}this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.getImage(1))}createPath_(t){let e=this.points_;const i=this.radius_;if(e===1/0)t.arc(0,0,i,0,2*Math.PI);else{const n=void 0===this.radius2_?i:this.radius2_;void 0!==this.radius2_&&(e*=2);const r=this.angle_-Math.PI/2,o=2*Math.PI/e;for(let a=0;a<e;a++){const l=r+a*o,h=a%2==0?i:n;t.lineTo(h*Math.cos(l),h*Math.sin(l))}t.closePath()}}drawHitDetectionCanvas_(t,e){e.translate(t.size/2,t.size/2),this.createPath_(e),e.fillStyle=$t,e.fill(),this.stroke_&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}}const wr=Wn;class Xn extends wr{constructor(t){super({points:1/0,fill:(t=t||{radius:5}).fill,radius:t.radius,stroke:t.stroke,scale:void 0!==t.scale?t.scale:1,rotation:void 0!==t.rotation?t.rotation:0,rotateWithView:void 0!==t.rotateWithView&&t.rotateWithView,displacement:void 0!==t.displacement?t.displacement:[0,0],declutterMode:t.declutterMode})}clone(){const t=this.getScale(),e=new Xn({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}setRadius(t){this.radius_=t,this.render()}}const Lr=Xn;class Zn{constructor(t){this.color_=void 0!==(t=t||{}).color?t.color:null}clone(){const t=this.getColor();return new Zn({color:Array.isArray(t)?t.slice():t||void 0})}getColor(){return this.color_}setColor(t){this.color_=t}}const Kn=Zn;class Bn{constructor(t){this.color_=void 0!==(t=t||{}).color?t.color:null,this.lineCap_=t.lineCap,this.lineDash_=void 0!==t.lineDash?t.lineDash:null,this.lineDashOffset_=t.lineDashOffset,this.lineJoin_=t.lineJoin,this.miterLimit_=t.miterLimit,this.width_=t.width}clone(){const t=this.getColor();return new Bn({color:Array.isArray(t)?t.slice():t||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(t){this.color_=t}setLineCap(t){this.lineCap_=t}setLineDash(t){this.lineDash_=t}setLineDashOffset(t){this.lineDashOffset_=t}setLineJoin(t){this.lineJoin_=t}setMiterLimit(t){this.miterLimit_=t}setWidth(t){this.width_=t}}const Ar=Bn;class xe{constructor(t){t=t||{},this.geometry_=null,this.geometryFunction_=Mr,void 0!==t.geometry&&this.setGeometry(t.geometry),this.fill_=void 0!==t.fill?t.fill:null,this.image_=void 0!==t.image?t.image:null,this.renderer_=void 0!==t.renderer?t.renderer:null,this.hitDetectionRenderer_=void 0!==t.hitDetectionRenderer?t.hitDetectionRenderer:null,this.stroke_=void 0!==t.stroke?t.stroke:null,this.text_=void 0!==t.text?t.text:null,this.zIndex_=t.zIndex}clone(){let t=this.getGeometry();return t&&"object"==typeof t&&(t=t.clone()),new xe({geometry:t,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer(),stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(t){this.renderer_=t}setHitDetectionRenderer(t){this.hitDetectionRenderer_=t}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(t){this.fill_=t}getImage(){return this.image_}setImage(t){this.image_=t}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t}getText(){return this.text_}setText(t){this.text_=t}getZIndex(){return this.zIndex_}setGeometry(t){"function"==typeof t?this.geometryFunction_=t:"string"==typeof t?this.geometryFunction_=function(e){return e.get(t)}:t?void 0!==t&&(this.geometryFunction_=function(){return t}):this.geometryFunction_=Mr,this.geometry_=t}setZIndex(t){this.zIndex_=t}}let Un=null;function ah(s,t){if(!Un){const e=new Kn({color:"rgba(255,255,255,0.4)"}),i=new Ar({color:"#3399CC",width:1.25});Un=[new xe({image:new Lr({fill:e,stroke:i,radius:5}),fill:e,stroke:i})]}return Un}function Mr(s){return s.getGeometry()}const Xi=xe;let ui=null;class lh extends Ti{constructor(t,e,i,n,r,o){super(),this.hitDetectionImage_=null,this.image_=t,this.crossOrigin_=n,this.canvas_={},this.color_=o,this.unlisten_=null,this.imageState_=r,this.size_=i,this.src_=e}initializeImage_(){this.image_=new Image,null!==this.crossOrigin_&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(void 0===this.tainted_&&2===this.imageState_){ui||(ui=Lt(1,1)),ui.drawImage(this.image_,0,0);try{ui.getImageData(0,0,1,1),this.tainted_=!1}catch(t){ui=null,this.tainted_=!0}}return!0===this.tainted_}dispatchChangeEvent_(){this.dispatchEvent("change")}handleImageError_(){this.imageState_=3,this.unlistenImage_(),this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=2,this.size_?(this.image_.width=this.size_[0],this.image_.height=this.size_[1]):this.size_=[this.image_.width,this.image_.height],this.unlistenImage_(),this.dispatchChangeEvent_()}getImage(t){return this.image_||this.initializeImage_(),this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_}getPixelRatio(t){return this.replaceColor_(t),this.canvas_[t]?t:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const t=this.size_[0],e=this.size_[1],i=Lt(t,e);i.fillRect(0,0,t,e),this.hitDetectionImage_=i.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(0===this.imageState_){this.image_||this.initializeImage_(),this.imageState_=1;try{this.image_.src=this.src_}catch(t){this.handleImageError_()}this.unlisten_=Pn(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this))}}replaceColor_(t){if(!this.color_||this.canvas_[t]||2!==this.imageState_)return;const e=this.image_,i=document.createElement("canvas");i.width=Math.ceil(e.width*t),i.height=Math.ceil(e.height*t);const n=i.getContext("2d");n.scale(t,t),n.drawImage(e,0,0),n.globalCompositeOperation="multiply",n.fillStyle=gs(this.color_),n.fillRect(0,0,i.width/t,i.height/t),n.globalCompositeOperation="destination-in",n.drawImage(e,0,0),this.canvas_[t]=i}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}class jn extends Sr{constructor(t){super({opacity:void 0!==(t=t||{}).opacity?t.opacity:1,rotation:void 0!==t.rotation?t.rotation:0,scale:void 0!==t.scale?t.scale:1,displacement:void 0!==t.displacement?t.displacement:[0,0],rotateWithView:void 0!==t.rotateWithView&&t.rotateWithView,declutterMode:t.declutterMode}),this.anchor_=void 0!==t.anchor?t.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=void 0!==t.anchorOrigin?t.anchorOrigin:"top-left",this.anchorXUnits_=void 0!==t.anchorXUnits?t.anchorXUnits:"fraction",this.anchorYUnits_=void 0!==t.anchorYUnits?t.anchorYUnits:"fraction",this.crossOrigin_=void 0!==t.crossOrigin?t.crossOrigin:null;const o=void 0!==t.img?t.img:null;this.imgSize_=t.imgSize;let a=t.src;(0,H.h)(!(void 0!==a&&o),4),(0,H.h)(!o||o&&this.imgSize_,5),(void 0===a||0===a.length)&&o&&(a=o.src||st(o)),(0,H.h)(void 0!==a&&a.length>0,6);const l=void 0!==t.src?0:2;this.color_=void 0!==t.color?wi(t.color):null,this.iconImage_=function hh(s,t,e,i,n,r){let o=Li.get(t,i,r);return o||(o=new lh(s,t,e,i,n,r),Li.set(t,i,r,o)),o}(o,a,void 0!==this.imgSize_?this.imgSize_:null,this.crossOrigin_,l,this.color_),this.offset_=void 0!==t.offset?t.offset:[0,0],this.offsetOrigin_=void 0!==t.offsetOrigin?t.offsetOrigin:"top-left",this.origin_=null,this.size_=void 0!==t.size?t.size:null}clone(){const t=this.getScale();return new jn({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,imgSize:this.imgSize_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:Array.isArray(t)?t.slice():t,size:null!==this.size_?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let t=this.normalizedAnchor_;if(!t){t=this.anchor_;const n=this.getSize();if("fraction"==this.anchorXUnits_||"fraction"==this.anchorYUnits_){if(!n)return null;t=this.anchor_.slice(),"fraction"==this.anchorXUnits_&&(t[0]*=n[0]),"fraction"==this.anchorYUnits_&&(t[1]*=n[1])}if("top-left"!=this.anchorOrigin_){if(!n)return null;t===this.anchor_&&(t=this.anchor_.slice()),("top-right"==this.anchorOrigin_||"bottom-right"==this.anchorOrigin_)&&(t[0]=-t[0]+n[0]),("bottom-left"==this.anchorOrigin_||"bottom-right"==this.anchorOrigin_)&&(t[1]=-t[1]+n[1])}this.normalizedAnchor_=t}const e=this.getDisplacement(),i=this.getScaleArray();return[t[0]-e[0]/i[0],t[1]+e[1]/i[1]]}setAnchor(t){this.anchor_=t,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(t){return this.iconImage_.getImage(t)}getPixelRatio(t){return this.iconImage_.getPixelRatio(t)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let t=this.offset_;if("top-left"!=this.offsetOrigin_){const e=this.getSize(),i=this.iconImage_.getSize();if(!e||!i)return null;t=t.slice(),("top-right"==this.offsetOrigin_||"bottom-right"==this.offsetOrigin_)&&(t[0]=i[0]-e[0]-t[0]),("bottom-left"==this.offsetOrigin_||"bottom-right"==this.offsetOrigin_)&&(t[1]=i[1]-e[1]-t[1])}return this.origin_=t,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}listenImageChange(t){this.iconImage_.addEventListener("change",t)}load(){this.iconImage_.load()}unlistenImageChange(t){this.iconImage_.removeEventListener("change",t)}}const Vn=jn;class Hn{constructor(t){this.font_=(t=t||{}).font,this.rotation_=t.rotation,this.rotateWithView_=t.rotateWithView,this.scale_=t.scale,this.scaleArray_=At(void 0!==t.scale?t.scale:1),this.text_=t.text,this.textAlign_=t.textAlign,this.justify_=t.justify,this.textBaseline_=t.textBaseline,this.fill_=void 0!==t.fill?t.fill:new Kn({color:"#333"}),this.maxAngle_=void 0!==t.maxAngle?t.maxAngle:Math.PI/4,this.placement_=void 0!==t.placement?t.placement:"point",this.overflow_=!!t.overflow,this.stroke_=void 0!==t.stroke?t.stroke:null,this.offsetX_=void 0!==t.offsetX?t.offsetX:0,this.offsetY_=void 0!==t.offsetY?t.offsetY:0,this.backgroundFill_=t.backgroundFill?t.backgroundFill:null,this.backgroundStroke_=t.backgroundStroke?t.backgroundStroke:null,this.padding_=void 0===t.padding?null:t.padding}clone(){const t=this.getScale();return new Hn({font:this.getFont(),placement:this.getPlacement(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}setOverflow(t){this.overflow_=t}setFont(t){this.font_=t}setMaxAngle(t){this.maxAngle_=t}setOffsetX(t){this.offsetX_=t}setOffsetY(t){this.offsetY_=t}setPlacement(t){this.placement_=t}setRotateWithView(t){this.rotateWithView_=t}setFill(t){this.fill_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=At(void 0!==t?t:1)}setStroke(t){this.stroke_=t}setText(t){this.text_=t}setTextAlign(t){this.textAlign_=t}setJustify(t){this.justify_=t}setTextBaseline(t){this.textBaseline_=t}setBackgroundFill(t){this.backgroundFill_=t}setBackgroundStroke(t){this.backgroundStroke_=t}setPadding(t){this.padding_=t}}const uh=Hn;function br(s){return new Xi({fill:di(s,""),stroke:gi(s,""),text:dh(s),image:gh(s)})}function di(s,t){const e=s[t+"fill-color"];if(e)return new Kn({color:e})}function gi(s,t){const e=s[t+"stroke-width"],i=s[t+"stroke-color"];if(e||i)return new Ar({width:e,color:i,lineCap:s[t+"stroke-line-cap"],lineJoin:s[t+"stroke-line-join"],lineDash:s[t+"stroke-line-dash"],lineDashOffset:s[t+"stroke-line-dash-offset"],miterLimit:s[t+"stroke-miter-limit"]})}function dh(s){const t=s["text-value"];return t?new uh({text:t,font:s["text-font"],maxAngle:s["text-max-angle"],offsetX:s["text-offset-x"],offsetY:s["text-offset-y"],overflow:s["text-overflow"],placement:s["text-placement"],scale:s["text-scale"],rotateWithView:s["text-rotate-with-view"],rotation:s["text-rotation"],textAlign:s["text-align"],justify:s["text-justify"],textBaseline:s["text-baseline"],padding:s["text-padding"],fill:di(s,"text-"),backgroundFill:di(s,"text-background-"),stroke:gi(s,"text-"),backgroundStroke:gi(s,"text-background-")}):void 0}function gh(s){const t=s["icon-src"],e=s["icon-img"];if(t||e)return new Vn({src:t,img:e,imgSize:s["icon-img-size"],anchor:s["icon-anchor"],anchorOrigin:s["icon-anchor-origin"],anchorXUnits:s["icon-anchor-x-units"],anchorYUnits:s["icon-anchor-y-units"],color:s["icon-color"],crossOrigin:s["icon-cross-origin"],offset:s["icon-offset"],displacement:s["icon-displacement"],opacity:s["icon-opacity"],scale:s["icon-scale"],rotation:s["icon-rotation"],rotateWithView:s["icon-rotate-with-view"],size:s["icon-size"],declutterMode:s["icon-declutter-mode"]});const i=s["shape-points"];if(i){const r="shape-";return new wr({points:i,fill:di(s,r),stroke:gi(s,r),radius:s["shape-radius"],radius1:s["shape-radius1"],radius2:s["shape-radius2"],angle:s["shape-angle"],displacement:s["shape-displacement"],rotation:s["shape-rotation"],rotateWithView:s["shape-rotate-with-view"],scale:s["shape-scale"],declutterMode:s["shape-declutter-mode"]})}const n=s["circle-radius"];if(n){const r="circle-";return new Lr({radius:n,fill:di(s,r),stroke:gi(s,r),displacement:s["circle-displacement"],scale:s["circle-scale"],rotation:s["circle-rotation"],rotateWithView:s["circle-rotate-with-view"],declutterMode:s["circle-declutter-mode"]})}}const _h=class fh extends Ai{constructor(t){t=t||{};const e=Object.assign({},t);delete e.style,delete e.renderBuffer,delete e.updateWhileAnimating,delete e.updateWhileInteracting,super(e),this.declutter_=void 0!==t.declutter&&t.declutter,this.renderBuffer_=void 0!==t.renderBuffer?t.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(t.style),this.updateWhileAnimating_=void 0!==t.updateWhileAnimating&&t.updateWhileAnimating,this.updateWhileInteracting_=void 0!==t.updateWhileInteracting&&t.updateWhileInteracting}getDeclutter(){return this.declutter_}getFeatures(t){return super.getFeatures(t)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get("renderOrder")}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(t){t.declutterTree||(t.declutterTree=new Ir(9)),this.getRenderer().renderDeclutter(t)}setRenderOrder(t){this.set("renderOrder",t)}setStyle(t){let e;if(void 0===t)e=ah;else if(null===t)e=null;else if("function"==typeof t)e=t;else if(t instanceof Xi)e=t;else if(Array.isArray(t)){const i=t.length,n=new Array(i);for(let r=0;r<i;++r){const o=t[r];n[r]=o instanceof Xi?o:br(o)}e=n}else e=br(t);this.style_=e,this.styleFunction_=null===t?void 0:function oh(s){let t;if("function"==typeof s)t=s;else{let e;Array.isArray(s)?e=s:((0,H.h)("function"==typeof s.getZIndex,41),e=[s]),t=function(){return e}}return t}(this.style_),this.changed()}},fi={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},Zi=[fi.FILL],ye=[fi.STROKE],ke=[fi.BEGIN_PATH],Pr=[fi.CLOSE_PATH],W=fi;var mh=Q(2401);const Dr=class ph{drawCustom(t,e,i,n){}drawGeometry(t){}setStyle(t){}drawCircle(t,e){}drawFeature(t,e){}drawGeometryCollection(t,e){}drawLineString(t,e){}drawMultiLineString(t,e){}drawMultiPoint(t,e){}drawMultiPolygon(t,e){}drawPoint(t,e){}drawPolygon(t,e){}drawText(t,e){}setFillStrokeStyle(t,e){}setImageStyle(t,e){}setTextStyle(t,e){}},_i=class xh extends Dr{constructor(t,e,i,n){super(),this.tolerance=t,this.maxExtent=e,this.pixelRatio=n,this.maxLineWidth=0,this.resolution=i,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(t){const e=this.pixelRatio;return 1==e?t:t.map(function(i){return i*e})}appendFlatPointCoordinates(t,e){const i=this.getBufferedMaxExtent(),n=this.tmpCoordinate_,r=this.coordinates;let o=r.length;for(let a=0,l=t.length;a<l;a+=e)n[0]=t[a],n[1]=t[a+1],(0,T.b8)(i,n)&&(r[o++]=n[0],r[o++]=n[1]);return o}appendFlatLineCoordinates(t,e,i,n,r,o){const a=this.coordinates;let l=a.length;const h=this.getBufferedMaxExtent();o&&(e+=n);let c=t[e],u=t[e+1];const d=this.tmpCoordinate_;let _,m,p,f=!0;for(_=e+n;_<i;_+=n)d[0]=t[_],d[1]=t[_+1],p=(0,T.pX)(h,d),p!==m?(f&&(a[l++]=c,a[l++]=u,f=!1),a[l++]=d[0],a[l++]=d[1]):p===mh.Z.INTERSECTING?(a[l++]=d[0],a[l++]=d[1],f=!1):f=!0,c=d[0],u=d[1],m=p;return(r&&f||_===e+n)&&(a[l++]=c,a[l++]=u),l}drawCustomCoordinates_(t,e,i,n,r){for(let o=0,a=i.length;o<a;++o){const l=i[o],h=this.appendFlatLineCoordinates(t,e,l,n,!1,!1);r.push(h),e=l}return e}drawCustom(t,e,i,n){this.beginGeometry(t,e);const r=t.getType(),o=t.getStride(),a=this.coordinates.length;let l,h,c,u,d;switch(r){case"MultiPolygon":l=t.getOrientedFlatCoordinates(),u=[];const f=t.getEndss();d=0;for(let _=0,m=f.length;_<m;++_){const p=[];d=this.drawCustomCoordinates_(l,d,f[_],o,p),u.push(p)}this.instructions.push([W.CUSTOM,a,u,t,i,Zs]),this.hitDetectionInstructions.push([W.CUSTOM,a,u,t,n||i,Zs]);break;case"Polygon":case"MultiLineString":c=[],l="Polygon"==r?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),d=this.drawCustomCoordinates_(l,0,t.getEnds(),o,c),this.instructions.push([W.CUSTOM,a,c,t,i,Ni]),this.hitDetectionInstructions.push([W.CUSTOM,a,c,t,n||i,Ni]);break;case"LineString":case"Circle":l=t.getFlatCoordinates(),h=this.appendFlatLineCoordinates(l,0,l.length,o,!1,!1),this.instructions.push([W.CUSTOM,a,h,t,i,Ke]),this.hitDetectionInstructions.push([W.CUSTOM,a,h,t,n||i,Ke]);break;case"MultiPoint":l=t.getFlatCoordinates(),h=this.appendFlatPointCoordinates(l,o),h>a&&(this.instructions.push([W.CUSTOM,a,h,t,i,Ke]),this.hitDetectionInstructions.push([W.CUSTOM,a,h,t,n||i,Ke]));break;case"Point":l=t.getFlatCoordinates(),this.coordinates.push(l[0],l[1]),h=this.coordinates.length,this.instructions.push([W.CUSTOM,a,h,t,i]),this.hitDetectionInstructions.push([W.CUSTOM,a,h,t,n||i])}this.endGeometry(e)}beginGeometry(t,e){this.beginGeometryInstruction1_=[W.BEGIN_GEOMETRY,e,0,t],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[W.BEGIN_GEOMETRY,e,0,t],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const t=this.hitDetectionInstructions;let e;t.reverse();const i=t.length;let n,r,o=-1;for(e=0;e<i;++e)n=t[e],r=n[0],r==W.END_GEOMETRY?o=e:r==W.BEGIN_GEOMETRY&&(n[2]=e,j(this.hitDetectionInstructions,o,e),o=-1)}setFillStrokeStyle(t,e){const i=this.state;if(t){const n=t.getColor();i.fillStyle=Vt(n||$t)}else i.fillStyle=void 0;if(e){const n=e.getColor();i.strokeStyle=Vt(n||ri);const r=e.getLineCap();i.lineCap=void 0!==r?r:Oi;const o=e.getLineDash();i.lineDash=o?o.slice():ii;const a=e.getLineDashOffset();i.lineDashOffset=a||0;const l=e.getLineJoin();i.lineJoin=void 0!==l?l:ze;const h=e.getWidth();i.lineWidth=void 0!==h?h:1;const c=e.getMiterLimit();i.miterLimit=void 0!==c?c:10,i.lineWidth>this.maxLineWidth&&(this.maxLineWidth=i.lineWidth,this.bufferedMaxExtent_=null)}else i.strokeStyle=void 0,i.lineCap=void 0,i.lineDash=null,i.lineDashOffset=void 0,i.lineJoin=void 0,i.lineWidth=void 0,i.miterLimit=void 0}createFill(t){const e=t.fillStyle,i=[W.SET_FILL_STYLE,e];return"string"!=typeof e&&i.push(!0),i}applyStroke(t){this.instructions.push(this.createStroke(t))}createStroke(t){return[W.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,this.applyPixelRatio(t.lineDash),t.lineDashOffset*this.pixelRatio]}updateFillStyle(t,e){const i=t.fillStyle;("string"!=typeof i||t.currentFillStyle!=i)&&(void 0!==i&&this.instructions.push(e.call(this,t)),t.currentFillStyle=i)}updateStrokeStyle(t,e){const i=t.strokeStyle,n=t.lineCap,r=t.lineDash,o=t.lineDashOffset,a=t.lineJoin,l=t.lineWidth,h=t.miterLimit;(t.currentStrokeStyle!=i||t.currentLineCap!=n||r!=t.currentLineDash&&!ot(t.currentLineDash,r)||t.currentLineDashOffset!=o||t.currentLineJoin!=a||t.currentLineWidth!=l||t.currentMiterLimit!=h)&&(void 0!==i&&e.call(this,t),t.currentStrokeStyle=i,t.currentLineCap=n,t.currentLineDash=r,t.currentLineDashOffset=o,t.currentLineJoin=a,t.currentLineWidth=l,t.currentMiterLimit=h)}endGeometry(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const e=[W.END_GEOMETRY,t];this.instructions.push(e),this.hitDetectionInstructions.push(e)}getBufferedMaxExtent(){return!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=(0,T.d9)(this.maxExtent),this.maxLineWidth>0)&&(0,T.f3)(this.bufferedMaxExtent_,this.resolution*(this.maxLineWidth+1)/2,this.bufferedMaxExtent_),this.bufferedMaxExtent_}},Fr=class Rh extends _i{constructor(t,e,i,n){super(t,e,i,n)}drawFlatCoordinatess_(t,e,i,n){const r=this.state,o=void 0!==r.fillStyle,a=void 0!==r.strokeStyle,l=i.length;this.instructions.push(ke),this.hitDetectionInstructions.push(ke);for(let h=0;h<l;++h){const c=i[h],u=this.coordinates.length,d=this.appendFlatLineCoordinates(t,e,c,n,!0,!a),f=[W.MOVE_TO_LINE_TO,u,d];this.instructions.push(f),this.hitDetectionInstructions.push(f),a&&(this.instructions.push(Pr),this.hitDetectionInstructions.push(Pr)),e=c}return o&&(this.instructions.push(Zi),this.hitDetectionInstructions.push(Zi)),a&&(this.instructions.push(ye),this.hitDetectionInstructions.push(ye)),e}drawCircle(t,e){const i=this.state;if(void 0===i.fillStyle&&void 0===i.strokeStyle)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e),void 0!==i.fillStyle&&this.hitDetectionInstructions.push([W.SET_FILL_STYLE,$t]),void 0!==i.strokeStyle&&this.hitDetectionInstructions.push([W.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]);const o=t.getFlatCoordinates(),a=t.getStride(),l=this.coordinates.length;this.appendFlatLineCoordinates(o,0,o.length,a,!1,!1);const h=[W.CIRCLE,l];this.instructions.push(ke,h),this.hitDetectionInstructions.push(ke,h),void 0!==i.fillStyle&&(this.instructions.push(Zi),this.hitDetectionInstructions.push(Zi)),void 0!==i.strokeStyle&&(this.instructions.push(ye),this.hitDetectionInstructions.push(ye)),this.endGeometry(e)}drawPolygon(t,e){const i=this.state;if(void 0===i.fillStyle&&void 0===i.strokeStyle)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e),void 0!==i.fillStyle&&this.hitDetectionInstructions.push([W.SET_FILL_STYLE,$t]),void 0!==i.strokeStyle&&this.hitDetectionInstructions.push([W.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]);const o=t.getEnds(),a=t.getOrientedFlatCoordinates(),l=t.getStride();this.drawFlatCoordinatess_(a,0,o,l),this.endGeometry(e)}drawMultiPolygon(t,e){const i=this.state;if(void 0===i.fillStyle&&void 0===i.strokeStyle)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e),void 0!==i.fillStyle&&this.hitDetectionInstructions.push([W.SET_FILL_STYLE,$t]),void 0!==i.strokeStyle&&this.hitDetectionInstructions.push([W.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]);const o=t.getEndss(),a=t.getOrientedFlatCoordinates(),l=t.getStride();let h=0;for(let c=0,u=o.length;c<u;++c)h=this.drawFlatCoordinatess_(a,h,o[c],l);this.endGeometry(e)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const t=this.tolerance;if(0!==t){const e=this.coordinates;for(let i=0,n=e.length;i<n;++i)e[i]=Oe(e[i],t)}return super.finish()}setFillStrokeStyles_(){const t=this.state;void 0!==t.fillStyle&&this.updateFillStyle(t,this.createFill),void 0!==t.strokeStyle&&this.updateStrokeStyle(t,this.applyStroke)}};function vh(s,t,e,i,n){let c,u,d,f,_,m,p,x,E,C,r=e,o=e,a=0,l=0,h=e;for(u=e;u<i;u+=n){const v=t[u],I=t[u+1];void 0!==_&&(E=v-_,C=I-m,f=Math.sqrt(E*E+C*C),void 0!==p&&(l+=d,c=Math.acos((p*E+x*C)/(d*f)),c>s&&(l>a&&(a=l,r=h,o=u),l=0,h=u-n)),d=f,p=E,x=C),_=v,m=I}return l+=f,l>a?[h,u]:[r,o]}const mi={left:0,end:0,center:.5,right:1,start:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1},Sh={Circle:Fr,Default:_i,Image:class yh extends _i{constructor(t,e,i,n){super(t,e,i,n),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(t,e){if(!this.image_)return;this.beginGeometry(t,e);const i=t.getFlatCoordinates(),n=t.getStride(),r=this.coordinates.length,o=this.appendFlatPointCoordinates(i,n);this.instructions.push([W.DRAW_IMAGE,r,o,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([W.DRAW_IMAGE,r,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}drawMultiPoint(t,e){if(!this.image_)return;this.beginGeometry(t,e);const i=t.getFlatCoordinates(),n=t.getStride(),r=this.coordinates.length,o=this.appendFlatPointCoordinates(i,n);this.instructions.push([W.DRAW_IMAGE,r,o,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([W.DRAW_IMAGE,r,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(t,e){const i=t.getAnchor(),n=t.getSize(),r=t.getOrigin();this.imagePixelRatio_=t.getPixelRatio(this.pixelRatio),this.anchorX_=i[0],this.anchorY_=i[1],this.hitDetectionImage_=t.getHitDetectionImage(),this.image_=t.getImage(this.pixelRatio),this.height_=n[1],this.opacity_=t.getOpacity(),this.originX_=r[0],this.originY_=r[1],this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScaleArray(),this.width_=n[0],this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}},LineString:class Ch extends _i{constructor(t,e,i,n){super(t,e,i,n)}drawFlatCoordinates_(t,e,i,n){const r=this.coordinates.length,o=this.appendFlatLineCoordinates(t,e,i,n,!1,!1),a=[W.MOVE_TO_LINE_TO,r,o];return this.instructions.push(a),this.hitDetectionInstructions.push(a),i}drawLineString(t,e){const i=this.state;if(void 0===i.strokeStyle||void 0===i.lineWidth)return;this.updateStrokeStyle(i,this.applyStroke),this.beginGeometry(t,e),this.hitDetectionInstructions.push([W.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,ii,0],ke);const o=t.getFlatCoordinates(),a=t.getStride();this.drawFlatCoordinates_(o,0,o.length,a),this.hitDetectionInstructions.push(ye),this.endGeometry(e)}drawMultiLineString(t,e){const i=this.state;if(void 0===i.strokeStyle||void 0===i.lineWidth)return;this.updateStrokeStyle(i,this.applyStroke),this.beginGeometry(t,e),this.hitDetectionInstructions.push([W.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset],ke);const o=t.getEnds(),a=t.getFlatCoordinates(),l=t.getStride();let h=0;for(let c=0,u=o.length;c<u;++c)h=this.drawFlatCoordinates_(a,h,o[c],l);this.hitDetectionInstructions.push(ye),this.endGeometry(e)}finish(){const t=this.state;return null!=t.lastStroke&&t.lastStroke!=this.coordinates.length&&this.instructions.push(ye),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(t){null!=t.lastStroke&&t.lastStroke!=this.coordinates.length&&(this.instructions.push(ye),t.lastStroke=this.coordinates.length),t.lastStroke=0,super.applyStroke(t),this.instructions.push(ke)}},Polygon:Fr,Text:class Ih extends _i{constructor(t,e,i,n){super(t,e,i,n),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterImageWithText_=void 0}finish(){const t=super.finish();return t.textStates=this.textStates,t.fillStates=this.fillStates,t.strokeStates=this.strokeStates,t}drawText(t,e){const r=this.textState_;if(""===this.text_||!r||!this.textFillState_&&!this.textStrokeState_)return;const o=this.coordinates;let a=o.length;const l=t.getType();let h=null,c=t.getStride();if("line"!==r.placement||"LineString"!=l&&"MultiLineString"!=l&&"Polygon"!=l&&"MultiPolygon"!=l){let u=r.overflow?null:[];switch(l){case"Point":case"MultiPoint":h=t.getFlatCoordinates();break;case"LineString":h=t.getFlatMidpoint();break;case"Circle":h=t.getCenter();break;case"MultiLineString":h=t.getFlatMidpoints(),c=2;break;case"Polygon":h=t.getFlatInteriorPoint(),r.overflow||u.push(h[2]/this.resolution),c=3;break;case"MultiPolygon":const p=t.getFlatInteriorPoints();h=[];for(let x=0,E=p.length;x<E;x+=3)r.overflow||u.push(p[x+2]/this.resolution),h.push(p[x],p[x+1]);if(0===h.length)return;c=2}const d=this.appendFlatPointCoordinates(h,c);if(d===a)return;if(u&&(d-a)/2!=h.length/c){let p=a/2;u=u.filter((x,E)=>{const C=o[2*(p+E)]===h[E*c]&&o[2*(p+E)+1]===h[E*c+1];return C||--p,C})}this.saveTextStates_(),(r.backgroundFill||r.backgroundStroke)&&(this.setFillStrokeStyle(r.backgroundFill,r.backgroundStroke),r.backgroundFill&&(this.updateFillStyle(this.state,this.createFill),this.hitDetectionInstructions.push(this.createFill(this.state))),r.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(t,e);let f=r.padding;if(f!=Me&&(r.scale[0]<0||r.scale[1]<0)){let p=r.padding[0],x=r.padding[1],E=r.padding[2],C=r.padding[3];r.scale[0]<0&&(x=-x,C=-C),r.scale[1]<0&&(p=-p,E=-E),f=[p,x,E,C]}const _=this.pixelRatio;this.instructions.push([W.DRAW_IMAGE,a,d,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,void 0,this.declutterImageWithText_,f==Me?Me:f.map(function(p){return p*_}),!!r.backgroundFill,!!r.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,u]);const m=1/_;this.hitDetectionInstructions.push([W.DRAW_IMAGE,a,d,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[m,m],NaN,void 0,this.declutterImageWithText_,f,!!r.backgroundFill,!!r.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,u]),this.endGeometry(e)}else{if(!(0,T.kK)(this.getBufferedMaxExtent(),t.getExtent()))return;let u;if(h=t.getFlatCoordinates(),"LineString"==l)u=[h.length];else if("MultiLineString"==l)u=t.getEnds();else if("Polygon"==l)u=t.getEnds().slice(0,1);else if("MultiPolygon"==l){const m=t.getEndss();u=[];for(let p=0,x=m.length;p<x;++p)u.push(m[p][0])}this.beginGeometry(t,e);const d=r.textAlign;let _,f=0;for(let m=0,p=u.length;m<p;++m){if(null==d){const E=vh(r.maxAngle,h,f,u[m],c);f=E[0],_=E[1]}else _=u[m];for(let E=f;E<_;E+=c)o.push(h[E],h[E+1]);const x=o.length;f=u[m],this.drawChars_(a,x),a=x}this.endGeometry(e)}}saveTextStates_(){const t=this.textStrokeState_,e=this.textState_,i=this.textFillState_,n=this.strokeKey_;t&&(n in this.strokeStates||(this.strokeStates[n]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}));const r=this.textKey_;r in this.textStates||(this.textStates[r]={font:e.font,textAlign:e.textAlign||oi,justify:e.justify,textBaseline:e.textBaseline||Pi,scale:e.scale});const o=this.fillKey_;i&&(o in this.fillStates||(this.fillStates[o]={fillStyle:i.fillStyle}))}drawChars_(t,e){const i=this.textStrokeState_,n=this.textState_,r=this.strokeKey_,o=this.textKey_,a=this.fillKey_;this.saveTextStates_();const l=this.pixelRatio,h=mi[n.textBaseline],c=this.textOffsetY_*l,u=this.text_,d=i?i.lineWidth*Math.abs(n.scale[0])/2:0;this.instructions.push([W.DRAW_CHARS,t,e,h,n.overflow,a,n.maxAngle,l,c,r,d*l,u,o,1]),this.hitDetectionInstructions.push([W.DRAW_CHARS,t,e,h,n.overflow,a,n.maxAngle,1,c,r,d,u,o,1/l])}setTextStyle(t,e){let i,n,r;if(t){const o=t.getFill();o?(n=this.textFillState_,n||(n={},this.textFillState_=n),n.fillStyle=Vt(o.getColor()||$t)):(n=null,this.textFillState_=n);const a=t.getStroke();if(a){r=this.textStrokeState_,r||(r={},this.textStrokeState_=r);const _=a.getLineDash(),m=a.getLineDashOffset(),p=a.getWidth(),x=a.getMiterLimit();r.lineCap=a.getLineCap()||Oi,r.lineDash=_?_.slice():ii,r.lineDashOffset=void 0===m?0:m,r.lineJoin=a.getLineJoin()||ze,r.lineWidth=void 0===p?1:p,r.miterLimit=void 0===x?10:x,r.strokeStyle=Vt(a.getColor()||ri)}else r=null,this.textStrokeState_=r;i=this.textState_;const l=t.getFont()||Is;wo(l);const h=t.getScaleArray();i.overflow=t.getOverflow(),i.font=l,i.maxAngle=t.getMaxAngle(),i.placement=t.getPlacement(),i.textAlign=t.getTextAlign(),i.justify=t.getJustify(),i.textBaseline=t.getTextBaseline()||Pi,i.backgroundFill=t.getBackgroundFill(),i.backgroundStroke=t.getBackgroundStroke(),i.padding=t.getPadding()||Me,i.scale=void 0===h?[1,1]:h;const c=t.getOffsetX(),u=t.getOffsetY(),d=t.getRotateWithView(),f=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=void 0===c?0:c,this.textOffsetY_=void 0===u?0:u,this.textRotateWithView_=void 0!==d&&d,this.textRotation_=void 0===f?0:f,this.strokeKey_=r?("string"==typeof r.strokeStyle?r.strokeStyle:st(r.strokeStyle))+r.lineCap+r.lineDashOffset+"|"+r.lineWidth+r.lineJoin+r.miterLimit+"["+r.lineDash.join()+"]":"",this.textKey_=i.font+i.scale+(i.textAlign||"?")+(i.justify||"?")+(i.textBaseline||"?"),this.fillKey_=n?"string"==typeof n.fillStyle?n.fillStyle:"|"+st(n.fillStyle):""}else this.text_="";this.declutterImageWithText_=e}}},kr=class wh{constructor(t,e,i,n){this.tolerance_=t,this.maxExtent_=e,this.pixelRatio_=n,this.resolution_=i,this.buildersByZIndex_={}}finish(){const t={};for(const e in this.buildersByZIndex_){t[e]=t[e]||{};const i=this.buildersByZIndex_[e];for(const n in i){const r=i[n].finish();t[e][n]=r}}return t}getBuilder(t,e){const i=void 0!==t?t.toString():"0";let n=this.buildersByZIndex_[i];void 0===n&&(n={},this.buildersByZIndex_[i]=n);let r=n[e];return void 0===r&&(r=new(0,Sh[e])(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),n[e]=r),r}};function Lh(s,t,e,i,n,r,o,a,l,h,c,u){let d=s[t],f=s[t+1],_=0,m=0,p=0,x=0;function E(){_=d,m=f,d=s[t+=i],f=s[t+1],x+=p,p=Math.sqrt((d-_)*(d-_)+(f-m)*(f-m))}do{E()}while(t<e-i&&x+p<r);let C=0===p?0:(r-x)/p;const v=(0,Y.t7)(_,d,C),I=(0,Y.t7)(m,f,C),A=t-i,M=x,F=r+a*l(h,n,c);for(;t<e-i&&x+p<F;)E();C=0===p?0:(F-x)/p;const X=(0,Y.t7)(_,d,C),Z=(0,Y.t7)(m,f,C);let nt;if(u){const b=[v,I,X,Z];Os(b,0,4,2,u,b,b),nt=b[0]>b[2]}else nt=v>X;const et=Math.PI,B=[],mt=A+i===t;let U;if(p=0,x=M,d=s[t=A],f=s[t+1],mt)return E(),U=Math.atan2(f-m,d-_),nt&&(U+=U>0?-et:et),B[0]=[(X+v)/2,(Z+I)/2,(F-r)/2,U,n],B;for(let b=0,O=(n=n.replace(/\n/g," ")).length;b<O;){E();let N=Math.atan2(f-m,d-_);if(nt&&(N+=N>0?-et:et),void 0!==U){let rt=N-U;if(rt+=rt>et?-2*et:rt<-et?2*et:0,Math.abs(rt)>o)return null}U=N;const ct=b;let ut=0;for(;b<O;++b){const ht=a*l(h,n[nt?O-b-1:b],c);if(t+i<e&&x+p<r+ut+ht/2)break;ut+=ht}if(b===ct)continue;const xt=nt?n.substring(O-ct,O-b):n.substring(ct,b);C=0===p?0:(r+ut/2-x)/p;const S=(0,Y.t7)(_,d,C),Mt=(0,Y.t7)(m,f,C);B.push([S,Mt,ut/2,N,xt]),r+=ut}return B}function Nr(s,t,e,i){let n=s[t],r=s[t+1],o=0;for(let a=t+i;a<e;a+=i){const l=s[a],h=s[a+1];o+=Math.sqrt((l-n)*(l-n)+(h-r)*(h-r)),n=l,r=h}return o}const je=(0,T.lJ)(),Ee=[],ee=[],ie=[],Ce=[];function Gr(s){return s[3].declutterBox}const Ah=new RegExp("["+String.fromCharCode(1425)+"-"+String.fromCharCode(2303)+String.fromCharCode(64285)+"-"+String.fromCharCode(65023)+String.fromCharCode(65136)+"-"+String.fromCharCode(65276)+String.fromCharCode(67584)+"-"+String.fromCharCode(69631)+String.fromCharCode(124928)+"-"+String.fromCharCode(126975)+"]");function Yr(s,t){return("start"===t||"end"===t)&&!Ah.test(s)&&(t="start"===t?"left":"right"),mi[t]}function Mh(s,t,e){return e>0&&s.push("\n",""),s.push(t,""),s}const Oh=class bh{constructor(t,e,i,n){this.overlaps=i,this.pixelRatio=e,this.resolution=t,this.instructions=n.instructions,this.coordinates=n.coordinates,this.coordinateCache_={},this.renderedTransform_=[1,0,0,1,0,0],this.hitDetectionInstructions=n.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=n.fillStates||{},this.strokeStates=n.strokeStates||{},this.textStates=n.textStates||{},this.widths_={},this.labels_={}}createLabel(t,e,i,n){const r=t+e+i+n;if(this.labels_[r])return this.labels_[r];const o=n?this.strokeStates[n]:null,a=i?this.fillStates[i]:null,l=this.textStates[e],h=this.pixelRatio,c=[l.scale[0]*h,l.scale[1]*h],u=Array.isArray(t),d=l.justify?mi[l.justify]:Yr(Array.isArray(t)?t[0]:t,l.textAlign||oi),f=n&&o.lineWidth?o.lineWidth:0,_=u?t:t.split("\n").reduce(Mh,[]),{width:m,height:p,widths:x,heights:E,lineWidths:C}=function Ao(s,t){const e=[],i=[],n=[];let r=0,o=0,a=0,l=0;for(let h=0,c=t.length;h<=c;h+=2){const u=t[h];if("\n"===u||h===c){r=Math.max(r,o),n.push(o),o=0,a+=l;continue}const d=t[h+1]||s.font,f=Di(d,u);e.push(f),o+=f;const _=Lo(d);i.push(_),l=Math.max(l,_)}return{width:r,height:a,widths:e,heights:i,lineWidths:n}}(l,_),v=m+f,I=[],A=(v+2)*c[0],M=(p+f)*c[1],F={width:A<0?Math.floor(A):Math.ceil(A),height:M<0?Math.floor(M):Math.ceil(M),contextInstructions:I};(1!=c[0]||1!=c[1])&&I.push("scale",c),n&&(I.push("strokeStyle",o.strokeStyle),I.push("lineWidth",f),I.push("lineCap",o.lineCap),I.push("lineJoin",o.lineJoin),I.push("miterLimit",o.miterLimit),I.push("setLineDash",[o.lineDash]),I.push("lineDashOffset",o.lineDashOffset)),i&&I.push("fillStyle",a.fillStyle),I.push("textBaseline","middle"),I.push("textAlign","center");const X=.5-d;let Z=d*v+X*f;const nt=[],et=[];let O,B=0,mt=0,U=0,b=0;for(let N=0,ct=_.length;N<ct;N+=2){const ut=_[N];if("\n"===ut){mt+=B,B=0,Z=d*v+X*f,++b;continue}const xt=_[N+1]||l.font;xt!==O&&(n&&nt.push("font",xt),i&&et.push("font",xt),O=xt),B=Math.max(B,E[U]);const S=[ut,Z+X*x[U]+d*(x[U]-C[b]),.5*(f+B)+mt];Z+=x[U],n&&nt.push("strokeText",S),i&&et.push("fillText",S),++U}return Array.prototype.push.apply(I,nt),Array.prototype.push.apply(I,et),this.labels_[r]=F,F}replayTextBackground_(t,e,i,n,r,o,a){t.beginPath(),t.moveTo.apply(t,e),t.lineTo.apply(t,i),t.lineTo.apply(t,n),t.lineTo.apply(t,r),t.lineTo.apply(t,e),o&&(this.alignFill_=o[2],this.fill_(t)),a&&(this.setStrokeStyle_(t,a),t.stroke())}calculateImageOrLabelDimensions_(t,e,i,n,r,o,a,l,h,c,u,d,f,_,m,p){let x=i-(a*=d[0]),E=n-(l*=d[1]);const C=r+h>t?t-h:r,v=o+c>e?e-c:o,I=_[3]+C*d[0]+_[1],A=_[0]+v*d[1]+_[2],M=x-_[3],F=E-_[0];let X;return(m||0!==u)&&(Ee[0]=M,Ce[0]=M,Ee[1]=F,ee[1]=F,ee[0]=M+I,ie[0]=ee[0],ie[1]=F+A,Ce[1]=ie[1]),0!==u?(X=Qt([1,0,0,1,0,0],i,n,1,1,u,-i,-n),pt(X,Ee),pt(X,ee),pt(X,ie),pt(X,Ce),(0,T.T9)(Math.min(Ee[0],ee[0],ie[0],Ce[0]),Math.min(Ee[1],ee[1],ie[1],Ce[1]),Math.max(Ee[0],ee[0],ie[0],Ce[0]),Math.max(Ee[1],ee[1],ie[1],Ce[1]),je)):(0,T.T9)(Math.min(M,M+I),Math.min(F,F+A),Math.max(M,M+I),Math.max(F,F+A),je),f&&(x=Math.round(x),E=Math.round(E)),{drawImageX:x,drawImageY:E,drawImageW:C,drawImageH:v,originX:h,originY:c,declutterBox:{minX:je[0],minY:je[1],maxX:je[2],maxY:je[3],value:p},canvasTransform:X,scale:d}}replayImageOrLabel_(t,e,i,n,r,o,a){const h=n.declutterBox,c=t.canvas,u=a?a[2]*n.scale[0]/2:0;return h.minX-u<=c.width/e&&h.maxX+u>=0&&h.minY-u<=c.height/e&&h.maxY+u>=0&&(!(!o&&!a)&&this.replayTextBackground_(t,Ee,ee,ie,Ce,o,a),function Mo(s,t,e,i,n,r,o,a,l,h,c){s.save(),1!==e&&(s.globalAlpha*=e),t&&s.setTransform.apply(s,t),i.contextInstructions?(s.translate(l,h),s.scale(c[0],c[1]),function bo(s,t){const e=s.contextInstructions;for(let i=0,n=e.length;i<n;i+=2)Array.isArray(e[i+1])?t[e[i]].apply(t,e[i+1]):t[e[i]]=e[i+1]}(i,s)):c[0]<0||c[1]<0?(s.translate(l,h),s.scale(c[0],c[1]),s.drawImage(i,n,r,o,a,0,0,o,a)):s.drawImage(i,n,r,o,a,l,h,o*c[0],a*c[1]),s.restore()}(t,n.canvasTransform,r,i,n.originX,n.originY,n.drawImageW,n.drawImageH,n.drawImageX,n.drawImageY,n.scale)),!0}fill_(t){if(this.alignFill_){const e=pt(this.renderedTransform_,[0,0]),i=512*this.pixelRatio;t.save(),t.translate(e[0]%i,e[1]%i),t.rotate(this.viewRotation_)}t.fill(),this.alignFill_&&t.restore()}setStrokeStyle_(t,e){t.strokeStyle=e[1],t.lineWidth=e[2],t.lineCap=e[3],t.lineJoin=e[4],t.miterLimit=e[5],t.lineDashOffset=e[7],t.setLineDash(e[6])}drawLabelWithPointPlacement_(t,e,i,n){const r=this.textStates[e],o=this.createLabel(t,e,n,i),a=this.strokeStates[i],l=this.pixelRatio,h=Yr(Array.isArray(t)?t[0]:t,r.textAlign||oi),c=mi[r.textBaseline||Pi],u=a&&a.lineWidth?a.lineWidth:0;return{label:o,anchorX:h*(o.width/l-2*r.scale[0])+2*(.5-h)*u,anchorY:c*o.height/l+2*(.5-c)*u}}execute_(t,e,i,n,r,o,a,l){let h;this.pixelCoordinates_&&ot(i,this.renderedTransform_)?h=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),h=be(this.coordinates,0,this.coordinates.length,2,i,this.pixelCoordinates_),function uo(s,t){s[0]=t[0],s[1]=t[1],s[2]=t[2],s[3]=t[3],s[4]=t[4],s[5]=t[5]}(this.renderedTransform_,i));let c=0;const u=n.length;let f,_,m,p,x,E,C,v,I,A,M,F,d=0,X=0,Z=0,nt=null,et=null;const B=this.coordinateCache_,mt=this.viewRotation_,U=Math.round(1e12*Math.atan2(-i[1],i[0]))/1e12,b={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:mt},O=this.instructions!=n||this.overlaps?0:200;let N,ct,ut,xt;for(;c<u;){const S=n[c];switch(S[0]){case W.BEGIN_GEOMETRY:N=S[1],xt=S[3],N.getGeometry()?void 0===a||(0,T.kK)(a,xt.getExtent())?++c:c=S[2]+1:c=S[2];break;case W.BEGIN_PATH:X>O&&(this.fill_(t),X=0),Z>O&&(t.stroke(),Z=0),!X&&!Z&&(t.beginPath(),p=NaN,x=NaN),++c;break;case W.CIRCLE:d=S[1];const rt=h[d],ht=h[d+1],yt=h[d+2]-rt,ne=h[d+3]-ht,Ve=Math.sqrt(yt*yt+ne*ne);t.moveTo(rt+Ve,ht),t.arc(rt,ht,Ve,0,2*Math.PI,!0),++c;break;case W.CLOSE_PATH:t.closePath(),++c;break;case W.CUSTOM:d=S[1],f=S[2];const He=S[4],Bi=6==S.length?S[5]:void 0;b.geometry=S[3],b.feature=N,c in B||(B[c]=[]);const ve=B[c];Bi?Bi(h,d,f,2,ve):(ve[0]=h[d],ve[1]=h[d+1],ve.length=2),He(ve,b),++c;break;case W.DRAW_IMAGE:d=S[1],f=S[2],v=S[3],_=S[4],m=S[5];let xi=S[6];const Ie=S[7],Ui=S[8],ji=S[9],Vi=S[10];let qe=S[11];const $n=S[12];let It=S[13];const Dt=S[14],Xt=S[15];if(!v&&S.length>=20){I=S[19],A=S[20],M=S[21],F=S[22];const bt=this.drawLabelWithPointPlacement_(I,A,M,F);v=bt.label,S[3]=v,_=(bt.anchorX-S[23])*this.pixelRatio,S[4]=_,m=(bt.anchorY-S[24])*this.pixelRatio,S[5]=m,xi=v.height,S[6]=xi,It=v.width,S[13]=It}let se,Je,Ne,Se;S.length>25&&(se=S[25]),S.length>17?(Je=S[16],Ne=S[17],Se=S[18]):(Je=Me,Ne=!1,Se=!1),Vi&&U?qe+=mt:!Vi&&!U&&(qe-=mt);let Qe=0;for(;d<f;d+=2){if(se&&se[Qe++]<It/this.pixelRatio)continue;const bt=this.calculateImageOrLabelDimensions_(v.width,v.height,h[d],h[d+1],It,xi,_,m,Ui,ji,qe,$n,r,Je,Ne||Se,N),$e=[t,e,v,bt,Ie,Ne?nt:null,Se?et:null];if(l){if("none"===Dt)continue;if("obstacle"===Dt){l.insert(bt.declutterBox);continue}{let Ft,re;if(Xt){const Ot=f-d;if(!Xt[Ot]){Xt[Ot]=$e;continue}if(Ft=Xt[Ot],delete Xt[Ot],re=Gr(Ft),l.collides(re))continue}if(l.collides(bt.declutterBox))continue;Ft&&(l.insert(re),this.replayImageOrLabel_.apply(this,Ft)),l.insert(bt.declutterBox)}}this.replayImageOrLabel_.apply(this,$e)}++c;break;case W.DRAW_CHARS:const Hi=S[1],Tt=S[2],ts=S[3],Oc=S[4];F=S[5];const Pc=S[6],Jr=S[7],Qr=S[8];M=S[9];const es=S[10];I=S[11],A=S[12];const $r=[S[13],S[13]],is=this.textStates[A],yi=is.font,Ei=[is.scale[0]*Jr,is.scale[1]*Jr];let Ci;yi in this.widths_?Ci=this.widths_[yi]:(Ci={},this.widths_[yi]=Ci);const to=Nr(h,Hi,Tt,2),eo=Math.abs(Ei[0])*ws(yi,I,Ci);if(Oc||eo<=to){const Ft=Lh(h,Hi,Tt,2,I,(to-eo)*mi[this.textStates[A].textAlign],Pc,Math.abs(Ei[0]),ws,yi,Ci,U?0:this.viewRotation_);t:if(Ft){const re=[];let Ot,qi,Ji,St,kt;if(M)for(Ot=0,qi=Ft.length;Ot<qi;++Ot){kt=Ft[Ot],Ji=kt[4],St=this.createLabel(Ji,A,"",M),_=kt[2]+(Ei[0]<0?-es:es),m=ts*St.height+2*(.5-ts)*es*Ei[1]/Ei[0]-Qr;const oe=this.calculateImageOrLabelDimensions_(St.width,St.height,kt[0],kt[1],St.width,St.height,_,m,0,0,kt[3],$r,!1,Me,!1,N);if(l&&l.collides(oe.declutterBox))break t;re.push([t,e,St,oe,1,null,null])}if(F)for(Ot=0,qi=Ft.length;Ot<qi;++Ot){kt=Ft[Ot],Ji=kt[4],St=this.createLabel(Ji,A,F,""),_=kt[2],m=ts*St.height-Qr;const oe=this.calculateImageOrLabelDimensions_(St.width,St.height,kt[0],kt[1],St.width,St.height,_,m,0,0,kt[3],$r,!1,Me,!1,N);if(l&&l.collides(oe.declutterBox))break t;re.push([t,e,St,oe,1,null,null])}l&&l.load(re.map(Gr));for(let oe=0,Dc=re.length;oe<Dc;++oe)this.replayImageOrLabel_.apply(this,re[oe])}}++c;break;case W.END_GEOMETRY:if(void 0!==o){N=S[1];const bt=o(N,xt);if(bt)return bt}++c;break;case W.FILL:O?X++:this.fill_(t),++c;break;case W.MOVE_TO_LINE_TO:for(d=S[1],f=S[2],ct=h[d],ut=h[d+1],E=ct+.5|0,C=ut+.5|0,(E!==p||C!==x)&&(t.moveTo(ct,ut),p=E,x=C),d+=2;d<f;d+=2)ct=h[d],ut=h[d+1],E=ct+.5|0,C=ut+.5|0,(d==f-2||E!==p||C!==x)&&(t.lineTo(ct,ut),p=E,x=C);++c;break;case W.SET_FILL_STYLE:nt=S,this.alignFill_=S[2],X&&(this.fill_(t),X=0,Z&&(t.stroke(),Z=0)),t.fillStyle=S[1],++c;break;case W.SET_STROKE_STYLE:et=S,Z&&(t.stroke(),Z=0),this.setStrokeStyle_(t,S),++c;break;case W.STROKE:O?Z++:t.stroke(),++c;break;default:++c}}X&&this.fill_(t),Z&&t.stroke()}execute(t,e,i,n,r,o){this.viewRotation_=n,this.execute_(t,e,i,this.instructions,r,void 0,void 0,o)}executeHitDetection(t,e,i,n,r){return this.viewRotation_=i,this.execute_(t,1,e,this.hitDetectionInstructions,!0,n,r)}},qn=["Polygon","Circle","LineString","Image","Text","Default"],Jn={},zr=class Ph{constructor(t,e,i,n,r,o){this.maxExtent_=t,this.overlaps_=n,this.pixelRatio_=i,this.resolution_=e,this.renderBuffer_=o,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=[1,0,0,1,0,0],this.createExecutors_(r)}clip(t,e){const i=this.getClipCoords(e);t.beginPath(),t.moveTo(i[0],i[1]),t.lineTo(i[2],i[3]),t.lineTo(i[4],i[5]),t.lineTo(i[6],i[7]),t.clip()}createExecutors_(t){for(const e in t){let i=this.executorsByZIndex_[e];void 0===i&&(i={},this.executorsByZIndex_[e]=i);const n=t[e];for(const r in n)i[r]=new Oh(this.resolution_,this.pixelRatio_,this.overlaps_,n[r])}}hasExecutors(t){for(const e in this.executorsByZIndex_){const i=this.executorsByZIndex_[e];for(let n=0,r=t.length;n<r;++n)if(t[n]in i)return!0}return!1}forEachFeatureAtCoordinate(t,e,i,n,r,o){const a=2*(n=Math.round(n))+1,l=Qt(this.hitDetectionTransform_,n+.5,n+.5,1/e,-1/e,-i,-t[0],-t[1]),h=!this.hitDetectionContext_;h&&(this.hitDetectionContext_=Lt(a,a));const c=this.hitDetectionContext_;let u;c.canvas.width!==a||c.canvas.height!==a?(c.canvas.width=a,c.canvas.height=a):h||c.clearRect(0,0,a,a),void 0!==this.renderBuffer_&&(u=(0,T.lJ)(),(0,T.Wj)(u,t),(0,T.f3)(u,e*(this.renderBuffer_+n),u));const d=function Dh(s){if(void 0!==Jn[s])return Jn[s];const t=2*s+1,e=s*s,i=new Array(e+1);for(let r=0;r<=s;++r)for(let o=0;o<=s;++o){const a=r*r+o*o;if(a>e)break;let l=i[a];l||(l=[],i[a]=l),l.push(4*((s+r)*t+(s+o))+3),r>0&&l.push(4*((s-r)*t+(s+o))+3),o>0&&(l.push(4*((s+r)*t+(s-o))+3),r>0&&l.push(4*((s-r)*t+(s-o))+3))}const n=[];for(let r=0,o=i.length;r<o;++r)i[r]&&n.push(...i[r]);return Jn[s]=n,n}(n);let f;function _(I,A){const M=c.getImageData(0,0,a,a).data;for(let F=0,X=d.length;F<X;F++)if(M[d[F]]>0){if(!o||"Image"!==f&&"Text"!==f||o.includes(I)){const Z=(d[F]-3)/4,nt=n-Z%a,et=n-(Z/a|0),B=r(I,A,nt*nt+et*et);if(B)return B}c.clearRect(0,0,a,a);break}}const m=Object.keys(this.executorsByZIndex_).map(Number);let p,x,E,C,v;for(m.sort(L),p=m.length-1;p>=0;--p){const I=m[p].toString();for(E=this.executorsByZIndex_[I],x=qn.length-1;x>=0;--x)if(f=qn[x],C=E[f],void 0!==C&&(v=C.executeHitDetection(c,l,i,_,u),v))return v}}getClipCoords(t){const e=this.maxExtent_;if(!e)return null;const i=e[0],n=e[1],r=e[2],o=e[3],a=[i,n,i,o,r,o,r,n];return be(a,0,8,2,t,a),a}isEmpty(){return Gt(this.executorsByZIndex_)}execute(t,e,i,n,r,o,a){const l=Object.keys(this.executorsByZIndex_).map(Number);let h,c,u,d,f,_;for(l.sort(L),this.maxExtent_&&(t.save(),this.clip(t,i)),o=o||qn,a&&l.reverse(),h=0,c=l.length;h<c;++h){const m=l[h].toString();for(f=this.executorsByZIndex_[m],u=0,d=o.length;u<d;++u)_=f[o[u]],void 0!==_&&_.execute(t,e,i,n,r,a)}this.maxExtent_&&t.restore()}},kh=class Fh extends Dr{constructor(t,e,i,n,r,o,a){super(),this.context_=t,this.pixelRatio_=e,this.extent_=i,this.transform_=n,this.viewRotation_=r,this.squaredTolerance_=o,this.userTransform_=a,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=[1,0,0,1,0,0]}drawImages_(t,e,i,n){if(!this.image_)return;const r=be(t,e,i,n,this.transform_,this.pixelCoordinates_),o=this.context_,a=this.tmpLocalTransform_,l=o.globalAlpha;1!=this.imageOpacity_&&(o.globalAlpha=l*this.imageOpacity_);let h=this.imageRotation_;this.imageRotateWithView_&&(h+=this.viewRotation_);for(let c=0,u=r.length;c<u;c+=2){const d=r[c]-this.imageAnchorX_,f=r[c+1]-this.imageAnchorY_;if(0!==h||1!=this.imageScale_[0]||1!=this.imageScale_[1]){const _=d+this.imageAnchorX_,m=f+this.imageAnchorY_;Qt(a,_,m,1,1,h,-_,-m),o.setTransform.apply(o,a),o.translate(_,m),o.scale(this.imageScale_[0],this.imageScale_[1]),o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),o.setTransform(1,0,0,1,0,0)}else o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,d,f,this.imageWidth_,this.imageHeight_)}1!=this.imageOpacity_&&(o.globalAlpha=l)}drawText_(t,e,i,n){if(!this.textState_||""===this.text_)return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const r=be(t,e,i,n,this.transform_,this.pixelCoordinates_),o=this.context_;let a=this.textRotation_;for(this.textRotateWithView_&&(a+=this.viewRotation_);e<i;e+=n){const l=r[e]+this.textOffsetX_,h=r[e+1]+this.textOffsetY_;0!==a||1!=this.textScale_[0]||1!=this.textScale_[1]?(o.translate(l-this.textOffsetX_,h-this.textOffsetY_),o.rotate(a),o.translate(this.textOffsetX_,this.textOffsetY_),o.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&o.strokeText(this.text_,0,0),this.textFillState_&&o.fillText(this.text_,0,0),o.setTransform(1,0,0,1,0,0)):(this.textStrokeState_&&o.strokeText(this.text_,l,h),this.textFillState_&&o.fillText(this.text_,l,h))}}moveToLineTo_(t,e,i,n,r){const o=this.context_,a=be(t,e,i,n,this.transform_,this.pixelCoordinates_);o.moveTo(a[0],a[1]);let l=a.length;r&&(l-=2);for(let h=2;h<l;h+=2)o.lineTo(a[h],a[h+1]);return r&&o.closePath(),i}drawRings_(t,e,i,n){for(let r=0,o=i.length;r<o;++r)e=this.moveToLineTo_(t,e,i[r],n,!0);return e}drawCircle(t){if((0,T.kK)(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=function ia(s,t,e){const i=s.getFlatCoordinates();if(i){const n=s.getStride();return be(i,0,i.length,n,t,e)}return null}(t,this.transform_,this.pixelCoordinates_),i=e[2]-e[0],n=e[3]-e[1],r=Math.sqrt(i*i+n*n),o=this.context_;o.beginPath(),o.arc(e[0],e[1],r,0,2*Math.PI),this.fillState_&&o.fill(),this.strokeState_&&o.stroke()}""!==this.text_&&this.drawText_(t.getCenter(),0,2,2)}}setStyle(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())}setTransform(t){this.transform_=t}drawGeometry(t){switch(t.getType()){case"Point":this.drawPoint(t);break;case"LineString":this.drawLineString(t);break;case"Polygon":this.drawPolygon(t);break;case"MultiPoint":this.drawMultiPoint(t);break;case"MultiLineString":this.drawMultiLineString(t);break;case"MultiPolygon":this.drawMultiPolygon(t);break;case"GeometryCollection":this.drawGeometryCollection(t);break;case"Circle":this.drawCircle(t)}}drawFeature(t,e){const i=e.getGeometryFunction()(t);!i||!(0,T.kK)(this.extent_,i.getExtent())||(this.setStyle(e),this.drawGeometry(i))}drawGeometryCollection(t){const e=t.getGeometriesArray();for(let i=0,n=e.length;i<n;++i)this.drawGeometry(e[i])}drawPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),""!==this.text_&&this.drawText_(e,0,e.length,i)}drawMultiPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),""!==this.text_&&this.drawText_(e,0,e.length,i)}drawLineString(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),(0,T.kK)(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const e=this.context_,i=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(i,0,i.length,t.getStride(),!1),e.stroke()}if(""!==this.text_){const e=t.getFlatMidpoint();this.drawText_(e,0,2,2)}}}drawMultiLineString(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getExtent();if((0,T.kK)(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const i=this.context_,n=t.getFlatCoordinates();let r=0;const o=t.getEnds(),a=t.getStride();i.beginPath();for(let l=0,h=o.length;l<h;++l)r=this.moveToLineTo_(n,r,o[l],a,!1);i.stroke()}if(""!==this.text_){const i=t.getFlatMidpoints();this.drawText_(i,0,i.length,2)}}}drawPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),(0,T.kK)(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(""!==this.text_){const e=t.getFlatInteriorPoint();this.drawText_(e,0,2,2)}}}drawMultiPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),(0,T.kK)(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_,i=t.getOrientedFlatCoordinates();let n=0;const r=t.getEndss(),o=t.getStride();e.beginPath();for(let a=0,l=r.length;a<l;++a)n=this.drawRings_(i,n,r[a],o);this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(""!==this.text_){const e=t.getFlatInteriorPoints();this.drawText_(e,0,e.length,2)}}}setContextFillState_(t){const e=this.context_,i=this.contextFillState_;i?i.fillStyle!=t.fillStyle&&(i.fillStyle=t.fillStyle,e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})}setContextStrokeState_(t){const e=this.context_,i=this.contextStrokeState_;i?(i.lineCap!=t.lineCap&&(i.lineCap=t.lineCap,e.lineCap=t.lineCap),ot(i.lineDash,t.lineDash)||e.setLineDash(i.lineDash=t.lineDash),i.lineDashOffset!=t.lineDashOffset&&(i.lineDashOffset=t.lineDashOffset,e.lineDashOffset=t.lineDashOffset),i.lineJoin!=t.lineJoin&&(i.lineJoin=t.lineJoin,e.lineJoin=t.lineJoin),i.lineWidth!=t.lineWidth&&(i.lineWidth=t.lineWidth,e.lineWidth=t.lineWidth),i.miterLimit!=t.miterLimit&&(i.miterLimit=t.miterLimit,e.miterLimit=t.miterLimit),i.strokeStyle!=t.strokeStyle&&(i.strokeStyle=t.strokeStyle,e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset,e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})}setContextTextState_(t){const e=this.context_,i=this.contextTextState_,n=t.textAlign?t.textAlign:oi;i?(i.font!=t.font&&(i.font=t.font,e.font=t.font),i.textAlign!=n&&(i.textAlign=n,e.textAlign=n),i.textBaseline!=t.textBaseline&&(i.textBaseline=t.textBaseline,e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=n,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:n,textBaseline:t.textBaseline})}setFillStrokeStyle(t,e){if(t){const i=t.getColor();this.fillState_={fillStyle:Vt(i||$t)}}else this.fillState_=null;if(e){const i=e.getColor(),n=e.getLineCap(),r=e.getLineDash(),o=e.getLineDashOffset(),a=e.getLineJoin(),l=e.getWidth(),h=e.getMiterLimit(),c=r||ii;this.strokeState_={lineCap:void 0!==n?n:Oi,lineDash:1===this.pixelRatio_?c:c.map(u=>u*this.pixelRatio_),lineDashOffset:(o||0)*this.pixelRatio_,lineJoin:void 0!==a?a:ze,lineWidth:(void 0!==l?l:1)*this.pixelRatio_,miterLimit:void 0!==h?h:10,strokeStyle:Vt(i||ri)}}else this.strokeState_=null}setImageStyle(t){let e;if(!t||!(e=t.getSize()))return void(this.image_=null);const i=t.getPixelRatio(this.pixelRatio_),n=t.getAnchor(),r=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=n[0]*i,this.imageAnchorY_=n[1]*i,this.imageHeight_=e[1]*i,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=r[0],this.imageOriginY_=r[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation();const o=t.getScaleArray();this.imageScale_=[o[0]*this.pixelRatio_/i,o[1]*this.pixelRatio_/i],this.imageWidth_=e[0]*i}setTextStyle(t){if(t){const e=t.getFill();if(e){const f=e.getColor();this.textFillState_={fillStyle:Vt(f||$t)}}else this.textFillState_=null;const i=t.getStroke();if(i){const f=i.getColor(),_=i.getLineCap(),m=i.getLineDash(),p=i.getLineDashOffset(),x=i.getLineJoin(),E=i.getWidth(),C=i.getMiterLimit();this.textStrokeState_={lineCap:void 0!==_?_:Oi,lineDash:m||ii,lineDashOffset:p||0,lineJoin:void 0!==x?x:ze,lineWidth:void 0!==E?E:1,miterLimit:void 0!==C?C:10,strokeStyle:Vt(f||ri)}}else this.textStrokeState_=null;const n=t.getFont(),r=t.getOffsetX(),o=t.getOffsetY(),a=t.getRotateWithView(),l=t.getRotation(),h=t.getScaleArray(),c=t.getText(),u=t.getTextAlign(),d=t.getTextBaseline();this.textState_={font:void 0!==n?n:Is,textAlign:void 0!==u?u:oi,textBaseline:void 0!==d?d:Pi},this.text_=void 0!==c?Array.isArray(c)?c.reduce((f,_,m)=>f+(m%2?" ":_),""):c:"",this.textOffsetX_=void 0!==r?this.pixelRatio_*r:0,this.textOffsetY_=void 0!==o?this.pixelRatio_*o:0,this.textRotateWithView_=void 0!==a&&a,this.textRotation_=void 0!==l?l:0,this.textScale_=[this.pixelRatio_*h[0],this.pixelRatio_*h[1]]}else this.text_=""}},Ht=.5,Wr={Point:function Vh(s,t,e,i,n){const r=e.getImage(),o=e.getText();let a;if(r){if(2!=r.getImageState())return;let l=s;if(n){const c=r.getDeclutterMode();if("none"!==c)if(l=n,"obstacle"===c){const u=s.getBuilder(e.getZIndex(),"Image");u.setImageStyle(r,a),u.drawPoint(t,i)}else o&&o.getText()&&(a={})}const h=l.getBuilder(e.getZIndex(),"Image");h.setImageStyle(r,a),h.drawPoint(t,i)}if(o&&o.getText()){let l=s;n&&(l=n);const h=l.getBuilder(e.getZIndex(),"Text");h.setTextStyle(o,a),h.drawText(t,i)}},LineString:function Bh(s,t,e,i,n){const r=e.getStroke();if(r){const a=s.getBuilder(e.getZIndex(),"LineString");a.setFillStrokeStyle(null,r),a.drawLineString(t,i)}const o=e.getText();if(o&&o.getText()){const a=(n||s).getBuilder(e.getZIndex(),"Text");a.setTextStyle(o),a.drawText(t,i)}},Polygon:function qh(s,t,e,i,n){const r=e.getFill(),o=e.getStroke();if(r||o){const l=s.getBuilder(e.getZIndex(),"Polygon");l.setFillStrokeStyle(r,o),l.drawPolygon(t,i)}const a=e.getText();if(a&&a.getText()){const l=(n||s).getBuilder(e.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,i)}},MultiPoint:function Hh(s,t,e,i,n){const r=e.getImage(),o=e.getText();let a;if(r){if(2!=r.getImageState())return;let l=s;if(n){const c=r.getDeclutterMode();if("none"!==c)if(l=n,"obstacle"===c){const u=s.getBuilder(e.getZIndex(),"Image");u.setImageStyle(r,a),u.drawMultiPoint(t,i)}else o&&o.getText()&&(a={})}const h=l.getBuilder(e.getZIndex(),"Image");h.setImageStyle(r,a),h.drawMultiPoint(t,i)}if(o&&o.getText()){let l=s;n&&(l=n);const h=l.getBuilder(e.getZIndex(),"Text");h.setTextStyle(o,a),h.drawText(t,i)}},MultiLineString:function Uh(s,t,e,i,n){const r=e.getStroke();if(r){const a=s.getBuilder(e.getZIndex(),"LineString");a.setFillStrokeStyle(null,r),a.drawMultiLineString(t,i)}const o=e.getText();if(o&&o.getText()){const a=(n||s).getBuilder(e.getZIndex(),"Text");a.setTextStyle(o),a.drawText(t,i)}},MultiPolygon:function jh(s,t,e,i,n){const r=e.getFill(),o=e.getStroke();if(o||r){const l=s.getBuilder(e.getZIndex(),"Polygon");l.setFillStrokeStyle(r,o),l.drawMultiPolygon(t,i)}const a=e.getText();if(a&&a.getText()){const l=(n||s).getBuilder(e.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,i)}},GeometryCollection:function Kh(s,t,e,i,n){const r=t.getGeometriesArray();let o,a;for(o=0,a=r.length;o<a;++o)(0,Wr[r[o].getType()])(s,r[o],e,i,n)},Circle:function Xh(s,t,e,i,n){const r=e.getFill(),o=e.getStroke();if(r||o){const l=s.getBuilder(e.getZIndex(),"Circle");l.setFillStrokeStyle(r,o),l.drawCircle(t,i)}const a=e.getText();if(a&&a.getText()){const l=(n||s).getBuilder(e.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,i)}}};function zh(s,t){return parseInt(st(s),10)-parseInt(st(t),10)}function Qn(s,t){return.5*s/t}function Xr(s,t,e,i,n,r,o){let a=!1;const l=e.getImage();if(l){const h=l.getImageState();2==h||3==h?l.unlistenImageChange(n):(0==h&&l.load(),l.listenImageChange(n),a=!0)}return function Zh(s,t,e,i,n,r){const o=e.getGeometryFunction()(t);if(!o)return;const a=o.simplifyTransformed(i,n);e.getRenderer()?Zr(s,a,e,t):(0,Wr[a.getType()])(s,a,e,t,r)}(s,t,e,i,r,o),a}function Zr(s,t,e,i){if("GeometryCollection"!=t.getType())s.getBuilder(e.getZIndex(),"Default").drawCustom(t,i,e.getRenderer(),e.getHitDetectionRenderer());else{const r=t.getGeometries();for(let o=0,a=r.length;o<a;++o)Zr(s,r[o],e,i)}}const Qh=class Jh extends vr{constructor(t){super(t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.hitDetectionImageData_=null,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=(0,T.lJ)(),this.wrappedRenderedExtent_=(0,T.lJ)(),this.renderedCenter_=null,this.renderedProjection_=null,this.renderedRenderOrder_=null,this.replayGroup_=null,this.replayGroupChanged=!0,this.declutterExecutorGroup=null,this.clipping=!0,this.compositionContext_=null,this.opacity_=1}renderWorlds(t,e,i){const n=e.extent,r=e.viewState,o=r.center,a=r.resolution,l=r.projection,h=r.rotation,c=l.getExtent(),u=this.getLayer().getSource(),d=e.pixelRatio,f=e.viewHints,_=!(f[0]||f[1]),m=this.compositionContext_,p=Math.round(e.size[0]*d),x=Math.round(e.size[1]*d),E=u.getWrapX()&&l.canWrapX(),C=E?(0,T.dz)(c):null,v=E?Math.ceil((n[2]-c[2])/C)+1:1;let I=E?Math.floor((n[0]-c[0])/C):0;do{const A=this.getRenderTransform(o,a,h,d,p,x,I*C);t.execute(m,1,A,h,_,void 0,i)}while(++I<v)}setupCompositionContext_(){if(1!==this.opacity_){const t=Lt(this.context.canvas.width,this.context.canvas.height,Rr);this.compositionContext_=t}else this.compositionContext_=this.context}releaseCompositionContext_(){if(1!==this.opacity_){const t=this.context.globalAlpha;this.context.globalAlpha=this.opacity_,this.context.drawImage(this.compositionContext_.canvas,0,0),this.context.globalAlpha=t,Rs(this.compositionContext_),Rr.push(this.compositionContext_.canvas),this.compositionContext_=null}}renderDeclutter(t){this.declutterExecutorGroup&&(this.setupCompositionContext_(),this.renderWorlds(this.declutterExecutorGroup,t,t.declutterTree),this.releaseCompositionContext_())}renderFrame(t,e){const i=t.pixelRatio,n=t.layerStatesArray[t.layerIndex];(function go(s,t,e){(function ei(s,t,e,i,n,r,o){return s[0]=t,s[1]=e,s[2]=i,s[3]=n,s[4]=r,s[5]=o,s})(s,t,0,0,e,0,0)})(this.pixelTransform,1/i,1/i),Si(this.inversePixelTransform,this.pixelTransform);const r=nn(this.pixelTransform);this.useContainer(e,r,this.getBackground(t));const o=this.context,a=o.canvas,l=this.replayGroup_,h=this.declutterExecutorGroup;if((!l||l.isEmpty())&&(!h||h.isEmpty()))return null;const c=Math.round(t.size[0]*i),u=Math.round(t.size[1]*i);a.width!=c||a.height!=u?(a.width=c,a.height=u,a.style.transform!==r&&(a.style.transform=r)):this.containerReused||o.clearRect(0,0,c,u),this.preRender(o,t);const d=t.viewState,f=d.projection;this.opacity_=n.opacity,this.setupCompositionContext_();let _=!1,m=!0;if(n.extent&&this.clipping){const p=(0,z.dY)(n.extent,f);m=(0,T.kK)(p,t.extent),_=m&&!(0,T.r4)(p,t.extent),_&&this.clipUnrotated(this.compositionContext_,t,p)}return m&&this.renderWorlds(l,t),_&&this.compositionContext_.restore(),this.releaseCompositionContext_(),this.postRender(o,t),this.renderedRotation_!==d.rotation&&(this.renderedRotation_=d.rotation,this.hitDetectionImageData_=null),this.container}getFeatures(t){return new Promise(function(e){if(!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const i=[this.context.canvas.width,this.context.canvas.height];pt(this.pixelTransform,i);const n=this.renderedCenter_,r=this.renderedResolution_,o=this.renderedRotation_,a=this.renderedProjection_,l=this.wrappedRenderedExtent_,h=this.getLayer(),c=[],u=i[0]*Ht,d=i[1]*Ht;c.push(this.getRenderTransform(n,r,o,Ht,u,d,0).slice());const f=h.getSource(),_=a.getExtent();if(f.getWrapX()&&a.canWrapX()&&!(0,T.r4)(_,l)){let m=l[0];const p=(0,T.dz)(_);let E,x=0;for(;m<_[0];)--x,E=p*x,c.push(this.getRenderTransform(n,r,o,Ht,u,d,E).slice()),m+=p;for(x=0,m=l[2];m>_[2];)++x,E=p*x,c.push(this.getRenderTransform(n,r,o,Ht,u,d,E).slice()),m-=p}this.hitDetectionImageData_=function Nh(s,t,e,i,n,r,o){const h=Lt(s[0]*Ht,s[1]*Ht);h.imageSmoothingEnabled=!1;const c=h.canvas,u=new kh(h,Ht,n,null,o),d=e.length,f=Math.floor(16777215/d),_={};for(let p=1;p<=d;++p){const x=e[p-1],E=x.getStyleFunction()||i;if(!i)continue;let C=E(x,r);if(!C)continue;Array.isArray(C)||(C=[C]);const I="#"+("000000"+(p*f).toString(16)).slice(-6);for(let A=0,M=C.length;A<M;++A){const F=C[A],X=F.getGeometryFunction()(x);if(!X||!(0,T.kK)(n,X.getExtent()))continue;const Z=F.clone(),nt=Z.getFill();nt&&nt.setColor(I);const et=Z.getStroke();et&&(et.setColor(I),et.setLineDash(null)),Z.setText(void 0);const B=F.getImage();if(B&&0!==B.getOpacity()){const b=B.getImageSize();if(!b)continue;const O=Lt(b[0],b[1],void 0,{alpha:!1}),N=O.canvas;O.fillStyle=I,O.fillRect(0,0,N.width,N.height),Z.setImage(new Vn({img:N,imgSize:b,anchor:B.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:B.getOrigin(),opacity:1,size:B.getSize(),scale:B.getScale(),rotation:B.getRotation(),rotateWithView:B.getRotateWithView()}))}const mt=Z.getZIndex()||0;let U=_[mt];U||(U={},_[mt]=U,U.Polygon=[],U.Circle=[],U.LineString=[],U.Point=[]),U[X.getType().replace("Multi","")].push(X,Z)}}const m=Object.keys(_).map(Number).sort(L);for(let p=0,x=m.length;p<x;++p){const E=_[m[p]];for(const C in E){const v=E[C];for(let I=0,A=v.length;I<A;I+=2){u.setStyle(v[I+1]);for(let M=0,F=t.length;M<F;++M)u.setTransform(t[M]),u.drawGeometry(v[I])}}}return h.getImageData(0,0,c.width,c.height)}(i,c,this.renderedFeatures_,h.getStyleFunction(),l,r,o)}e(function Gh(s,t,e){const i=[];if(e){const n=Math.floor(Math.round(s[0])*Ht),r=Math.floor(Math.round(s[1])*Ht),o=4*((0,Y.uZ)(n,0,e.width-1)+(0,Y.uZ)(r,0,e.height-1)*e.width),c=e.data[o+2]+256*(e.data[o+1]+256*e.data[o]),u=Math.floor(16777215/t.length);c&&c%u==0&&i.push(t[c/u-1])}return i}(t,this.renderedFeatures_,this.hitDetectionImageData_))}.bind(this))}forEachFeatureAtCoordinate(t,e,i,n,r){if(!this.replayGroup_)return;const o=e.viewState.resolution,a=e.viewState.rotation,l=this.getLayer(),h={},c=function(f,_,m){const p=st(f),x=h[p];if(x){if(!0!==x&&m<x.distanceSq){if(0===m)return h[p]=!0,r.splice(r.lastIndexOf(x),1),n(f,l,_);x.geometry=_,x.distanceSq=m}}else{if(0===m)return h[p]=!0,n(f,l,_);r.push(h[p]={feature:f,layer:l,geometry:_,distanceSq:m,callback:n})}};let u;const d=[this.replayGroup_];return this.declutterExecutorGroup&&d.push(this.declutterExecutorGroup),d.some(f=>u=f.forEachFeatureAtCoordinate(t,o,a,i,c,f===this.declutterExecutorGroup&&e.declutterTree?e.declutterTree.all().map(_=>_.value):null)),u}handleFontsChanged(){const t=this.getLayer();t.getVisible()&&this.replayGroup_&&t.changed()}handleStyleImageChange_(t){this.renderIfReadyAndVisible()}prepareFrame(t){const e=this.getLayer(),i=e.getSource();if(!i)return!1;const n=t.viewHints[0],r=t.viewHints[1],o=e.getUpdateWhileAnimating(),a=e.getUpdateWhileInteracting();if(this.ready&&!o&&n||!a&&r)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const l=t.extent,h=t.viewState,c=h.projection,u=h.resolution,d=t.pixelRatio,f=e.getRevision(),_=e.getRenderBuffer();let m=e.getRenderOrder();void 0===m&&(m=zh);const p=h.center.slice(),x=(0,T.f3)(l,_*u),E=x.slice(),C=[x.slice()],v=c.getExtent();if(i.getWrapX()&&c.canWrapX()&&!(0,T.r4)(v,t.extent)){const b=(0,T.dz)(v),O=Math.max((0,T.dz)(x)/2,b);x[0]=v[0]-O,x[2]=v[2]+O,(0,jt.Cf)(p,c);const N=(0,T.Cf)(C[0],c);N[0]<v[0]&&N[2]<v[2]?C.push([N[0]+b,N[1],N[2]+b,N[3]]):N[0]>v[0]&&N[2]>v[2]&&C.push([N[0]-b,N[1],N[2]-b,N[3]])}if(this.ready&&this.renderedResolution_==u&&this.renderedRevision_==f&&this.renderedRenderOrder_==m&&(0,T.r4)(this.wrappedRenderedExtent_,x))return ot(this.renderedExtent_,E)||(this.hitDetectionImageData_=null,this.renderedExtent_=E),this.renderedCenter_=p,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const I=new kr(Qn(u,d),x,u,d);let A;this.getLayer().getDeclutter()&&(A=new kr(Qn(u,d),x,u,d));const M=(0,z.Cs)();let F;if(M){for(let b=0,O=C.length;b<O;++b){const ct=(0,z.Fj)(C[b],c);i.loadFeatures(ct,(0,z.on)(u,c),M)}F=(0,z.WO)(M,c)}else for(let b=0,O=C.length;b<O;++b)i.loadFeatures(C[b],u,c);const X=function Wh(s,t){const e=Qn(s,t);return e*e}(u,d);let Z=!0;const nt=function(b){let O;const N=b.getStyleFunction()||e.getStyleFunction();if(N&&(O=N(b,u)),O){const ct=this.renderFeature(b,X,O,I,F,A);Z=Z&&!ct}}.bind(this),et=(0,z.Fj)(x,c),B=i.getFeaturesInExtent(et);m&&B.sort(m);for(let b=0,O=B.length;b<O;++b)nt(B[b]);this.renderedFeatures_=B,this.ready=Z;const mt=I.finish(),U=new zr(x,u,d,i.getOverlaps(),mt,e.getRenderBuffer());return A&&(this.declutterExecutorGroup=new zr(x,u,d,i.getOverlaps(),A.finish(),e.getRenderBuffer())),this.renderedResolution_=u,this.renderedRevision_=f,this.renderedRenderOrder_=m,this.renderedExtent_=E,this.wrappedRenderedExtent_=x,this.renderedCenter_=p,this.renderedProjection_=c,this.replayGroup_=U,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(t,e,i,n,r,o){if(!i)return!1;let a=!1;if(Array.isArray(i))for(let l=0,h=i.length;l<h;++l)a=Xr(n,t,i[l],e,this.boundHandleStyleImageChange_,r,o)||a;else a=Xr(n,t,i,e,this.boundHandleStyleImageChange_,r,o);return a}},tc=class $h extends _h{constructor(t){super(t)}createRenderer(){return new Qh(this)}},Kr=class ec{constructor(t){this.rbush_=new Ir(t),this.items_={}}insert(t,e){const i={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:e};this.rbush_.insert(i),this.items_[st(e)]=i}load(t,e){const i=new Array(e.length);for(let n=0,r=e.length;n<r;n++){const o=t[n],a=e[n],l={minX:o[0],minY:o[1],maxX:o[2],maxY:o[3],value:a};i[n]=l,this.items_[st(a)]=l}this.rbush_.load(i)}remove(t){const e=st(t),i=this.items_[e];return delete this.items_[e],null!==this.rbush_.remove(i)}update(t,e){const i=this.items_[st(e)];(0,T.fS)([i.minX,i.minY,i.maxX,i.maxY],t)||(this.remove(e),this.insert(t,e))}getAll(){return this.rbush_.all().map(function(e){return e.value})}getInExtent(t){return this.rbush_.search({minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]}).map(function(n){return n.value})}forEach(t){return this.forEach_(this.getAll(),t)}forEachInExtent(t,e){return this.forEach_(this.getInExtent(t),e)}forEach_(t,e){let i;for(let n=0,r=t.length;n<r;n++)if(i=e(t[n]),i)return i;return i}isEmpty(){return Gt(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(t){const e=this.rbush_.toJSON();return(0,T.T9)(e.minX,e.minY,e.maxX,e.maxY,t)}concat(t){this.rbush_.load(t.rbush_.all());for(const e in t.items_)this.items_[e]=t.items_[e]}};function ic(s,t){return[[-1/0,-1/0,1/0,1/0]]}function Ur(s,t){return function(e,i,n,r,o){const a=this;!function nc(s,t,e,i,n,r,o){const a=new XMLHttpRequest;a.open("GET","function"==typeof s?s(e,i,n):s,!0),"arraybuffer"==t.getType()&&(a.responseType="arraybuffer"),a.withCredentials=false,a.onload=function(l){if(!a.status||a.status>=200&&a.status<300){const h=t.getType();let c;"json"==h||"text"==h?c=a.responseText:"xml"==h?(c=a.responseXML,c||(c=(new DOMParser).parseFromString(a.responseText,"application/xml"))):"arraybuffer"==h&&(c=a.response),c?r(t.readFeatures(c,{extent:e,featureProjection:n}),t.readProjection(c)):o()}else o()},a.onerror=o,a.send()}(s,t,e,i,n,function(l,h){a.addFeatures(l),void 0!==r&&r(l)},o||Rt)}}class Te extends y{constructor(t,e,i){super(t),this.feature=e,this.features=i}}const rc=class sc extends pr{constructor(t){super({attributions:(t=t||{}).attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:void 0===t.wrapX||t.wrapX}),this.loader_=Rt,this.format_=t.format,this.overlaps_=void 0===t.overlaps||t.overlaps,this.url_=t.url,void 0!==t.loader?this.loader_=t.loader:void 0!==this.url_&&((0,H.h)(this.format_,7),this.loader_=Ur(this.url_,this.format_)),this.strategy_=void 0!==t.strategy?t.strategy:ic;const e=void 0===t.useSpatialIndex||t.useSpatialIndex;let i,n;this.featuresRtree_=e?new Kr:null,this.loadedExtentsRtree_=new Kr,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null,Array.isArray(t.features)?n=t.features:t.features&&(i=t.features,n=i.getArray()),!e&&void 0===i&&(i=new Ut(n)),void 0!==n&&this.addFeaturesInternal(n),void 0!==i&&this.bindFeaturesCollection_(i)}addFeature(t){this.addFeatureInternal(t),this.changed()}addFeatureInternal(t){const e=st(t);if(!this.addToIndex_(e,t))return void(this.featuresCollection_&&this.featuresCollection_.remove(t));this.setupChangeEvents_(e,t);const i=t.getGeometry();if(i){const n=i.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(n,t)}else this.nullGeometryFeatures_[e]=t;this.dispatchEvent(new Te("addfeature",t))}setupChangeEvents_(t,e){this.featureChangeKeys_[t]=[$(e,"change",this.handleFeatureChange_,this),$(e,"propertychange",this.handleFeatureChange_,this)]}addToIndex_(t,e){let i=!0;const n=e.getId();return void 0!==n&&(n.toString()in this.idIndex_?i=!1:this.idIndex_[n.toString()]=e),i&&((0,H.h)(!(t in this.uidIndex_),30),this.uidIndex_[t]=e),i}addFeatures(t){this.addFeaturesInternal(t),this.changed()}addFeaturesInternal(t){const e=[],i=[],n=[];for(let r=0,o=t.length;r<o;r++){const a=t[r],l=st(a);this.addToIndex_(l,a)&&i.push(a)}for(let r=0,o=i.length;r<o;r++){const a=i[r],l=st(a);this.setupChangeEvents_(l,a);const h=a.getGeometry();if(h){const c=h.getExtent();e.push(c),n.push(a)}else this.nullGeometryFeatures_[l]=a}if(this.featuresRtree_&&this.featuresRtree_.load(e,n),this.hasListener("addfeature"))for(let r=0,o=i.length;r<o;r++)this.dispatchEvent(new Te("addfeature",i[r]))}bindFeaturesCollection_(t){let e=!1;this.addEventListener("addfeature",function(i){e||(e=!0,t.push(i.feature),e=!1)}),this.addEventListener("removefeature",function(i){e||(e=!0,t.remove(i.feature),e=!1)}),t.addEventListener("add",function(i){e||(e=!0,this.addFeature(i.element),e=!1)}.bind(this)),t.addEventListener("remove",function(i){e||(e=!0,this.removeFeature(i.element),e=!1)}.bind(this)),this.featuresCollection_=t}clear(t){if(t){for(const i in this.featureChangeKeys_)this.featureChangeKeys_[i].forEach(dt);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){const i=function(n){this.removeFeatureInternal(n)}.bind(this);this.featuresRtree_.forEach(i);for(const n in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[n])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const e=new Te("clear");this.dispatchEvent(e),this.changed()}forEachFeature(t){if(this.featuresRtree_)return this.featuresRtree_.forEach(t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureAtCoordinateDirect(t,e){return this.forEachFeatureInExtent([t[0],t[1],t[0],t[1]],function(n){if(n.getGeometry().intersectsCoordinate(t))return e(n)})}forEachFeatureInExtent(t,e){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(t,e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureIntersectingExtent(t,e){return this.forEachFeatureInExtent(t,function(i){if(i.getGeometry().intersectsExtent(t)){const r=e(i);if(r)return r}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let t;return this.featuresCollection_?t=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(t=this.featuresRtree_.getAll(),Gt(this.nullGeometryFeatures_)||J(t,Object.values(this.nullGeometryFeatures_))),t}getFeaturesAtCoordinate(t){const e=[];return this.forEachFeatureAtCoordinateDirect(t,function(i){e.push(i)}),e}getFeaturesInExtent(t,e){if(this.featuresRtree_){if(!(e&&e.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(t);const n=(0,T.MV)(t,e);return[].concat(...n.map(r=>this.featuresRtree_.getInExtent(r)))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(t,e){const i=t[0],n=t[1];let r=null;const o=[NaN,NaN];let a=1/0;const l=[-1/0,-1/0,1/0,1/0];return e=e||Nt,this.featuresRtree_.forEachInExtent(l,function(h){if(e(h)){const c=h.getGeometry(),u=a;if(a=c.closestPointXY(i,n,o,a),a<u){r=h;const d=Math.sqrt(a);l[0]=i-d,l[1]=n-d,l[2]=i+d,l[3]=n+d}}}),r}getExtent(t){return this.featuresRtree_.getExtent(t)}getFeatureById(t){const e=this.idIndex_[t.toString()];return void 0!==e?e:null}getFeatureByUid(t){const e=this.uidIndex_[t];return void 0!==e?e:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(t){const e=t.target,i=st(e),n=e.getGeometry();if(n){const o=n.getExtent();i in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[i],this.featuresRtree_&&this.featuresRtree_.insert(o,e)):this.featuresRtree_&&this.featuresRtree_.update(o,e)}else i in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(e),this.nullGeometryFeatures_[i]=e);const r=e.getId();if(void 0!==r){const o=r.toString();this.idIndex_[o]!==e&&(this.removeFromIdIndex_(e),this.idIndex_[o]=e)}else this.removeFromIdIndex_(e),this.uidIndex_[i]=e;this.changed(),this.dispatchEvent(new Te("changefeature",e))}hasFeature(t){const e=t.getId();return void 0!==e?e in this.idIndex_:st(t)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&Gt(this.nullGeometryFeatures_):!this.featuresCollection_||0===this.featuresCollection_.getLength()}loadFeatures(t,e,i){const n=this.loadedExtentsRtree_,r=this.strategy_(t,e,i);for(let o=0,a=r.length;o<a;++o){const l=r[o];n.forEachInExtent(l,function(c){return(0,T.r4)(c.extent,l)})||(++this.loadingExtentsCount_,this.dispatchEvent(new Te("featuresloadstart")),this.loader_.call(this,l,e,i,function(c){--this.loadingExtentsCount_,this.dispatchEvent(new Te("featuresloadend",void 0,c))}.bind(this),function(){--this.loadingExtentsCount_,this.dispatchEvent(new Te("featuresloaderror"))}.bind(this)),n.insert(l,{extent:l.slice()}))}this.loading=!(this.loader_.length<4)&&this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(t){const e=this.loadedExtentsRtree_;let i;e.forEachInExtent(t,function(n){if((0,T.fS)(n.extent,t))return i=n,!0}),i&&e.remove(i)}removeFeature(t){if(!t)return;const e=st(t);e in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[e]:this.featuresRtree_&&this.featuresRtree_.remove(t),this.removeFeatureInternal(t)&&this.changed()}removeFeatureInternal(t){const e=st(t),i=this.featureChangeKeys_[e];if(!i)return;i.forEach(dt),delete this.featureChangeKeys_[e];const n=t.getId();return void 0!==n&&delete this.idIndex_[n.toString()],delete this.uidIndex_[e],this.dispatchEvent(new Te("removefeature",t)),t}removeFromIdIndex_(t){let e=!1;for(const i in this.idIndex_)if(this.idIndex_[i]===t){delete this.idIndex_[i],e=!0;break}return e}setLoader(t){this.loader_=t}setUrl(t){(0,H.h)(this.format_,7),this.url_=t,this.setLoader(Ur(t,this.format_))}};var pi=Q(4974),oc=Q(7224),ac=Q(2780);const lc=["mapElementRef"];let hc=(()=>{class s{constructor(e,i,n){this.locationService=e,this.gameService=i,this.info=n,this.destroy$=new Jt.xQ,this.features={}}ngOnInit(){return(0,Ge.mG)(this,void 0,void 0,function*(){!this.game||(this.setUpMap(),this.setupSubscriptions())})}setupSubscriptions(){const e=this.locationService.watchLocation();e.pipe((0,oc.P)()).subscribe(()=>{this.setUpMarkers(),this.playerFeature=this.setUpUser()}),e.pipe((0,le.R)(this.destroy$)).subscribe(i=>{this.updateUserLocation(i)}),this.gameService.enablePoints$.pipe((0,le.R)(this.destroy$)).subscribe(i=>{this.enableMarkers(i)}),this.gameService.disablePoints$.pipe((0,le.R)(this.destroy$)).subscribe(i=>{this.disableMarkers(i)})}setUpMap(){const[e,i]=this.game.location,n=this.game.zoom,r=(0,pi.xA)([i,e]);this.map=new al({view:new me({center:r,zoom:n}),layers:[new rh({source:new Hl})],target:"ol-map"});const o=new rc({features:[]});this.markerSource=o;const a=new tc({source:o});this.map.addLayer(a),this.map.on("moveend",l=>{const h=this.map.getView().getZoom();console.log(h)}),this.map.on("click",l=>{const h=this.map.forEachFeatureAtPixel(l.pixel,c=>c);!h||this.onFeatureClicked(l,h)}),setTimeout(()=>{this.map.setTarget(this.mapElementRef.nativeElement)})}onFeatureClicked(e,i){console.log(i);const n=i.get("data");if(!n.clickable)return;const r=(0,pi.FY)(i.getGeometry().getCoordinates()),o=(0,pi.FY)(this.playerFeature.getGeometry().getCoordinates()),a=this.locationService.distance(r[1],o[1],r[0],o[0]),l=this.gameService.isCloseEnough(a);console.log(a),this.gameService.pointSelected({point:n,distance:a,isClose:l})}setUpMarkers(){const e=this.gameService.getPoints();this.game.points.forEach(i=>{var n,r;null===(n=e[i.name])||void 0===n||!n.visible||(console.log(i.name,null===(r=e[i.name])||void 0===r?void 0:r.visible),this.showMarker(i))})}showMarker(e){const[i,n]=e.location,r=(0,pi.xA)([n,i]);this.addMarker(r,Object.assign({clickable:!0,img:e.img||"assets/x_marker.png"},e))}getRegexExpr(e){return e.map(i=>{const n=i.replace(/\*/g,".*");return new RegExp(n,"g")})}enableMarkers(e){const i=this.getRegexExpr(e);this.game.points.filter(n=>i.some(r=>n.name.match(r))).forEach(n=>{n.visible=!0,this.showMarker(n)})}disableMarkers(e){const i=this.getRegexExpr(e),n=this.game.points.filter(r=>i.some(o=>r.name.match(o))).map(r=>r.name);for(const r of n){const o=this.features[r];!o||(o.forEach(a=>this.markerSource.removeFeature(a)),delete this.features[r])}}setUpUser(){return this.addMarker([0,0],{clickable:!1,img:"assets/current_location.png"})}ngOnDestroy(){console.log("destroying"),this.destroy$.next(),this.destroy$.unsubscribe()}addMarker(e,i){const n=new hl({geometry:new js(e),data:i}),r=new Xi({image:new Vn({anchor:[.5,46],anchorXUnits:"fraction",anchorYUnits:"pixels",src:i.img})});return n.setStyle(r),this.markerSource.addFeature(n),this.features[i.name]=[...this.features[i.name]||[],n],n}updateUserLocation(e){!this.playerFeature||this.playerFeature.getGeometry().setCoordinates((0,pi.Z_)(e))}ngAfterContentInit(){}}return s.\u0275fac=function(e){return new(e||s)(g.Y36(ac.a),g.Y36(Le.h),g.Y36(he.C))},s.\u0275cmp=g.Xpm({type:s,selectors:[["app-map"]],viewQuery:function(e,i){if(1&e&&g.Gf(lc,7),2&e){let n;g.iGM(n=g.CRH())&&(i.mapElementRef=n.first)}},inputs:{game:"game"},decls:3,vars:0,consts:[["id","ol-map",1,"map-container"],["mapElementRef",""]],template:function(e,i){1&e&&(g.ynx(0),g._UZ(1,"div",0,1),g.BQk())},styles:["[_nghost-%COMP%]{display:flex;flex-grow:1;flex-direction:column;height:100vh}.map-container[_ngcontent-%COMP%]{flex-grow:1}"],changeDetection:0}),s})();var jr=Q(2198);class Vr{constructor(t){this.gameService=t}onSubmit(t){const e=this.isCorrect(t),i=Array.isArray(t)?t:[t];this.gameService.answerSelected(this.point,e?"correct":"incorrect",i)}}function cc(s,t){if(1&s&&(g.TgZ(0,"ion-item")(1,"ion-label"),g._uU(2),g.qZA(),g._UZ(3,"ion-radio",4),g.qZA()),2&s){const e=t.$implicit;g.xp6(2),g.Oqu(e),g.xp6(1),g.Q6J("value",e)}}function uc(s,t){if(1&s){const e=g.EpF();g.TgZ(0,"ion-list")(1,"ion-item-group")(2,"ion-item-divider")(3,"ion-label"),g._uU(4," Options "),g.qZA()(),g.TgZ(5,"ion-radio-group",1),g.NdJ("ngModelChange",function(n){g.CHM(e);const r=g.oxw();return g.KtG(r.selected=n)}),g.YNc(6,cc,4,2,"ion-item",2),g.qZA()(),g.TgZ(7,"ion-button",3),g.NdJ("click",function(){g.CHM(e);const n=g.oxw();return g.KtG(n.select())}),g._uU(8," Submit "),g.qZA()()}if(2&s){const e=g.oxw();g.xp6(5),g.Q6J("ngModel",e.selected),g.xp6(1),g.Q6J("ngForOf",e.point.body.choices),g.xp6(1),g.Q6J("disabled",!e.selected)}}let Hr=(()=>{class s extends Vr{constructor(e){super(e),this.answered=!1}set point(e){this._point=e,this.answered=!1}get point(){return this._point}ngOnInit(){}select(){this.onSubmit(this.selected)}isCorrect(e){const i=this.point.body.possibleAnswers.includes(e);return i&&(this.answered=!0),i}}return s.\u0275fac=function(e){return new(e||s)(g.Y36(Le.h))},s.\u0275cmp=g.Xpm({type:s,selectors:[["app-multiple-choice"]],inputs:{point:"point"},features:[g.qOj],decls:1,vars:1,consts:[[4,"ngIf"],[3,"ngModel","ngModelChange"],[4,"ngFor","ngForOf"],["expand","block",3,"disabled","click"],["slot","end",3,"value"]],template:function(e,i){1&e&&g.YNc(0,uc,9,3,"ion-list",0),2&e&&g.Q6J("ngIf",!i.answered)},dependencies:[q.YG,q.Ie,q.rH,q.Ub,q.Q$,q.q_,q.B7,q.se,q.U5,q.QI,V.sg,V.O5,ae.JJ,ae.On],encapsulation:2}),s})();function dc(s,t){if(1&s){const e=g.EpF();g.ynx(0),g.TgZ(1,"ion-item")(2,"ion-input",1),g.NdJ("ngModelChange",function(n){g.CHM(e);const r=g.oxw();return g.KtG(r.input=n)})("keyup.enter",function(){g.CHM(e);const n=g.oxw();return g.KtG(n.submit())}),g.qZA()(),g.TgZ(3,"ion-button",2),g.NdJ("click",function(){g.CHM(e);const n=g.oxw();return g.KtG(n.submit())}),g._uU(4," Submit "),g.qZA(),g.BQk()}if(2&s){const e=g.oxw();g.xp6(2),g.Q6J("ngModel",e.input),g.xp6(1),g.Q6J("disabled",!(null!=e.input&&e.input.length))}}let qr=(()=>{class s extends Vr{constructor(e){super(e),this.input="",this.found=!1}set point(e){this._point=e,this.found=!1,this.input=""}get point(){return this._point}ngOnInit(){}submit(){var e;null!==(e=this.input)&&void 0!==e&&e.length&&this.onSubmit(this.input)}isCorrect(e){if(!e.length)return;e=e.trim().toLowerCase();const i=this.point.body.possibleAnswers.some(n=>n.trim().toLowerCase()===e);return this.found=i,i}}return s.\u0275fac=function(e){return new(e||s)(g.Y36(Le.h))},s.\u0275cmp=g.Xpm({type:s,selectors:[["app-short-answer"]],inputs:{point:"point"},features:[g.qOj],decls:1,vars:1,consts:[[4,"ngIf"],["placeholder","Enter your answer",3,"ngModel","ngModelChange","keyup.enter"],["expand","block",3,"disabled","click"]],template:function(e,i){1&e&&g.YNc(0,dc,5,2,"ng-container",0),2&e&&g.Q6J("ngIf",!i.found)},dependencies:[q.YG,q.pK,q.Ie,q.j9,V.O5,ae.JJ,ae.On],encapsulation:2}),s})();function gc(s,t){1&s&&(g.ynx(0),g.TgZ(1,"ion-item"),g._uU(2," You are not close to this location! "),g.qZA(),g.BQk())}function fc(s,t){if(1&s&&(g.ynx(0),g._UZ(1,"app-short-answer",4),g.BQk()),2&s){const e=g.oxw(3);g.xp6(1),g.Q6J("point",e.pointAny)}}function _c(s,t){if(1&s&&(g.ynx(0),g._UZ(1,"app-multiple-choice",4),g.BQk()),2&s){const e=g.oxw(3);g.xp6(1),g.Q6J("point",e.pointAny)}}function mc(s,t){if(1&s){const e=g.EpF();g.ynx(0),g.TgZ(1,"ion-item",5),g.NdJ("click",function(){g.CHM(e);const n=g.oxw(3);return g.KtG(n.ok())}),g._uU(2," OK "),g.qZA(),g.BQk()}}function pc(s,t){if(1&s&&(g.TgZ(0,"p"),g._uU(1),g.qZA()),2&s){const e=g.oxw(5);g.xp6(1),g.hij(" ",e.point.body.messageIfCorrect," ")}}function xc(s,t){if(1&s){const e=g.EpF();g.TgZ(0,"div"),g._uU(1," correct "),g.YNc(2,pc,2,1,"p",0),g.TgZ(3,"ion-button",6),g.NdJ("click",function(){g.CHM(e);const n=g.oxw(4);return g.KtG(n.ok())}),g._uU(4," Next "),g.qZA()()}if(2&s){const e=g.oxw(4);g.xp6(2),g.Q6J("ngIf",e.point.body.messageIfCorrect)}}function yc(s,t){if(1&s&&(g.TgZ(0,"p"),g._uU(1),g.qZA()),2&s){const e=g.oxw(5);g.xp6(1),g.hij(" ",e.point.body.messageIfIncorrect," ")}}function Ec(s,t){if(1&s){const e=g.EpF();g.ynx(0),g._uU(1," incorrect "),g.YNc(2,yc,2,1,"p",0),g.TgZ(3,"ion-footer")(4,"ion-button",6),g.NdJ("click",function(){g.CHM(e);const n=g.oxw(4);return g.KtG(n.giveUp())}),g._uU(5," Give Up "),g.qZA()(),g.BQk()}if(2&s){const e=g.oxw(4);g.xp6(2),g.Q6J("ngIf",e.point.body.messageIfIncorrect)}}function Cc(s,t){if(1&s&&(g.ynx(0),g.YNc(1,xc,5,1,"div",0),g.YNc(2,Ec,6,1,"ng-container",0),g.BQk()),2&s){const e=g.oxw(3);g.xp6(1),g.Q6J("ngIf",e.isCorrect),g.xp6(1),g.Q6J("ngIf",!e.isCorrect)}}function Tc(s,t){if(1&s&&(g.ynx(0),g.TgZ(1,"ion-item-group")(2,"ion-item-divider")(3,"ion-label"),g._uU(4),g.qZA()(),g.TgZ(5,"div"),g._uU(6),g.qZA()(),g.ynx(7,1),g.YNc(8,fc,2,1,"ng-container",2),g.YNc(9,_c,2,1,"ng-container",2),g.YNc(10,mc,3,0,"ng-container",3),g.BQk(),g.YNc(11,Cc,3,2,"ng-container",0),g.BQk()),2&s){const e=g.oxw(2);g.xp6(4),g.hij(" ",e.point.body.title," "),g.xp6(2),g.hij(" ",e.point.body.text," "),g.xp6(1),g.Q6J("ngSwitch",e.point.body.type),g.xp6(1),g.Q6J("ngSwitchCase","shortanswer"),g.xp6(1),g.Q6J("ngSwitchCase","multiplechoice"),g.xp6(2),g.Q6J("ngIf",e.showFeedback)}}function Rc(s,t){if(1&s&&(g.ynx(0),g.TgZ(1,"ion-item")(2,"ion-label"),g._uU(3),g.qZA()(),g.BQk()),2&s){const e=g.oxw(2);g.xp6(3),g.hij(" ",e.point.body.afterExplored," ")}}function vc(s,t){if(1&s&&(g.ynx(0)(1,1),g.YNc(2,gc,3,0,"ng-container",2),g.YNc(3,Tc,12,6,"ng-container",2),g.YNc(4,Rc,4,1,"ng-container",2),g.BQk()()),2&s){const e=g.oxw();g.xp6(1),g.Q6J("ngSwitch",e.status),g.xp6(1),g.Q6J("ngSwitchCase","not_close"),g.xp6(1),g.Q6J("ngSwitchCase","close"),g.xp6(1),g.Q6J("ngSwitchCase","explored")}}let Ic=(()=>{class s{constructor(e,i,n){this.gameService=e,this.menuController=i,this.info=n,this.destroy$=new Jt.xQ,this.showFeedback=!1,this.isCorrect=!1,this.status="not_close"}set selectedPoint(e){this._selectedPoint=e,this.showFeedback=!1,e&&(this.status=e.explored?"explored":e.isClose?"close":"not_close")}get selectedPoint(){return this._selectedPoint}get pointAny(){return this.point}get point(){return this._selectedPoint.point}ngOnInit(){const e=this.gameService.answerSelected$.pipe((0,le.R)(this.destroy$));e.pipe((0,jr.h)(i=>["correct","incorrect"].includes(i.result))).subscribe(i=>{this.showFeedback=!0,this.isCorrect="correct"===i.result}),e.pipe((0,jr.h)(i=>"ok"===i.result)).subscribe(i=>{this.gameService.moveNext(this.point),this.menuController.close()})}ok(){this.gameService.answerSelected(this.point,"ok")}giveUp(){return(0,Ge.mG)(this,void 0,void 0,function*(){!(yield this.info.confirm("Give up","Are you sure to give up?"))||this.ok()})}ngOnDestroy(){console.log("destro"),this.destroy$.next(),this.destroy$.unsubscribe()}}return s.\u0275fac=function(e){return new(e||s)(g.Y36(Le.h),g.Y36(q._q),g.Y36(he.C))},s.\u0275cmp=g.Xpm({type:s,selectors:[["app-game-point"]],inputs:{selectedPoint:"selectedPoint"},decls:1,vars:1,consts:[[4,"ngIf"],[3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],[3,"point"],["button","",3,"click"],["expand","block",3,"click"]],template:function(e,i){1&e&&g.YNc(0,vc,5,4,"ng-container",0),2&e&&g.Q6J("ngIf",i.selectedPoint)},dependencies:[q.YG,q.fr,q.Ie,q.rH,q.Ub,q.Q$,V.O5,V.RF,V.n9,V.ED,Hr,qr]}),s})();function Sc(s,t){if(1&s&&(g.ynx(0),g._UZ(1,"app-map",10),g.BQk()),2&s){const e=g.oxw();g.xp6(1),g.Q6J("game",e.game)}}function wc(s,t){1&s&&(g.TgZ(0,"div"),g._uU(1," GAME NOT LOADED "),g.qZA())}const Lc=[{path:"",component:(()=>{class s{constructor(e,i,n,r){this.menuController=e,this.gameService=i,this.router=n,this.info=r,this.title$=new we.X("Menu"),this.destroy$=new Jt.xQ}ngOnInit(){this.menuController.swipeGesture(!1),this.gameService.pointSelected$.pipe((0,le.R)(this.destroy$)).subscribe(e=>{!e||(console.log(e),this.selectedPoint=e,this.title$.next(e.point.title),this.menuController.open())}),this.gameService.gameSelected$.pipe((0,le.R)(this.destroy$)).subscribe(e=>{!e||(this.game=e)})}ngOnDestroy(){this.destroy$.next(),this.destroy$.unsubscribe()}}return s.\u0275fac=function(e){return new(e||s)(g.Y36(q._q),g.Y36(Le.h),g.Y36(Zt.F0),g.Y36(he.C))},s.\u0275cmp=g.Xpm({type:s,selectors:[["app-game-map"]],features:[g._Bn([q._q])],decls:23,vars:8,consts:[["contentId","main-content"],[1,"ion-text-center"],[1,"ion-padding"],[3,"selectedPoint"],["id","main-content",1,"ion-page"],[3,"translucent"],[3,"fullscreen"],["collapse","condense"],["size","large"],[4,"ngIf"],[3,"game"]],template:function(e,i){1&e&&(g.TgZ(0,"ion-menu",0)(1,"ion-header",1)(2,"ion-toolbar")(3,"ion-title"),g._uU(4),g.ALo(5,"async"),g.qZA()()(),g.TgZ(6,"ion-content",2)(7,"ion-menu-toggle")(8,"ion-button"),g._uU(9,"Close"),g.qZA()(),g._UZ(10,"app-game-point",3),g.qZA()(),g.TgZ(11,"div",4)(12,"ion-header",5)(13,"ion-toolbar")(14,"ion-title"),g._uU(15," Map "),g.qZA()()(),g.TgZ(16,"ion-content",6)(17,"ion-header",7)(18,"ion-toolbar")(19,"ion-title",8),g._uU(20,"Game"),g.qZA()()(),g.YNc(21,Sc,2,1,"ng-container",9),g.YNc(22,wc,2,0,"div",9),g.qZA()()),2&e&&(g.xp6(4),g.Oqu(g.lcZ(5,6,i.title$)),g.xp6(6),g.Q6J("selectedPoint",i.selectedPoint),g.xp6(2),g.Q6J("translucent",!0),g.xp6(4),g.Q6J("fullscreen",!0),g.xp6(5),g.Q6J("ngIf",i.game),g.xp6(1),g.Q6J("ngIf",!i.game))},dependencies:[q.YG,q.W2,q.Gu,q.z0,q.zc,q.wd,q.sr,V.O5,hc,Ic,V.Ov]}),s})()}];let Ac=(()=>{class s{}return s.\u0275fac=function(e){return new(e||s)},s.\u0275mod=g.oAB({type:s}),s.\u0275inj=g.cJS({imports:[Zt.Bz.forChild(Lc),Zt.Bz]}),s})(),Mc=(()=>{class s{}return s.\u0275fac=function(e){return new(e||s)},s.\u0275mod=g.oAB({type:s}),s.\u0275inj=g.cJS({imports:[q.Pc,V.ez,ae.u5]}),s})(),bc=(()=>{class s{}return s.\u0275fac=function(e){return new(e||s)},s.\u0275mod=g.oAB({type:s}),s.\u0275inj=g.cJS({imports:[q.Pc,V.ez,ae.u5,Ac,Mc]}),s})()},2402:function(ns){ns.exports=function(){"use strict";function ti(y,R,w,P,D){!function L(k,j,J,it,ot){for(;it>J;){if(it-J>600){var lt=it-J+1,ft=j-J+1,Nt=Math.log(lt),Pt=.5*Math.exp(2*Nt/3),Rt=.5*Math.sqrt(Nt*Pt*(lt-Pt)/lt)*(ft-lt/2<0?-1:1);L(k,j,Math.max(J,Math.floor(j-ft*Pt/lt+Rt)),Math.min(it,Math.floor(j+(lt-ft)*Pt/lt+Rt)),ot)}var Kt=k[j],Gt=J,wt=it;for(Q(k,J,j),ot(k[it],Kt)>0&&Q(k,J,it);Gt<wt;){for(Q(k,Gt,wt),Gt++,wt--;ot(k[Gt],Kt)<0;)Gt++;for(;ot(k[wt],Kt)>0;)wt--}0===ot(k[J],Kt)?Q(k,J,wt):Q(k,++wt,it),wt<=j&&(J=wt+1),j<=wt&&(it=wt-1)}}(y,R,w||0,P||y.length-1,D||q)}function Q(y,R,w){var P=y[R];y[R]=y[w],y[w]=P}function q(y,R){return y<R?-1:y>R?1:0}var V=function(y){void 0===y&&(y=9),this._maxEntries=Math.max(4,y),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function ae(y,R,w){if(!w)return R.indexOf(y);for(var P=0;P<R.length;P++)if(w(y,R[P]))return P;return-1}function Zt(y,R){we(y,0,y.children.length,R,y)}function we(y,R,w,P,D){D||(D=Ae(null)),D.minX=1/0,D.minY=1/0,D.maxX=-1/0,D.maxY=-1/0;for(var L=R;L<w;L++){var k=y.children[L];Jt(D,y.leaf?P(k):k)}return D}function Jt(y,R){return y.minX=Math.min(y.minX,R.minX),y.minY=Math.min(y.minY,R.minY),y.maxX=Math.max(y.maxX,R.maxX),y.maxY=Math.max(y.maxY,R.maxY),y}function le(y,R){return y.minX-R.minX}function Le(y,R){return y.minY-R.minY}function g(y){return(y.maxX-y.minX)*(y.maxY-y.minY)}function he(y){return y.maxX-y.minX+(y.maxY-y.minY)}function Ge(y,R){return y.minX<=R.minX&&y.minY<=R.minY&&R.maxX<=y.maxX&&R.maxY<=y.maxY}function Ye(y,R){return R.minX<=y.maxX&&R.minY<=y.maxY&&R.maxX>=y.minX&&R.maxY>=y.minY}function Ae(y){return{children:y,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Qi(y,R,w,P,D){for(var L=[R,w];L.length;)if(!((w=L.pop())-(R=L.pop())<=P)){var k=R+Math.ceil((w-R)/P/2)*P;ti(y,k,R,w,D),L.push(R,k,k,w)}}return V.prototype.all=function(){return this._all(this.data,[])},V.prototype.search=function(y){var R=this.data,w=[];if(!Ye(y,R))return w;for(var P=this.toBBox,D=[];R;){for(var L=0;L<R.children.length;L++){var k=R.children[L],j=R.leaf?P(k):k;Ye(y,j)&&(R.leaf?w.push(k):Ge(y,j)?this._all(k,w):D.push(k))}R=D.pop()}return w},V.prototype.collides=function(y){var R=this.data;if(!Ye(y,R))return!1;for(var w=[];R;){for(var P=0;P<R.children.length;P++){var D=R.children[P],L=R.leaf?this.toBBox(D):D;if(Ye(y,L)){if(R.leaf||Ge(y,L))return!0;w.push(D)}}R=w.pop()}return!1},V.prototype.load=function(y){if(!y||!y.length)return this;if(y.length<this._minEntries){for(var R=0;R<y.length;R++)this.insert(y[R]);return this}var w=this._build(y.slice(),0,y.length-1,0);if(this.data.children.length)if(this.data.height===w.height)this._splitRoot(this.data,w);else{if(this.data.height<w.height){var P=this.data;this.data=w,w=P}this._insert(w,this.data.height-w.height-1,!0)}else this.data=w;return this},V.prototype.insert=function(y){return y&&this._insert(y,this.data.height-1),this},V.prototype.clear=function(){return this.data=Ae([]),this},V.prototype.remove=function(y,R){if(!y)return this;for(var w,P,D,L=this.data,k=this.toBBox(y),j=[],J=[];L||j.length;){if(L||(L=j.pop(),P=j[j.length-1],w=J.pop(),D=!0),L.leaf){var it=ae(y,L.children,R);if(-1!==it)return L.children.splice(it,1),j.push(L),this._condense(j),this}D||L.leaf||!Ge(L,k)?P?(w++,L=P.children[w],D=!1):L=null:(j.push(L),J.push(w),w=0,P=L,L=L.children[0])}return this},V.prototype.toBBox=function(y){return y},V.prototype.compareMinX=function(y,R){return y.minX-R.minX},V.prototype.compareMinY=function(y,R){return y.minY-R.minY},V.prototype.toJSON=function(){return this.data},V.prototype.fromJSON=function(y){return this.data=y,this},V.prototype._all=function(y,R){for(var w=[];y;)y.leaf?R.push.apply(R,y.children):w.push.apply(w,y.children),y=w.pop();return R},V.prototype._build=function(y,R,w,P){var D,L=w-R+1,k=this._maxEntries;if(L<=k)return Zt(D=Ae(y.slice(R,w+1)),this.toBBox),D;P||(P=Math.ceil(Math.log(L)/Math.log(k)),k=Math.ceil(L/Math.pow(k,P-1))),(D=Ae([])).leaf=!1,D.height=P;var j=Math.ceil(L/k),J=j*Math.ceil(Math.sqrt(k));Qi(y,R,w,J,this.compareMinX);for(var it=R;it<=w;it+=J){var ot=Math.min(it+J-1,w);Qi(y,it,ot,j,this.compareMinY);for(var lt=it;lt<=ot;lt+=j){var ft=Math.min(lt+j-1,ot);D.children.push(this._build(y,lt,ft,P-1))}}return Zt(D,this.toBBox),D},V.prototype._chooseSubtree=function(y,R,w,P){for(;P.push(R),!R.leaf&&P.length-1!==w;){for(var D=1/0,L=1/0,k=void 0,j=0;j<R.children.length;j++){var J=R.children[j],it=g(J),ot=(lt=y,ft=J,(Math.max(ft.maxX,lt.maxX)-Math.min(ft.minX,lt.minX))*(Math.max(ft.maxY,lt.maxY)-Math.min(ft.minY,lt.minY))-it);ot<L?(L=ot,D=it<D?it:D,k=J):ot===L&&it<D&&(D=it,k=J)}R=k||R.children[0]}var lt,ft;return R},V.prototype._insert=function(y,R,w){var P=w?y:this.toBBox(y),D=[],L=this._chooseSubtree(P,this.data,R,D);for(L.children.push(y),Jt(L,P);R>=0&&D[R].children.length>this._maxEntries;)this._split(D,R),R--;this._adjustParentBBoxes(P,D,R)},V.prototype._split=function(y,R){var w=y[R],P=w.children.length,D=this._minEntries;this._chooseSplitAxis(w,D,P);var L=this._chooseSplitIndex(w,D,P),k=Ae(w.children.splice(L,w.children.length-L));k.height=w.height,k.leaf=w.leaf,Zt(w,this.toBBox),Zt(k,this.toBBox),R?y[R-1].children.push(k):this._splitRoot(w,k)},V.prototype._splitRoot=function(y,R){this.data=Ae([y,R]),this.data.height=y.height+1,this.data.leaf=!1,Zt(this.data,this.toBBox)},V.prototype._chooseSplitIndex=function(y,R,w){for(var P,D,L,k,j,J,it,ot=1/0,lt=1/0,ft=R;ft<=w-R;ft++){var Nt=we(y,0,ft,this.toBBox),Pt=we(y,ft,w,this.toBBox),Rt=(D=Nt,L=Pt,void 0,void 0,void 0,void 0,k=Math.max(D.minX,L.minX),j=Math.max(D.minY,L.minY),J=Math.min(D.maxX,L.maxX),it=Math.min(D.maxY,L.maxY),Math.max(0,J-k)*Math.max(0,it-j)),ce=g(Nt)+g(Pt);Rt<ot?(ot=Rt,P=ft,lt=ce<lt?ce:lt):Rt===ot&&ce<lt&&(lt=ce,P=ft)}return P||w-R},V.prototype._chooseSplitAxis=function(y,R,w){var P=y.leaf?this.compareMinX:le,D=y.leaf?this.compareMinY:Le;this._allDistMargin(y,R,w,P)<this._allDistMargin(y,R,w,D)&&y.children.sort(P)},V.prototype._allDistMargin=function(y,R,w,P){y.children.sort(P);for(var D=this.toBBox,L=we(y,0,R,D),k=we(y,w-R,w,D),j=he(L)+he(k),J=R;J<w-R;J++){var it=y.children[J];Jt(L,y.leaf?D(it):it),j+=he(L)}for(var ot=w-R-1;ot>=R;ot--){var lt=y.children[ot];Jt(k,y.leaf?D(lt):lt),j+=he(k)}return j},V.prototype._adjustParentBBoxes=function(y,R,w){for(var P=w;P>=0;P--)Jt(R[P],y)},V.prototype._condense=function(y){for(var R=y.length-1,w=void 0;R>=0;R--)0===y[R].children.length?R>0?(w=y[R-1].children).splice(w.indexOf(y[R]),1):this.clear():Zt(y[R],this.toBBox)},V}()}}]);