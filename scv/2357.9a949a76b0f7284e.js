"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2357],{2357:(H,Z,l)=>{l.r(Z),l.d(Z,{StoryBuilderPageModule:()=>V});var g=l(9808),c=l(4182),a=l(7590),f=l(5010),t=l(2096),U=l(5485),x=l(2811),A=l(4848),N=l(759),P=l(5672),h=l(4974);const q=["mapElementRef"];let y=(()=>{class n{constructor(){this.startPoint=[0,0],this.coordinateClick=new t.vpe}ngOnInit(){this.setUpMap()}setUpMap(){const[o,e]=this.startPoint,s=(0,h.xA)([e,o]);this.map=new U.Z({view:new x.ZP({center:s,zoom:18}),layers:[new A.Z({source:new P.Z})],target:"ol-map"});const u=new N.Z({});this.map.addLayer(u),this.map.on("click",d=>{const p=this.map.getCoordinateFromPixel(d.pixel),S=(0,h.FY)(p);this.coordinateClick.emit({coordinate:[S[1],S[0]],event:d})}),setTimeout(()=>{this.map.setTarget(this.mapElementRef.nativeElement)})}goToPoint(o,e=18){const r=(0,h.xA)([o[1],o[0]]),s=this.map.getView();s.setCenter(r),s.setZoom(e)}}return n.\u0275fac=function(o){return new(o||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-coordinate-selection"]],viewQuery:function(o,e){if(1&o&&t.Gf(q,7),2&o){let r;t.iGM(r=t.CRH())&&(e.mapElementRef=r.first)}},inputs:{startPoint:"startPoint"},outputs:{coordinateClick:"coordinateClick"},decls:3,vars:0,consts:[["id","ol-map",1,"map-container"],["mapElementRef",""]],template:function(o,e){1&o&&(t.ynx(0),t._UZ(1,"div",0,1),t.BQk())},styles:["[_nghost-%COMP%]{display:flex;flex-grow:1;flex-direction:column;height:100vh}.map-container[_ngcontent-%COMP%]{flex-grow:1}"]}),n})(),b=(()=>{class n{constructor(){this.coordinateSelected=new t.vpe,this.startPoint=[0,0]}ngOnInit(){}onCoordinateClick(o){console.log(o.coordinate),this.coordinate=o.coordinate}go(){try{const o=this.coord.replace(/\[|\]/g,"").split(",").map(e=>parseFloat(e.trim()));this.coordinate=o,this.coordinateSelect.goToPoint(o)}catch(o){console.log(o.message)}}copy(){navigator.clipboard.writeText(JSON.stringify(this.coordinate))}select(){this.coordinateSelected.emit(this.coordinate)}}return n.\u0275fac=function(o){return new(o||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-coordinate-select-wrapper"]],viewQuery:function(o,e){if(1&o&&t.Gf(y,7),2&o){let r;t.iGM(r=t.CRH())&&(e.coordinateSelect=r.first)}},inputs:{startPoint:"startPoint"},outputs:{coordinateSelected:"coordinateSelected"},decls:10,vars:4,consts:[["placeholder","Enter coordinates",3,"ngModel","ngModelChange","keyup.enter"],[3,"click"],[3,"startPoint","coordinateClick"]],template:function(o,e){1&o&&(t.TgZ(0,"ion-item")(1,"ion-input",0),t.NdJ("ngModelChange",function(s){return e.coord=s})("keyup.enter",function(){return e.go()}),t.qZA()(),t.TgZ(2,"ion-item")(3,"ion-button",1),t.NdJ("click",function(){return e.go()}),t._uU(4," Go "),t.qZA(),t.TgZ(5,"ion-button",1),t.NdJ("click",function(){return e.copy()}),t._uU(6),t.qZA(),t.TgZ(7,"ion-button",1),t.NdJ("click",function(){return e.select()}),t._uU(8),t.qZA()(),t.TgZ(9,"app-coordinate-selection",2),t.NdJ("coordinateClick",function(s){return e.onCoordinateClick(s)}),t.qZA()),2&o&&(t.xp6(1),t.Q6J("ngModel",e.coord),t.xp6(5),t.hij(" Copy [",e.coordinate,"] "),t.xp6(2),t.hij(" Select [",e.coordinate,"] "),t.xp6(1),t.Q6J("startPoint",e.startPoint))},dependencies:[c.JJ,c.On,a.YG,a.pK,a.Ie,a.j9,y]}),n})();var _=l(655),v=l(5529),C=l(7224),w=l(7625);function m(n){return n?n.split(",").map(i=>i.trim()).filter(i=>!!i).map(i=>{const o="^"+i.replace("*",".+")+"$";return new RegExp(o,"g")}):null}var k=l(9258),F=l(4725);function M(n,i){1&n&&(t.ynx(0),t.TgZ(1,"ion-item")(2,"ion-label"),t._uU(3," Choices "),t.qZA(),t._UZ(4,"ion-textarea",23),t.TgZ(5,"span",6),t._uU(6,"Not valid"),t.qZA()(),t.BQk())}function I(n,i){1&n&&(t.ynx(0),t.TgZ(1,"ion-item")(2,"ion-label"),t._uU(3," Possible Answers "),t.qZA(),t._UZ(4,"ion-textarea",24),t.TgZ(5,"span",6),t._uU(6,"Not valid"),t.qZA()(),t.TgZ(7,"ion-item")(8,"ion-label"),t._uU(9," Message If Correct "),t.qZA(),t._UZ(10,"ion-textarea",25),t.TgZ(11,"span",6),t._uU(12,"Not valid"),t.qZA()(),t.TgZ(13,"ion-item")(14,"ion-label"),t._uU(15," Message If Not Correct "),t.qZA(),t._UZ(16,"ion-textarea",26),t.TgZ(17,"span",6),t._uU(18,"Not valid"),t.qZA()(),t.BQk())}const E=function(){return["multiplechoice","shortanswer"]};function O(n,i){if(1&n){const o=t.EpF();t.TgZ(0,"ion-accordion",14)(1,"ion-item",3)(2,"ion-label"),t._uU(3),t.qZA(),t.TgZ(4,"ion-button",0),t.NdJ("click",function(){const r=t.CHM(o),s=r.$implicit,u=r.index,d=t.oxw();return t.KtG(d.removePoint(s,u))}),t._uU(5," X "),t.qZA()(),t.TgZ(6,"div",4)(7,"ion-item-group",15),t._uU(8),t.TgZ(9,"ion-item")(10,"ion-label"),t._uU(11," Name "),t.qZA(),t._UZ(12,"ion-input",5),t.TgZ(13,"span",6),t._uU(14,"Not valid"),t.qZA()(),t.TgZ(15,"ion-item")(16,"ion-label"),t._uU(17," Title "),t.qZA(),t._UZ(18,"ion-textarea",16),t.TgZ(19,"span",6),t._uU(20,"Not valid"),t.qZA()(),t.TgZ(21,"ion-item")(22,"ion-label"),t._uU(23," Location "),t.qZA(),t._UZ(24,"ion-input",8),t.TgZ(25,"ion-button",0),t.NdJ("click",function(){const s=t.CHM(o).index,u=t.oxw();return t.KtG(u.selectPointLocation(s))}),t._uU(26,"select"),t.qZA(),t.TgZ(27,"span",6),t._uU(28,"Not valid"),t.qZA()(),t.TgZ(29,"ion-item"),t._UZ(30,"ion-checkbox",17),t.TgZ(31,"ion-label"),t._uU(32," Visible "),t.qZA()(),t.ynx(33,18),t.TgZ(34,"ion-item")(35,"ion-label"),t._uU(36," Text "),t.qZA(),t._UZ(37,"ion-textarea",19),t.TgZ(38,"span",6),t._uU(39,"Not valid"),t.qZA()(),t.YNc(40,M,7,0,"ng-container",13),t.YNc(41,I,19,0,"ng-container",13),t.TgZ(42,"ion-item")(43,"ion-label"),t._uU(44," After Explored "),t.qZA(),t._UZ(45,"ion-textarea",20),t.TgZ(46,"span",6),t._uU(47,"Not valid"),t.qZA()(),t.TgZ(48,"ion-item")(49,"ion-label"),t._uU(50," Enables "),t.qZA(),t._UZ(51,"ion-textarea",21),t.TgZ(52,"span",6),t._uU(53,"Not valid"),t.qZA()(),t.TgZ(54,"ion-item")(55,"ion-label"),t._uU(56," Disables "),t.qZA(),t._UZ(57,"ion-textarea",22),t.TgZ(58,"span",6),t._uU(59,"Not valid"),t.qZA()(),t.BQk(),t.qZA()()()}if(2&n){const o=i.$implicit,e=i.index;t.Q6J("value",e),t.xp6(3),t.hij(" ",o.value.name,""),t.xp6(4),t.Q6J("formGroupName",e),t.xp6(1),t.hij(" ",o.value.type," "),t.xp6(32),t.Q6J("ngIf","multiplechoice"===o.value.type),t.xp6(1),t.Q6J("ngIf",t.DdM(6,E).includes(o.value.type))}}function Q(n,i){if(1&n){const o=t.EpF();t.TgZ(0,"div",27)(1,"app-coordinate-select-wrapper",28),t.NdJ("coordinateSelected",function(r){t.CHM(o);const s=t.oxw();return t.KtG(s.coordinateSelected(r))}),t.qZA()()}if(2&n){const o=t.oxw();t.xp6(1),t.Q6J("startPoint",o.lastUsed)}}function j(n,i){1&n&&(t.TgZ(0,"div"),t._uU(1," Point name(s) doesn't exists "),t.qZA())}function G(n,i){if(1&n&&(t.TgZ(0,"div",29),t.YNc(1,j,2,0,"div",13),t.qZA()),2&n){const o=t.oxw();t.xp6(1),t.Q6J("ngIf",o.gameForm.errors.nameNotExist)}}function $(n,i){if(1&n){const o=t.EpF();t.TgZ(0,"div")(1,"ion-button",0),t.NdJ("click",function(){t.CHM(o);const r=t.oxw();return t.KtG(r.copy())}),t._uU(2," Copy "),t.qZA(),t._UZ(3,"br"),t.TgZ(4,"code"),t._uU(5),t.qZA()()}if(2&n){const o=t.oxw();t.xp6(5),t.hij(" ",o.jsonStory," ")}}const Y=[{path:"",component:(()=>{class n{constructor(o,e,r,s){this.fb=o,this.gameBuilderService=e,this.info=r,this.router=s,this.destroy$=new v.xQ,this.coordinateSelected$=new v.xQ,this.pointForms=this.fb.array([]),this.lastUsed=[0,0],this.showMap=!1,this.gameForm=this.fb.group({name:this.fb.control(null,[c.kI.required]),description:this.fb.control(null,[c.kI.required]),location:this.fb.control(null,[c.kI.required,n=>{const i=n.value;return!i||i.match(/\[\s*-?\d+\.\d+,\s*-?\d+\.\d+\s*\]/g)?null:{notValid:!0}}]),points:this.pointForms},{validators:[n=>{const i=n.get("points");if(!i)return null;const o=i.value,e=o.map(s=>s.name.trim()).filter(s=>!!s);let r=-1;for(const s of o){r++;let u=m(s.body.enables);if(console.log(u,e),u&&u.some(d=>e.some(p=>!p.match(d))))return i.at(r).get("body").get("enables").setErrors({nameNotExist:!0}),{nameNotExist:!0};if(u=m(s.body.disables),u&&u.some(d=>e.some(p=>!!p.match(d))))return i.at(r).get("body").get("disables").setErrors({nameNotExist:!0}),{nameNotExist:!0}}return null},n=>{const i=n.get("points");if(!i)return null;const o=i.value;let e=-1;for(const r of o)if(e++,"multiplechoice"===r.body.type){const s=r.body,u=m(s.choices),d=m(s.possibleAnswers);u&&d?!1===d.every(p=>u.includes(p))&&(i.at(e).get("body").get("choices").setErrors({noChoiceFound:!0}),i.at(e).get("body").get("possibleAnswers").setErrors({noChoiceFound:!0})):(i.at(e).get("body").get("choices").setErrors({noChoiceFound:!0}),i.at(e).get("body").get("possibleAnswers").setErrors({noChoiceFound:!0}))}return null}],updateOn:"blur"})}ngOnInit(){console.log(this.pointForms),this.coordinateSelected$.pipe((0,w.R)(this.destroy$)).subscribe(o=>{this.lastUsed=o})}ngOnDestroy(){this.destroy$.next(),this.destroy$.unsubscribe()}selectLocation(o){return(0,_.mG)(this,void 0,void 0,function*(){this.showMap=!0;const e=yield this.coordinateSelected$.pipe((0,C.P)()).toPromise();this.gameForm.controls.location.patchValue(JSON.stringify(e)),this.showMap=!1})}selectPointLocation(o){return(0,_.mG)(this,void 0,void 0,function*(){this.showMap=!0;const e=yield this.coordinateSelected$.pipe((0,C.P)()).toPromise();this.showMap=!1,this.pointForms.at(o).patchValue({location:JSON.stringify(e)})})}getPoint(o){const e={type:o,text:this.fb.control(null,[c.kI.required]),afterExplored:this.fb.control(null,[c.kI.required]),enables:this.fb.control(null,[]),disables:this.fb.control(null,[])},r={possibleAnswers:this.fb.control(null,[c.kI.required]),messageIfCorrect:this.fb.control(null,[]),messageIfIncorrect:this.fb.control(null,[])};switch(o){case"note":case"shortanswer":return this.fb.group(Object.assign(Object.assign({},e),r));case"multiplechoice":return this.fb.group(Object.assign(Object.assign(Object.assign({},e),r),{choices:this.fb.control(null,[c.kI.required])}))}}addPoint(o){const e=this.fb.group({name:this.fb.control(`point${this.pointForms.length+1}`,[]),title:this.fb.control(null,[]),location:this.fb.control(null,[c.kI.required,n=>{const i=n.value;return!i||i.match(/\[\s*-?\d+\.\d+,\s*-?\d+\.\d+\s*\]/g)?null:{notValid:!0}}]),visible:this.fb.control(!0,[]),type:o,body:this.getPoint(o)});this.pointForms.push(e)}removePoint(o,e){return(0,_.mG)(this,void 0,void 0,function*(){!(yield this.info.confirm("Remove",`Are you sure to remove ${o.get("name").value}?`))||this.pointForms.removeAt(e)})}coordinateSelected(o){this.coordinateSelected$.next(o)}copy(){navigator.clipboard.writeText(JSON.stringify(this.jsonStory))}onSubmit(){console.log(this.gameForm.valid),!1===this.gameForm.valid?(console.log(this.gameForm.errors),this.jsonStory=null):(this.jsonStory=JSON.stringify(this.gameForm.value),this.gameBuilderService.storyJson=this.jsonStory,this.router.navigate(["story"])),console.log(this.gameForm.value)}}return n.\u0275fac=function(o){return new(o||n)(t.Y36(c.qu),t.Y36(k.y),t.Y36(F.C),t.Y36(f.F0))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-story-builder"]],decls:50,vars:6,consts:[[3,"click"],[3,"formGroup","hidden"],["value","first"],["slot","header","color","light"],["slot","content",1,"ion-padding"],["type","text","formControlName","name"],["slot","error"],["formControlName","description"],["type","text","formControlName","location"],["formArrayName","points"],[3,"value",4,"ngFor","ngForOf"],["style","width: 70%",4,"ngIf"],["style","color: red;",4,"ngIf"],[4,"ngIf"],[3,"value"],[3,"formGroupName"],["formControlName","title"],["slot","start","formControlName","visible"],["formGroupName","body"],["formControlName","text"],["formControlName","afterExplored"],["formControlName","enables"],["formControlName","disables"],["formControlName","choices"],["formControlName","possibleAnswers"],["formControlName","messageIfCorrect"],["formControlName","messageIfIncorrect"],[2,"width","70%"],[3,"startPoint","coordinateSelected"],[2,"color","red"]],template:function(o,e){1&o&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),t._uU(3,"story-builder"),t.qZA()()(),t.TgZ(4,"ion-content")(5,"ion-item-divider")(6,"ion-label"),t._uU(7," Points "),t.qZA(),t.TgZ(8,"ion-button",0),t.NdJ("click",function(){return e.addPoint("note")}),t._uU(9," Note "),t.qZA(),t.TgZ(10,"ion-button",0),t.NdJ("click",function(){return e.addPoint("shortanswer")}),t._uU(11," Short Answer "),t.qZA(),t.TgZ(12,"ion-button",0),t.NdJ("click",function(){return e.addPoint("multiplechoice")}),t._uU(13," Multiple Choice "),t.qZA()(),t.TgZ(14,"ion-accordion-group",1)(15,"ion-accordion",2)(16,"ion-item",3)(17,"ion-label"),t._uU(18,"Game Details"),t.qZA()(),t.TgZ(19,"div",4)(20,"ion-item-group")(21,"ion-item")(22,"ion-label"),t._uU(23," Name "),t.qZA(),t._UZ(24,"ion-input",5),t.TgZ(25,"span",6),t._uU(26,"Not valid"),t.qZA()(),t.TgZ(27,"ion-item")(28,"ion-label"),t._uU(29," Description "),t.qZA(),t._UZ(30,"ion-textarea",7),t.TgZ(31,"span",6),t._uU(32,"Not valid"),t.qZA()(),t.TgZ(33,"ion-item")(34,"ion-label"),t._uU(35," Location "),t.qZA(),t._UZ(36,"ion-input",8),t.TgZ(37,"ion-button",0),t.NdJ("click",function(){return e.selectLocation("location")}),t._uU(38,"select"),t.qZA(),t.TgZ(39,"span",6),t._uU(40,"Not valid"),t.qZA()()()()(),t.ynx(41,9),t.YNc(42,O,60,7,"ion-accordion",10),t.BQk(),t.qZA(),t.YNc(43,Q,2,1,"div",11),t.YNc(44,G,2,1,"div",12),t.TgZ(45,"ion-button",0),t.NdJ("click",function(){return e.onSubmit()}),t._uU(46," Submit "),t.qZA(),t.YNc(47,$,6,1,"div",13),t._UZ(48,"br")(49,"br"),t.qZA()),2&o&&(t.xp6(14),t.Q6J("formGroup",e.gameForm)("hidden",e.showMap),t.xp6(28),t.Q6J("ngForOf",e.pointForms.controls),t.xp6(1),t.Q6J("ngIf",e.showMap),t.xp6(1),t.Q6J("ngIf",e.gameForm.errors),t.xp6(3),t.Q6J("ngIf",e.jsonStory))},dependencies:[g.sg,g.O5,c.JJ,c.JL,a.We,a.eh,a.YG,a.nz,a.W2,a.Gu,a.pK,a.Ie,a.rH,a.Ub,a.Q$,a.g2,a.wd,a.sr,a.w,a.j9,c.sg,c.u,c.x0,c.CE,b],styles:[".pointsDiv[_ngcontent-%COMP%]{padding-left:10px}"]}),n})()},{path:"map",component:b}];let W=(()=>{class n{}return n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[f.Bz.forChild(Y),f.Bz]}),n})();var R=l(520);let V=(()=>{class n{}return n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[g.ez,c.u5,a.Pc,W,c.UX,R.JF]}),n})()}}]);