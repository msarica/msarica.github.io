"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[662],{662:(Q,v,a)=>{a.d(v,{v:()=>L});var C=a(5861),T=a(8645),y=a(1374),i=a(2181),w=a(9773),s=a(7027),d=a(95),g=a(6814),n=a(6689),x=a(6546);function I(t,r){if(1&t){const o=n.EpF();n.TgZ(0,"ion-item",3),n.NdJ("click",function(){const l=n.CHM(o).$implicit,f=n.oxw(2);return n.KtG(f.optionSelected(l))}),n._uU(1),n.qZA()}if(2&t){const o=r.$implicit;n.xp6(1),n.hij(" ",o.text," ")}}function b(t,r){if(1&t&&(n.ynx(0),n.TgZ(1,"ion-item")(2,"ion-label",1),n._uU(3),n.qZA()(),n.TgZ(4,"ion-list"),n.YNc(5,I,2,1,"ion-item",2),n.qZA(),n.BQk()),2&t){const o=n.oxw();n.xp6(3),n.hij(" ",o.question.text," "),n.xp6(2),n.Q6J("ngForOf",o.question.options)}}let _=(()=>{var t;class r{constructor(e){this.gameService=e,this.history=[]}ngOnInit(){var e;this.question=null===(e=this.point)||void 0===e?void 0:e.body,this.history=[]}optionSelected(e){var c;if(!this.point)throw new Error("point not found");if(this.history.push({pointId:this.point.id,title:this.point.title+"-"+(null===(c=this.question)||void 0===c?void 0:c.text),selection:[e.text],time:Date.now()}),e.action)return this.gameService.closeMenu(""),this.gameService.addHistory(this.history),void this.gameService.moveNext({pointId:this.point.id,...e.action});e.item&&(this.question=e.item)}}return(t=r).\u0275fac=function(e){return new(e||t)(n.Y36(x.h))},t.\u0275cmp=n.Xpm({type:t,selectors:[["app-decision"]],inputs:{point:"point"},standalone:!0,features:[n.jDz],decls:1,vars:1,consts:[[4,"ngIf"],[1,"ion-text-wrap"],["class","ion-text-wrap",3,"click",4,"ngFor","ngForOf"],[1,"ion-text-wrap",3,"click"]],template:function(e,c){1&e&&n.YNc(0,b,6,2,"ng-container",0),2&e&&n.Q6J("ngIf",c.question)},dependencies:[s.Pc,s.Ie,s.Q$,s.q_,g.ez,g.sg,g.O5,d.u5]}),r})();class m{constructor(r){this.gameService=r}onSubmit(r){const o=this.isCorrect(r),e=Array.isArray(r)?r:[r];this.gameService.answerSelected(this.point,o?"correct":"incorrect",e)}}let p=(()=>{var t;class r extends m{set point(e){this._point=e,this.input=""}get point(){return this._point}constructor(e){super(e),this.input="",this._point=null}ngOnInit(){}submit(){var e;null!==(e=this.input)&&void 0!==e&&e.length&&this.onSubmit(this.input)}isCorrect(e){return!!e.length&&(e=e.trim().toLowerCase(),this.point.body.possibleAnswers.some(l=>l.trim().toLowerCase()===e))}}return(t=r).\u0275fac=function(e){return new(e||t)(n.Y36(x.h))},t.\u0275cmp=n.Xpm({type:t,selectors:[["app-short-answer"]],inputs:{point:"point"},standalone:!0,features:[n.qOj,n.jDz],decls:5,vars:3,consts:[["placeholder","Enter your answer",3,"ngModel","ngModelChange","keyup.enter"],["expand","block",3,"disabled","click"]],template:function(e,c){1&e&&(n.ynx(0),n.TgZ(1,"ion-item")(2,"ion-input",0),n.NdJ("ngModelChange",function(f){return c.input=f})("keyup.enter",function(){return c.submit()}),n.qZA()(),n.TgZ(3,"ion-button",1),n.NdJ("click",function(){return c.submit()}),n._uU(4),n.qZA(),n.BQk()),2&e&&(n.xp6(2),n.Q6J("ngModel",c.input),n.xp6(1),n.Q6J("disabled",!c.input.length),n.xp6(1),n.hij(" ","Submit"," "))},dependencies:[s.Pc,s.YG,s.pK,s.Ie,s.j9,d.u5,d.JJ,d.On,g.ez],encapsulation:2}),r})();function u(t,r){if(1&t&&(n.TgZ(0,"ion-item")(1,"ion-radio",4),n._uU(2),n.qZA()()),2&t){const o=r.$implicit;n.xp6(1),n.Q6J("value",o),n.xp6(1),n.hij(" ",o," ")}}function h(t,r){if(1&t){const o=n.EpF();n.TgZ(0,"ion-list")(1,"ion-item-group")(2,"ion-radio-group",1),n.NdJ("ngModelChange",function(c){n.CHM(o);const l=n.oxw();return n.KtG(l.selected=c)}),n.YNc(3,u,3,2,"ion-item",2),n.qZA()(),n.TgZ(4,"ion-button",3),n.NdJ("click",function(){n.CHM(o);const c=n.oxw();return n.KtG(c.select())}),n._uU(5),n.qZA()()}if(2&t){const o=n.oxw();n.xp6(2),n.Q6J("ngModel",o.selected),n.xp6(1),n.Q6J("ngForOf",o.body.choices),n.xp6(1),n.Q6J("disabled",!o.selected),n.xp6(1),n.hij(" ","Submit"," ")}}let S=(()=>{var t;class r extends m{set point(e){this._point=e,this.answered=!1}get point(){return this._point}get body(){return this._point.body}constructor(e){super(e),this._point=null,this.selected="",this.answered=!1}ngOnInit(){}select(){this.onSubmit(this.selected)}isCorrect(e){const c=this.point.body.possibleAnswers.includes(e);return c&&(this.answered=!0),c}}return(t=r).\u0275fac=function(e){return new(e||t)(n.Y36(x.h))},t.\u0275cmp=n.Xpm({type:t,selectors:[["app-multiple-choice"]],inputs:{point:"point"},standalone:!0,features:[n.qOj,n.jDz],decls:1,vars:1,consts:[[4,"ngIf"],[3,"ngModel","ngModelChange"],[4,"ngFor","ngForOf"],["expand","block",3,"disabled","click"],["label","Option","slot","end",3,"value"]],template:function(e,c){1&e&&n.YNc(0,h,6,4,"ion-list",0),2&e&&n.Q6J("ngIf",!c.answered)},dependencies:[s.Pc,s.YG,s.Ie,s.Ub,s.q_,s.B7,s.se,s.U5,s.QI,g.ez,g.sg,g.O5,d.u5,d.JJ,d.On],encapsulation:2}),r})();var Z=a(8658),P=a(8939),J=a(6593);function A(t,r){1&t&&(n.ynx(0),n.TgZ(1,"ion-item"),n._uU(2," This point is not active yet... Keep exploring! "),n.qZA(),n.BQk())}function U(t,r){1&t&&(n.ynx(0),n.TgZ(1,"ion-item"),n._uU(2," You are not close to this location! "),n.qZA(),n.BQk())}function N(t,r){1&t&&n._UZ(0,"div",6),2&t&&n.Q6J("innerHTML",r.$implicit,n.oJD)}function M(t,r){if(1&t&&(n.TgZ(0,"ion-item")(1,"ion-label"),n.YNc(2,N,1,1,"div",5),n.qZA()()),2&t){const o=n.oxw(3);n.xp6(2),n.Q6J("ngForOf",o.bodyText)}}function G(t,r){if(1&t&&(n.ynx(0),n._UZ(1,"app-decision",8),n.BQk()),2&t){const o=n.oxw(4);n.xp6(1),n.Q6J("point",o.point)}}function Y(t,r){if(1&t&&(n.ynx(0),n._UZ(1,"app-short-answer",8),n.BQk()),2&t){const o=n.oxw(4);n.xp6(1),n.Q6J("point",o.point)}}function O(t,r){if(1&t&&(n.ynx(0),n._UZ(1,"app-multiple-choice",8),n.BQk()),2&t){const o=n.oxw(4);n.xp6(1),n.Q6J("point",o.point)}}function k(t,r){if(1&t){const o=n.EpF();n.ynx(0),n.TgZ(1,"ion-item",9),n.NdJ("click",function(){n.CHM(o);const c=n.oxw(4);return n.KtG(c.close())}),n._uU(2),n.qZA(),n.BQk()}2&t&&(n.xp6(2),n.hij(" ","OK"," "))}function q(t,r){if(1&t&&(n.ynx(0,1),n.YNc(1,G,2,1,"ng-container",2),n.YNc(2,Y,2,1,"ng-container",2),n.YNc(3,O,2,1,"ng-container",2),n.YNc(4,k,3,1,"ng-container",7),n.BQk()),2&t){const o=n.oxw(3);n.Q6J("ngSwitch",o.point.body.type),n.xp6(1),n.Q6J("ngSwitchCase","choice"),n.xp6(1),n.Q6J("ngSwitchCase","shortanswer"),n.xp6(1),n.Q6J("ngSwitchCase","multiplechoice")}}function H(t,r){if(1&t&&(n.TgZ(0,"ion-card-content"),n._uU(1),n.qZA()),2&t){const o=n.oxw(5);n.xp6(1),n.hij(" ",o.messageIfCorrect," ")}}function F(t,r){if(1&t){const o=n.EpF();n.TgZ(0,"div")(1,"ion-card",10)(2,"ion-card-header")(3,"ion-card-title"),n._uU(4),n.qZA()(),n.YNc(5,H,2,1,"ion-card-content",0),n.qZA(),n.TgZ(6,"ion-button",11),n.NdJ("click",function(){n.CHM(o);const c=n.oxw(4);return n.KtG(c.close())}),n._uU(7),n.qZA()()}if(2&t){const o=n.oxw(4);n.xp6(4),n.Oqu("Correct"),n.xp6(1),n.Q6J("ngIf",o.messageIfCorrect),n.xp6(2),n.hij(" ","Next"," ")}}function D(t,r){if(1&t&&(n.TgZ(0,"ion-card-content"),n._uU(1),n.qZA()),2&t){const o=n.oxw(5);n.xp6(1),n.hij(" ",o.messageIfIncorrect," ")}}function j(t,r){if(1&t){const o=n.EpF();n.TgZ(0,"ion-button",11),n.NdJ("click",function(){n.CHM(o);const c=n.oxw(5);return n.KtG(c.giveUp())}),n._uU(1),n.qZA()}2&t&&(n.xp6(1),n.hij(" ","GiveUp"," "))}function B(t,r){if(1&t&&(n.ynx(0),n.TgZ(1,"ion-card",12)(2,"ion-card-header")(3,"ion-card-title"),n._uU(4),n.qZA()(),n.YNc(5,D,2,1,"ion-card-content",0),n.qZA(),n.TgZ(6,"ion-footer"),n.YNc(7,j,2,1,"ion-button",13),n.qZA(),n.BQk()),2&t){const o=n.oxw(4);n.xp6(4),n.Oqu("Incorrect"),n.xp6(1),n.Q6J("ngIf",o.messageIfIncorrect),n.xp6(2),n.Q6J("ngIf",o.canGiveUp)}}function E(t,r){if(1&t&&(n.ynx(0),n.YNc(1,F,8,3,"div",0),n.YNc(2,B,8,3,"ng-container",0),n.BQk()),2&t){const o=n.oxw(3);n.xp6(1),n.Q6J("ngIf",o.isCorrect),n.xp6(1),n.Q6J("ngIf",!o.isCorrect)}}function $(t,r){if(1&t&&(n.ynx(0),n.TgZ(1,"ion-item")(2,"ion-label",3)(3,"h1"),n._uU(4),n.qZA()()(),n.YNc(5,M,3,1,"ion-item",0),n.YNc(6,q,5,4,"ng-container",4),n.YNc(7,E,3,2,"ng-container",0),n.BQk()),2&t){const o=n.oxw(2);n.xp6(4),n.Oqu(o.point.body.title),n.xp6(1),n.Q6J("ngIf",null==o.bodyText?null:o.bodyText.length),n.xp6(1),n.Q6J("ngIf",!o.isCorrect),n.xp6(1),n.Q6J("ngIf",o.showFeedback)}}function K(t,r){if(1&t&&(n.ynx(0),n._UZ(1,"app-story-history-item",14),n.BQk()),2&t){const o=n.oxw(2);n.xp6(1),n.Q6J("item",o.hist)}}function z(t,r){if(1&t&&(n.ynx(0)(1,1),n.YNc(2,A,3,0,"ng-container",2),n.YNc(3,U,3,0,"ng-container",2),n.YNc(4,$,8,4,"ng-container",2),n.BQk(),n.YNc(5,K,2,1,"ng-container",0),n.BQk()),2&t){const o=n.oxw();n.xp6(1),n.Q6J("ngSwitch",o.status),n.xp6(1),n.Q6J("ngSwitchCase","not_selectable"),n.xp6(1),n.Q6J("ngSwitchCase","not_close"),n.xp6(1),n.Q6J("ngSwitchCase","close"),n.xp6(1),n.Q6J("ngIf",o.hist)}}let L=(()=>{var t;class r{getStatus(){const e=this.selectedPoint;return e.notSelectable?"not_selectable":e.explored?"explored":e.isClose?"close":"not_close"}set selectedPoint(e){if(this._selectedPoint=e,this.showFeedback=!1,this.isCorrect=!1,this.hist=void 0,!e)return;this.status=this.getStatus(),"explored"===this.status&&this.gameService.historyChanged$.pipe((0,y.P)()).subscribe(l=>{const f=l.history.find(R=>R.pointId===e.pointId);f&&(this.hist=Z.H.toHistItem(e.point,f))}),this.messageIfCorrect=e.point.body.messageIfCorrect,this.messageIfIncorrect=e.point.body.messageIfIncorrect,this.canGiveUp=!e.point.body.cannotGiveUp,console.log(e);const c=Array.isArray(e.point.body.text)?e.point.body.text:[e.point.body.text];this.bodyText="choice"===e.point.body.type?void 0:c.map(l=>this.sanitizer.bypassSecurityTrustHtml(l.replace(/\n/g,"<br>")))}get selectedPoint(){return this._selectedPoint}constructor(e,c,l){this.gameService=e,this.info=c,this.sanitizer=l,this.destroy$=new T.x,this._selectedPoint=null,this.showFeedback=!1,this.isCorrect=!1,this.canGiveUp=!0,this.status="not_close"}get point(){return this.selectedPoint.point}get isExplored(){return this._selectedPoint.explored}ngOnInit(){this.gameService.answerSelected$.pipe((0,i.h)(c=>!!c),(0,i.h)(c=>{var l;return c.id===(null===(l=this.point)||void 0===l?void 0:l.id)}),(0,w.R)(this.destroy$)).pipe((0,i.h)(c=>["correct","incorrect","giveUp"].includes(c.result))).subscribe(c=>{if(c){if("giveUp"===c.result)return void this.gameService.moveNext(this.point2MoveNext());this.showFeedback=!0,this.isCorrect="correct"===c.result,this.isCorrect&&this.gameService.moveNext(this.point2MoveNext())}})}close(){this.gameService.closeMenu(""),this.selectedPoint=null}point2MoveNext(){return{pointId:this.point.id,...this.point.body.action||{}}}giveUp(){var e=this;return(0,C.Z)(function*(){(yield e.info.confirmYesNo("Give up","Are you sure to give up?"))&&(e.gameService.answerSelected(e.point,"giveUp"),e.close())})()}ngOnDestroy(){console.log("destroy"),this.destroy$.next(),this.destroy$.unsubscribe()}}return(t=r).\u0275fac=function(e){return new(e||t)(n.Y36(x.h),n.Y36(P.C),n.Y36(J.H7))},t.\u0275cmp=n.Xpm({type:t,selectors:[["app-game-point"]],inputs:{selectedPoint:"selectedPoint"},standalone:!0,features:[n.jDz],decls:1,vars:1,consts:[[4,"ngIf"],[3,"ngSwitch"],[4,"ngSwitchCase"],[1,"ion-text-wrap"],[3,"ngSwitch",4,"ngIf"],["class","ion-text-wrap",3,"innerHTML",4,"ngFor","ngForOf"],[1,"ion-text-wrap",3,"innerHTML"],[4,"ngSwitchDefault"],[3,"point"],["button","",3,"click"],["color","success"],["expand","block",3,"click"],["color","danger"],["expand","block",3,"click",4,"ngIf"],[3,"item"]],template:function(e,c){1&e&&n.YNc(0,z,6,5,"ng-container",0),2&e&&n.Q6J("ngIf",c.selectedPoint)},dependencies:[s.Pc,s.YG,s.PM,s.FN,s.Zi,s.Dq,s.fr,s.Ie,s.Q$,d.u5,g.ez,g.sg,g.O5,g.RF,g.n9,g.ED,_,p,S,Z.H],styles:[".correct[_ngcontent-%COMP%]{padding:5px;border:1px solid green;border-radius:5px;color:green}.incorrect[_ngcontent-%COMP%]{padding:5px;border:1px solid red;border-radius:5px;color:red}"],changeDetection:0}),r})()},8658:(Q,v,a)=>{a.d(v,{H:()=>b});var C=a(6814),T=a(95),y=a(7027),i=a(6689);function w(_,m){if(1&_&&(i.TgZ(0,"ion-item",3)(1,"ion-label"),i._uU(2),i.qZA()()),2&_){const p=i.oxw(2);i.xp6(2),i.Oqu(p.item.title)}}function s(_,m){if(1&_&&(i.TgZ(0,"div"),i._uU(1),i.qZA()),2&_){const p=m.$implicit;i.xp6(1),i.hij(" ",p," ")}}function d(_,m){if(1&_&&(i.TgZ(0,"div"),i._uU(1),i.qZA()),2&_){const p=i.oxw(3);i.xp6(1),i.hij(" ",p.item.selection," ")}}function g(_,m){1&_&&(i.TgZ(0,"div"),i._uU(1," GAVE UP :( "),i.qZA())}function n(_,m){if(1&_&&(i.ynx(0),i.YNc(1,s,2,1,"div",4),i.TgZ(2,"h5"),i._uU(3,"Selection"),i.qZA(),i.YNc(4,d,2,1,"div",0),i.YNc(5,g,2,0,"div",0),i.BQk()),2&_){const p=i.oxw(2);i.xp6(1),i.Q6J("ngForOf",p.item.question),i.xp6(3),i.Q6J("ngIf",!p.item.gaveUp),i.xp6(1),i.Q6J("ngIf",p.item.gaveUp)}}function x(_,m){if(1&_&&(i.TgZ(0,"div"),i._uU(1),i.qZA()),2&_){const p=i.oxw(2);i.xp6(1),i.hij(" ",p.item.result," ")}}function I(_,m){if(1&_&&(i.ynx(0),i.YNc(1,w,3,1,"ion-item",1),i.TgZ(2,"div",2),i.YNc(3,n,6,3,"ng-container",0),i.YNc(4,x,2,1,"div",0),i.qZA(),i.BQk()),2&_){const p=i.oxw();i.xp6(1),i.Q6J("ngIf",p.showHeader),i.xp6(2),i.Q6J("ngIf",!p.item.result),i.xp6(1),i.Q6J("ngIf",p.item.result)}}let b=(()=>{var _;class m{constructor(){this.index=0,this.showHeader=!1}ngOnInit(){}static toHistItem(u,h){return{title:h.title,question:u&&(Array.isArray(u.body.text)?u.body.text:[u.body.text]),selection:h.selection.join(", "),gaveUp:h.gaveUp,result:h.result}}}return(_=m).\u0275fac=function(u){return new(u||_)},_.\u0275cmp=i.Xpm({type:_,selectors:[["app-story-history-item"]],inputs:{item:"item",index:"index",showHeader:"showHeader"},standalone:!0,features:[i.jDz],decls:1,vars:1,consts:[[4,"ngIf"],["slot","header","color","light",4,"ngIf"],["slot","content",1,"ion-padding"],["slot","header","color","light"],[4,"ngFor","ngForOf"]],template:function(u,h){1&u&&i.YNc(0,I,5,3,"ng-container",0),2&u&&i.Q6J("ngIf",h.item)},dependencies:[y.Pc,y.Ie,y.Q$,C.ez,C.sg,C.O5,T.u5]}),m})()}}]);