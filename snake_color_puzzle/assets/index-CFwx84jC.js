var e=Object.defineProperty,t=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,s=(t,n,i)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[n]=i,o=(e,o)=>{for(var l in o||(o={}))n.call(o,l)&&s(e,l,o[l]);if(t)for(var l of t(o))i.call(o,l)&&s(e,l,o[l]);return e},l=(e,t,n)=>s(e,"symbol"!=typeof t?t+"":t,n);!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const r={maxLevels:50,colors:["red","blue","green","yellow","purple","orange"],gridSizes:[{width:2,height:2},{width:3,height:3},{width:4,height:4},{width:5,height:4},{width:5,height:5},{width:6,height:5},{width:6,height:6},{width:7,height:6},{width:7,height:7},{width:8,height:7},{width:8,height:8},{width:9,height:8}]},a={red:"#e74c3c",blue:"#3498db",green:"#2ecc71",yellow:"#f1c40f",purple:"#9b59b6",orange:"#e67e22"},c="snake-color-puzzle-state",d="snake-color-puzzle-highest-level";function h(e){return e[Math.floor(Math.random()*e.length)]}function u(e){const t=Math.min(Math.floor((e-1)/5),r.gridSizes.length-1),n=r.gridSizes[t],i=Math.min(2+Math.floor(e/8),r.colors.length),s=r.colors.slice(0,i),o=function(e,t){const n=[];let i=0;for(let o=0;o<e.height;o++)for(let s=0;s<e.width;s++)n.push({id:"block-"+i++,color:h(t),position:{x:s,y:o},isSelected:!1,isConnected:!1});const s=new Set(n.map(e=>e.color));if(1===s.size&&t.length>1){const e=n[0].color,i=t.filter(t=>t!==e),s=Math.max(1,Math.floor(n.length/4)),o=new Set;for(;o.size<s;){const e=Math.floor(Math.random()*n.length);o.add(e)}o.forEach(e=>{const t=i[Math.floor(Math.random()*i.length)];n[e].color=t})}return n}(n,s),l=function(e){const{width:t,height:n}=e,i=t*n,s=[];for(let l=0;l<n;l++)for(let e=0;e<t;e++)s.push({x:e,y:l});const o=10;for(let l=0;l<o;l++){const t=g(s[Math.floor(Math.random()*s.length)],e);if(t.length===i)return t}return function(e){const{width:t,height:n}=e,i=[{x:0,y:0},{x:t-1,y:0},{x:0,y:n-1},{x:t-1,y:n-1}],s=i[Math.floor(Math.random()*i.length)],o=[];for(let l=0;l<n;l++)if(l%2==0)for(let e=0;e<t;e++)o.push({x:e,y:l});else for(let e=t-1;e>=0;e--)o.push({x:e,y:l});s.x===t-1&&o.forEach(e=>e.x=t-1-e.x);s.y===n-1&&o.forEach(e=>e.y=n-1-e.y);return o}(e)}(n),a=function(e){if(0===e.length)return[];const t=[e[0]];for(let n=1;n<e.length;n++)e[n]!==e[n-1]&&t.push(e[n]);if(1===t.length){const n=[...new Set(e)];if(n.length>1){const e=t[0],i=n.find(t=>t!==e);return[e,i]}return[t[0],t[0]]}return t}(l.map(e=>o.find(t=>t.position.x===e.x&&t.position.y===e.y).color));return{id:e,gridSize:n,colors:s,pattern:a,blocks:o,isCompleted:!1,isUnlocked:1===e}}function g(e,t){const{width:n,height:i}=t,s=new Set,o=[];return function e(t){const l=`${t.x},${t.y}`;if(s.has(l))return!1;if(s.add(l),o.push(t),o.length===n*i)return!0;const r=[],a=[{dx:0,dy:-1},{dx:1,dy:0},{dx:0,dy:1},{dx:-1,dy:0}];for(const{dx:s,dy:o}of a){const e=t.x+s,l=t.y+o;e>=0&&e<n&&l>=0&&l<i&&r.push({x:e,y:l})}for(let n=r.length-1;n>0;n--){const e=Math.floor(Math.random()*(n+1));[r[n],r[e]]=[r[e],r[n]]}for(const n of r)if(e(n))return!0;return s.delete(l),o.pop(),!1}(e),o}function p(e){try{localStorage.setItem(d,e.toString())}catch(t){console.warn("Failed to save highest level:",t)}}const v={preventMistakes:!0},y="snake-color-puzzle-settings";function m(){try{const e=localStorage.getItem(y);if(e)return JSON.parse(e)}catch(e){console.warn("Failed to load settings:",e)}return v}class f{constructor(){l(this,"state"),l(this,"currentLevel",null),l(this,"listeners",[]),this.state=this.initializeState(),this.loadFromStorage()}initializeState(){return{currentLevel:1,highestUnlockedLevel:1,selectedBlocks:[],selectedPattern:[],isGameComplete:!1}}loadFromStorage(){const e=function(){try{const e=localStorage.getItem(c);if(e)return JSON.parse(e)}catch(e){console.warn("Failed to load game state:",e)}return null}(),t=function(){try{const e=localStorage.getItem(d);if(e)return parseInt(e,10)||1}catch(e){console.warn("Failed to load highest level:",e)}return 1}();e&&(this.state=o(o({},this.state),e)),t>this.state.highestUnlockedLevel&&(this.state.highestUnlockedLevel=t),this.state.currentLevel=this.state.highestUnlockedLevel}getState(){return o({},this.state)}getCurrentLevel(){return this.currentLevel}loadLevel(e){e>this.state.highestUnlockedLevel?console.warn(`Level ${e} is not unlocked yet`):(this.currentLevel=u(e),this.state.currentLevel=e,this.state.selectedBlocks=[],this.state.selectedPattern=[],this.notifyListeners())}dispatch(e){switch(e.type){case"SELECT_BLOCK":this.selectBlock(e.block);break;case"DESELECT_BLOCK":this.deselectBlock(e.block);break;case"RESET_LEVEL":this.resetLevel();break;case"COMPLETE_LEVEL":this.completeLevel();break;case"UNLOCK_LEVEL":this.unlockLevel(e.level);break;case"LOAD_GAME":this.loadGame(e.state);break;case"SAVE_GAME":this.saveGame()}}selectBlock(e){if(!this.currentLevel)return;if(!(0===this.state.selectedBlocks.length||this.areAdjacent(e,this.state.selectedBlocks[this.state.selectedBlocks.length-1])))return;if(m().preventMistakes&&!this.isValidMoveAccordingToPattern(e))return;const t=this.currentLevel.blocks.findIndex(t=>t.id===e.id);-1!==t&&(this.currentLevel.blocks[t].isSelected=!0),this.state.selectedBlocks.push(e),this.updateSelectedPattern(e.color),this.notifyListeners()}deselectBlock(e){if(!this.currentLevel)return;const t=this.state.selectedBlocks.findIndex(t=>t.id===e.id);if(-1===t)return;if(t===this.state.selectedBlocks.length-1)return void this.notifyListeners();const n=this.state.selectedBlocks.slice(t+1);this.state.selectedBlocks.splice(t+1),this.rebuildSelectedPattern();const i=new Set(n.map(e=>e.id));this.currentLevel.blocks.forEach(e=>{i.has(e.id)&&(e.isSelected=!1)}),this.notifyListeners()}updateSelectedPattern(e){if(0===this.state.selectedPattern.length)return void this.state.selectedPattern.push(e);e!==this.state.selectedPattern[this.state.selectedPattern.length-1]&&this.state.selectedPattern.push(e)}rebuildSelectedPattern(){if(this.state.selectedPattern=[],0!==this.state.selectedBlocks.length)for(const e of this.state.selectedBlocks)this.updateSelectedPattern(e.color)}resetLevel(){this.currentLevel&&(this.currentLevel.blocks.forEach(e=>{e.isSelected=!1,e.isConnected=!1}),this.state.selectedBlocks=[],this.state.selectedPattern=[],this.notifyListeners())}completeLevel(){if(!this.currentLevel)return;this.currentLevel.isCompleted=!0;const e=this.state.currentLevel+1;e>this.state.highestUnlockedLevel&&(this.state.highestUnlockedLevel=e,p(e)),this.saveGame(),this.notifyListeners()}unlockLevel(e){e>this.state.highestUnlockedLevel&&(this.state.highestUnlockedLevel=e,p(e),this.notifyListeners())}loadGame(e){this.state=o({},e),this.notifyListeners()}saveGame(){!function(e){try{localStorage.setItem(c,JSON.stringify(e))}catch(t){console.warn("Failed to save game state:",t)}}(this.state)}areAdjacent(e,t){const n=Math.abs(e.position.x-t.position.x),i=Math.abs(e.position.y-t.position.y);return 1===n&&0===i||0===n&&1===i}isValidMoveAccordingToPattern(e){if(!this.currentLevel)return!1;const{pattern:t}=this.currentLevel,n=this.state.selectedPattern.length;if(0===n)return e.color===t[0];const i=this.state.selectedPattern[n-1];if(e.color===i)return!0;const s=t[((n-1)%t.length+1)%t.length];return e.color===s}subscribe(e){return this.listeners.push(e),()=>{const t=this.listeners.indexOf(e);t>-1&&this.listeners.splice(t,1)}}notifyListeners(){this.listeners.forEach(e=>e(this.getState()))}}class b{constructor(e){l(this,"container"),this.container=e,this.render()}render(){this.container.innerHTML='\n      <div class="header">\n        <div class="header-content">\n          <h1 class="game-title">Snake Color Puzzle <span class="version">v1.0.3</span></h1>\n          <div class="level-info">\n            <button class="level-number level-trigger" id="open-level-dialog" aria-label="Change level">Level <span id="current-level">1</span> ‚åÑ</button>\n            <button class="control-button restart-button" id="restart-button" aria-label="Restart level">üîÑ Restart</button>\n            <button class="control-button settings-button" id="open-settings-dialog" aria-label="Open settings">‚öôÔ∏è Settings</button>\n          </div>\n        </div>\n      </div>\n    '}update(e,t){const n=this.container.querySelector("#current-level");n&&(n.textContent=t.id.toString())}}class x{constructor(e,t){l(this,"container"),l(this,"gridElement",null),this.container=e,this.render()}render(){this.container.innerHTML='\n      <div class="game-grid">\n        <div class="grid-container" id="grid-container">\n          \x3c!-- Grid will be generated here --\x3e\n        </div>\n      </div>\n    ',this.gridElement=this.container.querySelector("#grid-container")}update(e,t,n){this.gridElement&&(this.gridElement.innerHTML="",this.gridElement.style.gridTemplateColumns=`repeat(${e.gridSize.width}, 1fr)`,this.gridElement.style.gridTemplateRows=`repeat(${e.gridSize.height}, 1fr)`,e.blocks.forEach(e=>{const i=document.createElement("div");if(i.className="game-block "+(e.isSelected?"selected":""),i.style.backgroundColor=a[e.color],i.style.position="relative",e.isSelected){const n=t.findIndex(t=>t.id===e.id);if(-1!==n){const e=document.createElement("div");e.textContent=String(n+1),e.style.position="absolute",e.style.top="4px",e.style.right="6px",e.style.background="rgba(0,0,0,0.65)",e.style.color="#fff",e.style.borderRadius="10px",e.style.padding="2px 6px",e.style.fontSize="12px",e.style.lineHeight="1",e.style.pointerEvents="none",i.appendChild(e)}}i.addEventListener("click",()=>{this.handleBlockClick(e,n)}),i.addEventListener("touchstart",t=>{t.preventDefault(),this.handleBlockClick(e,n)}),this.gridElement.appendChild(i)}))}handleBlockClick(e,t){e.isSelected?t.dispatch({type:"DESELECT_BLOCK",block:e}):t.dispatch({type:"SELECT_BLOCK",block:e})}}class k{constructor(e){l(this,"container"),this.container=e,this.render()}render(){this.container.innerHTML='\n      <div class="pattern-display">\n        <div class="pattern-display-content">\n          <h3>Match this pattern:</h3>\n          <div class="pattern-container">\n            <div class="target-pattern" id="target-pattern">\n              \x3c!-- Target pattern will be displayed here --\x3e\n            </div>\n          </div>\n        </div>\n      </div>\n    '}update(e,t,n,i){const s=this.container.querySelector("#target-pattern"),o=m();s&&(s.innerHTML="",e.forEach((n,l)=>{const r=document.createElement("div");if(r.className="pattern-color-block",r.style.backgroundColor=a[n],o.preventMistakes&&this.shouldShowIndicator(l,t,e,i)){const e=document.createElement("div");e.className="pattern-indicator",e.style.cssText="\n            position: absolute;\n            top: -8px;\n            left: 50%;\n            transform: translateX(-50%);\n            width: 0;\n            height: 0;\n            border-left: 8px solid transparent;\n            border-right: 8px solid transparent;\n            border-bottom: 12px solid #e74c3c;\n            z-index: 10;\n          ",r.style.position="relative",r.appendChild(e)}s.appendChild(r)}))}shouldShowIndicator(e,t,n,i){if(i&&0===i.length)return 0===e;if(!i||0===i.length)return!1;let s=0;for(let o=1;o<i.length;o++)i[o].color!==i[o-1].color&&s++;return s%=n.length,e===s}}class L{constructor(e,t){l(this,"container"),l(this,"gameStateManager"),l(this,"isOpen",!1),this.container=e,this.gameStateManager=t,this.render(),this.attachGlobalHandlers()}render(){if(this.container.querySelector(".level-dialog-overlay"))return;const e=document.createElement("div");e.className="level-dialog-overlay",e.innerHTML='\n      <div class="level-dialog" role="dialog" aria-modal="true" aria-labelledby="level-dialog-title">\n        <div class="level-dialog-header">\n          <h3 id="level-dialog-title">Select Level</h3>\n          <button class="level-dialog-close" id="level-dialog-close" aria-label="Close">‚úñ</button>\n        </div>\n        <div class="level-dialog-body">\n          <div class="level-buttons" id="dialog-level-buttons"></div>\n        </div>\n      </div>\n    ',this.container.appendChild(e);const t=e.querySelector("#level-dialog-close");null==t||t.addEventListener("click",()=>this.close()),e.addEventListener("click",t=>{t.target===e&&this.close()})}attachGlobalHandlers(){document.addEventListener("keydown",e=>{this.isOpen&&"Escape"===e.key&&this.close()})}open(){const e=this.container.querySelector(".level-dialog-overlay");e&&(this.isOpen=!0,e.style.display="flex")}close(){const e=this.container.querySelector(".level-dialog-overlay");e&&(this.isOpen=!1,e.style.display="none")}update(e){const t=this.container.querySelector("#dialog-level-buttons");if(!t)return;t.innerHTML="";const n=r.maxLevels;for(let i=1;i<=n;i++){const n=document.createElement("button"),s=i>e.highestUnlockedLevel,o=i===e.currentLevel,l=i<e.highestUnlockedLevel;n.className=`level-button ${s?"locked":"unlocked"} ${o?"current":""} ${l?"completed":""}`,n.textContent=i.toString(),n.disabled=s,s||n.addEventListener("click",()=>{this.gameStateManager.loadLevel(i),this.close()}),t.appendChild(n)}}}class S{constructor(e){l(this,"container"),l(this,"overlay",null),l(this,"dialog",null),l(this,"settings"),this.container=e,this.settings=m(),this.render()}render(){this.overlay=document.createElement("div"),this.overlay.className="settings-overlay",this.overlay.style.cssText="\n            position: fixed;\n            inset: 0;\n            background: rgba(0,0,0,0.4);\n            display: none;\n            align-items: center;\n            justify-content: center;\n            z-index: 1000;\n        ",this.dialog=document.createElement("div"),this.dialog.className="settings-dialog",this.dialog.style.cssText="\n            background: white;\n            padding: 24px 28px;\n            border-radius: 12px;\n            font-size: 16px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.3);\n            display: flex;\n            flex-direction: column;\n            gap: 20px;\n            min-width: 320px;\n            max-width: 400px;\n        ",this.dialog.innerHTML='\n            <div class="settings-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">\n                <h2 style="margin: 0; font-size: 20px; font-weight: bold; color: #2c3e50;">Settings</h2>\n                <button class="close-button" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #7f8c8d;">&times;</button>\n            </div>\n            \n            <div class="settings-content">\n                <div class="setting-item" style="display: flex; align-items: center; gap: 12px; padding: 12px 0;">\n                    <input type="checkbox" id="prevent-mistakes" class="setting-checkbox" style="width: 18px; height: 18px; cursor: pointer;">\n                    <label for="prevent-mistakes" style="cursor: pointer; font-size: 16px; color: #2c3e50;">\n                        Prevent mistakes\n                    </label>\n                </div>\n                <div class="setting-description" style="font-size: 14px; color: #7f8c8d; margin-top: 4px; line-height: 1.4;">\n                    When enabled, invalid moves will be blocked. You can only click on blocks that match the current pattern position.\n                </div>\n            </div>\n            \n            <div class="settings-actions" style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 8px;">\n                <button class="control-button cancel-button" style="background: #95a5a6; color: white; padding: 10px 16px; border-radius: 8px; font-size: 14px; font-weight: 600; border: none; cursor: pointer;">\n                    Cancel\n                </button>\n                <button class="control-button save-button" style="background: #3498db; color: white; padding: 10px 16px; border-radius: 8px; font-size: 14px; font-weight: 600; border: none; cursor: pointer;">\n                    Save\n                </button>\n            </div>\n        ',this.overlay.appendChild(this.dialog),this.container.appendChild(this.overlay),this.setupEventListeners(),this.updateUI()}setupEventListeners(){if(!this.overlay||!this.dialog)return;const e=this.dialog.querySelector(".close-button");null==e||e.addEventListener("click",()=>this.close());const t=this.dialog.querySelector(".cancel-button");null==t||t.addEventListener("click",()=>this.close());const n=this.dialog.querySelector(".save-button");null==n||n.addEventListener("click",()=>this.saveSettings()),this.overlay.addEventListener("click",e=>{e.target===this.overlay&&this.close()}),document.addEventListener("keydown",e=>{"Escape"===e.key&&this.isOpen()&&this.close()})}updateUI(){if(!this.dialog)return;const e=this.dialog.querySelector("#prevent-mistakes");e&&(e.checked=this.settings.preventMistakes)}open(){var e;if(this.overlay){this.overlay.style.display="flex";const t=null==(e=this.dialog)?void 0:e.querySelector("input");null==t||t.focus()}}close(){this.overlay&&(this.overlay.style.display="none")}isOpen(){var e;return"flex"===(null==(e=this.overlay)?void 0:e.style.display)}saveSettings(){if(!this.dialog)return;const e=this.dialog.querySelector("#prevent-mistakes");this.settings={preventMistakes:(null==e?void 0:e.checked)||!1},function(e){try{localStorage.setItem(y,JSON.stringify(e))}catch(t){console.warn("Failed to save settings:",t)}}(this.settings),this.close()}getSettings(){return this.settings}update(e){}}class w{constructor(e){l(this,"container"),l(this,"overlay",null),l(this,"dialog",null),this.container=e,this.render()}render(){this.overlay=document.createElement("div"),this.overlay.className="instructions-overlay",this.overlay.style.cssText="\n            position: fixed;\n            inset: 0;\n            background: rgba(0,0,0,0.4);\n            display: none;\n            align-items: center;\n            justify-content: center;\n            z-index: 1000;\n        ",this.dialog=document.createElement("div"),this.dialog.className="instructions-dialog",this.dialog.style.cssText="\n            background: white;\n            padding: 24px 28px;\n            border-radius: 12px;\n            font-size: 16px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.3);\n            display: flex;\n            flex-direction: column;\n            gap: 20px;\n            min-width: 400px;\n            max-width: 500px;\n            max-height: 80vh;\n            overflow-y: auto;\n        ",this.dialog.innerHTML='\n            <div class="instructions-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">\n                <h2 style="margin: 0; font-size: 20px; font-weight: bold; color: #2c3e50;">How to Play</h2>\n                <button class="close-button" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #7f8c8d;">&times;</button>\n            </div>\n            \n            <div class="instructions-content" style="line-height: 1.6; color: #2c3e50;">\n                <div class="instruction-section" style="margin-bottom: 20px;">\n                    <h3 style="margin: 0 0 8px 0; font-size: 16px; font-weight: bold; color: #34495e;">üéØ Objective</h3>\n                    <p style="margin: 0;">Select blocks in the correct order to match the color pattern shown at the top of the screen.</p>\n                </div>\n\n                <div class="instruction-section" style="margin-bottom: 20px;">\n                    <h3 style="margin: 0 0 8px 0; font-size: 16px; font-weight: bold; color: #34495e;">üéÆ How to Play</h3>\n                    <ul style="margin: 0; padding-left: 20px;">\n                        <li style="margin-bottom: 6px;">Look at the color pattern displayed at the top</li>\n                        <li style="margin-bottom: 6px;">Click on blocks in the grid to select them in the correct order</li>\n                        <li style="margin-bottom: 6px;">Each selected block should match the next color in the pattern</li>\n                        <li style="margin-bottom: 6px;">Complete the pattern to finish the level</li>\n                    </ul>\n                </div>\n\n                <div class="instruction-section" style="margin-bottom: 20px;">\n                    <h3 style="margin: 0 0 8px 0; font-size: 16px; font-weight: bold; color: #34495e;">‚öôÔ∏è Settings</h3>\n                    <ul style="margin: 0; padding-left: 20px;">\n                        <li style="margin-bottom: 6px;"><strong>Prevent Mistakes:</strong> When enabled, you can only click on blocks that match the current pattern position</li>\n                        <li style="margin-bottom: 6px;">Use the Settings button to toggle this feature</li>\n                    </ul>\n                </div>\n\n                <div class="instruction-section" style="margin-bottom: 20px;">\n                    <h3 style="margin: 0 0 8px 0; font-size: 16px; font-weight: bold; color: #34495e;">üîÑ Controls</h3>\n                    <ul style="margin: 0; padding-left: 20px;">\n                        <li style="margin-bottom: 6px;"><strong>Restart:</strong> Reset the current level</li>\n                        <li style="margin-bottom: 6px;"><strong>Level Selector:</strong> Choose different levels</li>\n                        <li style="margin-bottom: 6px;"><strong>Settings:</strong> Adjust game preferences</li>\n                    </ul>\n                </div>\n\n                <div class="instruction-section">\n                    <h3 style="margin: 0 0 8px 0; font-size: 16px; font-weight: bold; color: #34495e;">üí° Tips</h3>\n                    <ul style="margin: 0; padding-left: 20px;">\n                        <li style="margin-bottom: 6px;">Start with the first color in the pattern</li>\n                        <li style="margin-bottom: 6px;">Look for blocks that are connected to your current selection</li>\n                        <li style="margin-bottom: 6px;">Use the "Prevent Mistakes" setting if you want guidance</li>\n                        <li style="margin-bottom: 6px;">Take your time to plan your moves</li>\n                    </ul>\n                </div>\n            </div>\n            \n            <div class="instructions-actions" style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 8px;">\n                <button class="control-button close-instructions-button" style="background: #3498db; color: white; padding: 10px 16px; border-radius: 8px; font-size: 14px; font-weight: 600; border: none; cursor: pointer;">\n                    Got it!\n                </button>\n            </div>\n        ',this.overlay.appendChild(this.dialog),this.container.appendChild(this.overlay),this.setupEventListeners()}setupEventListeners(){if(!this.overlay||!this.dialog)return;const e=this.dialog.querySelector(".close-button");null==e||e.addEventListener("click",()=>this.close());const t=this.dialog.querySelector(".close-instructions-button");null==t||t.addEventListener("click",()=>this.close()),this.overlay.addEventListener("click",e=>{e.target===this.overlay&&this.close()}),document.addEventListener("keydown",e=>{"Escape"===e.key&&this.isOpen()&&this.close()})}open(){var e;if(this.overlay){this.overlay.style.display="flex";const t=null==(e=this.dialog)?void 0:e.querySelector("button");null==t||t.focus()}}close(){this.overlay&&(this.overlay.style.display="none")}isOpen(){var e;return"flex"===(null==(e=this.overlay)?void 0:e.style.display)}}class E{constructor(e){l(this,"gameStateManager"),l(this,"container"),l(this,"header"),l(this,"levelDialog"),l(this,"settingsDialog"),l(this,"instructionsDialog"),l(this,"patternDisplay"),l(this,"gameGrid"),l(this,"currentState",null),l(this,"currentLevel",null),this.container=e,this.gameStateManager=new f,this.initializeComponents(),this.setupEventListeners(),this.loadInitialLevel()}initializeComponents(){this.container.innerHTML="",this.container.innerHTML='\n      <div class="game-container">\n        <div class="game-header"></div>\n        <div class="level-dialog-container"></div>\n        <div class="settings-dialog-container"></div>\n        <div class="instructions-dialog-container"></div>\n        <div class="pattern-display-container"></div>\n        <div class="game-grid-container"></div>\n        <button class="info-button" id="info-button" aria-label="View instructions" title="How to Play">\n          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>\n            <path d="M12 16v-4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>\n            <path d="M12 8h.01" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>\n          </svg>\n        </button>\n      </div>\n    ',this.header=new b(this.container.querySelector(".game-header")),this.levelDialog=new L(this.container.querySelector(".level-dialog-container"),this.gameStateManager),this.settingsDialog=new S(this.container.querySelector(".settings-dialog-container")),this.instructionsDialog=new w(this.container.querySelector(".instructions-dialog-container")),this.patternDisplay=new k(this.container.querySelector(".pattern-display-container")),this.gameGrid=new x(this.container.querySelector(".game-grid-container"),this.gameStateManager)}setupEventListeners(){this.gameStateManager.subscribe(e=>{this.currentState=e,this.currentLevel=this.gameStateManager.getCurrentLevel(),this.updateUI()});(()=>{const e=this.container.querySelector("#open-level-dialog"),t=this.container.querySelector("#restart-button"),n=this.container.querySelector("#open-settings-dialog"),i=this.container.querySelector("#info-button");e&&!e.getAttribute("data-bound")&&(e.setAttribute("data-bound","true"),e.addEventListener("click",()=>{this.levelDialog.open()})),t&&!t.getAttribute("data-bound")&&(t.setAttribute("data-bound","true"),t.addEventListener("click",()=>{this.gameStateManager.dispatch({type:"RESET_LEVEL"})})),n&&!n.getAttribute("data-bound")&&(n.setAttribute("data-bound","true"),n.addEventListener("click",()=>{this.settingsDialog.open()})),i&&!i.getAttribute("data-bound")&&(i.setAttribute("data-bound","true"),i.addEventListener("click",()=>{this.instructionsDialog.open()}))})()}loadInitialLevel(){const e=this.gameStateManager.getState();this.gameStateManager.loadLevel(e.currentLevel)}updateUI(){this.currentState&&this.currentLevel&&(this.header.update(this.currentState,this.currentLevel),this.levelDialog.update(this.currentState),this.patternDisplay.update(this.currentLevel.pattern,this.currentState.selectedPattern,this.currentState,this.currentState.selectedBlocks),this.gameGrid.update(this.currentLevel,this.currentState.selectedBlocks,this.gameStateManager),!this.currentLevel.isCompleted&&this.currentLevel.blocks.every(e=>e.isSelected)&&this.checkAndMaybeCompleteLevel(),this.currentLevel.isCompleted&&this.showLevelCompleteDialog())}checkAndMaybeCompleteLevel(){const e=this.gameStateManager.getState(),t=this.gameStateManager.getCurrentLevel();if(!t||t.isCompleted)return;const n=t.blocks.every(e=>e.isSelected),i=function(e,t){if(0===t.length)return!1;if(0===e.length)return!1;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}(e.selectedPattern,t.pattern);n&&i&&this.gameStateManager.dispatch({type:"COMPLETE_LEVEL"})}showLevelCompleteDialog(){if(document.querySelector("#level-complete-overlay"))return;const e=document.createElement("div");e.id="level-complete-overlay",e.style.cssText="\n        position: fixed;\n        inset: 0;\n        background: rgba(0,0,0,0.4);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        z-index: 1000;\n      ";const t=document.createElement("div");t.style.cssText="\n        background: #2ecc71;\n        color: white;\n        padding: 24px 28px;\n        border-radius: 12px;\n        font-size: 22px;\n        font-weight: bold;\n        box-shadow: 0 4px 20px rgba(0,0,0,0.3);\n        display: flex;\n        flex-direction: column;\n        gap: 16px;\n        min-width: 260px;\n        text-align: center;\n      ";const n=document.createElement("div");n.textContent="üéâ Level Complete!";const i=document.createElement("button");i.className="control-button next-level-button",i.textContent="‚û°Ô∏è Next Level",i.style.cssText="\n        background: white;\n        color: #2ecc71;\n        padding: 10px 14px;\n        border-radius: 8px;\n        font-size: 18px;\n        font-weight: 700;\n        border: none;\n        cursor: pointer;\n      ",i.addEventListener("click",()=>{const e=this.gameStateManager.getState();this.gameStateManager.loadLevel(e.currentLevel+1);const t=document.querySelector("#level-complete-overlay");t&&t.parentElement&&t.parentElement.removeChild(t)}),t.appendChild(n),t.appendChild(i),e.appendChild(t),document.body.appendChild(e)}}document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("app");e&&new E(e)});
