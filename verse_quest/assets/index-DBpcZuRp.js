var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,i=(t,n,s)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[n]=s,o=(e,t)=>{for(var n in t||(t={}))a.call(t,n)&&i(e,n,t[n]);if(s)for(var n of s(t))r.call(t,n)&&i(e,n,t[n]);return e},c=(e,t,n)=>i(e,"symbol"!=typeof t?t+"":t,n),l=(e,t,n)=>new Promise((s,a)=>{var r=e=>{try{o(n.next(e))}catch(t){a(t)}},i=e=>{try{o(n.throw(e))}catch(t){a(t)}},o=e=>e.done?s(e.value):Promise.resolve(e.value).then(r,i);o((n=n.apply(e,t)).next())});function d(...e){console.log(...e)}!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();class h{constructor(e){c(this,"game"),c(this,"currentChapterIndex",0),c(this,"currentSentenceIndex",0),c(this,"furthestUnlockedChapterIndex",0),c(this,"furthestUnlockedSentenceIndex",0),c(this,"listeners",[]),c(this,"STORAGE_KEY","verse-quest-game-state"),c(this,"puzzleStates",{}),this.game=e,this.loadGameState()}getCurrentChapter(){return this.game.chapters[this.currentChapterIndex]}getCurrentSentence(){return this.getCurrentChapter().sentences[this.currentSentenceIndex]}getCurrentSentenceIndex(){return this.currentSentenceIndex}getCurrentChapterIndex(){return this.currentChapterIndex}getTotalSentences(){return this.getCurrentChapter().sentences.length}getTotalChapters(){return this.game.chapters.length}nextSentence(){const e=this.getCurrentChapter();return this.currentSentenceIndex<e.sentences.length-1&&(this.currentSentenceIndex++,this.puzzleStates={},this.saveGameState(),this.notifyListeners(),!0)}nextChapter(){return this.currentChapterIndex<this.game.chapters.length-1&&(this.currentChapterIndex++,this.currentSentenceIndex=0,this.puzzleStates={},this.saveGameState(),this.notifyListeners(),!0)}goToChapter(e){return!!(this.isChapterUnlocked(e)&&e>=0&&e<this.game.chapters.length)&&(this.currentChapterIndex=e,this.currentSentenceIndex=0,this.puzzleStates={},this.saveGameState(),this.notifyListeners(),!0)}goToSentence(e,t){return!!(this.isSentenceUnlocked(e,t)&&e>=0&&e<this.game.chapters.length&&t>=0&&t<this.game.chapters[e].sentences.length)&&(this.currentChapterIndex=e,this.currentSentenceIndex=t,this.puzzleStates={},this.saveGameState(),this.notifyListeners(),!0)}isGameComplete(){return this.currentChapterIndex>=this.game.chapters.length-1&&this.currentSentenceIndex>=this.getCurrentChapter().sentences.length-1}subscribe(e){this.listeners.push(e)}notifyListeners(){this.listeners.forEach(e=>e())}isChapterUnlocked(e){return e<=this.furthestUnlockedChapterIndex}isSentenceUnlocked(e,t){return e<this.furthestUnlockedChapterIndex||e===this.furthestUnlockedChapterIndex&&t<=this.furthestUnlockedSentenceIndex}updateFurthestUnlocked(e,t){(e>this.furthestUnlockedChapterIndex||e===this.furthestUnlockedChapterIndex&&t>this.furthestUnlockedSentenceIndex)&&(this.furthestUnlockedChapterIndex=e,this.furthestUnlockedSentenceIndex=t,d(`Furthest unlocked updated to chapter ${e}, sentence ${t}`))}markSentenceCompleted(e,t){this.updateFurthestUnlocked(e,t);if(t===this.game.chapters[e].sentences.length-1){const t=e+1;t<this.game.chapters.length&&(d(`Last sentence of chapter ${e} completed, unlocking first sentence of chapter ${t}`),this.updateFurthestUnlocked(t,0))}this.saveGameState()}isSentenceCompleted(e,t){return e<this.furthestUnlockedChapterIndex||e===this.furthestUnlockedChapterIndex&&t<this.furthestUnlockedSentenceIndex}isChapterCompleted(e){if(e<this.furthestUnlockedChapterIndex)return!0;if(e===this.furthestUnlockedChapterIndex){const t=this.game.chapters[e].sentences.length;return this.furthestUnlockedSentenceIndex>=t-1}return!1}getUnlockedChapters(){const e=[];for(let t=0;t<=this.furthestUnlockedChapterIndex;t++)e.push(t);return e}getCompletedSentences(e){const t=[];if(e<this.furthestUnlockedChapterIndex){const n=this.game.chapters[e].sentences.length;for(let e=0;e<n;e++)t.push(e)}else if(e===this.furthestUnlockedChapterIndex)for(let n=0;n<this.furthestUnlockedSentenceIndex;n++)t.push(n);return t}getFurthestUnlockedLevel(){return{chapterIndex:this.furthestUnlockedChapterIndex,sentenceIndex:this.furthestUnlockedSentenceIndex}}goToFurthestUnlockedLevel(){const e=this.getFurthestUnlockedLevel();return this.goToSentence(e.chapterIndex,e.sentenceIndex)}saveGameState(){const e=this.getCurrentSentenceId(),t=this.puzzleStates[e],n={currentChapterIndex:this.currentChapterIndex,currentSentenceIndex:this.currentSentenceIndex,furthestUnlockedChapterIndex:this.furthestUnlockedChapterIndex,furthestUnlockedSentenceIndex:this.furthestUnlockedSentenceIndex,puzzleStates:void 0!==t?{[e]:t}:{}};try{localStorage.setItem(this.STORAGE_KEY,JSON.stringify(n)),d("Game state saved:",n)}catch(s){console.warn("Failed to save game state:",s)}}loadGameState(){try{const e=localStorage.getItem(this.STORAGE_KEY);if(e){const t=JSON.parse(e);if(d("Loading game state:",t),this.isNewFormat(t)){const e=t;this.isValidGameState(e)?(this.loadNewFormatGameState(e),d("Game state loaded successfully (new format). Furthest unlocked:",this.furthestUnlockedChapterIndex,this.furthestUnlockedSentenceIndex)):console.warn("Invalid new format game state, using defaults")}else if(this.isLegacyFormat(t)){const e=t;this.isValidLegacyGameState(e)?(this.migrateLegacyGameState(e),d("Game state migrated successfully from legacy format. Furthest unlocked:",this.furthestUnlockedChapterIndex,this.furthestUnlockedSentenceIndex)):console.warn("Invalid legacy game state, using defaults")}else console.warn("Unknown game state format, using defaults")}}catch(e){console.warn("Failed to load game state:",e)}}isNewFormat(e){return"number"==typeof e.furthestUnlockedChapterIndex&&"number"==typeof e.furthestUnlockedSentenceIndex}isLegacyFormat(e){return Array.isArray(e.unlockedChapters)&&"object"==typeof e.completedSentences}loadNewFormatGameState(e){this.currentChapterIndex=e.currentChapterIndex,this.currentSentenceIndex=e.currentSentenceIndex,this.furthestUnlockedChapterIndex=e.furthestUnlockedChapterIndex,this.furthestUnlockedSentenceIndex=e.furthestUnlockedSentenceIndex;const t=e.puzzleStates||{},n=this.getCurrentSentenceId();this.puzzleStates=void 0!==t[n]?{[n]:t[n]}:{}}migrateLegacyGameState(e){if(this.currentChapterIndex=e.currentChapterIndex,this.currentSentenceIndex=e.currentSentenceIndex,e.unlockedChapters.length>0?this.furthestUnlockedChapterIndex=Math.max(...e.unlockedChapters):this.furthestUnlockedChapterIndex=0,this.furthestUnlockedSentenceIndex=0,e.completedSentences[this.furthestUnlockedChapterIndex]){const t=e.completedSentences[this.furthestUnlockedChapterIndex];t.length>0&&(this.furthestUnlockedSentenceIndex=Math.max(...t))}this.puzzleStates=e.puzzleStates||{},this.saveGameState(),d("Migrated from legacy format:",{unlockedChapters:e.unlockedChapters,completedSentences:e.completedSentences,migratedTo:{furthestUnlockedChapterIndex:this.furthestUnlockedChapterIndex,furthestUnlockedSentenceIndex:this.furthestUnlockedSentenceIndex}})}isValidGameState(e){if("number"!=typeof e.currentChapterIndex||"number"!=typeof e.currentSentenceIndex||"number"!=typeof e.furthestUnlockedChapterIndex||"number"!=typeof e.furthestUnlockedSentenceIndex)return!1;if(e.currentChapterIndex<0||e.currentChapterIndex>=this.game.chapters.length)return!1;const t=this.game.chapters[e.currentChapterIndex];if(e.currentSentenceIndex<0||e.currentSentenceIndex>=t.sentences.length)return!1;if(e.furthestUnlockedChapterIndex<0||e.furthestUnlockedChapterIndex>=this.game.chapters.length)return!1;const n=this.game.chapters[e.furthestUnlockedChapterIndex];return!(e.furthestUnlockedSentenceIndex<0||e.furthestUnlockedSentenceIndex>=n.sentences.length)}isValidLegacyGameState(e){if("number"!=typeof e.currentChapterIndex||"number"!=typeof e.currentSentenceIndex||!Array.isArray(e.unlockedChapters)||"object"!=typeof e.completedSentences)return!1;if(e.currentChapterIndex<0||e.currentChapterIndex>=this.game.chapters.length)return!1;const t=this.game.chapters[e.currentChapterIndex];return!(e.currentSentenceIndex<0||e.currentSentenceIndex>=t.sentences.length)&&!!e.unlockedChapters.every(e=>"number"==typeof e&&e>=0&&e<this.game.chapters.length)}getCurrentSentenceId(){return this.getCurrentSentence().id}getPuzzleState(e){return this.puzzleStates[e]}setPuzzleState(e,t){this.puzzleStates[e]=t,this.saveGameState()}clearPuzzleState(e){void 0!==this.puzzleStates[e]&&(delete this.puzzleStates[e],this.saveGameState())}resetGame(){this.currentChapterIndex=0,this.currentSentenceIndex=0,this.furthestUnlockedChapterIndex=0,this.furthestUnlockedSentenceIndex=0,this.puzzleStates={},this.saveGameState(),this.notifyListeners()}testMigration(){{const e={currentChapterIndex:2,currentSentenceIndex:5,unlockedChapters:[0,1,2,3],completedSentences:{0:[0,1,2,3,4,5,6,7,8,9],1:[0,1,2,3,4,5,6,7,8,9],2:[0,1,2,3,4],3:[]},puzzleStates:{"test-sentence":{test:"data"}}};d("Testing migration with legacy state:",e),this.migrateLegacyGameState(e),d("Migration result:",{furthestUnlockedChapterIndex:this.furthestUnlockedChapterIndex,furthestUnlockedSentenceIndex:this.furthestUnlockedSentenceIndex})}}}class u{constructor(e,t,n,s,a,r=!0,i){c(this,"container"),c(this,"overlay"),c(this,"dialogElement"),c(this,"allowClose"),c(this,"currentAudio",null),this.container=e,this.allowClose=r,this.createDialog(t,n,s,a,i)}createDialog(e,t,n,s,a){this.overlay=document.createElement("div"),this.overlay.className="dialog-overlay",this.dialogElement=document.createElement("div"),this.dialogElement.className="dialog";let r="";s&&s.length>0&&(r=`\n                <div class="correct-combination">\n                    <p class="combination-label">Correct combination:</p>\n                    <div class="combination-emojis">\n                        ${s.map(e=>`<span class="combination-emoji">${e}</span>`).join("")}\n                    </div>\n                </div>\n            `);let i="";if(a){let e="";a.translation&&(e=`\n                    <p class="sentence-translation">"${a.translation}"</p>\n                `);let t="";if(void 0!==a.chapterIndex){t=`\n                    <button class="play-button" data-audio-url="${`https://webdosya.diyanet.gov.tr/kuran/kuranikerim/Sound/${"ar_osmanSahin"}/${a.chapterIndex}_${a.sentenceId}.mp3`}" title="Play Audio">\n                        <span class="speaker-icon">üîä</span>\n                    </button>\n                `}i=`\n                <div class="sentence-display">\n                    <div class="sentence-label-container">\n                        <p class="sentence-label">${a.chapterName} - ${a.sentenceId}</p>\n                        ${t}\n                    </div>\n                    <p class="sentence-text">"${a.sentenceText}"</p>\n                    ${e}\n                </div>\n            `}this.dialogElement.innerHTML=`\n            ${this.allowClose?'<button class="dialog-close" id="dialog-close">√ó</button>':""}\n            <div class="dialog-content">\n                <p class="dialog-message">${e}</p>\n                ${i}\n                ${r}\n                <button class="dialog-button">${t}</button>\n            </div>\n        `;if(this.dialogElement.querySelector(".dialog-button").addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),n()}),this.allowClose){this.dialogElement.querySelector(".dialog-close").addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),this.close()})}const o=this.dialogElement.querySelector(".play-button");o&&o.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),this.playAudio(o)}),this.overlay.appendChild(this.dialogElement),this.container.appendChild(this.overlay),setTimeout(()=>{this.overlay.classList.add("show")},10)}close(){this.overlay.classList.remove("show"),setTimeout(()=>{this.overlay.parentNode&&this.overlay.parentNode.removeChild(this.overlay)},300)}forceClose(){this.close()}playAudio(e){const t=e.getAttribute("data-audio-url");if(!t)return;const n=e.querySelector(".speaker-icon");if(this.currentAudio&&!this.currentAudio.paused)return this.currentAudio.pause(),this.currentAudio.currentTime=0,this.currentAudio=null,n.textContent="üîä",void(e.title="Play Audio");n.textContent="‚èπ",e.title="Loading...",e.disabled=!0;const s=new Audio(t);this.currentAudio=s,s.addEventListener("loadstart",()=>{e.title="Loading..."}),s.addEventListener("canplay",()=>{e.title="Playing - Click to stop",e.disabled=!1}),s.addEventListener("ended",()=>{n.textContent="üîä",e.title="Play Audio",this.currentAudio=null}),s.addEventListener("error",()=>{n.textContent="üîä",e.title="Error - Try Again",e.disabled=!1,this.currentAudio=null}),s.play().catch(t=>{console.error("Error playing audio:",t),n.textContent="üîä",e.title="Error - Try Again",e.disabled=!1,this.currentAudio=null})}}const p=new Map;const g=class e{constructor(){c(this,"audioContext",null),c(this,"isEnabled",!0),this.initializeAudioContext()}static getInstance(){return e.instance||(e.instance=new e),e.instance}initializeAudioContext(){try{const e=()=>{this.audioContext||(this.audioContext=new(window.AudioContext||window.webkitAudioContext)),document.removeEventListener("click",e),document.removeEventListener("keydown",e)};document.addEventListener("click",e),document.addEventListener("keydown",e)}catch(e){console.warn("Audio context not supported:",e)}}setEnabled(e){this.isEnabled=e}isSoundEnabled(){return this.isEnabled}playCorrectSound(){this.isEnabled&&(this.playTone(800,.1,"sine"),setTimeout(()=>{this.playTone(1e3,.1,"sine")},100))}playIncorrectSound(){this.isEnabled&&(this.playTone(400,.15,"triangle"),setTimeout(()=>{this.playTone(300,.15,"triangle")},150))}playTone(e,t,n="sine"){if(this.audioContext||(this.initializeAudioContext(),this.audioContext))try{"suspended"===this.audioContext.state&&this.audioContext.resume();const s=this.audioContext.createOscillator(),a=this.audioContext.createGain();s.connect(a),a.connect(this.audioContext.destination),s.frequency.setValueAtTime(e,this.audioContext.currentTime),s.type=n,a.gain.setValueAtTime(0,this.audioContext.currentTime),a.gain.linearRampToValueAtTime(.1,this.audioContext.currentTime+.01),a.gain.linearRampToValueAtTime(0,this.audioContext.currentTime+t),s.start(this.audioContext.currentTime),s.stop(this.audioContext.currentTime+t)}catch(s){console.warn("Error playing sound:",s)}}isSupported(){return!(!window.AudioContext&&!window.webkitAudioContext)}};c(g,"instance",null);let m=g;class S{constructor(){c(this,"container",null),c(this,"onComplete",null),c(this,"onStateChange",null),c(this,"currentState",{}),c(this,"words",[]),c(this,"puzzleWords",[]),c(this,"correctWords",[]),c(this,"currentWordIndex",0),c(this,"selectedTranslations",[]),c(this,"remainingWords",[]),c(this,"optionsPerWord",4),c(this,"wrongAnswerBehavior","restart"),c(this,"speakCurrentWord"),c(this,"soundFeedback")}mount(e,t,n){var s,a,r;this.container=e,this.onComplete=n,this.onStateChange=t.onStateChange,this.soundFeedback=m.getInstance(),this.words=t.originals||[],this.puzzleWords=[...t.puzzleWords||[]],this.correctWords=[...t.correctWords||[]],this.currentWordIndex=(null==(s=t.initialState)?void 0:s.currentWordIndex)||0,this.selectedTranslations=(null==(a=t.initialState)?void 0:a.selectedTranslations)||[],this.optionsPerWord="all"===t.optionsPerWord?"all":Number(t.optionsPerWord||4),this.wrongAnswerBehavior=t.wrongAnswerBehavior||"restart",this.speakCurrentWord=t.speakCurrentWord;const i=this.getCurrentSentenceWords();if((null==(r=t.initialState)?void 0:r.remainingWords)&&(this.currentWordIndex>0||this.selectedTranslations.length>0))this.remainingWords=t.initialState.remainingWords;else{const e=[...i].sort(()=>Math.random()-.5);this.remainingWords=this.limitOptions(e)}this.render(),this.speakCurrentWordIfEnabled()}unmount(){this.container&&(this.container.innerHTML=""),this.container=null,this.onComplete=null,this.onStateChange=null}render(){this.container&&(this.container.innerHTML=`\n            <div class="word-translation-puzzle">\n                <div class="arabic-text">\n                    <p class="verse-text">\n                        ${this.words.map((e,t)=>t<this.currentWordIndex?`<span class="completed-word">${e}</span>`:t===this.currentWordIndex?`<span class="current-word">${e}</span>`:`<span class="future-word">${e}</span>`).join(" ")}\n                    </p>\n                </div>\n\n                <div class="selected-translations">\n                    <div class="selected-container">\n                        ${this.selectedTranslations.map(e=>`\n                            <span class="selected-translation">${e}</span>\n                        `).join("")}\n                    </div>\n                </div>\n\n                <div class="translation-grid">\n                    <div class="grid-container">\n                        ${this.remainingWords.map(e=>{const t="all"===this.optionsPerWord&&this.selectedTranslations.includes(e);return`<button class="translation-button${t?" selected-correct":""}" data-word="${e}" ${t?"disabled":""}>${t?`<span class="strike">${e}</span>`:e}</button>`}).join("")}\n                    </div>\n                </div>\n\n            </div>\n        `,this.setupEventListeners())}setupEventListeners(){if(!this.container)return;this.container.querySelectorAll(".translation-button").forEach(e=>{e.addEventListener("click",e=>{const t=e.target,n=(t.closest&&t.closest("button")||t).getAttribute("data-word");n&&this.selectTranslation(n)})})}selectTranslation(e){const t=this.correctWords[this.currentWordIndex];if(e===t)if(this.soundFeedback.playCorrectSound(),"all"===this.optionsPerWord||(this.remainingWords=this.remainingWords.filter(t=>t!==e)),this.selectedTranslations.push(e),this.currentWordIndex++,this.saveState(),this.currentWordIndex>=this.words.length)this.onComplete&&this.onComplete({correct:!0,selectedTranslations:this.selectedTranslations,correctWords:this.correctWords});else{if(this.speakCurrentWordIfEnabled(),"all"!==this.optionsPerWord){const e=this.getCurrentSentenceWords(),t=this.correctWords[this.currentWordIndex],n=e.filter(e=>e!==t).sort(()=>Math.random()-.5),s=Math.max(0,this.optionsPerWord-1),a=[t,...n.slice(0,s)].sort(()=>Math.random()-.5);this.remainingWords=a}this.render()}else this.soundFeedback.playIncorrectSound(),this.showErrorFeedback(e),setTimeout(()=>{this.applyWrongAnswerBehavior()},800)}showErrorFeedback(e){if(!this.container)return;const t=this.container.querySelector(`[data-word="${e}"]`);t&&(t.classList.add("wrong-selection"),setTimeout(()=>{t.classList.remove("wrong-selection")},1e3));const n=this.correctWords[this.currentWordIndex],s=this.container.querySelector(`[data-word="${n}"]`);s&&(s.classList.add("flash-correct"),setTimeout(()=>{s.classList.remove("flash-correct")},800))}clearSelection(){this.selectedTranslations=[],this.currentWordIndex=0;const e=this.getCurrentSentenceWords();if("all"===this.optionsPerWord){const t=this.remainingWords.filter(t=>e.includes(t)),n=new Set(t),s=e.filter(e=>!n.has(e));this.remainingWords=[...t,...s]}else{const t=[...e].sort(()=>Math.random()-.5);this.remainingWords=this.limitOptions(t)}this.saveState(),this.render(),this.speakCurrentWordIfEnabled()}applyWrongAnswerBehavior(){if("none"!==this.wrongAnswerBehavior){if("back4"===this.wrongAnswerBehavior){const e=Math.max(0,this.currentWordIndex-4);if(this.selectedTranslations=this.selectedTranslations.slice(0,e),this.currentWordIndex=e,"all"===this.optionsPerWord){const e=this.getCurrentSentenceWords(),t=new Set(e),n=this.remainingWords.filter(e=>t.has(e)),s=e.filter(e=>!n.includes(e));this.remainingWords=[...n,...s]}else{const e=this.getCurrentSentenceWords(),t=this.correctWords[this.currentWordIndex],n=e.filter(e=>e!==t).sort(()=>Math.random()-.5),s=Math.max(0,this.optionsPerWord-1);this.remainingWords=[t,...n.slice(0,s)].sort(()=>Math.random()-.5)}return this.saveState(),this.render(),void this.speakCurrentWordIfEnabled()}this.clearSelection()}}getCurrentSentenceWords(){const e=this.puzzleWords.filter(e=>this.correctWords.includes(e));return[...new Set(e)]}limitOptions(e){if("all"===this.optionsPerWord)return e;const t=this.correctWords[this.currentWordIndex],n=e.filter(e=>e!==t).sort(()=>Math.random()-.5),s=Math.max(0,this.optionsPerWord-1);return[t,...n.slice(0,s)].sort(()=>Math.random()-.5)}saveState(){this.currentState={currentWordIndex:this.currentWordIndex,selectedTranslations:this.selectedTranslations,remainingWords:this.remainingWords},this.onStateChange&&this.onStateChange(this.currentState)}speakCurrentWordIfEnabled(){this.speakCurrentWord&&this.words.length>0&&this.currentWordIndex<this.words.length&&this.speakCurrentWord(this.currentWordIndex)}}let C=!1;function f(){var e,t;C||(e="word-translation-grid",t=()=>new S,p.set(e,t),C=!0)}const v="verse-quest-settings",x={optionsPerWord:4,playSound:!1,soundFeedback:!0,wrongAnswerBehavior:"restart",language:"turkish"};function k(){try{const e=localStorage.getItem(v);if(!e)return o({},x);const t=JSON.parse(e);return o(o({},x),t)}catch(e){return o({},x)}}const I=class e{constructor(){c(this,"currentAudio",null)}static getInstance(){return e.instance||(e.instance=new e),e.instance}speakWord(e,t,n,s){this.stop();const a=n+1,r=`https://audio.qurancdn.com/wbw/${e.toString().padStart(3,"0")}_${t.toString().padStart(3,"0")}_${a.toString().padStart(3,"0")}.mp3`;this.currentAudio=new Audio(r),this.currentAudio.onended=()=>{this.currentAudio=null,s&&s()},this.currentAudio.onerror=e=>{console.warn("Audio playback error:",e),this.currentAudio=null,s&&s()},this.currentAudio.play().catch(e=>{console.warn("Failed to play audio:",e),this.currentAudio=null,s&&s()})}speak(e,t){console.warn("speak() method is deprecated. Use speakWord() with chapter, sentence, and word indices instead."),t&&t()}stop(){this.currentAudio&&(this.currentAudio.pause(),this.currentAudio.currentTime=0,this.currentAudio=null)}isSupported(){return"Audio"in window}isSpeaking(){return null!==this.currentAudio&&!this.currentAudio.paused&&!this.currentAudio.ended}};c(I,"instance",null);let y=I;class b{constructor(e,t){c(this,"gameState"),c(this,"container"),c(this,"dialog",null),c(this,"activePuzzle",{unmount:null}),c(this,"settings",k()),c(this,"soundFeedback"),c(this,"appInstance"),f(),this.gameState=e,this.soundFeedback=m.getInstance(),this.soundFeedback.setEnabled(this.settings.soundFeedback),this.appInstance=t}render(e){this.container=e,this.gameState.subscribe(()=>this.renderGame()),this.renderGame()}renderGame(){const e=this.gameState.getCurrentChapter();e&&this.gameState.game.chapters.length?(this.container.innerHTML=`\n            <div class="game-container">\n                <header class="game-header">\n                    <div class="header-top">\n                        <h1 class="clickable-title" id="chapter-title">\n                            ${e.name} \n                            <span class="progress-in-title">(${this.gameState.getCurrentSentenceIndex()+1}/${this.gameState.getTotalSentences()})</span>\n                        </h1>\n                    </div>\n                    <button id="settings-button" class="settings-button" aria-label="Settings">‚öôÔ∏è</button>\n                    <div class="chapter-navigation" id="chapter-navigation" style="display: none;">\n                        <div class="chapter-navigation-content">\n                            <button class="chapter-nav-close" id="chapter-nav-close">√ó</button>\n                            ${this.renderChapterNavigation()}\n                        </div>\n                    </div>\n                </header>\n                \n                <main class="game-main">\n                    <div class="puzzle-container">\n                        <div class="puzzle-host"></div>\n                    </div>\n                </main>\n                \n                <div class="version-display">v1.3.0</div>\n            </div>\n        `,this.setupEventListeners(),this.setupPuzzle()):this.container.innerHTML='<div class="loading"><div class="spinner"></div>Loading game data...</div>'}renderChapterNavigation(){const e=this.gameState.game.chapters,t=this.gameState.getUnlockedChapters(),n=this.gameState.getCurrentChapterIndex();return`\n            <div class="chapters-list">\n                <h3>${this.gameState.game.config.ui.chapterListTitle}</h3>\n                \n                <div class="chapters-grid">\n                    ${e.map((e,s)=>{const a=t.includes(s),r=s===n,i=this.gameState.getCompletedSentences(s),o=e.sentences.length,c=i.length,l=!r;return`\n                            <div class="chapter-item ${a?"unlocked":"locked"} ${r?"current":""} ${this.gameState.isChapterCompleted(s)?"completed":""}" \n                                 data-chapter-index="${s}">\n                                <div class="chapter-header" ${a?`data-collapsible="true" data-chapter-index="${s}"`:""}>\n                                    <h4>${e.name}</h4>\n                                    <div class="chapter-header-right">\n                                        ${a?`<span class="progress-badge">${c}/${o}</span>`:'<span class="lock-icon">üîí</span>'}\n                                    </div>\n                                </div>\n                                <p class="chapter-description">${e.description}</p>\n                                ${a?`<div class="chapter-content ${l?"collapsed":"expanded"}">${this.renderChapterSentences(s,i)}</div>`:""}\n                            </div>\n                        `}).join("")}\n                </div>\n            </div>\n        `}renderChapterSentences(e,t){const n=this.gameState.game.chapters[e],s=this.gameState.getCurrentChapterIndex(),a=this.gameState.getCurrentSentenceIndex();return`\n            <div class="sentences-list">\n                ${n.sentences.map((n,r)=>{const i=t.includes(r),o=e===s&&r===a,c=this.gameState.isChapterUnlocked(e),l=r>0&&t.includes(r-1);let d=0===r&&c||l||i;return o&&(d=!0),`\n                        <div class="sentence-item ${i?"completed":""} ${d?"unlocked":"locked"} ${o?"current":""}" \n                             data-chapter-index="${e}" \n                             data-sentence-index="${r}">\n                            <span class="sentence-number">${n.id}</span>\n                            <span class="sentence-preview">${n.sentence.substring(0,50)}${n.sentence.length>50?"...":""}</span>\n                            ${i?'<span class="checkmark">‚úì</span>':""}\n                        </div>\n                    `}).join("")}\n            </div>\n        `}setupEventListeners(){const e=this.container.querySelector("#chapter-title"),t=this.container.querySelector("#chapter-navigation"),n=this.container.querySelector("#chapter-nav-close");e&&t&&e.addEventListener("click",()=>{t.style.display="flex"}),n&&t&&n.addEventListener("click",()=>{t.style.display="none"}),t&&t.addEventListener("click",e=>{e.target===t&&(t.style.display="none")});const s=this.container.querySelector("#settings-button");s&&s.addEventListener("click",()=>this.openSettingsDialog()),this.setupChapterNavigation()}setupChapterNavigation(){this.container.querySelectorAll('.chapter-header[data-collapsible="true"]').forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation();const n=parseInt(e.getAttribute("data-chapter-index")||"0"),s=this.container.querySelector(`[data-chapter-index="${n}"]`),a=null==s?void 0:s.querySelector(".chapter-content");if(a){a.classList.contains("collapsed")?(a.classList.remove("collapsed"),a.classList.add("expanded")):(a.classList.remove("expanded"),a.classList.add("collapsed"))}})});this.container.querySelectorAll(".sentence-item.unlocked").forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation();const n=parseInt(e.getAttribute("data-chapter-index")||"0"),s=parseInt(e.getAttribute("data-sentence-index")||"0");this.gameState.goToSentence(n,s);const a=this.container.querySelector("#chapter-navigation");a&&(a.style.display="none"),this.dialog&&(this.dialog.forceClose(),this.dialog=null)})})}setupPuzzle(){var e,s,a;const r=this.container.querySelector(".puzzle-host");if(!r)return;this.activePuzzle.unmount&&(this.activePuzzle.unmount(),this.activePuzzle.unmount=null);const i=this.gameState.getCurrentSentence(),c=(null==(e=i.puzzle)?void 0:e.type)||"word-translation-grid";let l={};if("word-translation-grid"===c){const e=this.gameState.getCurrentChapter().sentences.filter(e=>e.translations).flatMap(e=>e.translations);l={config:(null==(s=i.puzzle)?void 0:s.config)||{},originals:i.originals||[],translations:i.translations||[],puzzleWords:e,correctWords:i.translations||[]}}const d=o(o({},l),(null==(a=i.puzzle)?void 0:a.config)||{});if("word-translation-grid"===c&&void 0===d.title&&(d.title=this.gameState.game.config.ui.title),this.settings.playSound){const e=this.gameState.getCurrentChapter(),t=this.gameState.getCurrentSentence();d.speakCurrentWord=n=>{!function(e,t,n,s){const a=y.getInstance();a.isSupported()?a.speakWord(e,t,n,s):console.warn("Audio playback is not supported in this browser")}(e.index,parseInt(t.id),n)}}const h=function(e){const t=p.get(e);if(!t)throw new Error(`Unknown puzzle type: ${e}`);return t()}(c),u=i.id,g=this.gameState.getPuzzleState(u);var m,S;h.mount(r,(m=o({},d),S={initialState:g,onStateChange:e=>{this.gameState.setPuzzleState(u,e)},optionsPerWord:this.settings.optionsPerWord,wrongAnswerBehavior:this.settings.wrongAnswerBehavior},t(m,n(S))),e=>{const t=this.gameState.getCurrentChapterIndex(),n=this.gameState.getCurrentSentenceIndex();this.gameState.clearPuzzleState(u),this.gameState.markSentenceCompleted(t,n),this.showCompletionDialog(null==e?void 0:e.correct)}),this.activePuzzle.unmount=()=>h.unmount()}showCompletionDialog(e){const t=this.gameState.getCurrentSentenceIndex()===this.gameState.getTotalSentences()-1,n=this.gameState.getCurrentChapterIndex()===this.gameState.getTotalChapters()-1,s=this.gameState.getCurrentSentence(),a=this.gameState.getCurrentChapter(),r=this.gameState.game.config.messages,i=r.encouraging;let o=i[Math.floor(Math.random()*i.length)],c=r.buttons.nextVerse;t&&n?(o=r.lastVerseLastChapter,c=r.buttons.playAgain):t&&(o=r.lastVerse,c=r.buttons.nextChapter);const l={chapterIndex:a.index,chapterName:a.name,sentenceId:s.id,sentenceText:s.sentence,translation:s.translation};this.dialog=new u(this.container,o,c,()=>this.proceedToNext(),e,!1,l)}proceedToNext(){const e=this.gameState.getCurrentSentenceIndex()===this.gameState.getTotalSentences()-1,t=this.gameState.getCurrentChapterIndex()===this.gameState.getTotalChapters()-1;!(e&&t)&&this.dialog&&(this.dialog.close(),this.dialog=null),e&&t?this.gameState.resetGame():e?this.gameState.nextChapter():this.gameState.nextSentence()}openSettingsDialog(){const e=document.createElement("div");e.className="chapter-navigation",e.style.display="flex";const t=document.createElement("div");t.className="chapter-navigation-content";const n=document.createElement("button");n.className="chapter-nav-close",n.textContent="√ó";const s=document.createElement("h3");s.textContent=this.gameState.game.config.settings.title;const a=document.createElement("form");a.className="settings-form";const r=document.createElement("fieldset"),i=document.createElement("legend");i.textContent=this.gameState.game.config.settings.language.title,r.appendChild(i);[{value:"turkish",label:this.gameState.game.config.settings.language.options.turkish},{value:"english",label:this.gameState.game.config.settings.language.options.english}].forEach(e=>{const t=document.createElement("label");t.className="settings-radio";const n=document.createElement("input");n.type="radio",n.name="language",n.value=e.value,this.settings.language===e.value&&(n.checked=!0);const s=document.createElement("span");s.textContent=e.label,t.appendChild(n),t.appendChild(s),r.appendChild(t)}),a.appendChild(r);const o=document.createElement("fieldset"),c=document.createElement("legend");c.textContent=this.gameState.game.config.settings.optionsPerWord.title,o.appendChild(c);[{value:2,label:this.gameState.game.config.settings.optionsPerWord.options.two},{value:4,label:this.gameState.game.config.settings.optionsPerWord.options.four},{value:6,label:this.gameState.game.config.settings.optionsPerWord.options.six},{value:8,label:this.gameState.game.config.settings.optionsPerWord.options.eight},{value:"all",label:this.gameState.game.config.settings.optionsPerWord.options.all}].forEach(e=>{const t=document.createElement("label");t.className="settings-radio";const n=document.createElement("input");n.type="radio",n.name="optionsPerWord",n.value=String(e.value),this.settings.optionsPerWord===e.value&&(n.checked=!0);const s=document.createElement("span");s.textContent=e.label,t.appendChild(n),t.appendChild(s),o.appendChild(t)}),a.appendChild(o);const d=document.createElement("fieldset"),h=document.createElement("legend");h.textContent=this.gameState.game.config.settings.audio.title,d.appendChild(h);const u=document.createElement("label");u.className="settings-checkbox";const p=document.createElement("input");p.type="checkbox",p.name="playSound",p.checked=this.settings.playSound;const g=document.createElement("span");g.textContent=this.gameState.game.config.settings.audio.readWord,u.appendChild(p),u.appendChild(g),d.appendChild(u);const m=document.createElement("label");m.className="settings-checkbox";const S=document.createElement("input");S.type="checkbox",S.name="soundFeedback",S.checked=this.settings.soundFeedback;const C=document.createElement("span");C.textContent=this.gameState.game.config.settings.audio.soundFeedback,m.appendChild(S),m.appendChild(C),d.appendChild(m),a.appendChild(d);const f=document.createElement("fieldset"),x=document.createElement("legend");x.textContent=this.gameState.game.config.settings.wrongAnswer.title,f.appendChild(x);[{value:"restart",label:this.gameState.game.config.settings.wrongAnswer.restart},{value:"back4",label:this.gameState.game.config.settings.wrongAnswer.back4},{value:"none",label:this.gameState.game.config.settings.wrongAnswer.none}].forEach(e=>{const t=document.createElement("label");t.className="settings-radio";const n=document.createElement("input");n.type="radio",n.name="wrongAnswerBehavior",n.value=String(e.value),this.settings.wrongAnswerBehavior===e.value&&(n.checked=!0);const s=document.createElement("span");s.textContent=e.label,t.appendChild(n),t.appendChild(s),f.appendChild(t)}),a.appendChild(f);const k=document.createElement("div");k.className="dialog-actions";const I=document.createElement("button");I.type="button",I.className="button-secondary",I.textContent=this.gameState.game.config.settings.buttons.cancel;const y=document.createElement("button");y.type="button",y.className="button-primary",y.textContent=this.gameState.game.config.settings.buttons.save,k.appendChild(I),k.appendChild(y),t.appendChild(n),t.appendChild(s),t.appendChild(a),t.appendChild(k),e.appendChild(t);const b=()=>{e.style.display="none",e.parentNode&&e.parentNode.removeChild(e)};e.addEventListener("click",t=>{t.target===e&&b()}),n.addEventListener("click",()=>b()),I.addEventListener("click",()=>b()),y.addEventListener("click",()=>l(this,null,function*(){var e,t,n,s,r;const i=null==(e=a.querySelector('input[name="optionsPerWord"]:checked'))?void 0:e.value,o="all"===i?"all":Number(i),c=(null==(t=a.querySelector('input[name="playSound"]'))?void 0:t.checked)||!1,l=(null==(n=a.querySelector('input[name="soundFeedback"]'))?void 0:n.checked)||!1,d=(null==(s=a.querySelector('input[name="wrongAnswerBehavior"]:checked'))?void 0:s.value)||"restart",h=(null==(r=a.querySelector('input[name="language"]:checked'))?void 0:r.value)||"turkish",u=this.settings.language!==h;this.settings={optionsPerWord:o,playSound:c,soundFeedback:l,wrongAnswerBehavior:d,language:h},function(e){try{localStorage.setItem(v,JSON.stringify(e))}catch(t){}}(this.settings),this.soundFeedback.setEnabled(l),b(),u&&this.appInstance?yield this.appInstance.reloadWithLanguage(h):this.setupPuzzle()})),document.body.appendChild(e)}}function w(e="turkish"){return l(this,null,function*(){try{const n="english"===e?"./game_eng.json":"./game.json",s=yield fetch(n);if(!s.ok)throw new Error(`Failed to load game data: ${s.statusText}`);const a=yield s.json(),r=[];for(const e of a.chapters)try{const t=yield fetch(`./${e}.json`);if(t.ok){const e=yield t.json();r.push(e)}else console.warn(`Failed to load chapter ${e}: ${t.statusText}`)}catch(t){console.error(`Error loading chapter ${e}:`,t)}return{id:a.id,name:a.name,description:a.description,config:a.config,chapters:r}}catch(t){return console.error("Error loading game data:",t),{id:"verse-quest-1",name:"Verse Quest",description:"A journey through emojis and verses",config:{ui:{chapterListTitle:"Chapters",title:"Select the emojis in the correct order:"},messages:{encouraging:["Great job!","Excellent work!","Well done!","Perfect!","Amazing!","Fantastic!","Outstanding!","Brilliant!","Wonderful!","Incredible!","Superb!","Magnificent!","Splendid!","Terrific!","Awesome!","Phenomenal!","Remarkable!","Exceptional!","Marvelous!","Spectacular!"],lastVerseLastChapter:"Congratulations! You have completed the entire journey!",lastVerse:"Chapter complete! Ready for the next chapter?",buttons:{nextVerse:"Next Verse",nextChapter:"Next Chapter",playAgain:"Play Again"}},settings:{title:"Settings",language:{title:"Language",options:{turkish:"T√ºrk√ße",english:"English"}},optionsPerWord:{title:"Number of options per word",options:{two:"2 options",four:"4 options",six:"6 options",eight:"8 options",all:"All options"}},audio:{title:"Audio",readWord:"Read word",soundFeedback:"Sound feedback"},wrongAnswer:{title:"Wrong answer behavior",restart:"Restart from beginning",back4:"Go back 4 words",none:"No penalty"},buttons:{cancel:"Cancel",save:"Save"}}},chapters:[]}}})}document.title="Verse Quest v1.3.0";const E=document.querySelector('meta[name="apple-mobile-web-app-title"]');E&&E.setAttribute("content","Verse Quest v1.3.0");(new class{constructor(){c(this,"gameState",null),c(this,"gameUI",null)}init(){return l(this,null,function*(){try{const e=document.getElementById("app");e&&(e.innerHTML='<div class="loading"><div class="spinner"></div>Loading game data...</div>');const t=k(),n=yield w(t.language);this.gameState=new h(n),this.gameUI=new b(this.gameState,this),e&&this.gameUI.render(e)}catch(e){console.error("Failed to initialize app:",e);const t=document.getElementById("app");t&&(t.innerHTML='<div class="error">Failed to load game. Please refresh the page.</div>')}})}reloadWithLanguage(e){return l(this,null,function*(){try{const t=document.getElementById("app");t&&(t.innerHTML='<div class="loading"><div class="spinner"></div>Loading game data...</div>'),this.gameState=null,this.gameUI=null;const n=yield w(e);this.gameState=new h(n),this.gameUI=new b(this.gameState,this),t&&this.gameUI.render(t)}catch(t){console.error("Failed to reload app with new language:",t);const e=document.getElementById("app");e&&(e.innerHTML='<div class="error">Failed to load game. Please refresh the page.</div>')}})}}).init().catch(e=>{console.error("Failed to initialize app:",e)});
