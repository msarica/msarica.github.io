var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,a=(t,n,s)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[n]=s,r=(e,t)=>{for(var n in t||(t={}))i.call(t,n)&&a(e,n,t[n]);if(s)for(var n of s(t))o.call(t,n)&&a(e,n,t[n]);return e},c=(e,t,n)=>a(e,"symbol"!=typeof t?t+"":t,n),l=(e,t,n)=>new Promise((s,i)=>{var o=e=>{try{r(n.next(e))}catch(t){i(t)}},a=e=>{try{r(n.throw(e))}catch(t){i(t)}},r=e=>e.done?s(e.value):Promise.resolve(e.value).then(o,a);r((n=n.apply(e,t)).next())});function h(...e){console.log(...e)}!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();class d{constructor(e){c(this,"game"),c(this,"currentChapterIndex",0),c(this,"currentSentenceIndex",0),c(this,"unlockedChapters",[0]),c(this,"completedSentences",{}),c(this,"listeners",[]),c(this,"STORAGE_KEY","verse-quest-game-state"),c(this,"puzzleStates",{}),this.game=e,this.loadGameState()}getCurrentChapter(){return this.game.chapters[this.currentChapterIndex]}getCurrentSentence(){return this.getCurrentChapter().sentences[this.currentSentenceIndex]}getCurrentSentenceIndex(){return this.currentSentenceIndex}getCurrentChapterIndex(){return this.currentChapterIndex}getTotalSentences(){return this.getCurrentChapter().sentences.length}getTotalChapters(){return this.game.chapters.length}nextSentence(){const e=this.getCurrentChapter();return this.currentSentenceIndex<e.sentences.length-1&&(this.currentSentenceIndex++,this.puzzleStates={},this.saveGameState(),this.notifyListeners(),!0)}nextChapter(){return this.currentChapterIndex<this.game.chapters.length-1&&(this.currentChapterIndex++,this.currentSentenceIndex=0,this.unlockChapter(this.currentChapterIndex),this.puzzleStates={},this.saveGameState(),this.notifyListeners(),!0)}goToChapter(e){return!!(this.isChapterUnlocked(e)&&e>=0&&e<this.game.chapters.length)&&(this.currentChapterIndex=e,this.currentSentenceIndex=0,this.puzzleStates={},this.saveGameState(),this.notifyListeners(),!0)}goToSentence(e,t){return!!(this.isChapterUnlocked(e)&&e>=0&&e<this.game.chapters.length&&t>=0&&t<this.game.chapters[e].sentences.length)&&(this.currentChapterIndex=e,this.currentSentenceIndex=t,this.puzzleStates={},this.saveGameState(),this.notifyListeners(),!0)}isGameComplete(){return this.currentChapterIndex>=this.game.chapters.length-1&&this.currentSentenceIndex>=this.getCurrentChapter().sentences.length-1}subscribe(e){this.listeners.push(e)}notifyListeners(){this.listeners.forEach(e=>e())}isChapterUnlocked(e){return this.unlockedChapters.includes(e)}getUnlockedChapters(){return[...this.unlockedChapters]}unlockChapter(e){this.unlockedChapters.includes(e)||(this.unlockedChapters.push(e),h(`Chapter ${e} unlocked! Unlocked chapters:`,this.unlockedChapters))}markSentenceCompleted(e,t){this.completedSentences[e]||(this.completedSentences[e]=[]),this.completedSentences[e].includes(t)||(this.completedSentences[e].push(t),h(`Sentence ${t} completed in chapter ${e}`));if(t===this.game.chapters[e].sentences.length-1){const t=e+1;t<this.game.chapters.length&&(h(`Last sentence of chapter ${e} completed, unlocking chapter ${t}`),this.unlockChapter(t))}this.saveGameState()}isSentenceCompleted(e,t){var n;return(null==(n=this.completedSentences[e])?void 0:n.includes(t))||!1}getCompletedSentences(e){return this.completedSentences[e]||[]}getFurthestUnlockedLevel(){const e=this.unlockedChapters.length>0?Math.max(...this.unlockedChapters):0,t=this.getCompletedSentences(e),n=this.game.chapters[e].sentences.length;if(t.length>=n){const t=e+1;return t<this.game.chapters.length&&this.isChapterUnlocked(t)?{chapterIndex:t,sentenceIndex:0}:{chapterIndex:e,sentenceIndex:n-1}}if(0===t.length)return{chapterIndex:e,sentenceIndex:0};const s=Math.max(...t);return{chapterIndex:e,sentenceIndex:Math.min(s+1,n-1)}}goToFurthestUnlockedLevel(){const e=this.getFurthestUnlockedLevel();return this.goToSentence(e.chapterIndex,e.sentenceIndex)}saveGameState(){const e=this.getCurrentSentenceId(),t=this.puzzleStates[e],n={currentChapterIndex:this.currentChapterIndex,currentSentenceIndex:this.currentSentenceIndex,unlockedChapters:this.unlockedChapters,completedSentences:this.completedSentences,puzzleStates:void 0!==t?{[e]:t}:{}};try{localStorage.setItem(this.STORAGE_KEY,JSON.stringify(n)),h("Game state saved:",n)}catch(s){console.warn("Failed to save game state:",s)}}loadGameState(){try{const e=localStorage.getItem(this.STORAGE_KEY);if(e){const t=JSON.parse(e);if(h("Loading game state:",t),this.isValidGameState(t)){this.currentChapterIndex=t.currentChapterIndex,this.currentSentenceIndex=t.currentSentenceIndex,this.unlockedChapters=t.unlockedChapters,this.completedSentences=t.completedSentences;const e=t.puzzleStates||{},n=this.getCurrentSentenceId();this.puzzleStates=void 0!==e[n]?{[n]:e[n]}:{},h("Game state loaded successfully. Unlocked chapters:",this.unlockedChapters)}else console.warn("Invalid game state, using defaults")}}catch(e){console.warn("Failed to load game state:",e)}}isValidGameState(e){if("number"!=typeof e.currentChapterIndex||"number"!=typeof e.currentSentenceIndex||!Array.isArray(e.unlockedChapters)||"object"!=typeof e.completedSentences)return!1;if(e.currentChapterIndex<0||e.currentChapterIndex>=this.game.chapters.length)return!1;const t=this.game.chapters[e.currentChapterIndex];return!(e.currentSentenceIndex<0||e.currentSentenceIndex>=t.sentences.length)&&!!e.unlockedChapters.every(e=>"number"==typeof e&&e>=0&&e<this.game.chapters.length)}getCurrentSentenceId(){return this.getCurrentSentence().id}getPuzzleState(e){return this.puzzleStates[e]}setPuzzleState(e,t){this.puzzleStates[e]=t,this.saveGameState()}clearPuzzleState(e){void 0!==this.puzzleStates[e]&&(delete this.puzzleStates[e],this.saveGameState())}resetGame(){this.currentChapterIndex=0,this.currentSentenceIndex=0,this.unlockedChapters=[0],this.completedSentences={},this.puzzleStates={},this.saveGameState(),this.notifyListeners()}}class u{constructor(e,t,n,s,i,o=!0,a){c(this,"container"),c(this,"overlay"),c(this,"dialogElement"),c(this,"allowClose"),this.container=e,this.allowClose=o,this.createDialog(t,n,s,i,a)}createDialog(e,t,n,s,i){this.overlay=document.createElement("div"),this.overlay.className="dialog-overlay",this.dialogElement=document.createElement("div"),this.dialogElement.className="dialog";let o="";s&&s.length>0&&(o=`\n                <div class="correct-combination">\n                    <p class="combination-label">Correct combination:</p>\n                    <div class="combination-emojis">\n                        ${s.map(e=>`<span class="combination-emoji">${e}</span>`).join("")}\n                    </div>\n                </div>\n            `);let a="";i&&(a=`\n                <div class="sentence-display">\n                    <p class="sentence-label">${i.chapterName} - ${i.sentenceId}</p>\n                    <p class="sentence-text">"${i.sentenceText}"</p>\n                </div>\n            `),this.dialogElement.innerHTML=`\n            ${this.allowClose?'<button class="dialog-close" id="dialog-close">Ã—</button>':""}\n            <div class="dialog-content">\n                <p class="dialog-message">${e}</p>\n                ${a}\n                ${o}\n                <button class="dialog-button">${t}</button>\n            </div>\n        `;if(this.dialogElement.querySelector(".dialog-button").addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),n()}),this.allowClose){this.dialogElement.querySelector(".dialog-close").addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),this.close()})}this.overlay.appendChild(this.dialogElement),this.container.appendChild(this.overlay),setTimeout(()=>{this.overlay.classList.add("show")},10)}close(){this.overlay.classList.remove("show"),setTimeout(()=>{this.overlay.parentNode&&this.overlay.parentNode.removeChild(this.overlay)},300)}forceClose(){this.close()}}const m=new Map;function p(e,t){m.set(e,t)}class g{constructor(e,t,n,s,i){var o,a,r;c(this,"container"),c(this,"correctEmojis"),c(this,"allEmojis"),c(this,"selectedEmojis",[]),c(this,"onComplete"),c(this,"onStateChange"),c(this,"columnElements",[]),c(this,"columnEmojis",[]),c(this,"wheelPositions",[]),c(this,"wheelElements",[]),c(this,"slotHeightPx",40),this.container=e,this.correctEmojis=t,this.allEmojis=n,this.onComplete=s,this.onStateChange=null==i?void 0:i.onStateChange,(null==(o=null==i?void 0:i.initialState)?void 0:o.columnEmojis)&&i.initialState.columnEmojis.length===t.length?this.columnEmojis=i.initialState.columnEmojis:this.columnEmojis=t.map((e,t)=>this.getEmojisForColumn(t)),(null==(a=null==i?void 0:i.initialState)?void 0:a.selectedEmojis)&&i.initialState.selectedEmojis.length===t.length?this.selectedEmojis=i.initialState.selectedEmojis:this.selectedEmojis=this.columnEmojis.map(e=>e[0]),(null==(r=null==i?void 0:i.initialState)?void 0:r.wheelPositions)&&i.initialState.wheelPositions.length===t.length?this.wheelPositions=i.initialState.wheelPositions:this.wheelPositions=new Array(t.length).fill(0),this.render(),this.emitStateChange()}safeMod(e,t){return(e%t+t)%t}render(){this.container.innerHTML="",this.container.className="combination-lock";const e=document.createElement("div");e.className="lock-body";const t=document.createElement("div");t.className="lock-columns";for(let s=0;s<this.correctEmojis.length;s++){const e=this.createLockColumn(s);t.appendChild(e),this.columnElements.push(e)}e.appendChild(t),this.container.appendChild(e);const n=document.createElement("div");n.className="lock-instructions",n.textContent="Swipe up or down on each column to select emojis",this.container.appendChild(n)}createLockColumn(e){const t=document.createElement("div");t.className="lock-column",t.dataset.index=e.toString();const n=document.createElement("div");n.className="lock-wheel",n.dataset.index=e.toString();const s=this.columnEmojis[e];for(let l=0;l<5;l++){const e=document.createElement("div");e.className="emoji-option",e.dataset.index=l.toString();const t=20*l;e.style.top=`${t}%`,e.style.height="20%",n.appendChild(e)}const i=this.wheelPositions[e]||0,o=this.slotHeightPx,a=Math.round(i/o),r=s.length,c=this.safeMod(a,r);return this.updateColumnDisplay(n,c,s),this.wheelElements[e]=n,this.addSwipeListeners(n,e),t.appendChild(n),t}getEmojisForColumn(e){const t=this.correctEmojis[e];return[...[...this.allEmojis.filter(e=>e!==t)].sort(()=>Math.random()-.5).slice(0,4),t].sort(()=>Math.random()-.5)}addSwipeListeners(e,t){if(e.hasListeners)return;let n=0,s=0,i=!1,o=[],a=0,r=0;const c=c=>{i=!0,n="touches"in c?c.touches[0].clientY:c.clientY,s=n,r=performance.now(),a=0,e.classList.add("dragging"),o=this.columnEmojis[t],c.cancelable&&c.preventDefault()},l=n=>{if(!i)return;const o="touches"in n?n.touches[0].clientY:n.clientY,c=performance.now(),l=o-s,h=c-r;h>0&&(a=-l/h),this.wheelPositions[t]-=l;const d=this.columnEmojis[t];d&&d.length>0&&this.updateWheelPosition(e,this.wheelPositions[t],d),s=o,r=c,n.cancelable&&n.preventDefault()},h=()=>{i&&(i=!1,e.classList.remove("dragging"),this.startMomentumAnimation(e,this.wheelPositions[t],a,o,t))};e.addEventListener("touchstart",c,{passive:!1}),e.addEventListener("touchmove",l,{passive:!1}),e.addEventListener("touchend",h),e.addEventListener("mousedown",c),e.addEventListener("mousemove",l),e.addEventListener("mouseup",h),e.addEventListener("mouseleave",h),e.hasListeners=!0}updateWheelPosition(e,t,n){const s=this.slotHeightPx,i=n.length;if(0===i)return;const o=Math.round(t/s),a=this.safeMod(o,i);this.updateColumnDisplay(e,a,n)}startMomentumAnimation(e,t,n,s,i){const o=this.slotHeightPx;let a=n,r=performance.now();const c=()=>{const t=performance.now(),n=t-r;a*=Math.pow(.95,n/16),this.wheelPositions[i]+=a*n;const l=this.columnEmojis[i];if(l&&l.length>0&&this.updateWheelPosition(e,this.wheelPositions[i],l),Math.abs(a)<.1){const t=Math.round(this.wheelPositions[i]/o)*o;return void this.snapToPosition(e,this.wheelPositions[i],t,s,i)}r=t,requestAnimationFrame(c)};requestAnimationFrame(c)}snapToPosition(e,t,n,s,i){const o=performance.now(),a=t,r=n-a,c=()=>{const t=performance.now()-o,n=Math.min(t/200,1),l=1-Math.pow(1-n,3),h=a+r*l;this.wheelPositions[i]=h;const d=this.columnEmojis[i];if(d&&d.length>0&&this.updateWheelPosition(e,h,d),n<1)requestAnimationFrame(c);else{const e=this.slotHeightPx,t=Math.round(h/e),n=s.length,o=t%n,a=s[o<0?o+n:o];this.selectedEmojis[i]=a,this.wheelPositions[i]=h,this.emitStateChange();this.selectedEmojis.every(e=>e&&""!==e.trim())&&this.checkCombination()}};requestAnimationFrame(c)}updateColumnDisplay(e,t,n){let s=e.querySelectorAll(".emoji-option");if(0===s.length){for(let t=0;t<5;t++){const n=document.createElement("div");n.className="emoji-option",n.dataset.index=t.toString();const s=20*t;n.style.top=`${s}%`,n.style.height="20%",e.appendChild(n)}s=e.querySelectorAll(".emoji-option")}const i=n.length;s.forEach((e,s)=>{const o=e,a=this.safeMod(t-2+s,i),r=n[a];o.textContent=r,o.dataset.emoji=r,2===s?o.classList.add("selected"):o.classList.remove("selected")})}updateDisplay(){this.columnElements.forEach((e,t)=>{this.selectedEmojis[t]?e.classList.add("locked"):e.classList.remove("locked")})}emitStateChange(){this.onStateChange&&this.onStateChange({selectedEmojis:[...this.selectedEmojis],wheelPositions:[...this.wheelPositions],columnEmojis:this.columnEmojis.map(e=>[...e])})}checkCombination(){if(this.selectedEmojis.length!==this.correctEmojis.length||this.selectedEmojis.some(e=>!e))return;this.selectedEmojis.every((e,t)=>e===this.correctEmojis[t])?(this.container.classList.add("correct"),this.onComplete(!0,this.correctEmojis)):(this.container.classList.add("incorrect"),setTimeout(()=>{this.reset()},1e3))}reset(){this.container.classList.remove("incorrect"),this.columnElements=[],this.updateDisplay()}resetLock(){this.selectedEmojis=this.columnEmojis.map(e=>e[0]),this.wheelPositions=new Array(this.correctEmojis.length).fill(0),this.container.classList.remove("correct","incorrect"),this.columnElements=[],this.render(),this.emitStateChange()}}class S{constructor(){c(this,"lock",null),c(this,"host",null)}mount(e,t,n){var s;const i=document.createElement("div");if(i.className="combination-lock-container",null==(s=t.title)||s){const e=document.createElement("h3");e.textContent="string"==typeof t.title?t.title:"Find the emoji combination that matches best:",i.appendChild(e)}this.host=document.createElement("div"),this.host.className="combination-lock-container",i.appendChild(this.host),e.appendChild(i),this.lock=new g(this.host,t.correctEmojis,t.pool,(e,t)=>{e&&n({correct:t})},{initialState:t.initialState,onStateChange:t.onStateChange})}unmount(){if(this.host&&this.host.parentNode){this.host.parentNode.remove()}this.lock=null,this.host=null}reset(){this.lock&&this.lock.resetLock()}}class C{constructor(){c(this,"host",null),c(this,"onComplete",null),c(this,"config"),c(this,"grid",[]),c(this,"selectedIndices",[]),c(this,"annotations",[])}mount(e,t,n){var s,i,o,a,c,l,h;this.onComplete=n,this.config=r({gridSize:null!=(o=t.gridSize)?o:null!=(i=null==(s=t.initialState)?void 0:s.gridSize)?i:5},t);const d=this.config.gridSize*this.config.gridSize,u=null==(a=t.initialState)?void 0:a.grid;if(u&&u.length===d)this.grid=[...u];else if(this.config.emojis&&this.config.emojis.length===d)this.grid=[...this.config.emojis];else{const e=this.config.pool&&this.config.pool.length>0?[...this.config.pool]:["ğŸ˜€","ğŸ˜ƒ","ğŸ˜„","ğŸ˜","ğŸ˜†","ğŸ˜…","ğŸ¤£","ğŸ˜‚","ğŸ™‚","ğŸ™ƒ","ğŸ˜‰","ğŸ˜Š","ğŸ˜‡","ğŸ¥°","ğŸ˜","ğŸ¤©","ğŸ˜˜","ğŸ˜—","ğŸ˜š","ğŸ˜™","ğŸ˜‹","ğŸ˜›","ğŸ˜œ","ğŸ¤ª","ğŸ˜","ğŸ§","ğŸ¤“","ğŸ˜","ğŸ¥³","ğŸ¤ ","ğŸ˜","ğŸ˜¶â€ğŸŒ«ï¸","ğŸ˜¶","ğŸ˜","ğŸ˜‘"],t=Array.from(new Set(e)),n=this.config.correctEmojis;Array.isArray(n)&&n.forEach(e=>{t.includes(e)||t.unshift(e)});const s=[];let i=[...t];for(this.shuffleInPlace(i);s.length<d;){for(let e=0;e<i.length&&s.length<d;e++)s.push(i[e]);this.shuffleInPlace(i)}this.shuffleInPlace(s),this.grid=s.slice(0,d)}this.selectedIndices=(null==(c=t.initialState)?void 0:c.selectedIndices)?[...t.initialState.selectedIndices]:[],this.annotations=(null==(l=t.initialState)?void 0:l.annotations)&&t.initialState.annotations.length===this.grid.length?[...t.initialState.annotations]:new Array(this.grid.length).fill(0);const m=document.createElement("div");if(m.className="emoji-sequence-grid-container",null==(h=this.config.title)||h){const e=document.createElement("h3");e.textContent="string"==typeof this.config.title?this.config.title:"Select the emojis in the correct order:",m.appendChild(e)}const p=this.getExpectedLength(),g=document.createElement("div");g.className="emoji-sequence-display",m.appendChild(g);const S=document.createElement("div");S.className="emoji-sequence-controls";const C=document.createElement("button");C.className="emoji-sequence-reset",C.type="button",C.textContent="Reset",C.addEventListener("click",()=>this.reset()),S.appendChild(C);const v=document.createElement("div");v.className="emoji-sequence-grid",v.style.gridTemplateColumns=`repeat(${this.config.gridSize}, 1fr)`,v.style.gridTemplateRows=`repeat(${this.config.gridSize}, 1fr)`,this.grid.forEach((e,t)=>{const n=document.createElement("button");n.className="emoji-sequence-cell",n.type="button",n.setAttribute("data-index",String(t)),n.textContent=e;const s=document.createElement("span");s.className="emoji-sequence-badge",this.annotations[t]>0&&(s.textContent=String(this.annotations[t])),n.appendChild(s),n.addEventListener("click",()=>this.onCellClick(t)),v.appendChild(n)}),m.appendChild(v),m.appendChild(S),e.appendChild(m),this.host=m,this.updateSequenceDisplay(g,p),this.emitStateChange()}unmount(){if(this.host&&this.host.parentNode){this.host.parentNode.remove()}this.host=null}reset(){if(this.selectedIndices=[],this.annotations=new Array(this.grid.length).fill(0),!this.host)return;this.host.querySelectorAll(".emoji-sequence-cell").forEach(e=>{const t=e.querySelector(".emoji-sequence-badge");t&&(t.textContent=""),e.classList.remove("selected")});const e=this.host.querySelector(".emoji-sequence-display");e&&this.updateSequenceDisplay(e,this.getExpectedLength()),this.emitStateChange()}onCellClick(e){if(!this.host)return;const t=this.selectedIndices.indexOf(e);if(-1!==t){this.selectedIndices.splice(t).forEach(e=>{this.annotations[e]=0;const t=this.getCellEl(e);if(t){const e=t.querySelector(".emoji-sequence-badge");e&&(e.textContent=""),t.classList.remove("selected")}})}else{const t=this.getExpectedLength();if(this.selectedIndices.length>=t)return;this.selectedIndices.push(e),this.annotations[e]=this.selectedIndices.length;const n=this.getCellEl(e);if(n){const t=n.querySelector(".emoji-sequence-badge");t&&(t.textContent=String(this.annotations[e])),n.classList.add("selected")}}const n=this.host.querySelector(".emoji-sequence-display");n&&this.updateSequenceDisplay(n,this.getExpectedLength()),this.emitStateChange();const s=this.getExpectedLength();this.selectedIndices.length===s&&this.validateCompletion()}getExpectedLength(){if(Array.isArray(this.config.correctSequence)&&this.config.correctSequence.length>0)return this.config.correctSequence.length;const e=this.config.correctEmojis;return e?e.length:Math.min(5,this.grid.length)}validateCompletion(){let e,t=!1;if(Array.isArray(this.config.correctSequence)&&this.config.correctSequence.length===this.selectedIndices.length)t=this.selectedIndices.every((e,t)=>e===this.config.correctSequence[t]),e=this.config.correctSequence.map(e=>this.grid[e]);else{const n=this.config.correctEmojis;if(n&&n.length===this.selectedIndices.length){t=this.selectedIndices.map(e=>this.grid[e]).every((e,t)=>e===n[t]),e=n}}t&&this.onComplete&&this.onComplete({correct:e})}getCellEl(e){return this.host?this.host.querySelector(`.emoji-sequence-cell[data-index="${e}"]`):null}updateSequenceDisplay(e,t){const n=[];for(let s=0;s<t;s++)s<this.selectedIndices.length?n.push(this.grid[this.selectedIndices[s]]):n.push("â—»ï¸");e.textContent=n.join(" "),e.setAttribute("data-count",`${this.selectedIndices.length}/${t}`)}emitStateChange(){this.config.onStateChange&&this.config.onStateChange({selectedIndices:[...this.selectedIndices],annotations:[...this.annotations],grid:[...this.grid],gridSize:this.config.gridSize})}shuffleInPlace(e){for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1)),s=e[t];e[t]=e[n],e[n]=s}}}let v=!1;class f{constructor(e){c(this,"gameState"),c(this,"container"),c(this,"dialog",null),c(this,"activePuzzle",{unmount:null}),v||(p("combination-lock",()=>new S),p("emoji-sequence-grid",()=>new C),v=!0),this.gameState=e,this.gameState.subscribe(()=>this.renderGame())}render(e){this.container=e,this.renderGame()}renderGame(){const e=this.gameState.getCurrentSentence(),t=this.gameState.getCurrentChapter();this.container.innerHTML=`\n            <div class="game-container">\n                <header class="game-header">\n                    <div class="header-top">\n                        <h1 class="clickable-title" id="chapter-title">\n                            ${t.name} \n                            <span class="progress-in-title">(${this.gameState.getCurrentSentenceIndex()+1}/${this.gameState.getTotalSentences()})</span>\n                        </h1>\n                    </div>\n                    <div class="chapter-navigation" id="chapter-navigation" style="display: none;">\n                        <div class="chapter-navigation-content">\n                            <button class="chapter-nav-close" id="chapter-nav-close">Ã—</button>\n                            ${this.renderChapterNavigation()}\n                        </div>\n                    </div>\n                </header>\n                \n                <main class="game-main">\n                    <div class="verse-container">\n                        <p class="verse-text">"${e.sentence}"</p>\n                    </div>\n                    \n                    <div class="puzzle-container">\n                        <div class="puzzle-host"></div>\n                    </div>\n                </main>\n                \n                <div class="version-display">v1.0.1</div>\n            </div>\n        `,this.setupEventListeners(),this.setupPuzzle()}renderChapterNavigation(){const e=this.gameState.game.chapters,t=this.gameState.getUnlockedChapters(),n=this.gameState.getCurrentChapterIndex();return`\n            <div class="chapters-list">\n                <h3>${this.gameState.game.config.ui.chapterListTitle}</h3>\n                \n                <div class="chapters-grid">\n                    ${e.map((e,s)=>{const i=t.includes(s),o=s===n,a=this.gameState.getCompletedSentences(s),r=e.sentences.length,c=a.length;return`\n                            <div class="chapter-item ${i?"unlocked":"locked"} ${o?"current":""}" \n                                 data-chapter-index="${s}">\n                                <div class="chapter-header">\n                                    <h4>${e.name}</h4>\n                                    ${i?`<span class="progress-badge">${c}/${r}</span>`:'<span class="lock-icon">ğŸ”’</span>'}\n                                </div>\n                                <p class="chapter-description">${e.description}</p>\n                                ${i?this.renderChapterSentences(s,a):""}\n                            </div>\n                        `}).join("")}\n                </div>\n            </div>\n        `}renderChapterSentences(e,t){const n=this.gameState.game.chapters[e],s=this.gameState.getCurrentChapterIndex(),i=this.gameState.getCurrentSentenceIndex();return`\n            <div class="sentences-list">\n                ${n.sentences.map((n,o)=>{const a=t.includes(o),r=e===s&&o===i,c=this.gameState.isChapterUnlocked(e),l=o>0&&t.includes(o-1);let h=0===o&&c||l||a;return r&&(h=!0),`\n                        <div class="sentence-item ${a?"completed":""} ${h?"unlocked":"locked"} ${r?"current":""}" \n                             data-chapter-index="${e}" \n                             data-sentence-index="${o}">\n                            <span class="sentence-number">${n.id}</span>\n                            <span class="sentence-preview">${n.sentence.substring(0,50)}${n.sentence.length>50?"...":""}</span>\n                            ${a?'<span class="checkmark">âœ“</span>':""}\n                        </div>\n                    `}).join("")}\n            </div>\n        `}setupEventListeners(){const e=this.container.querySelector("#chapter-title"),t=this.container.querySelector("#chapter-navigation"),n=this.container.querySelector("#chapter-nav-close");e&&t&&e.addEventListener("click",()=>{t.style.display="flex"}),n&&t&&n.addEventListener("click",()=>{t.style.display="none"}),t&&t.addEventListener("click",e=>{e.target===t&&(t.style.display="none")}),this.setupChapterNavigation()}setupChapterNavigation(){this.container.querySelectorAll(".sentence-item.unlocked").forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation();const n=parseInt(e.getAttribute("data-chapter-index")||"0"),s=parseInt(e.getAttribute("data-sentence-index")||"0");this.gameState.goToSentence(n,s);const i=this.container.querySelector("#chapter-navigation");i&&(i.style.display="none"),this.dialog&&(this.dialog.forceClose(),this.dialog=null)})})}setupPuzzle(){var e,s,i,o,a;const c=this.container.querySelector(".puzzle-host");if(!c)return;this.activePuzzle.unmount&&(this.activePuzzle.unmount(),this.activePuzzle.unmount=null);const l=this.gameState.getCurrentSentence(),h=(null==(e=l.puzzle)?void 0:e.type)||"emoji-sequence-grid",d=null!=(o=null==(i=null==(s=l.puzzle)?void 0:s.config)?void 0:i.gridSize)?o:5,u={correctEmojis:l.emojis,pool:this.createEmojiPool(l.emojis,d*d)},p=r(r({},u),(null==(a=l.puzzle)?void 0:a.config)||{});"emoji-sequence-grid"===h&&void 0===p.title&&(p.title=this.gameState.game.config.ui.emojiSequenceTitle);const g=function(e){const t=m.get(e);if(!t)throw new Error(`Unknown puzzle type: ${e}`);return t()}(h),S=l.id,C=this.gameState.getPuzzleState(S);var v;g.mount(c,(v=r({},p),t(v,n({initialState:C,onStateChange:e=>{this.gameState.setPuzzleState(S,e)}}))),e=>{const t=this.gameState.getCurrentChapterIndex(),n=this.gameState.getCurrentSentenceIndex();this.gameState.clearPuzzleState(S),this.gameState.markSentenceCompleted(t,n),this.showCompletionDialog(null==e?void 0:e.correct)}),this.activePuzzle.unmount=()=>g.unmount()}createEmojiPool(e,t){const n=this.gameState.game.config.emojiPool,s=new Set(e),i=n.filter(e=>!s.has(e));for(;s.size<t&&i.length>0;){const e=Math.floor(Math.random()*i.length);s.add(i[e]),i.splice(e,1)}if(s.size<t)for(const a of n){if(s.size>=t)break;s.add(a)}const o=Array.from(s);for(let a=o.length-1;a>0;a--){const e=Math.floor(Math.random()*(a+1)),t=o[a];o[a]=o[e],o[e]=t}return o.slice(0,t)}showCompletionDialog(e){const t=this.gameState.getCurrentSentenceIndex()===this.gameState.getTotalSentences()-1,n=this.gameState.getCurrentChapterIndex()===this.gameState.getTotalChapters()-1,s=this.gameState.getCurrentSentence(),i=this.gameState.getCurrentChapter(),o=this.gameState.game.config.messages,a=o.encouraging;let r=a[Math.floor(Math.random()*a.length)],c=o.buttons.nextVerse;t&&n?(r=o.lastVerseLastChapter,c=o.buttons.playAgain):t&&(r=o.lastVerse,c=o.buttons.nextChapter);const l={chapterName:i.name,sentenceId:s.id,sentenceText:s.sentence};this.dialog=new u(this.container,r,c,()=>this.proceedToNext(),e,!1,l)}proceedToNext(){const e=this.gameState.getCurrentSentenceIndex()===this.gameState.getTotalSentences()-1,t=this.gameState.getCurrentChapterIndex()===this.gameState.getTotalChapters()-1;!(e&&t)&&this.dialog&&(this.dialog.close(),this.dialog=null),e&&t?this.gameState.resetGame():e?this.gameState.nextChapter():this.gameState.nextSentence()}}(new class{constructor(){c(this,"gameState",null),c(this,"gameUI",null)}init(){return l(this,null,function*(){try{const e=document.getElementById("app");e&&(e.innerHTML='<div class="loading">Loading game data...</div>');const t=yield function(){return l(this,null,function*(){try{const e=yield fetch("./game.json");if(!e.ok)throw new Error(`Failed to load game data: ${e.statusText}`);return yield e.json()}catch(e){return console.error("Error loading game data:",e),{id:"verse-quest-1",name:"Verse Quest",description:"A journey through emojis and verses",config:{emojiPool:["ğŸ˜Š","ğŸ˜¢","ğŸ˜‚","ğŸ˜¨","ğŸ’•","ğŸ˜¡","ğŸ˜Œ","ğŸ¤”","ğŸ˜´","ğŸ˜","ğŸŒ…","â˜ï¸","ğŸ›ï¸","ğŸŒ™","ğŸŒ¸","ğŸ”¥","ğŸŒŠ","â­","ğŸŒˆ","â„ï¸","ğŸ’–","ğŸ’”","ğŸ”Š","ğŸ‘»","ğŸŒ±","âš¡","ğŸ•Šï¸","ğŸµ","ğŸ­","ğŸ”®"],ui:{chapterListTitle:"Chapters",emojiSequenceTitle:"Select the emojis in the correct order:"},messages:{encouraging:["Great job!","Excellent work!","Well done!","Perfect!","Amazing!","Fantastic!","Outstanding!","Brilliant!","Wonderful!","Incredible!","Superb!","Magnificent!","Splendid!","Terrific!","Awesome!","Phenomenal!","Remarkable!","Exceptional!","Marvelous!","Spectacular!"],lastVerseLastChapter:"Congratulations! You have completed the entire journey!",lastVerse:"Chapter complete! Ready for the next chapter?",buttons:{nextVerse:"Next Verse",nextChapter:"Next Chapter",playAgain:"Play Again"}}},chapters:[{id:"chapter-1",name:"The Beginning",description:"Start your emoji journey",sentences:[{id:"sentence-1",sentence:"The sun rises with hope in my heart",emojis:["ğŸ˜Š","ğŸŒ…","ğŸ’–"]},{id:"sentence-2",sentence:"Dark clouds gather as sadness fills the air",emojis:["ğŸ˜¢","â˜ï¸","ğŸ’”"]},{id:"sentence-3",sentence:"Laughter echoes through the empty halls",emojis:["ğŸ˜‚","ğŸ›ï¸","ğŸ”Š"]},{id:"sentence-4",sentence:"Fear grips my soul in the silent night",emojis:["ğŸ˜¨","ğŸŒ™","ğŸ‘»"]}]},{id:"chapter-2",name:"The Journey",description:"Continue your emoji exploration",sentences:[{id:"sentence-5",sentence:"Love blossoms like spring flowers",emojis:["ğŸ’•","ğŸŒ¸","ğŸŒ±"]},{id:"sentence-6",sentence:"Anger burns like a raging fire",emojis:["ğŸ˜¡","ğŸ”¥","âš¡"]},{id:"sentence-7",sentence:"Peace flows like a gentle river",emojis:["ğŸ˜Œ","ğŸŒŠ","ğŸ•Šï¸"]}]}]}}})}();this.gameState=new d(t),this.gameUI=new f(this.gameState),e&&this.gameUI.render(e)}catch(e){console.error("Failed to initialize app:",e);const t=document.getElementById("app");t&&(t.innerHTML='<div class="error">Failed to load game. Please refresh the page.</div>')}})}}).init().catch(e=>{console.error("Failed to initialize app:",e)});
