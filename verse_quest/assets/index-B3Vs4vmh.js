var e=Object.defineProperty,t=(t,n,s)=>((t,n,s)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[n]=s)(t,"symbol"!=typeof n?n+"":n,s),n=(e,t,n)=>new Promise((s,i)=>{var o=e=>{try{a(n.next(e))}catch(t){i(t)}},r=e=>{try{a(n.throw(e))}catch(t){i(t)}},a=e=>e.done?s(e.value):Promise.resolve(e.value).then(o,r);a((n=n.apply(e,t)).next())});!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();class s{constructor(e){t(this,"game"),t(this,"currentChapterIndex",0),t(this,"currentSentenceIndex",0),t(this,"listeners",[]),this.game=e}getCurrentChapter(){return this.game.chapters[this.currentChapterIndex]}getCurrentSentence(){return this.getCurrentChapter().sentences[this.currentSentenceIndex]}getCurrentSentenceIndex(){return this.currentSentenceIndex}getCurrentChapterIndex(){return this.currentChapterIndex}getTotalSentences(){return this.getCurrentChapter().sentences.length}getTotalChapters(){return this.game.chapters.length}nextSentence(){const e=this.getCurrentChapter();return this.currentSentenceIndex<e.sentences.length-1&&(this.currentSentenceIndex++,this.notifyListeners(),!0)}nextChapter(){return this.currentChapterIndex<this.game.chapters.length-1&&(this.currentChapterIndex++,this.currentSentenceIndex=0,this.notifyListeners(),!0)}isGameComplete(){return this.currentChapterIndex>=this.game.chapters.length-1&&this.currentSentenceIndex>=this.getCurrentChapter().sentences.length-1}subscribe(e){this.listeners.push(e)}notifyListeners(){this.listeners.forEach(e=>e())}}class i{constructor(e,n,s,i){t(this,"container"),t(this,"correctEmotions"),t(this,"allEmotions"),t(this,"selectedEmotions",[]),t(this,"onComplete"),this.container=e,this.correctEmotions=n,this.allEmotions=s,this.onComplete=i,this.render()}render(){this.container.innerHTML="",this.container.className="combination-lock";for(let t=0;t<this.correctEmotions.length;t++){const e=document.createElement("div");e.className="emotion-slot",e.dataset.index=t.toString();const n=document.createElement("div");n.className="emotion-display",n.textContent=this.selectedEmotions[t]||"?",e.appendChild(n),this.container.appendChild(e)}const e=document.createElement("div");e.className="emotion-selector";[...this.allEmotions].sort(()=>Math.random()-.5).forEach(t=>{const n=document.createElement("button");n.className="emotion-button",n.textContent=t,n.addEventListener("click",()=>this.selectEmotion(t)),e.appendChild(n)}),this.container.appendChild(e)}selectEmotion(e){const t=this.selectedEmotions.findIndex(e=>!e);-1!==t&&(this.selectedEmotions[t]=e,this.updateDisplay(),this.selectedEmotions.every(e=>e)&&this.checkCombination())}updateDisplay(){this.container.querySelectorAll(".emotion-display").forEach((e,t)=>{e.textContent=this.selectedEmotions[t]||"?"})}checkCombination(){this.selectedEmotions.every((e,t)=>e===this.correctEmotions[t])?(this.container.classList.add("correct"),setTimeout(()=>{this.onComplete(!0)},500)):(this.container.classList.add("incorrect"),setTimeout(()=>{this.reset()},1e3))}reset(){this.selectedEmotions=[],this.container.classList.remove("incorrect"),this.updateDisplay()}resetLock(){this.selectedEmotions=[],this.container.classList.remove("correct","incorrect"),this.render()}}class o{constructor(e,n,s,i){t(this,"container"),t(this,"overlay"),t(this,"dialogElement"),this.container=e,this.createDialog(n,s,i)}createDialog(e,t,n){this.overlay=document.createElement("div"),this.overlay.className="dialog-overlay",this.dialogElement=document.createElement("div"),this.dialogElement.className="dialog",this.dialogElement.innerHTML=`\n            <div class="dialog-content">\n                <p class="dialog-message">${e}</p>\n                <button class="dialog-button">${t}</button>\n            </div>\n        `;this.dialogElement.querySelector(".dialog-button").addEventListener("click",n),this.overlay.appendChild(this.dialogElement),this.container.appendChild(this.overlay),setTimeout(()=>{this.overlay.classList.add("show")},10)}close(){this.overlay.classList.remove("show"),setTimeout(()=>{this.overlay.parentNode&&this.overlay.parentNode.removeChild(this.overlay)},300)}}class r{constructor(e){t(this,"gameState"),t(this,"container"),t(this,"combinationLock",null),t(this,"dialog",null),this.gameState=e,this.gameState.subscribe(()=>this.renderGame())}render(e){this.container=e,this.renderGame()}renderGame(){const e=this.gameState.getCurrentSentence(),t=this.gameState.getCurrentChapter();this.container.innerHTML=`\n            <div class="game-container">\n                <header class="game-header">\n                    <h1>${t.name}</h1>\n                    <div class="progress">\n                        <span class="current">${this.gameState.getCurrentSentenceIndex()+1}</span>\n                        <span class="separator">/</span>\n                        <span class="total">${this.gameState.getTotalSentences()}</span>\n                    </div>\n                </header>\n                \n                <main class="game-main">\n                    <div class="verse-container">\n                        <p class="verse-text">"${e.sentence}"</p>\n                    </div>\n                    \n                    <div class="combination-container">\n                        <h3>Find the emotions that match this verse:</h3>\n                        <div class="combination-lock-container"></div>\n                    </div>\n                </main>\n            </div>\n        `,this.setupCombinationLock()}setupCombinationLock(){const e=this.container.querySelector(".combination-lock-container"),t=this.gameState.getCurrentSentence(),n=this.createEmotionPool(t.emojis);this.combinationLock=new i(e,t.emojis,n,e=>this.onCombinationComplete(e)),this.combinationLock=this.combinationLock}createEmotionPool(e){const t=[...e],n=12-e.length,s=["😊","😢","😂","😨","💕","😡","😌","🤔","😴","😍","🌅","☁️","🏛️","🌙","🌸","🔥","🌊","⭐","🌈","❄️","💖","💔","🔊","👻","🌱","⚡","🕊️","🎵","🎭","🔮"].filter(t=>!e.includes(t));for(let i=0;i<n;i++){const e=Math.floor(Math.random()*s.length);t.push(s[e]),s.splice(e,1)}return t}onCombinationComplete(e){e&&this.showCompletionDialog()}showCompletionDialog(){const e=this.gameState.getCurrentSentenceIndex()===this.gameState.getTotalSentences()-1,t=this.gameState.getCurrentChapterIndex()===this.gameState.getTotalChapters()-1;let n="Great job! You found the correct emotions!",s="Next Verse";e&&t?(n="Congratulations! You have completed the entire journey!",s="Play Again"):e&&(n="Chapter complete! Ready for the next chapter?",s="Next Chapter"),this.dialog=new o(this.container,n,s,()=>this.proceedToNext())}proceedToNext(){this.dialog&&(this.dialog.close(),this.dialog=null);const e=this.gameState.getCurrentSentenceIndex()===this.gameState.getTotalSentences()-1,t=this.gameState.getCurrentChapterIndex()===this.gameState.getTotalChapters()-1;if(e&&t){const e=this.gameState.game;this.gameState=new s(e),this.gameState.subscribe(()=>this.renderGame())}else e?this.gameState.nextChapter():this.gameState.nextSentence()}}(new class{constructor(){t(this,"gameState",null),t(this,"gameUI",null)}init(){return n(this,null,function*(){try{const e=document.getElementById("app");e&&(e.innerHTML='<div class="loading">Loading game data...</div>');const t=yield function(){return n(this,null,function*(){try{const e=yield fetch("./game.json");if(!e.ok)throw new Error(`Failed to load game data: ${e.statusText}`);return yield e.json()}catch(e){return console.error("Error loading game data:",e),{id:"verse-quest-1",name:"Verse Quest",description:"A journey through emotions and verses",chapters:[{id:"chapter-1",name:"The Beginning",description:"Start your emotional journey",sentences:[{id:"sentence-1",sentence:"The sun rises with hope in my heart",emojis:["😊","🌅","💖"]},{id:"sentence-2",sentence:"Dark clouds gather as sadness fills the air",emojis:["😢","☁️","💔"]},{id:"sentence-3",sentence:"Laughter echoes through the empty halls",emojis:["😂","🏛️","🔊"]},{id:"sentence-4",sentence:"Fear grips my soul in the silent night",emojis:["😨","🌙","👻"]}]},{id:"chapter-2",name:"The Journey",description:"Continue your emotional exploration",sentences:[{id:"sentence-5",sentence:"Love blossoms like spring flowers",emojis:["💕","🌸","🌱"]},{id:"sentence-6",sentence:"Anger burns like a raging fire",emojis:["😡","🔥","⚡"]},{id:"sentence-7",sentence:"Peace flows like a gentle river",emojis:["😌","🌊","🕊️"]}]}]}}})}();this.gameState=new s(t),this.gameUI=new r(this.gameState),e&&this.gameUI.render(e)}catch(e){console.error("Failed to initialize app:",e);const t=document.getElementById("app");t&&(t.innerHTML='<div class="error">Failed to load game. Please refresh the page.</div>')}})}}).init().catch(e=>{console.error("Failed to initialize app:",e)});
