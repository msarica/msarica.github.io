(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))a(e);new MutationObserver(e=>{for(const i of e)if(i.type==="childList")for(const h of i.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&a(h)}).observe(document,{childList:!0,subtree:!0});function s(e){const i={};return e.integrity&&(i.integrity=e.integrity),e.referrerPolicy&&(i.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?i.credentials="include":e.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(e){if(e.ep)return;e.ep=!0;const i=s(e);fetch(e.href,i)}})();var d=(l=>(l.START="start",l.GAME="game",l.PAUSE="pause",l.GAME_OVER="gameOver",l))(d||{}),n=(l=>(l.PHASER="phaser",l.PHOTON="photon",l.QUANTUM="quantum",l))(n||{});class g{canvas;ctx;gameState;currentScreen;lastTime=0;animationId=null;constructor(t){this.canvas=t,this.ctx=t.getContext("2d"),this.gameState={isRunning:!1,isPaused:!1,score:0,level:1},this.currentScreen=d.START,this.setupCanvas()}setupCanvas(){this.resizeCanvas(),window.addEventListener("resize",()=>this.resizeCanvas())}resizeCanvas(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight}initialize(){this.gameLoop()}start(){this.gameState.isRunning=!0,this.currentScreen=d.GAME}pause(){this.gameState.isPaused=!this.gameState.isPaused,this.currentScreen=this.gameState.isPaused?d.PAUSE:d.GAME}stop(){this.gameState.isRunning=!1,this.currentScreen=d.START,this.animationId&&cancelAnimationFrame(this.animationId)}gameLoop=(t=0)=>{const s=t-this.lastTime;this.lastTime=t,this.gameState.isRunning&&!this.gameState.isPaused&&this.update(s),this.render(),this.animationId=requestAnimationFrame(this.gameLoop)};update(t){}render(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}getCanvas(){return this.canvas}getContext(){return this.ctx}getGameState(){return{...this.gameState}}getCurrentScreen(){return this.currentScreen}setCurrentScreen(t){this.currentScreen=t}}class m{data;constructor(t){this.data={...t}}update(t){const s=t/1e3;this.data.position.x+=this.data.velocity.x*s,this.data.position.y+=this.data.velocity.y*s}render(t){if(this.data.isBeam){t.save(),t.strokeStyle=this.data.color,t.lineWidth=Math.max(1,this.data.radius*.8);const s=30,a=this.data.velocity.x,e=this.data.velocity.y,i=Math.hypot(a,e)||1,h=a/i*s,r=e/i*s;t.beginPath(),t.moveTo(this.data.position.x,this.data.position.y),t.lineTo(this.data.position.x+h,this.data.position.y+r),t.stroke(),t.restore();return}t.save(),t.fillStyle=this.data.color,t.beginPath(),t.arc(this.data.position.x,this.data.position.y,this.data.radius,0,Math.PI*2),t.fill(),t.restore()}getData(){return this.data}isOffscreen(t,s){const a=this.data.radius;return this.data.position.x<-a||this.data.position.x>t+a||this.data.position.y<-a||this.data.position.y>s+a}}class v{shipData;canvas;shipImage;imageLoaded=!1;targetX;moveSpeed=.1;tiltScaleX=1;hull=100;maxHull=100;ammo={phasers:999,photons:10,quantums:3};regenPerSecond=2;lastDamageTime=0;noDamageRegenDelayMs=2e3;projectiles=[];beams=[];fireCooldownsMs={[n.PHASER]:150,[n.PHOTON]:500,[n.QUANTUM]:800};fireTimersMs={[n.PHASER]:0,[n.PHOTON]:0,[n.QUANTUM]:0};hitSound;phaserSound;constructor(t){this.canvas=t,this.targetX=t.width/2,this.shipData={position:{x:t.width/2,y:t.height-80},width:60,height:40},this.shipImage=new Image,this.shipImage.onload=()=>{this.imageLoaded=!0},this.shipImage.src="/assets/images/player-ship.png";try{this.hitSound=new Audio("/assets/sounds/smallexplosion2.mp3"),this.hitSound.volume=.6}catch{}try{this.phaserSound=new Audio("/assets/sounds/phasers.mp3"),this.phaserSound.volume=.5}catch{}}update(t){const s=this.targetX-this.shipData.position.x;this.shipData.position.x+=s*this.moveSpeed,this.shipData.position.x=Math.max(this.shipData.width/2,Math.min(this.canvas.width-this.shipData.width/2,this.shipData.position.x));const a=.25,e=.01;if(this.tiltScaleX=1-Math.min(a,Math.abs(s)*e),this.fireTimersMs[n.PHASER]+=t,this.fireTimersMs[n.PHOTON]+=t,this.fireTimersMs[n.QUANTUM]+=t,Date.now()-this.lastDamageTime>this.noDamageRegenDelayMs){const i=this.regenPerSecond*t/1e3;this.hull=Math.min(this.maxHull,this.hull+i)}for(const i of this.projectiles)i.update(t);this.projectiles=this.projectiles.filter(i=>!i.isOffscreen(this.canvas.width,this.canvas.height));for(const i of this.beams)i.ttlMs-=t;this.beams=this.beams.filter(i=>i.ttlMs>0)}render(t){const{position:s,width:a,height:e}=this.shipData;this.imageLoaded?(t.save(),t.translate(s.x,s.y),t.scale(this.tiltScaleX,1),t.drawImage(this.shipImage,-a/2,-e/2,a,e),t.restore()):(t.save(),t.translate(s.x,s.y),t.scale(this.tiltScaleX,1),t.fillStyle="#4A90E2",t.strokeStyle="#2E5BBA",t.lineWidth=2,t.beginPath(),t.rect(-a/2,-e/2,a,e),t.fill(),t.stroke(),t.fillStyle="#FFFFFF",t.font="12px Arial",t.textAlign="center",t.textBaseline="middle",t.fillText("Loading...",0,0),t.restore());for(const i of this.projectiles)i.render(t);for(const i of this.beams)t.save(),t.strokeStyle=i.color,t.lineWidth=i.width,t.beginPath(),t.moveTo(i.start.x,i.start.y),t.lineTo(i.end.x,i.end.y),t.stroke(),t.restore()}moveToTarget(t){this.targetX=Math.max(this.shipData.width/2,Math.min(this.canvas.width-this.shipData.width/2,t))}stopMoving(){}getPosition(){return{...this.shipData.position}}getBounds(){return{x:this.shipData.position.x-this.shipData.width/2,y:this.shipData.position.y-this.shipData.height/2,width:this.shipData.width,height:this.shipData.height}}takeDamage(t){if(this.hull=Math.max(0,this.hull-t),this.lastDamageTime=Date.now(),this.hitSound)try{this.hitSound.currentTime=0,this.hitSound.play()}catch{}}getHull(){return this.hull}getAmmo(){return{...this.ammo}}getProjectiles(){return this.projectiles}tryFire(t,s){if(t===n.PHASER&&this.ammo.phasers<=0||t===n.PHOTON&&this.ammo.photons<=0||t===n.QUANTUM&&this.ammo.quantums<=0||this.fireTimersMs[t]<this.fireCooldownsMs[t])return!1;t===n.PHASER&&(this.ammo.phasers-=1),t===n.PHOTON&&(this.ammo.photons-=1),t===n.QUANTUM&&(this.ammo.quantums-=1),this.fireTimersMs[t]=0;const a=t===n.PHASER?1e3:t===n.PHOTON?600:700,e=t===n.PHASER?3:t===n.PHOTON?5:6,i=t===n.PHASER?10:t===n.PHOTON?30:45,h=t===n.PHASER?"#ff0000":t===n.PHOTON?"#ff8800":"#00bfff";if(t===n.PHASER&&s){const c={x:this.shipData.position.x,y:this.shipData.position.y-this.shipData.height/2},u={x:s.x,y:s.y};if(this.beams.push({start:c,end:u,color:h,ttlMs:80,width:3}),this.phaserSound)try{this.phaserSound.currentTime=0,this.phaserSound.play()}catch{}return!0}let r=0,o=-a;const p={position:{x:this.shipData.position.x,y:this.shipData.position.y-this.shipData.height/2},velocity:{x:r,y:o},radius:e,damage:i,color:h,fromPlayer:!0};if(this.projectiles.push(new m(p)),t===n.PHASER&&this.phaserSound)try{this.phaserSound.currentTime=0,this.phaserSound.play()}catch{}return!0}getWeaponDamage(t){return t===n.PHASER?10:t===n.PHOTON?30:45}}class S{stars;canvas;starCount=100;constructor(t){this.canvas=t,this.stars=[],this.generateStars()}generateStars(){this.stars=[];for(let t=0;t<this.starCount;t++)this.stars.push({position:{x:Math.random()*this.canvas.width,y:Math.random()*this.canvas.height},speed:.5+Math.random()*2,size:Math.random()*2+.5,brightness:.3+Math.random()*.7})}update(t){for(let s=0;s<this.stars.length;s++){const a=this.stars[s];a.position.y+=a.speed,a.position.y>this.canvas.height&&(a.position.y=-a.size,a.position.x=Math.random()*this.canvas.width)}}render(t){for(const s of this.stars){const a=s.brightness;t.fillStyle=`rgba(255, 255, 255, ${a})`,t.beginPath(),t.arc(s.position.x,s.position.y,s.size,0,2*Math.PI),t.fill()}}resize(){this.generateStars()}}class y{canvas;touchData;onMoveCallback;onEndCallback;onTapCallback;constructor(t,s,a,e){this.canvas=t,this.touchData={startX:0,currentX:0,isDragging:!1},this.onMoveCallback=s,this.onEndCallback=a,this.onTapCallback=e,this.setupEventListeners()}setupEventListeners(){this.canvas.addEventListener("touchstart",this.handleTouchStart.bind(this),{passive:!1}),this.canvas.addEventListener("touchmove",this.handleTouchMove.bind(this),{passive:!1}),this.canvas.addEventListener("touchend",this.handleTouchEnd.bind(this),{passive:!1}),this.canvas.addEventListener("touchcancel",this.handleTouchEnd.bind(this),{passive:!1}),this.canvas.addEventListener("mousedown",this.handleMouseDown.bind(this)),this.canvas.addEventListener("mousemove",this.handleMouseMove.bind(this)),this.canvas.addEventListener("mouseup",this.handleMouseUp.bind(this)),this.canvas.addEventListener("mouseleave",this.handleMouseUp.bind(this))}handleTouchStart(t){if(t.preventDefault(),t.touches.length>0){const s=t.touches[0],a=this.canvas.getBoundingClientRect();this.touchData.startX=s.clientX-a.left,this.touchData.currentX=this.touchData.startX,this.touchData.isDragging=!0,this.onTapCallback&&this.onTapCallback()}}handleTouchMove(t){if(t.preventDefault(),this.touchData.isDragging&&t.touches.length>0){const s=t.touches[0],a=this.canvas.getBoundingClientRect();this.touchData.currentX=s.clientX-a.left,this.onMoveCallback(this.touchData.currentX)}}handleTouchEnd(t){t.preventDefault(),this.touchData.isDragging=!1,this.onEndCallback()}handleMouseDown(t){const s=this.canvas.getBoundingClientRect();this.touchData.startX=t.clientX-s.left,this.touchData.currentX=this.touchData.startX,this.touchData.isDragging=!0,this.onTapCallback&&this.onTapCallback()}handleMouseMove(t){if(this.touchData.isDragging){const s=this.canvas.getBoundingClientRect();this.touchData.currentX=t.clientX-s.left,this.onMoveCallback(this.touchData.currentX)}}handleMouseUp(t){this.touchData.isDragging=!1,this.onEndCallback()}}class M{canvas;ctx;onStartCallback;constructor(t,s){this.canvas=t,this.ctx=t.getContext("2d"),this.onStartCallback=s,this.setupEventListeners()}setupEventListeners(){this.canvas.addEventListener("click",this.handleClick.bind(this)),this.canvas.addEventListener("touchstart",this.handleTouch.bind(this),{passive:!1})}handleClick(t){this.onStartCallback()}handleTouch(t){t.preventDefault(),this.onStartCallback()}render(){const t=this.canvas.width/2,s=this.canvas.height/2;this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.drawStarfield(),this.ctx.fillStyle="#FFD700",this.ctx.font="bold 48px Arial",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.shadowColor="#FFD700",this.ctx.shadowBlur=10,this.ctx.fillText("STAR TREK",t,s-150),this.ctx.shadowBlur=0,this.ctx.fillStyle="#4A90E2",this.ctx.font="24px Arial",this.ctx.fillText("ARCADE",t,s-100),this.drawInstructions(t,s-20),this.drawStartButton(t,s+180)}drawStarfield(){this.ctx.fillStyle="#FFFFFF";for(let t=0;t<100;t++){const s=Math.random()*this.canvas.width,a=Math.random()*this.canvas.height,e=Math.random()*2;this.ctx.beginPath(),this.ctx.arc(s,a,e,0,2*Math.PI),this.ctx.fill()}}drawInstructions(t,s){const i=t-200,h=s-140/2;this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.fillRect(i,h,400,140),this.ctx.strokeStyle="#4A90E2",this.ctx.lineWidth=2,this.ctx.strokeRect(i,h,400,140),this.ctx.fillStyle="#FFD700",this.ctx.font="bold 20px Arial",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText("MISSION BRIEFING",t,s-50),this.ctx.fillStyle="#FFFFFF",this.ctx.font="16px Arial",this.ctx.fillText("• Drag or swipe to move your ship",t,s-15),this.ctx.fillText("• Avoid enemy vessels",t,s+5),this.ctx.fillText("• Survive as long as possible",t,s+25),this.ctx.fillText("• Touch anywhere to begin",t,s+45)}drawStartButton(t,s){const i=t-100,h=s-60/2;this.ctx.fillStyle="#2E5BBA",this.ctx.fillRect(i,h,200,60),this.ctx.strokeStyle="#4A90E2",this.ctx.lineWidth=3,this.ctx.strokeRect(i,h,200,60),this.ctx.fillStyle="#FFFFFF",this.ctx.font="bold 24px Arial",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText("START MISSION",t,s)}destroy(){}}class f{data;static image=null;static imageLoaded=!1;constructor(t){this.data={...t},f.image||(f.image=new Image,f.image.onload=()=>{f.imageLoaded=!0},f.image.src="/assets/images/astroid.png")}update(t){const s=t/1e3;this.data.position.y+=this.data.velocityY*s}render(t){const s=this.data.width/2,a=this.data.height/2,e=this.data.position.x-s,i=this.data.position.y-a;if(f.image&&f.imageLoaded){t.drawImage(f.image,e,i,this.data.width,this.data.height);return}t.save(),t.fillStyle="#777777",t.strokeStyle="#555555",t.lineWidth=2,t.beginPath(),t.ellipse(this.data.position.x,this.data.position.y,s,a,0,0,Math.PI*2),t.fill(),t.stroke(),t.restore()}hit(t){this.data.health-=t,this.data.health<=0&&(this.data.alive=!1)}isOffscreen(t){return this.data.position.y-this.data.height/2>t}getData(){return this.data}}class x{position;radius;ttlMs;ageMs=0;color;ringOnly;constructor(t,s,a=400,e="#ffbb55",i=!1){this.position={x:t.x,y:t.y},this.radius=s,this.ttlMs=a,this.color=e,this.ringOnly=i}update(t){this.ageMs+=t}render(t){const s=Math.min(1,this.ageMs/this.ttlMs),a=1-s,e=this.radius*(.6+.8*s);if(t.save(),t.globalAlpha=Math.max(0,a),this.ringOnly)t.strokeStyle=this.color,t.lineWidth=2+3*(1-s),t.beginPath(),t.arc(this.position.x,this.position.y,e,0,Math.PI*2),t.stroke();else{const i=t.createRadialGradient(this.position.x,this.position.y,Math.max(0,e*.1),this.position.x,this.position.y,e);i.addColorStop(0,"rgba(255, 255, 200, 1)"),i.addColorStop(.4,this.color),i.addColorStop(1,"rgba(255, 100, 0, 0)"),t.fillStyle=i,t.beginPath(),t.arc(this.position.x,this.position.y,e,0,Math.PI*2),t.fill()}t.restore()}isAlive(){return this.ageMs<this.ttlMs}}class D extends g{ship;starField;_touchControls;startScreen;asteroids=[];explosions=[];spawnTimerMs=0;spawnIntervalMs=900;levelAsteroidHealth=30;constructor(t){super(t),this.ship=new v(t),this.starField=new S(t),this._touchControls=new y(t,this.handleShipMove.bind(this),this.handleShipStop.bind(this),this.handleTapShoot.bind(this)),this.startScreen=new M(t,this.startGame.bind(this)),this.initialize()}update(t){if(this.getCurrentScreen()===d.GAME){this.starField.update(t),this.ship.update(t);for(const i of this.explosions)i.update(t);this.spawnTimerMs+=t,this.spawnTimerMs>=this.spawnIntervalMs&&(this.spawnTimerMs=0,this.spawnAsteroid());for(const i of this.asteroids)i.update(t);const s=this.getCanvas();this.asteroids=this.asteroids.filter(i=>i.getData().alive&&!i.isOffscreen(s.height)),this.explosions=this.explosions.filter(i=>i.isAlive());const a=this.ship.getProjectiles();for(const i of a){const h=i.getData();if(h.fromPlayer)for(const r of this.asteroids){const o=r.getData();if(o.alive&&this.circleRectIntersect(h.position.x,h.position.y,h.radius,o.position.x-o.width/2,o.position.y-o.height/2,o.width,o.height)){const p=r.getData().health;r.hit(h.damage);const c=r.getData().health;if(p>0&&c<=0){const u=r.getData();this.spawnExplosion(u.position.x,u.position.y,Math.max(14,Math.min(36,(u.width+u.height)/4)))}h.position.y=-9999}}}const e=this.ship.getBounds();for(const i of this.asteroids){const h=i.getData();if(h.alive&&this.rectsIntersect(e.x,e.y,e.width,e.height,h.position.x-h.width/2,h.position.y-h.height/2,h.width,h.height)){const r=Math.max(10,Math.round((h.width+h.height)/8));this.ship.takeDamage(r),h.alive=!1,this.spawnExplosion(h.position.x,h.position.y,Math.max(18,Math.min(44,(h.width+h.height)/3)))}}this.ship.getHull()<=0&&this.setCurrentScreen(d.GAME_OVER)}}render(){const t=this.getCurrentScreen();t===d.START?this.startScreen.render():t===d.GAME?this.renderGame():t===d.GAME_OVER&&this.renderGameOver()}renderGame(){const t=this.getContext(),s=this.getCanvas();t.fillStyle="#000000",t.fillRect(0,0,s.width,s.height),this.starField.render(t),this.ship.render(t);for(const a of this.asteroids)a.render(t);for(const a of this.explosions)a.render(t);this.drawUI()}drawUI(){const t=this.getContext(),s=this.getGameState();t.fillStyle="#FFFFFF",t.font="20px Arial",t.textAlign="left",t.textBaseline="top",t.fillText(`Score: ${s.score}`,20,20),t.fillText(`Level: ${s.level}`,20,50);const a=this.ship.getHull(),e=200,i=16,h=20,r=80;t.fillStyle="#444",t.fillRect(h,r,e,i),t.fillStyle="#0f0",t.fillRect(h,r,Math.max(0,Math.min(e,a/100*e)),i),t.strokeStyle="#fff",t.strokeRect(h,r,e,i);const o=this.ship.getAmmo();t.fillStyle="#FFFFFF",t.fillText(`Phasers: ${o.phasers}  Photons: ${o.photons}  Quantums: ${o.quantums}`,20,110)}handleShipMove(t){this.getCurrentScreen()===d.GAME&&this.ship.moveToTarget(t)}handleShipStop(){this.ship.stopMoving()}startGame(){this.setCurrentScreen(d.GAME),this._touchControls,this.start()}renderGameOver(){const t=this.getContext(),s=this.getCanvas();t.fillStyle="#000000",t.fillRect(0,0,s.width,s.height),t.fillStyle="#FF3333",t.font="bold 56px Arial",t.textAlign="center",t.textBaseline="middle",t.fillText("GAME OVER",s.width/2,s.height/2-40),t.fillStyle="#FFFFFF",t.font="20px Arial",t.fillText("Refresh to restart",s.width/2,s.height/2+20)}handleTapShoot(){if(this.getCurrentScreen()!==d.GAME)return;const t=this.ship.getPosition(),s=140,a=520;let e=null;for(const r of this.asteroids){const o=r.getData();if(!o.alive||o.position.y>=t.y)continue;const p=o.position.x-t.x,c=o.position.y-t.y;if(Math.abs(p)>s)continue;const u=Math.hypot(p,c);u>a||(!e||u<e.dist)&&(e={a:r,dist:u})}if(!e)return;const i=e.a.getData().position;if(this.ship.tryFire(n.PHASER,{x:i.x,y:i.y})){const o=e.a.getData().health;e.a.hit(this.ship.getWeaponDamage(n.PHASER));const p=e.a.getData().health;if(o>0&&p<=0){const c=e.a.getData();this.spawnExplosion(c.position.x,c.position.y,Math.max(14,Math.min(36,(c.width+c.height)/4)))}}}spawnAsteroid(){const t=this.getCanvas(),s=Math.random()*t.width,a=30+Math.random()*40,e=this.levelAsteroidHealth+Math.floor(Math.random()*20),i={id:Date.now()+Math.floor(Math.random()*1e3),type:"asteroid",position:{x:s,y:-a},width:a,height:a,velocityY:100+Math.random()*120,health:e,alive:!0};this.asteroids.push(new f(i))}spawnExplosion(t,s,a){this.explosions.push(new x({x:t,y:s},a,420))}circleRectIntersect(t,s,a,e,i,h,r){const o=Math.max(e,Math.min(t,e+h)),p=Math.max(i,Math.min(s,i+r)),c=t-o,u=s-p;return c*c+u*u<=a*a}rectsIntersect(t,s,a,e,i,h,r,o){return t<i+r&&t+a>i&&s<h+o&&s+e>h}destroy(){super.stop(),this.startScreen&&this.startScreen.destroy()}resizeCanvas(){super.resizeCanvas(),this.starField&&this.starField.resize()}}document.addEventListener("DOMContentLoaded",()=>{const l=document.getElementById("game-canvas");if(!l){console.error("Game canvas not found!");return}const t=new D(l);document.addEventListener("visibilitychange",()=>{document.hidden&&t.pause()}),window.addEventListener("resize",()=>{})});
