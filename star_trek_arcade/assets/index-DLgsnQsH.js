(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))e(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const n of i.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&e(n)}).observe(document,{childList:!0,subtree:!0});function s(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function e(a){if(a.ep)return;a.ep=!0;const i=s(a);fetch(a.href,i)}})();var u=(o=>(o.START="start",o.GAME="game",o.PAUSE="pause",o.GAME_OVER="gameOver",o))(u||{}),h=(o=>(o.PHASER="phaser",o.PHOTON="photon",o.QUANTUM="quantum",o))(h||{});class m{canvas;ctx;gameState;currentScreen;lastTime=0;animationId=null;constructor(t){this.canvas=t,this.ctx=t.getContext("2d"),this.gameState={isRunning:!1,isPaused:!1,score:0,level:1},this.currentScreen=u.START,this.setupCanvas()}setupCanvas(){this.resizeCanvas(),window.addEventListener("resize",()=>this.resizeCanvas())}resizeCanvas(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight}initialize(){this.gameLoop()}start(){this.gameState.isRunning=!0,this.currentScreen=u.GAME}pause(){this.gameState.isPaused=!this.gameState.isPaused,this.currentScreen=this.gameState.isPaused?u.PAUSE:u.GAME}stop(){this.gameState.isRunning=!1,this.currentScreen=u.START,this.animationId&&cancelAnimationFrame(this.animationId)}gameLoop=(t=0)=>{const s=t-this.lastTime;this.lastTime=t,this.gameState.isRunning&&!this.gameState.isPaused&&this.update(s),this.render(),this.animationId=requestAnimationFrame(this.gameLoop)};update(t){}render(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}getCanvas(){return this.canvas}getContext(){return this.ctx}getGameState(){return{...this.gameState}}getCurrentScreen(){return this.currentScreen}setCurrentScreen(t){this.currentScreen=t}}class v{data;constructor(t){this.data={...t}}update(t){const s=t/1e3;this.data.position.x+=this.data.velocity.x*s,this.data.position.y+=this.data.velocity.y*s}render(t){if(this.data.isBeam){t.save(),t.strokeStyle=this.data.color,t.lineWidth=Math.max(1,this.data.radius*.8);const s=30,e=this.data.velocity.x,a=this.data.velocity.y,i=Math.hypot(e,a)||1,n=e/i*s,l=a/i*s;t.beginPath(),t.moveTo(this.data.position.x,this.data.position.y),t.lineTo(this.data.position.x+n,this.data.position.y+l),t.stroke(),t.restore();return}t.save(),t.fillStyle=this.data.color,t.beginPath(),t.arc(this.data.position.x,this.data.position.y,this.data.radius,0,Math.PI*2),t.fill(),t.restore()}getData(){return this.data}isOffscreen(t,s){const e=this.data.radius;return this.data.position.x<-e||this.data.position.x>t+e||this.data.position.y<-e||this.data.position.y>s+e}}class S{shipData;canvas;shipImage;imageLoaded=!1;targetX;moveSpeed=.1;tiltScaleX=1;hull=100;maxHull=100;ammo={phasers:999,photons:10,quantums:3};regenPerSecond=2;lastDamageTime=0;noDamageRegenDelayMs=2e3;projectiles=[];beams=[];fireCooldownsMs={[h.PHASER]:150,[h.PHOTON]:500,[h.QUANTUM]:800};fireTimersMs={[h.PHASER]:0,[h.PHOTON]:0,[h.QUANTUM]:0};hitSound;phaserSound;photonSound;quantumSound;constructor(t){this.canvas=t,this.targetX=t.width/2,this.shipData={position:{x:t.width/2,y:t.height-80},width:60,height:40},this.shipImage=new Image,this.shipImage.onload=()=>{this.imageLoaded=!0},this.shipImage.src="/star_trek_arcade/assets/images/player-ship.png";try{this.hitSound=new Audio("/star_trek_arcade/assets/sounds/smallexplosion2.mp3"),this.hitSound.volume=.6}catch{}try{this.phaserSound=new Audio("/star_trek_arcade/assets/sounds/phasers.mp3"),this.phaserSound.volume=.5}catch{}try{this.photonSound=new Audio("/star_trek_arcade/assets/sounds/photon_torpedo.mp3"),this.photonSound.volume=.6}catch{}try{this.quantumSound=new Audio("/star_trek_arcade/assets/sounds/quantum_torpedo.mp3"),this.quantumSound.volume=.6}catch{}}update(t){const s=this.targetX-this.shipData.position.x;this.shipData.position.x+=s*this.moveSpeed,this.shipData.position.x=Math.max(this.shipData.width/2,Math.min(this.canvas.width-this.shipData.width/2,this.shipData.position.x));const e=.25,a=.01;if(this.tiltScaleX=1-Math.min(e,Math.abs(s)*a),this.fireTimersMs[h.PHASER]+=t,this.fireTimersMs[h.PHOTON]+=t,this.fireTimersMs[h.QUANTUM]+=t,Date.now()-this.lastDamageTime>this.noDamageRegenDelayMs){const i=this.regenPerSecond*t/1e3;this.hull=Math.min(this.maxHull,this.hull+i)}for(const i of this.projectiles)i.update(t);this.projectiles=this.projectiles.filter(i=>!i.isOffscreen(this.canvas.width,this.canvas.height));for(const i of this.beams)i.ttlMs-=t;this.beams=this.beams.filter(i=>i.ttlMs>0)}render(t){const{position:s,width:e,height:a}=this.shipData;this.imageLoaded?(t.save(),t.translate(s.x,s.y),t.scale(this.tiltScaleX,1),t.drawImage(this.shipImage,-e/2,-a/2,e,a),t.restore()):(t.save(),t.translate(s.x,s.y),t.scale(this.tiltScaleX,1),t.fillStyle="#4A90E2",t.strokeStyle="#2E5BBA",t.lineWidth=2,t.beginPath(),t.rect(-e/2,-a/2,e,a),t.fill(),t.stroke(),t.fillStyle="#FFFFFF",t.font="12px Arial",t.textAlign="center",t.textBaseline="middle",t.fillText("Loading...",0,0),t.restore());for(const i of this.projectiles)i.render(t);for(const i of this.beams){t.save(),t.strokeStyle=i.color,t.lineWidth=i.width,t.beginPath();const n={x:this.shipData.position.x,y:this.shipData.position.y-this.shipData.height/2};t.moveTo(n.x,n.y),t.lineTo(i.end.x,i.end.y),t.stroke(),t.restore()}}moveToTarget(t){this.targetX=Math.max(this.shipData.width/2,Math.min(this.canvas.width-this.shipData.width/2,t))}stopMoving(){}getPosition(){return{...this.shipData.position}}getBounds(){return{x:this.shipData.position.x-this.shipData.width/2,y:this.shipData.position.y-this.shipData.height/2,width:this.shipData.width,height:this.shipData.height}}takeDamage(t){if(this.hull=Math.max(0,this.hull-t),this.lastDamageTime=Date.now(),this.hitSound)try{this.hitSound.currentTime=0,this.hitSound.play()}catch{}}getHull(){return this.hull}getAmmo(){return{...this.ammo}}getProjectiles(){return this.projectiles}tryFire(t,s){if(t===h.PHASER&&this.ammo.phasers<=0||t===h.PHOTON&&this.ammo.photons<=0||t===h.QUANTUM&&this.ammo.quantums<=0||this.fireTimersMs[t]<this.fireCooldownsMs[t])return!1;t===h.PHASER&&(this.ammo.phasers-=1),t===h.PHOTON&&(this.ammo.photons-=1),t===h.QUANTUM&&(this.ammo.quantums-=1),this.fireTimersMs[t]=0;const e=t===h.PHASER?1e3:t===h.PHOTON?600:700,a=t===h.PHASER?3:t===h.PHOTON?5:6,i=t===h.PHASER?10:t===h.PHOTON?30:45,n=t===h.PHASER?"#ff0000":t===h.PHOTON?"#ff8800":"#00bfff";if(t===h.PHASER&&s){const d={x:this.shipData.position.x,y:this.shipData.position.y-this.shipData.height/2},c={x:s.x,y:s.y};if(this.beams.push({start:d,end:c,color:n,ttlMs:80,width:3}),this.phaserSound)try{this.phaserSound.currentTime=0,this.phaserSound.play()}catch{}return!0}let l=0,r=-e;const p={position:{x:this.shipData.position.x,y:this.shipData.position.y-this.shipData.height/2},velocity:{x:l,y:r},radius:a,damage:i,color:n,fromPlayer:!0};if(this.projectiles.push(new v(p)),t===h.PHASER&&this.phaserSound)try{this.phaserSound.currentTime=0,this.phaserSound.play()}catch{}else if(t===h.PHOTON&&this.photonSound)try{this.photonSound.currentTime=0,this.photonSound.play()}catch{}else if(t===h.QUANTUM&&this.quantumSound)try{this.quantumSound.currentTime=0,this.quantumSound.play()}catch{}return!0}getWeaponDamage(t){return t===h.PHASER?10:t===h.PHOTON?30:45}reset(){this.targetX=this.canvas.width/2,this.shipData.position.x=this.canvas.width/2,this.shipData.position.y=this.canvas.height-80,this.hull=this.maxHull,this.lastDamageTime=0,this.ammo={phasers:999,photons:10,quantums:3},this.projectiles=[],this.beams=[],this.fireTimersMs={[h.PHASER]:0,[h.PHOTON]:0,[h.QUANTUM]:0},this.tiltScaleX=1}}class y{stars;canvas;starCount=100;constructor(t){this.canvas=t,this.stars=[],this.generateStars()}generateStars(){this.stars=[];for(let t=0;t<this.starCount;t++)this.stars.push({position:{x:Math.random()*this.canvas.width,y:Math.random()*this.canvas.height},speed:.5+Math.random()*2,size:Math.random()*2+.5,brightness:.3+Math.random()*.7})}update(t){for(let s=0;s<this.stars.length;s++){const e=this.stars[s];e.position.y+=e.speed,e.position.y>this.canvas.height&&(e.position.y=-e.size,e.position.x=Math.random()*this.canvas.width)}}render(t){for(const s of this.stars){const e=s.brightness;t.fillStyle=`rgba(255, 255, 255, ${e})`,t.beginPath(),t.arc(s.position.x,s.position.y,s.size,0,2*Math.PI),t.fill()}}resize(){this.generateStars()}}class x{canvas;touchData;onMoveCallback;onEndCallback;constructor(t,s,e){this.canvas=t,this.touchData={startX:0,currentX:0,isDragging:!1},this.onMoveCallback=s,this.onEndCallback=e,this.setupEventListeners()}setupEventListeners(){this.canvas.addEventListener("touchstart",this.handleTouchStart.bind(this),{passive:!1}),this.canvas.addEventListener("touchmove",this.handleTouchMove.bind(this),{passive:!1}),this.canvas.addEventListener("touchend",this.handleTouchEnd.bind(this),{passive:!1}),this.canvas.addEventListener("touchcancel",this.handleTouchEnd.bind(this),{passive:!1}),this.canvas.addEventListener("mousedown",this.handleMouseDown.bind(this)),this.canvas.addEventListener("mousemove",this.handleMouseMove.bind(this)),this.canvas.addEventListener("mouseup",this.handleMouseUp.bind(this)),this.canvas.addEventListener("mouseleave",this.handleMouseUp.bind(this))}handleTouchStart(t){if(t.preventDefault(),t.touches.length>0){const s=t.touches[0],e=this.canvas.getBoundingClientRect();this.touchData.startX=s.clientX-e.left,this.touchData.currentX=this.touchData.startX,this.touchData.isDragging=!0}}handleTouchMove(t){if(t.preventDefault(),this.touchData.isDragging&&t.touches.length>0){const s=t.touches[0],e=this.canvas.getBoundingClientRect();this.touchData.currentX=s.clientX-e.left,this.onMoveCallback(this.touchData.currentX)}}handleTouchEnd(t){t.preventDefault(),this.touchData.isDragging=!1,this.onEndCallback()}handleMouseDown(t){const s=this.canvas.getBoundingClientRect();this.touchData.startX=t.clientX-s.left,this.touchData.currentX=this.touchData.startX,this.touchData.isDragging=!0}handleMouseMove(t){if(this.touchData.isDragging){const s=this.canvas.getBoundingClientRect();this.touchData.currentX=t.clientX-s.left,this.onMoveCallback(this.touchData.currentX)}}handleMouseUp(t){this.touchData.isDragging=!1,this.onEndCallback()}}class M{canvas;ctx;onStartCallback;constructor(t,s){this.canvas=t,this.ctx=t.getContext("2d"),this.onStartCallback=s,this.setupEventListeners()}setupEventListeners(){this.canvas.addEventListener("click",this.handleClick.bind(this)),this.canvas.addEventListener("touchstart",this.handleTouch.bind(this),{passive:!1})}handleClick(t){this.onStartCallback()}handleTouch(t){t.preventDefault(),this.onStartCallback()}render(){const t=this.canvas.width/2,s=this.canvas.height/2;this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.drawStarfield(),this.ctx.fillStyle="#FFD700",this.ctx.font="bold 48px Arial",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.shadowColor="#FFD700",this.ctx.shadowBlur=10,this.ctx.fillText("STAR TREK",t,s-150),this.ctx.shadowBlur=0,this.ctx.fillStyle="#4A90E2",this.ctx.font="24px Arial",this.ctx.fillText("ARCADE",t,s-100),this.drawInstructions(t,s-20),this.drawStartButton(t,s+180)}drawStarfield(){this.ctx.fillStyle="#FFFFFF";for(let t=0;t<100;t++){const s=Math.random()*this.canvas.width,e=Math.random()*this.canvas.height,a=Math.random()*2;this.ctx.beginPath(),this.ctx.arc(s,e,a,0,2*Math.PI),this.ctx.fill()}}drawInstructions(t,s){const i=t-200,n=s-140/2;this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.fillRect(i,n,400,140),this.ctx.strokeStyle="#4A90E2",this.ctx.lineWidth=2,this.ctx.strokeRect(i,n,400,140),this.ctx.fillStyle="#FFD700",this.ctx.font="bold 20px Arial",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText("MISSION BRIEFING",t,s-50),this.ctx.fillStyle="#FFFFFF",this.ctx.font="16px Arial",this.ctx.fillText("• Drag or swipe to move your ship",t,s-15),this.ctx.fillText("• Avoid enemy vessels",t,s+5),this.ctx.fillText("• Survive as long as possible",t,s+25),this.ctx.fillText("• Touch anywhere to begin",t,s+45)}drawStartButton(t,s){const i=t-100,n=s-60/2;this.ctx.fillStyle="#2E5BBA",this.ctx.fillRect(i,n,200,60),this.ctx.strokeStyle="#4A90E2",this.ctx.lineWidth=3,this.ctx.strokeRect(i,n,200,60),this.ctx.fillStyle="#FFFFFF",this.ctx.font="bold 24px Arial",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText("START MISSION",t,s)}destroy(){}}class w{canvas;ctx;onRestartCallback;finalScore;finalLevel;constructor(t,s,e,a){this.canvas=t,this.ctx=t.getContext("2d"),this.onRestartCallback=s,this.finalScore=e,this.finalLevel=a,this.setupEventListeners()}setupEventListeners(){this.canvas.addEventListener("click",this.handleClick.bind(this)),this.canvas.addEventListener("touchstart",this.handleTouch.bind(this),{passive:!1})}handleClick(t){this.onRestartCallback()}handleTouch(t){t.preventDefault(),this.onRestartCallback()}render(){const t=this.canvas.width/2,s=this.canvas.height/2;this.ctx.fillStyle="#000000",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.drawStarfield(),this.ctx.fillStyle="#FF3333",this.ctx.font="bold 56px Arial",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.shadowColor="#FF3333",this.ctx.shadowBlur=15,this.ctx.fillText("GAME OVER",t,s-120),this.ctx.shadowBlur=0,this.drawFinalStats(t,s-40),this.drawRestartButton(t,s+120)}drawStarfield(){this.ctx.fillStyle="#FFFFFF";for(let t=0;t<100;t++){const s=Math.random()*this.canvas.width,e=Math.random()*this.canvas.height,a=Math.random()*2;this.ctx.beginPath(),this.ctx.arc(s,e,a,0,2*Math.PI),this.ctx.fill()}}drawFinalStats(t,s){const i=t-150,n=s-100/2;this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.fillRect(i,n,300,100),this.ctx.strokeStyle="#FF3333",this.ctx.lineWidth=2,this.ctx.strokeRect(i,n,300,100),this.ctx.fillStyle="#FFD700",this.ctx.font="bold 24px Arial",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText(`Final Score: ${this.finalScore}`,t,s-20),this.ctx.fillStyle="#FFFFFF",this.ctx.font="20px Arial",this.ctx.fillText(`Level Reached: ${this.finalLevel}`,t,s+20)}drawRestartButton(t,s){const i=t-100,n=s-60/2;this.ctx.fillStyle="#2E5BBA",this.ctx.fillRect(i,n,200,60),this.ctx.strokeStyle="#4A90E2",this.ctx.lineWidth=3,this.ctx.strokeRect(i,n,200,60),this.ctx.fillStyle="#FFFFFF",this.ctx.font="bold 24px Arial",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText("RESTART",t,s)}destroy(){}}class f{data;static image=null;static imageLoaded=!1;constructor(t){this.data={...t},f.image||(f.image=new Image,f.image.onload=()=>{f.imageLoaded=!0},f.image.src="/star_trek_arcade/assets/images/astroid.png")}update(t){const s=t/1e3;this.data.position.y+=this.data.velocityY*s}render(t){const s=this.data.width/2,e=this.data.height/2,a=this.data.position.x-s,i=this.data.position.y-e;if(f.image&&f.imageLoaded){t.drawImage(f.image,a,i,this.data.width,this.data.height);return}t.save(),t.fillStyle="#777777",t.strokeStyle="#555555",t.lineWidth=2,t.beginPath(),t.ellipse(this.data.position.x,this.data.position.y,s,e,0,0,Math.PI*2),t.fill(),t.stroke(),t.restore()}hit(t){this.data.health-=t,this.data.health<=0&&(this.data.alive=!1)}isOffscreen(t){return this.data.position.y-this.data.height/2>t}getData(){return this.data}}class b{position;radius;ttlMs;ageMs=0;color;ringOnly;constructor(t,s,e=400,a="#ffbb55",i=!1){this.position={x:t.x,y:t.y},this.radius=s,this.ttlMs=e,this.color=a,this.ringOnly=i}update(t){this.ageMs+=t}render(t){const s=Math.min(1,this.ageMs/this.ttlMs),e=1-s,a=this.radius*(.6+.8*s);if(t.save(),t.globalAlpha=Math.max(0,e),this.ringOnly)t.strokeStyle=this.color,t.lineWidth=2+3*(1-s),t.beginPath(),t.arc(this.position.x,this.position.y,a,0,Math.PI*2),t.stroke();else{const i=t.createRadialGradient(this.position.x,this.position.y,Math.max(0,a*.1),this.position.x,this.position.y,a);i.addColorStop(0,"rgba(255, 255, 200, 1)"),i.addColorStop(.4,this.color),i.addColorStop(1,"rgba(255, 100, 0, 0)"),t.fillStyle=i,t.beginPath(),t.arc(this.position.x,this.position.y,a,0,Math.PI*2),t.fill()}t.restore()}isAlive(){return this.ageMs<this.ttlMs}}class D{buttons=[];canvas;onWeaponFire;constructor(t,s){this.canvas=t,this.onWeaponFire=s,this.setupButtons(),this.setupEventListeners()}setupButtons(){const i=(this.canvas.width-280)/2,n=this.canvas.height-50-20;this.buttons=[{x:i,y:n,width:80,height:50,weapon:h.PHASER,label:"PHASER",color:"#ff0000",ammo:999,cooldown:0,maxCooldown:150},{x:i+80+20,y:n,width:80,height:50,weapon:h.PHOTON,label:"PHOTON",color:"#ff8800",ammo:10,cooldown:0,maxCooldown:500},{x:i+100*2,y:n,width:80,height:50,weapon:h.QUANTUM,label:"QUANTUM",color:"#00bfff",ammo:3,cooldown:0,maxCooldown:800}]}setupEventListeners(){this.canvas.addEventListener("touchstart",this.handleTouchStart.bind(this),{passive:!1}),this.canvas.addEventListener("touchend",this.handleTouchEnd.bind(this),{passive:!1}),this.canvas.addEventListener("mousedown",this.handleMouseDown.bind(this)),this.canvas.addEventListener("mouseup",this.handleMouseUp.bind(this))}handleTouchStart(t){if(t.preventDefault(),t.touches.length>0){const s=t.touches[0],e=this.canvas.getBoundingClientRect(),a=s.clientX-e.left,i=s.clientY-e.top;this.handleButtonClick(a,i)}}handleTouchEnd(t){t.preventDefault()}handleMouseDown(t){const s=this.canvas.getBoundingClientRect(),e=t.clientX-s.left,a=t.clientY-s.top;this.handleButtonClick(e,a)}handleMouseUp(t){}handleButtonClick(t,s){for(const e of this.buttons)if(t>=e.x&&t<=e.x+e.width&&s>=e.y&&s<=e.y+e.height){e.ammo>0&&e.cooldown<=0&&(this.onWeaponFire(e.weapon),e.cooldown=e.maxCooldown);break}}update(t,s){this.buttons[0].ammo=s.phasers,this.buttons[1].ammo=s.photons,this.buttons[2].ammo=s.quantums;for(const e of this.buttons)e.cooldown>0&&(e.cooldown-=t)}render(t){for(const s of this.buttons)this.renderButton(t,s)}renderButton(t,s){const e=s.ammo>0&&s.cooldown<=0,a=s.cooldown>0;e?(t.fillStyle=s.color,t.globalAlpha=.8):a?(t.fillStyle="#666666",t.globalAlpha=.6):(t.fillStyle="#333333",t.globalAlpha=.6),t.fillRect(s.x,s.y,s.width,s.height),t.globalAlpha=1,t.strokeStyle=e?"#ffffff":"#666666",t.lineWidth=2,t.strokeRect(s.x,s.y,s.width,s.height),t.fillStyle=e?"#ffffff":"#999999",t.font="bold 12px Arial",t.textAlign="center",t.textBaseline="middle";const i=s.x+s.width/2,n=s.y+s.height/2;if(t.fillText(s.label,i,n-8),t.font="10px Arial",t.fillText(`${s.ammo}`,i,n+8),a){const l=s.cooldown/s.maxCooldown,r=s.height*l;t.fillStyle="rgba(255, 255, 255, 0.3)",t.fillRect(s.x,s.y+s.height-r,s.width,r)}}resize(){this.setupButtons()}destroy(){this.canvas.removeEventListener("touchstart",this.handleTouchStart),this.canvas.removeEventListener("touchend",this.handleTouchEnd),this.canvas.removeEventListener("mousedown",this.handleMouseDown),this.canvas.removeEventListener("mouseup",this.handleMouseUp)}}class T extends m{ship;starField;_touchControls;weaponButtons;startScreen;gameOverScreen=null;asteroids=[];explosions=[];spawnTimerMs=0;spawnIntervalMs=900;levelAsteroidHealth=30;constructor(t){super(t),this.ship=new S(t),this.starField=new y(t),this._touchControls=new x(t,this.handleShipMove.bind(this),this.handleShipStop.bind(this)),this.weaponButtons=new D(t,this.handleWeaponFire.bind(this)),this.startScreen=new M(t,this.startGame.bind(this)),this.initialize()}update(t){if(this.getCurrentScreen()===u.GAME){this.starField.update(t),this.ship.update(t),this.weaponButtons.update(t,this.ship.getAmmo());for(const i of this.explosions)i.update(t);this.spawnTimerMs+=t,this.spawnTimerMs>=this.spawnIntervalMs&&(this.spawnTimerMs=0,this.spawnAsteroid());for(const i of this.asteroids)i.update(t);const s=this.getCanvas();this.asteroids=this.asteroids.filter(i=>i.getData().alive&&!i.isOffscreen(s.height)),this.explosions=this.explosions.filter(i=>i.isAlive());const e=this.ship.getProjectiles();for(const i of e){const n=i.getData();if(n.fromPlayer)for(const l of this.asteroids){const r=l.getData();if(r.alive&&this.circleRectIntersect(n.position.x,n.position.y,n.radius,r.position.x-r.width/2,r.position.y-r.height/2,r.width,r.height)){const p=l.getData().health;l.hit(n.damage);const d=l.getData().health;if(p>0&&d<=0){const c=l.getData();this.spawnExplosion(c.position.x,c.position.y,Math.max(14,Math.min(36,(c.width+c.height)/4)))}n.position.y=-9999}}}const a=this.ship.getBounds();for(const i of this.asteroids){const n=i.getData();if(n.alive&&this.rectsIntersect(a.x,a.y,a.width,a.height,n.position.x-n.width/2,n.position.y-n.height/2,n.width,n.height)){const l=Math.max(10,Math.round((n.width+n.height)/8));this.ship.takeDamage(l),n.alive=!1,this.spawnExplosion(n.position.x,n.position.y,Math.max(18,Math.min(44,(n.width+n.height)/3)))}}if(this.ship.getHull()<=0){const i=this.getGameState();this.gameOverScreen=new w(this.getCanvas(),this.restartGame.bind(this),i.score,i.level),this.setCurrentScreen(u.GAME_OVER)}}}render(){const t=this.getCurrentScreen();t===u.START?this.startScreen.render():t===u.GAME?this.renderGame():t===u.GAME_OVER&&this.gameOverScreen&&this.gameOverScreen.render()}renderGame(){const t=this.getContext(),s=this.getCanvas();t.fillStyle="#000000",t.fillRect(0,0,s.width,s.height),this.starField.render(t),this.ship.render(t);for(const e of this.asteroids)e.render(t);for(const e of this.explosions)e.render(t);this.weaponButtons.render(t),this.drawUI()}drawUI(){const t=this.getContext(),s=this.getGameState();t.fillStyle="#FFFFFF",t.font="20px Arial",t.textAlign="left",t.textBaseline="top",t.fillText(`Score: ${s.score}`,20,20),t.fillText(`Level: ${s.level}`,20,50);const e=this.ship.getHull(),a=200,i=16,n=20,l=80;t.fillStyle="#444",t.fillRect(n,l,a,i),t.fillStyle="#0f0",t.fillRect(n,l,Math.max(0,Math.min(a,e/100*a)),i),t.strokeStyle="#fff",t.strokeRect(n,l,a,i);const r=this.ship.getAmmo();t.fillStyle="#FFFFFF",t.fillText(`Phasers: ${r.phasers}  Photons: ${r.photons}  Quantums: ${r.quantums}`,20,110)}handleShipMove(t){this.getCurrentScreen()===u.GAME&&this.ship.moveToTarget(t)}handleShipStop(){this.ship.stopMoving()}startGame(){this.setCurrentScreen(u.GAME),this._touchControls,this.start()}restartGame(){this.asteroids=[],this.explosions=[],this.spawnTimerMs=0,this.levelAsteroidHealth=30,this.ship.reset();const t=this.getGameState();t.score=0,t.level=1,this.gameOverScreen&&(this.gameOverScreen.destroy(),this.gameOverScreen=null),this.startGame()}handleWeaponFire(t){if(this.getCurrentScreen()===u.GAME)if(t===h.PHASER){const s=this.ship.getPosition(),e=140,a=520;let i=null;for(const r of this.asteroids){const p=r.getData();if(!p.alive||p.position.y>=s.y)continue;const d=p.position.x-s.x,c=p.position.y-s.y;if(Math.abs(d)>e)continue;const g=Math.hypot(d,c);g>a||(!i||g<i.dist)&&(i={a:r,dist:g})}if(!i)return;const n=i.a.getData().position;if(this.ship.tryFire(h.PHASER,{x:n.x,y:n.y})){const p=i.a.getData().health;i.a.hit(this.ship.getWeaponDamage(h.PHASER));const d=i.a.getData().health;if(p>0&&d<=0){const c=i.a.getData();this.spawnExplosion(c.position.x,c.position.y,Math.max(14,Math.min(36,(c.width+c.height)/4)))}}}else this.ship.tryFire(t)}spawnAsteroid(){const t=this.getCanvas(),s=Math.random()*t.width,e=30+Math.random()*40,a=this.levelAsteroidHealth+Math.floor(Math.random()*20),i={id:Date.now()+Math.floor(Math.random()*1e3),type:"asteroid",position:{x:s,y:-e},width:e,height:e,velocityY:100+Math.random()*120,health:a,alive:!0};this.asteroids.push(new f(i))}spawnExplosion(t,s,e){this.explosions.push(new b({x:t,y:s},e,420))}circleRectIntersect(t,s,e,a,i,n,l){const r=Math.max(a,Math.min(t,a+n)),p=Math.max(i,Math.min(s,i+l)),d=t-r,c=s-p;return d*d+c*c<=e*e}rectsIntersect(t,s,e,a,i,n,l,r){return t<i+l&&t+e>i&&s<n+r&&s+a>n}destroy(){super.stop(),this.startScreen&&this.startScreen.destroy(),this.gameOverScreen&&this.gameOverScreen.destroy(),this.weaponButtons&&this.weaponButtons.destroy()}resizeCanvas(){super.resizeCanvas(),this.starField&&this.starField.resize(),this.weaponButtons&&this.weaponButtons.resize()}}document.addEventListener("DOMContentLoaded",()=>{const o=document.getElementById("game-canvas");if(!o){console.error("Game canvas not found!");return}const t=new T(o);document.addEventListener("visibilitychange",()=>{document.hidden&&t.pause()}),window.addEventListener("resize",()=>{})});
