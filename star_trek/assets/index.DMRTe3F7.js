!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();class e{constructor(){this.currentChallenge=null,this.panelOpen=!1,this.initializeEventListeners()}initializeEventListeners(){const e=document.getElementById("cancelMathBtn"),t=document.getElementById("optionA"),s=document.getElementById("optionB"),i=document.getElementById("optionC"),a=document.getElementById("optionD");null==e||e.addEventListener("click",()=>this.closePanel()),null==t||t.addEventListener("click",()=>this.selectOption("A")),null==s||s.addEventListener("click",()=>this.selectOption("B")),null==i||i.addEventListener("click",()=>this.selectOption("C")),null==a||a.addEventListener("click",()=>this.selectOption("D")),document.addEventListener("keydown",e=>{"Escape"===e.key&&this.panelOpen&&this.closePanel()})}showChallenge(e,t,s,i){if(this.panelOpen)return!1;this.panelOpen=!0;const a=Math.floor(9*Math.random())+2,o=Math.floor(9*Math.random())+2,n=a*o,l=this.generateOptions(n);return this.currentChallenge={num1:a,num2:o,correctAnswer:n,repairType:e,options:l,correctOptionLetter:l.correctLetter,onSuccess:t,onFailure:s,onCancel:i},this.updatePanelContent(),this.showPanel(),console.log(`Math challenge: ${a} × ${o} = ${n} (for ${e})`),console.log(`Options: A=${l.A}, B=${l.B}, C=${l.C}, D=${l.D}, Correct=${l.correctLetter}`),!0}generateOptions(e){const t=[];for(;t.length<3;){let s;switch(Math.floor(4*Math.random())){case 0:s=e+Math.floor(10*Math.random())+1;break;case 1:s=e-Math.floor(10*Math.random())-1;break;case 2:s=Math.floor(e*(.8+.4*Math.random()));break;case 3:s=10*Math.floor(e/10)+Math.floor(10*Math.random());break;default:s=e+1}s>0&&s!==e&&!t.includes(s)&&t.push(s)}const s=[e,...t];for(let o=s.length-1;o>0;o--){const e=Math.floor(Math.random()*(o+1));[s[o],s[e]]=[s[e],s[o]]}const i={A:s[0],B:s[1],C:s[2],D:s[3]},a=["A","B","C","D"].find(t=>i[t]===e);if(!a)throw new Error("Could not find correct answer in options");return i.correctLetter=a,i}updatePanelContent(){var e,t,s,i;if(!this.currentChallenge)return;const{num1:a,num2:o,repairType:n,options:l}=this.currentChallenge,h=document.getElementById("mathQuestion"),r=document.getElementById("mathDescription"),c=document.getElementById("mathFeedback");h&&(h.textContent=`${a} × ${o} = ?`),r&&(r.textContent="Complete this calculation to repair your "+("hull"===n?"hull integrity":"energy reserves")),c&&(c.textContent="",c.className="math-feedback");const d=null==(e=document.getElementById("optionA"))?void 0:e.querySelector(".option-value"),p=null==(t=document.getElementById("optionB"))?void 0:t.querySelector(".option-value"),m=null==(s=document.getElementById("optionC"))?void 0:s.querySelector(".option-value"),g=null==(i=document.getElementById("optionD"))?void 0:i.querySelector(".option-value");d&&(d.textContent=String(l.A)),p&&(p.textContent=String(l.B)),m&&(m.textContent=String(l.C)),g&&(g.textContent=String(l.D)),["optionA","optionB","optionC","optionD"].forEach(e=>{const t=document.getElementById(e);null==t||t.classList.remove("correct","incorrect")})}selectOption(e){if(!this.currentChallenge)return;const t=document.getElementById("mathFeedback"),s=document.getElementById(`option${e}`);if(["optionA","optionB","optionC","optionD"].forEach(e=>{const t=document.getElementById(e);null==t||t.classList.remove("correct","incorrect")}),e===this.currentChallenge.correctOptionLetter)null==s||s.classList.add("correct"),t&&(t.textContent="CORRECT! Repair applied.",t.className="math-feedback success"),this.currentChallenge.onSuccess&&this.currentChallenge.onSuccess(this.currentChallenge.repairType),this.closePanel();else{null==s||s.classList.add("incorrect"),t&&(t.textContent="INCORRECT! Penalty applied. Try again.",t.className="math-feedback error"),this.currentChallenge.onFailure&&this.currentChallenge.onFailure(this.currentChallenge.repairType);const e=document.getElementById(`option${this.currentChallenge.correctOptionLetter}`);null==e||e.classList.add("correct"),setTimeout(()=>{null==s||s.classList.remove("incorrect"),null==e||e.classList.remove("correct"),t&&(t.textContent="",t.className="math-feedback")},2e3)}}showPanel(){const e=document.querySelector(".weapons-panel"),t=document.getElementById("mathChallengePanel");e&&(e.style.display="none"),t&&(t.style.display="block")}closePanel(){const e=document.getElementById("mathChallengePanel"),t=document.querySelector(".weapons-panel");e&&(e.style.display="none"),t&&(t.style.display="block"),this.currentChallenge&&this.currentChallenge.onCancel&&this.currentChallenge.onCancel(),this.panelOpen=!1,this.currentChallenge=null,console.log("Math challenge closed")}isPanelOpen(){return this.panelOpen}getCurrentChallenge(){return this.currentChallenge}}class t{constructor(){this.images={},this.sounds={},this.loadingComplete=!1,this.loadPromises=[],this.initializeAssets()}initializeAssets(){const e="/star_trek/";this.images={playerShip:this.loadImage(`${e}assets/images/player-ship.png`),enemyShip:this.loadImage(`${e}assets/images/opponent-ship.png`)},this.sounds={photon:this.loadSound(`${e}assets/sounds/photon_torpedo.mp3`),phaser:this.loadSound(`${e}assets/sounds/phasers.mp3`),quantum:this.loadSound(`${e}assets/sounds/quantum_torpedo.mp3`),romulanDisruptor:this.loadSound(`${e}assets/sounds/romulan_disruptor.mp3`),romulanTorpedo:this.loadSound(`${e}assets/sounds/romulan_torpedo.mp3`),explosion1:this.loadSound(`${e}assets/sounds/smallexplosion1.mp3`),explosion2:this.loadSound(`${e}assets/sounds/smallexplosion2.mp3`)},this.waitForAssets().then(()=>{this.loadingComplete=!0,console.log("All assets loaded successfully!")}).catch(e=>{console.error("Error loading assets:",e)})}loadImage(e){const t=new Image,s=new Promise((s,i)=>{t.onload=()=>{console.log(`Image loaded: ${e}`),s(t)},t.onerror=t=>{console.error(`Image load error for ${e}:`,t),i(t)}});return this.loadPromises.push(s),t.src=e,t}loadSound(e){const t=new Audio(e);t.volume=.3;const s=new Promise((s,i)=>{t.addEventListener("canplaythrough",()=>{console.log(`Sound loaded: ${e}`),s(t)}),t.addEventListener("error",t=>{console.error(`Sound load error for ${e}:`,t),i(t)})});return this.loadPromises.push(s),t.load(),t}checkAssetsLoaded(){const e=Object.values(this.images).every(e=>e.complete);return e&&!this.loadingComplete?(this.loadingComplete=!0,console.log("All assets loaded successfully!"),!0):e?this.loadingComplete:(setTimeout(()=>this.checkAssetsLoaded(),100),!1)}async waitForAssets(){try{return await Promise.all(this.loadPromises),this.loadingComplete=!0,console.log("All assets loaded via promises!"),!0}catch(e){return console.error("Error loading assets:",e),!1}}getImage(e){return this.images[e]}getSound(e){return this.sounds[e]}playSound(e){const t=this.sounds[e];t?(console.log(`Playing ${e} sound...`),t.currentTime=0,t.play().catch(t=>{console.error(`Sound play failed for ${e}:`,t)})):console.error(`Sound not found: ${e}`)}playWeaponSound(e){console.log(`${e.toUpperCase()} FIRED!`),this.playSound(e)}playEnemyWeaponSound(e){console.log(`ENEMY ${e.toUpperCase()} FIRED!`);const t={phaser:"romulanDisruptor",torpedo:"romulanTorpedo"}[e];t?this.playSound(t):console.error(`Enemy sound not found for weapon type: ${e}`)}playExplosionSound(){const e=["explosion1","explosion2"],t=e[Math.floor(Math.random()*e.length)];this.playSound(t)}isLoaded(){return this.loadingComplete}getAssets(){return{images:this.images,sounds:this.sounds}}}class s{constructor(e){this.x=e.x??0,this.y=e.y??0,this.width=e.width,this.height=e.height,this.health=e.health||100,this.maxHealth=e.maxHealth||this.health,this.energy=e.energy||100,this.maxEnergy=e.maxEnergy||this.energy,this.velocityX=e.velocityX||.8,this.direction=e.direction||1,this.minX=e.minX||60,this.maxX=e.maxX||740,this.isPlayer=e.isPlayer||!1,this.isEnemy=e.isEnemy||!1}update(){this.x+=this.velocityX*this.direction,this.x<=this.minX?(this.x=this.minX,this.direction=1):this.x>=this.maxX&&(this.x=this.maxX,this.direction=-1)}takeDamage(e){return this.health-=e,this.health=Math.max(0,this.health),console.log(`${this.isPlayer?"Player":"Enemy"} took ${e} damage! Health: ${this.health}`),this.health<=0}repairHull(e=100){this.health=Math.min(this.maxHealth,this.health+e),console.log(`Hull repaired! Health: ${this.health}`)}rechargeEnergy(e=100){this.isPlayer&&(this.energy=Math.min(this.maxEnergy,this.energy+e),console.log(`Energy recharged! Energy: ${this.energy}`))}consumeEnergy(e){return!this.isPlayer||(this.energy-=e,this.energy=Math.max(0,this.energy),this.energy>=0)}hasEnergy(e){return!this.isPlayer||this.energy>=e}getBounds(){return{left:this.x-this.width/2,right:this.x+this.width/2,top:this.y-this.height/2,bottom:this.y+this.height/2}}contains(e,t){const s=this.getBounds();return e>=s.left&&e<=s.right&&t>=s.top&&t<=s.bottom}reset(e){this.x=e.x??this.x,this.y=e.y??this.y,this.health=e.health??this.maxHealth,this.energy=e.energy??this.maxEnergy,this.direction=e.direction??1}levelUp(e){this.isEnemy&&(this.maxHealth=100+25*(e-1),this.health=this.maxHealth,console.log(`Enemy leveled up! Level ${e}, Health: ${this.maxHealth}`))}getHealthPercent(){return this.health/this.maxHealth*100}getEnergyPercent(){return this.energy/this.maxEnergy*100}isDestroyed(){return this.health<=0}isAlive(){return this.health>0}}class i{constructor(e,t,s){this.assetManager=e,this.collisionManager=t,this.particleSystem=s,this.projectiles=[],this.missMessages=[],this.weaponConfigs={photon:{energyCost:25,damage:15,color:"#ff0000",speed:.005,arcHeight:{min:80,max:200}},phaser:{energyCost:50,damage:10,duration:500,instant:!0},quantum:{energyCost:50,damage:20,color:"#ffffff",speed:.006,arcHeight:{min:100,max:250},hasParticles:!0}}}fireWeapon(e,t,s){const i=this.weaponConfigs[e];if(!i)return console.error(`Unknown weapon type: ${e}`),!1;if(t.isPlayer&&!t.hasEnergy(i.energyCost))return console.log(`Insufficient energy for ${e}! Need ${i.energyCost}, have ${t.energy}`),!1;if(t.isPlayer&&t.consumeEnergy(i.energyCost),i.instant){this.createPhaserBeam(t,s,i),this.assetManager.playWeaponSound(e);return s.takeDamage(i.damage)&&this.particleSystem.createShipExplosion(s),!0}const a=this.createProjectile(e,t,s,i);return this.projectiles.push(a),t.isPlayer?this.assetManager.playWeaponSound(e):this.assetManager.playEnemyWeaponSound("torpedo"),!0}fireEnemyWeapon(e,t,s=1){const i=["phaser","torpedo"],a=i[Math.floor(Math.random()*i.length)];if("phaser"===a){const i={shooterShip:e,targetShip:t,duration:500,startTime:Date.now(),type:"enemy_phaser",damage:15+2*s};this.projectiles.push(i),this.assetManager.playEnemyWeaponSound("phaser");t.takeDamage(i.damage)&&this.particleSystem.createShipExplosion(t)}else{const i={x:e.x,y:e.y+e.height/2+10,startX:e.x,startY:e.y+e.height/2+10,targetX:t.x,targetY:t.y,progress:0,arcHeight:60+80*Math.random(),arcDirection:Math.random()<.5?-1:1,speed:.008+.001*s,width:4,height:12,damage:20+3*s,color:"#00ff00",type:"enemy_torpedo",trail:[],useCircularArc:!0,isEnemyProjectile:!0};this.projectiles.push(i),this.assetManager.playEnemyWeaponSound("torpedo")}console.log(`Enemy fired ${a}!`)}createProjectile(e,t,s,i){const a=t.isEnemy,o=a?t.y+t.height/2+10:t.y-t.height/2-10,n={x:t.x,y:o,startX:t.x,startY:o,targetX:s.x,targetY:s.y,progress:0,arcHeight:i.arcHeight?i.arcHeight.min+Math.random()*(i.arcHeight.max-i.arcHeight.min):100,arcDirection:Math.random()<.5?-1:1,speed:i.speed||.005,width:"quantum"===e?6:4,height:"quantum"===e?20:15,damage:i.damage,color:i.color||"#ff0000",type:e,trail:[],useCircularArc:!0,isEnemyProjectile:a};return i.hasParticles&&(n.particles=[]),n}createPhaserBeam(e,t,s){const i=e.isEnemy,a={shooterShip:e,targetShip:t,duration:s.duration||500,startTime:Date.now(),type:i?"enemy_phaser":"phaser",damage:s.damage};this.projectiles.push(a)}update(e,t){this.updateProjectiles(e,t),this.updateMissMessages(),this.particleSystem.update()}updateProjectiles(e,t){this.projectiles=this.projectiles.filter(s=>{if("phaser"===s.type||"enemy_phaser"===s.type){const e=s;return Date.now()-e.startTime<e.duration}if("explosion"===s.type){const e=s;return e.x+=e.vx,e.y+=e.vy,e.life--,e.life>0}if("progress"in s){const i=s;if(this.updateProjectileArc(i),i.trail){i.trail.push({x:i.x,y:i.y});const e=i.useCircularArc?30:8;i.trail.length>e&&i.trail.shift()}this.particleSystem.updateQuantumParticles(i);if(this.checkCollisions(i,e,t))return!1;if(this.collisionManager.checkProjectileMiss(i))return this.createMissMessage(i,e,t),!1}return!0})}updateProjectileArc(e){e.progress+=e.speed;const t=e.x,s=e.y,i=e.progress;if(e.useCircularArc){if(!e.cached){const t=e.targetX-e.startX,s=e.targetY-e.startY,i=Math.sqrt(t*t+s*s);e.cached={deltaX:t,deltaY:s,perpX:-s/i,perpY:t/i}}const t=e.startX+e.cached.deltaX*i,s=e.startY+e.cached.deltaY*i,a=Math.sin(Math.PI*i)*e.arcHeight*e.arcDirection;e.x=t+e.cached.perpX*a,e.y=s+e.cached.perpY*a}if(void 0!==t&&void 0!==s){const i=e.x-t,a=e.y-s;e.rotation=Math.atan2(a,i)}}checkCollisions(e,t,s){const i=this.collisionManager.checkProjectileCollision(e,t,s);return!(!i.hit||!i.impactPoint)&&(this.particleSystem.createExplosion(i.impactPoint.x,i.impactPoint.y),i.wasDestroyed&&i.targetShip&&this.particleSystem.createShipExplosion(i.targetShip),!0)}createMissMessage(e,t,s){const i=e.isEnemyProjectile?t:s,a=i.x+i.width/2+20,o=i.y;this.missMessages.push({x:a,y:o,text:"MISSED",life:120,maxLife:120,color:"#ff0000",fontSize:16,startTime:Date.now()}),console.log((e.isEnemyProjectile?"Enemy":"Player")+" torpedo missed!")}updateMissMessages(){this.missMessages=this.missMessages.filter(e=>(e.life--,e.life>0))}clear(){this.projectiles=[],this.missMessages=[],this.particleSystem.clear()}getProjectiles(){return[...this.projectiles,...this.particleSystem.getExplosionParticles()]}getMissMessages(){return this.missMessages}getShipExplosions(){return this.particleSystem.getShipExplosions()}}class a{constructor(){}checkProjectileCollision(e,t,s){const i=e.isEnemyProjectile?t:s;if(i.contains(e.x,e.y)){const t=i.takeDamage(e.damage);return{hit:!0,targetShip:i,wasDestroyed:t,impactPoint:{x:e.x,y:e.y}}}return{hit:!1}}checkShipCollision(e,t){const s=e.getBounds(),i=t.getBounds();return!(s.right<i.left||s.left>i.right||s.bottom<i.top||s.top>i.bottom)}checkPointInShip(e,t,s){return s.contains(e,t)}checkProjectileMiss(e){return e.progress>=1.5}}class o{constructor(e){this.assetManager=e,this.explosionParticles=[],this.shipExplosions=[]}createExplosion(e,t){this.assetManager.playExplosionSound();const s=[];for(let i=0;i<20;i++){const i={x:e+20*(Math.random()-.5),y:t+20*(Math.random()-.5),vx:4*(Math.random()-.5),vy:4*(Math.random()-.5),life:30,maxLife:30,size:3*Math.random()+1,type:"explosion"};this.explosionParticles.push(i),s.push(i)}return s}createShipExplosion(e){this.assetManager.playExplosionSound();const t={x:e.x,y:e.y,width:e.width,height:e.height,particles:[],startTime:Date.now(),duration:3e3,isPlayer:e.isPlayer};for(let s=0;s<80;s++){const s={x:e.x+(Math.random()-.5)*e.width,y:e.y+(Math.random()-.5)*e.height,vx:8*(Math.random()-.5),vy:8*(Math.random()-.5),life:60+120*Math.random(),maxLife:60+120*Math.random(),size:6*Math.random()+2,color:Math.random()<.5?"#ff6600":"#ffff00",type:"shipExplosion"};t.particles.push(s)}for(let s=0;s<3;s++)setTimeout(()=>{for(let i=0;i<30;i++){const i={x:e.x+(Math.random()-.5)*e.width*(1+.5*s),y:e.y+(Math.random()-.5)*e.height*(1+.5*s),vx:(Math.random()-.5)*(6-s),vy:(Math.random()-.5)*(6-s),life:40+80*Math.random(),maxLife:40+80*Math.random(),size:4*Math.random()+1,color:0===s?"#ff0000":1===s?"#ff6600":"#ffff00",type:"shipExplosion"};t.particles.push(i)}s<2&&this.assetManager.playExplosionSound()},500*s);this.shipExplosions.push(t),console.log((e.isPlayer?"Player":"Enemy")+" ship explosion created!")}update(){this.updateExplosionParticles(),this.updateShipExplosions()}updateExplosionParticles(){this.explosionParticles=this.explosionParticles.filter(e=>(e.x+=e.vx,e.y+=e.vy,e.life--,e.life>0))}updateShipExplosions(){this.shipExplosions.forEach(e=>{e.particles=e.particles.filter(e=>(e.x+=e.vx,e.y+=e.vy,e.life--,e.vy+=.1,e.vx*=.99,e.vy*=.99,e.life>0))}),this.shipExplosions=this.shipExplosions.filter(e=>Date.now()-e.startTime<e.duration&&e.particles.length>0)}updateQuantumParticles(e){if("quantum"===e.type&&e.particles){for(let t=0;t<3;t++)e.particles.push({x:e.x+10*(Math.random()-.5),y:e.y+10*(Math.random()-.5),vx:2*(Math.random()-.5),vy:2*(Math.random()-.5),life:30,maxLife:30});e.particles=e.particles.filter(e=>(e.x+=e.vx,e.y+=e.vy,e.life--,e.life>0))}}getExplosionParticles(){return this.explosionParticles}getShipExplosions(){return this.shipExplosions}clear(){this.explosionParticles=[],this.shipExplosions=[]}}class n{constructor(e,t){this.weaponSystem=e,this.lastShotTime=Date.now(),this.baseShootInterval=(null==t?void 0:t.baseShootInterval)||6e3,this.shootInterval=this.baseShootInterval,this.level=1}update(e,t,s){if(!s||!e.isAlive())return;const i=Date.now();i-this.lastShotTime>this.shootInterval&&(this.fireAtPlayer(e,t),this.lastShotTime=i)}fireAtPlayer(e,t){this.weaponSystem.fireEnemyWeapon(e,t,this.level)}setLevel(e){this.level=e,this.shootInterval=Math.max(800,this.baseShootInterval-300*(e-1)),console.log(`Enemy AI updated to Level ${e}! Firing rate: ${this.shootInterval}ms`)}getShootInterval(){return this.shootInterval}getLevel(){return this.level}reset(){this.lastShotTime=Date.now(),this.shootInterval=this.baseShootInterval,this.level=1}forceShot(e,t){this.fireAtPlayer(e,t),this.lastShotTime=Date.now()}setDifficulty(e){this.shootInterval=Math.max(500,this.baseShootInterval/e),console.log(`Enemy AI difficulty set to ${e}x! New firing rate: ${this.shootInterval}ms`)}}class l{constructor(){this.level=1,this.gameOver=!1,this.gameOverMessage="",this.levelCompleted=!1,this.gameStarted=!1,this.gamePaused=!1,this.callbacks=[]}onStateChange(e){this.callbacks.push(e)}notifyStateChange(){const e=this.getCurrentState();this.callbacks.forEach(t=>t(e))}startGame(){this.gameStarted=!0,this.gameOver=!1,this.gamePaused=!1,this.levelCompleted=!1,console.log("Game started!"),this.notifyStateChange()}pauseGame(){this.gameStarted&&!this.gameOver&&(this.gamePaused=!0,console.log("Game paused"),this.notifyStateChange())}resumeGame(){this.gameStarted&&!this.gameOver&&(this.gamePaused=!1,console.log("Game resumed"),this.notifyStateChange())}endGame(e){this.gameOver=!0,this.gameOverMessage=e,console.log(`Game Over: ${e}`),this.notifyStateChange()}completeLevel(){!this.gameOver&&this.gameStarted&&(this.levelCompleted=!0,console.log(`Level ${this.level} completed!`),this.notifyStateChange())}advanceToNextLevel(e,t,s,i,a){this.level++,this.levelCompleted=!1,e.reset({x:i/2,y:a-120,health:100,energy:100,direction:1}),t.levelUp(this.level),t.reset({x:i/2,y:90,health:t.maxHealth,direction:-1}),s.setLevel(this.level),console.log(`Advanced to Level ${this.level}! Enemy Health: ${t.maxHealth}`),this.notifyStateChange()}restartGame(e,t,s,i,a){this.gameOver=!1,this.gameOverMessage="",this.level=1,this.levelCompleted=!1,this.gameStarted=!1,this.gamePaused=!1,e.reset({x:i/2,y:a-120,health:100,energy:100,direction:1}),t.reset({x:i/2,y:90,health:100,direction:-1}),s.reset(),console.log("Game restarted!"),this.notifyStateChange()}checkVictoryCondition(e){return!(this.levelCompleted||!e.isDestroyed())&&(this.completeLevel(),!0)}checkDefeatCondition(e){return!(!e.isDestroyed()||this.gameOver)&&(this.endGame("MISSION FAILED"),!0)}getCurrentState(){return{level:this.level,gameOver:this.gameOver,gameOverMessage:this.gameOverMessage,levelCompleted:this.levelCompleted,gameStarted:this.gameStarted,gamePaused:this.gamePaused,canUpdate:this.gameStarted&&!this.gamePaused&&!this.gameOver,canUpdateProjectiles:this.gameStarted&&!this.gamePaused&&!this.gameOver}}getLevel(){return this.level}isGameActive(){return this.gameStarted&&!this.gameOver&&!this.gamePaused}isLevelCompleted(){return this.levelCompleted}isGameOver(){return this.gameOver}isGameStarted(){return this.gameStarted}isGamePaused(){return this.gamePaused}}class h{constructor(e,t){this.canvas=e;const s=e.getContext("2d");if(!s)throw new Error("Could not get 2D context from canvas");this.ctx=s,this.width=e.width,this.height=e.height,this.assetManager=t,this.stars=[],this.initializeStars()}initializeStars(){for(let e=0;e<200;e++)this.stars.push({x:Math.random()*this.width,y:Math.random()*this.height,size:2*Math.random()+.5,speed:.5*Math.random()+.1,brightness:.8*Math.random()+.2})}updateStars(){this.stars.forEach(e=>{e.y+=e.speed,e.y>this.height&&(e.y=0,e.x=Math.random()*this.width)})}render(e){this.ctx.fillStyle="#000",this.ctx.fillRect(0,0,this.width,this.height),this.drawStars(),this.assetManager.isLoaded()?(this.drawShips(e.playerShip,e.enemyShip),this.drawProjectiles(e.weaponSystem.getProjectiles()),this.drawMissMessages(e.weaponSystem.getMissMessages()),this.drawShipExplosions(e.weaponSystem.getShipExplosions()),e.gameOver&&this.drawGameOverScreen(e)):this.drawLoadingScreen()}drawLoadingScreen(){this.ctx.fillStyle="#00ff00",this.ctx.font="24px Courier New",this.ctx.textAlign="center",this.ctx.fillText("Loading Assets...",this.width/2,this.height/2),this.ctx.textAlign="left"}drawStars(){this.ctx.fillStyle="#ffffff",this.stars.forEach(e=>{this.ctx.globalAlpha=e.brightness,this.ctx.fillRect(e.x,e.y,e.size,e.size)}),this.ctx.globalAlpha=1}drawShips(e,t){if(e.isAlive()){const t=this.assetManager.getImage("playerShip");t&&t.complete?this.drawShipWithTransparency(t,e.x-e.width/2,e.y-e.height/2,e.width,e.height,"#00ffff"):(this.ctx.fillStyle="#00ff00",this.ctx.fillRect(e.x-e.width/2,e.y-e.height/2,e.width,e.height))}if(t.isAlive()){const e=this.assetManager.getImage("enemyShip");e&&e.complete?this.drawShipWithTransparency(e,t.x-t.width/2,t.y-t.height/2,t.width,t.height,"#ff6600"):(this.ctx.fillStyle="#ff0000",this.ctx.fillRect(t.x-t.width/2,t.y-t.height/2,t.width,t.height))}}drawShipWithTransparency(e,t,s,i,a,o){const n=`${e.src}_${i}_${a}`;this.processedImageCache||(this.processedImageCache=new Map);let l=this.processedImageCache.get(n);if(!l){l=document.createElement("canvas");const t=l.getContext("2d");l.width=i,l.height=a,t.drawImage(e,0,0,i,a);const s=t.getImageData(0,0,i,a),o=s.data;for(let e=0;e<o.length;e+=4){const t=o[e],s=o[e+1],i=o[e+2];(t+s+i)/3>200&&Math.abs(t-s)<30&&Math.abs(s-i)<30&&Math.abs(t-i)<30&&(o[e+3]=0)}t.putImageData(s,0,0),this.processedImageCache.set(n,l)}this.ctx.drawImage(l,t,s)}drawProjectiles(e){e.forEach(e=>{"phaser"===e.type||"enemy_phaser"===e.type?this.drawPhaserBeam(e):"explosion"===e.type?this.drawExplosionParticle(e):this.drawTorpedo(e)})}drawPhaserBeam(e){const t=1-(Date.now()-e.startTime)/e.duration,s=e.shooterShip.isEnemy,i=e.shooterShip.x,a=s?e.shooterShip.y+e.shooterShip.height/2:e.shooterShip.y-e.shooterShip.height/2,o=e.targetShip.x,n=e.targetShip.y,l="enemy_phaser"===e.type?"#00ff00":"#ff0000";this.ctx.globalAlpha=t,this.ctx.strokeStyle=l,this.ctx.lineWidth=4,this.ctx.shadowColor=l,this.ctx.shadowBlur=10,this.ctx.beginPath(),this.ctx.moveTo(i,a),this.ctx.lineTo(o,n),this.ctx.stroke(),this.ctx.shadowBlur=0,this.ctx.globalAlpha=1}drawExplosionParticle(e){const t=e.life/e.maxLife;this.ctx.globalAlpha=t,this.ctx.fillStyle=`hsl(${30+30*Math.random()}, 100%, 50%)`,this.ctx.fillRect(e.x,e.y,e.size,e.size),this.ctx.globalAlpha=1}drawTorpedo(e){e.trail&&(e.trail.forEach((t,s)=>{const i=s/e.trail.length*.5;this.ctx.globalAlpha=i,this.ctx.fillStyle=e.color,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,1.5,0,2*Math.PI),this.ctx.fill()}),this.ctx.globalAlpha=1),e.particles&&(e.particles.forEach(t=>{const s=t.life/t.maxLife;this.ctx.globalAlpha=s,this.ctx.fillStyle=e.color,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,1,0,2*Math.PI),this.ctx.fill()}),this.ctx.globalAlpha=1),this.ctx.fillStyle=e.color,this.ctx.shadowColor=e.color,this.ctx.shadowBlur=10;const t=Math.max(e.width,e.height)/2;this.ctx.beginPath(),this.ctx.arc(e.x,e.y,t,0,2*Math.PI),this.ctx.fill(),this.ctx.shadowBlur=5,this.ctx.fillStyle="rgba(255, 255, 255, 0.8)",this.ctx.beginPath(),this.ctx.arc(e.x,e.y,.4*t,0,2*Math.PI),this.ctx.fill(),this.ctx.shadowBlur=0}drawMissMessages(e){e.forEach(e=>{const t=e.life/e.maxLife;this.ctx.globalAlpha=t,this.ctx.fillStyle=e.color,this.ctx.font=`bold ${e.fontSize}px Courier New`,this.ctx.textAlign="left",this.ctx.shadowColor=e.color,this.ctx.shadowBlur=8,this.ctx.fillText(e.text,e.x,e.y),this.ctx.globalAlpha=1,this.ctx.shadowBlur=0,this.ctx.textAlign="left"})}drawShipExplosions(e){e.forEach(e=>{e.particles.forEach(e=>{const t=e.life/e.maxLife;this.ctx.globalAlpha=t,this.ctx.fillStyle=e.color||"#000000",this.ctx.shadowColor=e.color||"#000000",this.ctx.shadowBlur=8,this.ctx.beginPath(),this.ctx.arc(e.x,e.y,e.size||0,0,2*Math.PI),this.ctx.fill(),t>.5&&(this.ctx.fillStyle="#ffffff",this.ctx.globalAlpha=.8*t,this.ctx.beginPath(),this.ctx.arc(e.x,e.y,e.size||0,0,2*Math.PI),this.ctx.fill())})}),this.ctx.globalAlpha=1,this.ctx.shadowBlur=0}drawGameOverScreen(e){this.ctx.fillStyle="rgba(0, 0, 0, 0.8)",this.ctx.fillRect(0,0,this.width,this.height),this.ctx.fillStyle="#ff0000",this.ctx.font="bold 48px Courier New",this.ctx.textAlign="center",this.ctx.shadowColor="#ff0000",this.ctx.shadowBlur=15,this.ctx.fillText(e.gameOverMessage,this.width/2,this.height/2-40),this.ctx.fillStyle="#ffffff",this.ctx.font="24px Courier New",this.ctx.shadowColor="#ffffff",this.ctx.shadowBlur=8,this.ctx.fillText(`Hull Integrity: ${e.playerShip.health}%`,this.width/2,this.height/2+20),this.ctx.fillText(`Final Level Reached: ${e.level}`,this.width/2,this.height/2+60),this.ctx.fillStyle="#00ff00",this.ctx.font="20px Courier New",this.ctx.shadowColor="#00ff00",this.ctx.shadowBlur=10,this.ctx.fillText("Click RESTART to begin new mission",this.width/2,this.height/2+120),this.ctx.textAlign="left",this.ctx.shadowBlur=0}update(){this.updateStars()}}class r{constructor(){this.weaponCallbacks={},this.repairCallbacks={},this.gameCallbacks={},this.weaponConfigs={photon:25,phaser:50,quantum:50},this.initializeEventListeners()}initializeEventListeners(){this.weaponCallbacks={},this.repairCallbacks={},this.gameCallbacks={}}setWeaponCallbacks(e){this.weaponCallbacks=e;const t=document.getElementById("photonBtn"),s=document.getElementById("phaserBtn"),i=document.getElementById("quantumBtn");null==t||t.addEventListener("click",()=>this.fireWeapon("photon")),null==s||s.addEventListener("click",()=>this.fireWeapon("phaser")),null==i||i.addEventListener("click",()=>this.fireWeapon("quantum"))}setRepairCallbacks(e){this.repairCallbacks=e;const t=document.getElementById("repairHullBtn"),s=document.getElementById("repairEnergyBtn");null==t||t.addEventListener("click",()=>this.showMathChallenge("hull")),null==s||s.addEventListener("click",()=>this.showMathChallenge("energy"))}setGameCallbacks(e){this.gameCallbacks=e;const t=document.getElementById("restartBtn"),s=document.getElementById("continueBtn"),i=document.getElementById("startGameBtn");null==t||t.addEventListener("click",()=>{var e,t;null==(t=(e=this.gameCallbacks).restart)||t.call(e),this.hideRestartButton()}),null==s||s.addEventListener("click",()=>{var e,t;null==(t=(e=this.gameCallbacks).continue)||t.call(e),this.hideContinueButton()}),null==i||i.addEventListener("click",()=>{var e,t;return null==(t=(e=this.gameCallbacks).start)?void 0:t.call(e)})}fireWeapon(e){var t,s;null==(s=(t=this.weaponCallbacks).fire)||s.call(t,e);const i=document.getElementById(e+"Btn");null==i||i.classList.add("firing"),setTimeout(()=>null==i?void 0:i.classList.remove("firing"),500)}showMathChallenge(e){var t,s;null==(s=(t=this.repairCallbacks).show)||s.call(t,e)}updateUI(e){this.updateHealthBars(e),this.updateWeaponStatus(e.playerShip),this.updateLevelDisplay(e.level),this.updateEnemyLabel(e.level)}updateHealthBars(e){const t=document.querySelector(".hull-integrity");t&&(t.style.width=e.playerShip.health+"%");const s=document.querySelector(".energy-reserves");if(s){const t=e.playerShip.getEnergyPercent();s.style.width=t+"%"}const i=document.querySelector(".enemy-health");if(i){const t=e.enemyShip.getHealthPercent();i.style.width=t+"%"}}updateWeaponStatus(e){Object.keys(this.weaponConfigs).forEach(t=>{const s=document.getElementById(t+"Btn"),i=null==s?void 0:s.querySelector(".weapon-status"),a=this.weaponConfigs[t];e.hasEnergy(a)&&i&&s?(i.textContent="Ready",i.style.color="#00FF00",i.style.borderColor="#00FF00",i.style.backgroundColor="rgba(0, 255, 0, 0.1)",s.style.opacity="1",s.style.cursor="pointer"):i&&s&&(i.textContent="No Energy",i.style.color="#FF4444",i.style.borderColor="#FF4444",i.style.backgroundColor="rgba(255, 68, 68, 0.1)",s.style.opacity="0.6",s.style.cursor="not-allowed")})}updateLevelDisplay(e){const t=document.querySelector(".level-number");t&&(t.textContent=e.toString())}updateEnemyLabel(e){const t=document.querySelector(".enemy-label");t&&(t.textContent=`Enemy (Level ${e}):`)}showStartupScreen(){const e=document.getElementById("startupScreen"),t=document.getElementById("gameContainer");e&&(e.style.display="flex"),t&&(t.style.display="none")}showGameScreen(){const e=document.getElementById("startupScreen"),t=document.getElementById("gameContainer");e&&(e.style.display="none"),t&&(t.style.display="flex")}showRestartButton(){const e=document.getElementById("restartContainer");e&&(e.style.display="block")}hideRestartButton(){const e=document.getElementById("restartContainer");e&&(e.style.display="none")}showContinueButton(){const e=document.getElementById("continueContainer");e&&(e.style.display="block")}hideContinueButton(){const e=document.getElementById("continueContainer");e&&(e.style.display="none")}showWeaponsPanel(){const e=document.querySelector(".weapons-panel");e&&(e.style.display="block")}hideWeaponsPanel(){const e=document.querySelector(".weapons-panel");e&&(e.style.display="none")}reset(){this.hideRestartButton(),this.hideContinueButton(),this.showWeaponsPanel(),this.updateLevelDisplay(1),this.updateEnemyLabel(1);const e=document.querySelector(".hull-integrity"),t=document.querySelector(".energy-reserves"),s=document.querySelector(".enemy-health");e&&(e.style.width="100%"),t&&(t.style.width="100%"),s&&(s.style.width="100%")}showLoading(){console.log("Loading game assets...")}hideLoading(){console.log("Assets loaded, game ready!")}}class c{constructor(){const s=document.getElementById("gameCanvas");if(!s)throw new Error("Game canvas element not found");this.canvas=s,this.width=this.canvas.width,this.height=this.canvas.height,this.assetManager=new t,this.collisionManager=new a,this.particleSystem=new o(this.assetManager),this.mathChallenge=new e,this.weaponSystem=new i(this.assetManager,this.collisionManager,this.particleSystem),this.enemyAI=new n(this.weaponSystem),this.gameStateManager=new l,this.renderer=new h(this.canvas,this.assetManager),this.ui=new r,this.initializeShips(),this.initializeControls(),this.renderLoop()}initializeShips(){var e,t;this.playerShip=(e=this.width,t=this.height,new s({x:e/2,y:t-120,width:120,height:90,health:100,energy:100,maxEnergy:100,velocityX:.8,direction:1,minX:60,maxX:e-60,isPlayer:!0})),this.enemyShip=function(e,t,i=1){const a=100+25*(i-1);return new s({x:e/2,y:90,width:120,height:90,health:a,maxHealth:a,velocityX:.6,direction:-1,minX:60,maxX:e-60,isEnemy:!0})}(this.width,this.height,this.gameStateManager.getLevel())}initializeControls(){this.ui.setWeaponCallbacks({fire:e=>this.fireWeapon(e)}),this.ui.setRepairCallbacks({show:e=>this.showMathChallenge(e)}),this.ui.setGameCallbacks({start:()=>this.startGame(),restart:()=>this.restartGame(),continue:()=>this.continueToNextLevel()})}startGame(){this.ui.showGameScreen(),this.gameStateManager.startGame()}showMathChallenge(e){this.gameStateManager.isGameActive()&&!this.mathChallenge.isPanelOpen()&&(this.gameStateManager.pauseGame(),this.mathChallenge.showChallenge(e,e=>this.applyRepair(e),e=>this.applyPenalty(e),()=>this.closeMathPanel()))}applyRepair(e){"hull"===e?this.playerShip.repairHull():"energy"===e&&this.playerShip.rechargeEnergy()}applyPenalty(e){if("hull"===e){this.playerShip.takeDamage(1)&&(this.gameStateManager.endGame("MISSION FAILED"),this.ui.showRestartButton(),this.mathChallenge.closePanel(),console.log("Game Over due to penalty!"))}else"energy"===e&&(this.playerShip.consumeEnergy(1),console.log(`Penalty applied to energy! Energy: ${this.playerShip.energy}`))}closeMathPanel(){this.gameStateManager.resumeGame(),console.log("Math challenge closed, game resumed")}fireWeapon(e){this.gameStateManager.isGameActive()&&!this.gameStateManager.isLevelCompleted()&&this.weaponSystem.fireWeapon(e,this.playerShip,this.enemyShip)}updateShips(){this.gameStateManager.isGameActive()&&(this.playerShip.update(),this.enemyShip.update())}updateProjectiles(){if(!this.gameStateManager.isGameActive())return;const e=!this.gameStateManager.isLevelCompleted();this.enemyAI.update(this.enemyShip,this.playerShip,e),this.gameStateManager.checkDefeatCondition(this.playerShip)&&setTimeout(()=>{this.ui.showRestartButton()},1e3),this.weaponSystem.update(this.playerShip,this.enemyShip),this.gameStateManager.checkVictoryCondition(this.enemyShip)&&setTimeout(()=>{this.ui.showContinueButton()},1e3)}render(){const e=this.gameStateManager.getCurrentState(),t={level:e.level,gameOver:e.gameOver,gameOverMessage:e.gameOverMessage,playerShip:this.playerShip,enemyShip:this.enemyShip,weaponSystem:this.weaponSystem};this.renderer.render(t),this.ui.updateUI(t)}continueToNextLevel(){this.gameStateManager.advanceToNextLevel(this.playerShip,this.enemyShip,this.enemyAI,this.width,this.height),this.weaponSystem.clear()}restartGame(){this.mathChallenge.isPanelOpen()&&this.mathChallenge.closePanel(),this.gameStateManager.restartGame(this.playerShip,this.enemyShip,this.enemyAI,this.width,this.height),this.ui.showStartupScreen(),this.weaponSystem.clear(),this.ui.reset()}renderLoop(){this.renderer.update(),this.gameStateManager.isGameActive()&&(this.updateShips(),this.updateProjectiles()),this.render(),requestAnimationFrame(()=>this.renderLoop())}}window.addEventListener("load",()=>{new c});
//# sourceMappingURL=index.DMRTe3F7.js.map
